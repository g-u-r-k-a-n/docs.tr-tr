---
description: 'Hakkında daha fazla bilgi: Windows kimlik doğrulama hatalarını ayıklama'
title: Windows Kimlik Doğrulama Hatalarını Ayıklama
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: cfc8bf8ce9b9c5da3d9b25949321ed1ac2b62d98
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/06/2021
ms.locfileid: "99756493"
---
# <a name="debug-windows-authentication-errors"></a><span data-ttu-id="fa9a6-103">Windows kimlik doğrulama hatalarını ayıklama</span><span class="sxs-lookup"><span data-stu-id="fa9a6-103">Debug Windows authentication errors</span></span>

<span data-ttu-id="fa9a6-104">Windows kimlik doğrulamasını bir güvenlik mekanizması olarak kullanırken, güvenlik desteği sağlayıcısı arabirimi (SSPI) güvenlik süreçlerini işler.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-104">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="fa9a6-105">SSPI katmanında güvenlik hataları oluştuğunda, bunlar Windows Communication Foundation (WCF) ile ortaya çıkar.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-105">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="fa9a6-106">Bu konu, hataları tanılamanıza yardımcı olmak için bir çerçeve ve soru kümesi sağlar.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-106">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="fa9a6-107">Kerberos protokolüne genel bakış için bkz. [Kerberos açıklanıyor](/previous-versions/windows/it-pro/windows-2000-server/bb742516(v=technet.10)); SSPI 'ye genel bakış için bkz. [SSPI](/windows/win32/secauthn/sspi).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-107">For an overview of the Kerberos protocol, see [Kerberos Explained](/previous-versions/windows/it-pro/windows-2000-server/bb742516(v=technet.10)); for an overview of SSPI, see [SSPI](/windows/win32/secauthn/sspi).</span></span>  
  
 <span data-ttu-id="fa9a6-108">WCF, Windows kimlik doğrulaması için genellikle istemci ve hizmet arasında Kerberos karşılıklı kimlik doğrulaması gerçekleştiren *Negotiate* güvenlik desteği sağlayıcısı 'Nı (SSP) kullanır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-108">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="fa9a6-109">Kerberos protokolü kullanılamıyorsa, varsayılan olarak WCF, NT LAN Manager 'a (NTLM) geri döner.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-109">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="fa9a6-110">Ancak, WCF 'yi yalnızca Kerberos protokolünü kullanacak şekilde yapılandırabilirsiniz (ve Kerberos kullanılamıyorsa bir özel durum oluşturur).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-110">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="fa9a6-111">WCF 'yi, Kerberos protokolünün kısıtlı biçimlerini kullanacak şekilde de yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-111">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="fa9a6-112">Hata ayıklama yöntemi</span><span class="sxs-lookup"><span data-stu-id="fa9a6-112">Debugging Methodology</span></span>  

 <span data-ttu-id="fa9a6-113">Temel yöntem aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="fa9a6-113">The basic method is as follows:</span></span>  
  
1. <span data-ttu-id="fa9a6-114">Windows kimlik doğrulaması kullanıp kullanmayacağınızı belirleme.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-114">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="fa9a6-115">Başka bir düzen kullanıyorsanız, bu konu uygulanmaz.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-115">If you are using any other scheme, this topic does not apply.</span></span>  
  
2. <span data-ttu-id="fa9a6-116">Windows kimlik doğrulamasını kullandığınızdan eminseniz, WCF yapılandırmanızın Kerberos Direct veya Negotiate kullanıp kullanmadığını saptayın.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-116">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3. <span data-ttu-id="fa9a6-117">Yapılandırmanızın Kerberos protokolünü mi yoksa NTLM mi kullandığını belirledikten sonra, hata iletilerini doğru bağlamda anlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-117">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="fa9a6-118">Kerberos protokolünün ve NTLM 'nin kullanılabilirliği</span><span class="sxs-lookup"><span data-stu-id="fa9a6-118">Availability of the Kerberos Protocol and NTLM</span></span>  

 <span data-ttu-id="fa9a6-119">Kerberos SSP, Kerberos Anahtar Dağıtım Merkezi (KDC) olarak görev yapması için bir etki alanı denetleyicisi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-119">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="fa9a6-120">Kerberos protokolü yalnızca, istemci ve hizmet etki alanı kimliklerini kullanıyorsa kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-120">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="fa9a6-121">Diğer hesap birleşimlerinde, aşağıdaki tabloda özetlenen NTLM kullanılır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-121">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="fa9a6-122">Tablo üstbilgileri sunucu tarafından kullanılan olası hesap türlerini gösterir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-122">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="fa9a6-123">Sol sütunda istemci tarafından kullanılan olası hesap türleri görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-123">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="fa9a6-124">Yerel Kullanıcı</span><span class="sxs-lookup"><span data-stu-id="fa9a6-124">Local User</span></span>|<span data-ttu-id="fa9a6-125">Yerel Sistem</span><span class="sxs-lookup"><span data-stu-id="fa9a6-125">Local System</span></span>|<span data-ttu-id="fa9a6-126">Etki alanı kullanıcısı</span><span class="sxs-lookup"><span data-stu-id="fa9a6-126">Domain User</span></span>|<span data-ttu-id="fa9a6-127">Etki alanı makinesi</span><span class="sxs-lookup"><span data-stu-id="fa9a6-127">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="fa9a6-128">Yerel Kullanıcı</span><span class="sxs-lookup"><span data-stu-id="fa9a6-128">Local User</span></span>|<span data-ttu-id="fa9a6-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-129">NTLM</span></span>|<span data-ttu-id="fa9a6-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-130">NTLM</span></span>|<span data-ttu-id="fa9a6-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-131">NTLM</span></span>|<span data-ttu-id="fa9a6-132">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-132">NTLM</span></span>|  
|<span data-ttu-id="fa9a6-133">Yerel Sistem</span><span class="sxs-lookup"><span data-stu-id="fa9a6-133">Local System</span></span>|<span data-ttu-id="fa9a6-134">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-134">Anonymous NTLM</span></span>|<span data-ttu-id="fa9a6-135">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-135">Anonymous NTLM</span></span>|<span data-ttu-id="fa9a6-136">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-136">Anonymous NTLM</span></span>|<span data-ttu-id="fa9a6-137">Anonim NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-137">Anonymous NTLM</span></span>|  
|<span data-ttu-id="fa9a6-138">Etki alanı kullanıcısı</span><span class="sxs-lookup"><span data-stu-id="fa9a6-138">Domain User</span></span>|<span data-ttu-id="fa9a6-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-139">NTLM</span></span>|<span data-ttu-id="fa9a6-140">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-140">NTLM</span></span>|<span data-ttu-id="fa9a6-141">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fa9a6-141">Kerberos</span></span>|<span data-ttu-id="fa9a6-142">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fa9a6-142">Kerberos</span></span>|  
|<span data-ttu-id="fa9a6-143">Etki alanı makinesi</span><span class="sxs-lookup"><span data-stu-id="fa9a6-143">Domain Machine</span></span>|<span data-ttu-id="fa9a6-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-144">NTLM</span></span>|<span data-ttu-id="fa9a6-145">NTLM</span><span class="sxs-lookup"><span data-stu-id="fa9a6-145">NTLM</span></span>|<span data-ttu-id="fa9a6-146">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fa9a6-146">Kerberos</span></span>|<span data-ttu-id="fa9a6-147">Kerberos</span><span class="sxs-lookup"><span data-stu-id="fa9a6-147">Kerberos</span></span>|  
  
 <span data-ttu-id="fa9a6-148">Özellikle, dört hesap türü şunları içerir:</span><span class="sxs-lookup"><span data-stu-id="fa9a6-148">Specifically, the four account types include:</span></span>  
  
- <span data-ttu-id="fa9a6-149">Yerel Kullanıcı: yalnızca makine Kullanıcı profili.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-149">Local User: Machine-only user profile.</span></span> <span data-ttu-id="fa9a6-150">Örneğin: `MachineName\Administrator` veya `MachineName\ProfileName` .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-150">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
- <span data-ttu-id="fa9a6-151">Yerel Sistem: bir etki alanına katılmamış bir makinedeki yerleşik hesap SISTEMI.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-151">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
- <span data-ttu-id="fa9a6-152">Etki alanı kullanıcısı: Windows etki alanındaki bir kullanıcı hesabı.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-152">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="fa9a6-153">Örneğin: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-153">For example: `DomainName\ProfileName`.</span></span>  
  
- <span data-ttu-id="fa9a6-154">Etki alanı makinesi: bir Windows etki alanına katılmış bir makinede çalışan makine kimliğine sahip bir işlem.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-154">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="fa9a6-155">Örneğin: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-155">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="fa9a6-156">Hizmet kimlik bilgisi, <xref:System.ServiceModel.ICommunicationObject.Open%2A> <xref:System.ServiceModel.ServiceHost> sınıfının yöntemi çağrıldığında yakalanır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-156">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="fa9a6-157">İstemci bir ileti gönderdiğinde istemci kimlik bilgileri okundu.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-157">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="fa9a6-158">Yaygın Windows kimlik doğrulama sorunları</span><span class="sxs-lookup"><span data-stu-id="fa9a6-158">Common Windows Authentication Problems</span></span>  

 <span data-ttu-id="fa9a6-159">Bu bölümde bazı yaygın Windows kimlik doğrulama sorunları ve olası düzeltmeler açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-159">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="fa9a6-160">Kerberos protokolü</span><span class="sxs-lookup"><span data-stu-id="fa9a6-160">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="fa9a6-161">Kerberos protokolüyle SPN/UPN sorunları</span><span class="sxs-lookup"><span data-stu-id="fa9a6-161">SPN/UPN Problems with the Kerberos Protocol</span></span>  

 <span data-ttu-id="fa9a6-162">Windows kimlik doğrulaması kullanılırken ve Kerberos protokolü SSPI tarafından kullanıldığında veya anlaşılırsa, istemci uç noktasının kullandığı URL, hizmet URL 'SI içindeki hizmetin ana bilgisayarının tam etki alanı adını içermelidir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-162">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="fa9a6-163">Bu, hizmetin çalıştığı hesabın, bilgisayar Active Directory etki alanına eklendiğinde oluşturulan makine (varsayılan) hizmet asıl adı (SPN) anahtarına erişim sahibi olduğunu varsayar; bu, genellikle ağ hizmeti hesabı altında hizmeti çalıştırılarak yapılır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-163">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="fa9a6-164">Hizmetin, makine SPN anahtarına erişimi yoksa, istemcinin uç nokta kimliğinde hizmetin çalıştığı hesabın doğru SPN 'sini veya Kullanıcı asıl adını (UPN) sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-164">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="fa9a6-165">WCF 'nin SPN ve UPN ile nasıl çalıştığı hakkında daha fazla bilgi için bkz. [hizmet kimliği ve kimlik doğrulaması](service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-165">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="fa9a6-166">Web grupları veya Web bahçeleri gibi yük dengeleme senaryolarında, yaygın bir yöntem her bir uygulama için benzersiz bir hesap tanımlamak, bu hesaba bir SPN atamak ve tüm uygulama hizmetlerinin bu hesapta çalıştığından emin olmak içindir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-166">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="fa9a6-167">Hizmetinizin hesabı için bir SPN elde etmek üzere bir Active Directory etki alanı yöneticisi olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-167">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="fa9a6-168">Daha fazla bilgi için bkz. [Windows Için Kerberos teknik eki](/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-168">For more information, see [Kerberos Technical Supplement for Windows](/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="fa9a6-169">Kerberos protokolü doğrudan, hizmetin bir etki alanı makine hesabı altında çalışmasını gerektirir</span><span class="sxs-lookup"><span data-stu-id="fa9a6-169">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  

 <span data-ttu-id="fa9a6-170">Bu, `ClientCredentialType` özelliği olarak ayarlandığında `Windows` ve <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> özelliği `false` , aşağıdaki kodda gösterildiği gibi olarak ayarlandığında oluşur.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-170">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="fa9a6-171">Sorunu gidermek için, etki alanına katılmış bir makinede ağ hizmeti gibi bir etki alanı makine hesabı kullanarak hizmeti çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-171">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="fa9a6-172">Temsili kimlik bilgisi anlaşması gerektirir</span><span class="sxs-lookup"><span data-stu-id="fa9a6-172">Delegation Requires Credential Negotiation</span></span>  

 <span data-ttu-id="fa9a6-173">Kerberos kimlik doğrulama protokolünü temsilcisiyle birlikte kullanmak için, Kerberos protokolünü kimlik bilgisi anlaşmasına uygulamanız gerekir (bazen "Multi-BAI" veya "multi-step" Kerberos olarak adlandırılır).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-173">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="fa9a6-174">Kimlik bilgisi anlaşması olmadan Kerberos kimlik doğrulaması uygularsanız (bazen "tek bir görüntü" veya "tek seferlik" Kerberos olarak adlandırılır), bir özel durum oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-174">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="fa9a6-175">Kimlik bilgisi anlaşmasına sahip Kerberos uygulamak için aşağıdaki adımları uygulayın:</span><span class="sxs-lookup"><span data-stu-id="fa9a6-175">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1. <span data-ttu-id="fa9a6-176">' İ ayarlayarak temsilciyi <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> uygulayın <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-176">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2. <span data-ttu-id="fa9a6-177">SSPI anlaşması gerektir:</span><span class="sxs-lookup"><span data-stu-id="fa9a6-177">Require SSPI negotiation:</span></span>  
  
    1. <span data-ttu-id="fa9a6-178">Standart bağlamalar kullanıyorsanız, `NegotiateServiceCredential` özelliğini olarak ayarlayın `true` .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-178">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2. <span data-ttu-id="fa9a6-179">Özel Bağlamalar kullanıyorsanız, `AuthenticationMode` `Security` öğesinin özniteliğini olarak ayarlayın `SspiNegotiated` .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-179">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3. <span data-ttu-id="fa9a6-180">NTLM kullanımını engelleyerek SSPI anlaşmasının Kerberos kullanması gerekir:</span><span class="sxs-lookup"><span data-stu-id="fa9a6-180">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1. <span data-ttu-id="fa9a6-181">Aşağıdaki ifadesiyle kodda bunu yapın: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="fa9a6-181">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2. <span data-ttu-id="fa9a6-182">Ya da bunu yapılandırma dosyasında `allowNtlm` özniteliğini olarak ayarlayarak yapabilirsiniz `false` .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-182">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="fa9a6-183">Bu öznitelik içinde bulunur [\<windows>](../../configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md) .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-183">This attribute is contained in the [\<windows>](../../configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="fa9a6-184">NTLM protokolü</span><span class="sxs-lookup"><span data-stu-id="fa9a6-184">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="fa9a6-185">Negotiate SSP, NTLM 'ye geri döner, ancak NTLM devre dışı bırakılır</span><span class="sxs-lookup"><span data-stu-id="fa9a6-185">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  

 <span data-ttu-id="fa9a6-186"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A>Özelliği olarak ayarlanır `false` ve bu, NTLM kullanılıyorsa WINDOWS COMMUNICATION FOUNDATION (WCF) bir özel durum oluşturmak için en iyi çaba oluşturulmasına neden olur.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-186">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="fa9a6-187">Bu özelliğin olarak ayarlanması `false` , NTLM kimlik bilgilerinin kablo üzerinden gönderilmesini engelleyemeyebilir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-187">Setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="fa9a6-188">Aşağıda, NTLM 'ye geri dönüşü devre dışı bırakma gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-188">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="fa9a6-189">NTLM oturum açma başarısız</span><span class="sxs-lookup"><span data-stu-id="fa9a6-189">NTLM Logon Fails</span></span>  

 <span data-ttu-id="fa9a6-190">İstemci kimlik bilgileri hizmette geçerli değil.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-190">The client credentials are not valid on the service.</span></span> <span data-ttu-id="fa9a6-191">Kullanıcı adının ve parolanın doğru şekilde ayarlandığından ve hizmetin çalıştığı bilgisayar tarafından bilinen bir hesaba karşılık geldiğinden emin olun.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-191">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="fa9a6-192">NTLM, hizmetin bilgisayarında oturum açmak için belirtilen kimlik bilgilerini kullanır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-192">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="fa9a6-193">Kimlik bilgileri, istemcinin çalıştırıldığı bilgisayarda geçerli olabilir, ancak kimlik bilgileri hizmetin bilgisayarında geçerli değilse bu oturum açma işlemi başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-193">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="fa9a6-194">Anonim NTLM oturum açma oluşur, ancak anonim oturum açma Işlemleri varsayılan olarak devre dışıdır</span><span class="sxs-lookup"><span data-stu-id="fa9a6-194">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  

 <span data-ttu-id="fa9a6-195">Bir istemci oluştururken, <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> özelliği <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous> Aşağıdaki örnekte gösterildiği gibi olarak ayarlanır, ancak varsayılan olarak, sunucu anonim oturum açma işlemlerine izin vermez.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-195">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="fa9a6-196">Bu, sınıfının özelliğinin varsayılan değeri olduğu için oluşur <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> <xref:System.ServiceModel.Security.WindowsServiceCredential> `false` .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-196">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="fa9a6-197">Aşağıdaki istemci kodu anonim oturum açmaları etkinleştirmeye çalışır (varsayılan özelliğin olduğunu unutmayın `Identification` ).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-197">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="fa9a6-198">Aşağıdaki hizmet kodu, sunucu tarafından adsız oturum açmaları etkinleştirmek için varsayılan ayarı değiştirir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-198">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="fa9a6-199">Kimliğe bürünme hakkında daha fazla bilgi için bkz. [temsil ve kimliğe bürünme](delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="fa9a6-199">For more information about impersonation, see [Delegation and Impersonation](delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="fa9a6-200">Alternatif olarak, istemci yerleşik hesap SISTEMINI kullanarak bir Windows hizmeti olarak çalışır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-200">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="fa9a6-201">Diğer sorunlar</span><span class="sxs-lookup"><span data-stu-id="fa9a6-201">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="fa9a6-202">İstemci kimlik bilgileri doğru ayarlanmadı</span><span class="sxs-lookup"><span data-stu-id="fa9a6-202">Client Credentials Are Not Set Correctly</span></span>  

 <span data-ttu-id="fa9a6-203">Windows kimlik doğrulaması, <xref:System.ServiceModel.Security.WindowsClientCredential> sınıfının özelliği tarafından döndürülen örneğini kullanır <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> <xref:System.ServiceModel.ClientBase%601> <xref:System.ServiceModel.Security.UserNamePasswordClientCredential> .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-203">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="fa9a6-204">Aşağıda yanlış bir örnek gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-204">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="fa9a6-205">Aşağıda doğru örnek gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-205">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="fa9a6-206">SSPI kullanılamıyor</span><span class="sxs-lookup"><span data-stu-id="fa9a6-206">SSPI Is Not Available</span></span>  

 <span data-ttu-id="fa9a6-207">Aşağıdaki işletim sistemleri, sunucu olarak kullanıldığında Windows kimlik doğrulamasını desteklemez: Windows XP Home Edition, Windows XP Media Center Edition ve Windows Vista Home Edition.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-207">The following operating systems do not support Windows authentication when used as a server: Windows XP Home Edition, Windows XP Media Center Edition, and Windows Vista Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="fa9a6-208">Farklı kimliklerle geliştirme ve dağıtma</span><span class="sxs-lookup"><span data-stu-id="fa9a6-208">Developing and Deploying with Different Identities</span></span>  

 <span data-ttu-id="fa9a6-209">Uygulamanızı tek bir makinede geliştirir ve başka bir makineye dağıtırsanız ve her makinede kimlik doğrulamak için farklı hesap türleri kullanırsanız, farklı davranışlar yaşayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-209">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="fa9a6-210">Örneğin, bir Windows XP Pro makinesinde kimlik doğrulama modunu kullanarak uygulamanızı geliştirdiğinizi varsayalım `SSPI Negotiated` .</span><span class="sxs-lookup"><span data-stu-id="fa9a6-210">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="fa9a6-211">Kimlik doğrulaması için yerel bir kullanıcı hesabı kullanıyorsanız, NTLM protokolü kullanılacaktır.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-211">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="fa9a6-212">Uygulama geliştirildikten sonra, hizmeti bir etki alanı hesabı altında çalıştığı bir Windows Server 2003 makinesine dağıtırsınız.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-212">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="fa9a6-213">Bu noktada, istemci Kerberos ve bir etki alanı denetleyicisi kullandığından hizmetin kimliğini doğrulayamayacak.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-213">At this point, the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="fa9a6-214">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="fa9a6-214">See also</span></span>

- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="fa9a6-215">Temsilcilik ve Kimliğe Bürünme</span><span class="sxs-lookup"><span data-stu-id="fa9a6-215">Delegation and Impersonation</span></span>](delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="fa9a6-216">Desteklenmeyen Senaryolar</span><span class="sxs-lookup"><span data-stu-id="fa9a6-216">Unsupported Scenarios</span></span>](unsupported-scenarios.md)
