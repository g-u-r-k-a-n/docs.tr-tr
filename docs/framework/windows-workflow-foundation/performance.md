---
title: Windows Workflow Foundation 4 Performansı
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 5fec41baacca0f35618dd5bc409b88ac792ad125
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79182972"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="c34ca-102">Windows Workflow Foundation 4 Performansı</span><span class="sxs-lookup"><span data-stu-id="c34ca-102">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="c34ca-103">.NET Framework 4, Windows İş Akışı Vakfı'nın (WF) performansa ağır yatırımlarla büyük bir revizyonunu içerir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-103">.NET Framework 4 includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span> <span data-ttu-id="c34ca-104">Bu yeni revizyon, .NET Framework 3.0 ve .NET Framework 3.5'in bir parçası olarak gönderilen [!INCLUDE[wf1](../../../includes/wf1-md.md)] önceki sürümlerden önemli tasarım değişiklikleri sunar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-104">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and .NET Framework 3.5.</span></span> <span data-ttu-id="c34ca-105">Performans ve kullanılabilirliği büyük ölçüde artırmak için programlama modelinin, çalışma zamanının ve araçlamanın özünden yeniden şekillendirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-105">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="c34ca-106">Bu konu, bu düzeltmelerin önemli performans özelliklerini gösterir ve bunları önceki sürümle karşılaştırır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-106">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="c34ca-107">Bireysel iş akışı bileşeni performansı WF3 ve WF4 arasındaki büyüklük siparişleri ile artmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-107">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="c34ca-108">Bu, el kodlu Windows Communication Foundation (WCF) hizmetleri ile WCF iş akışı hizmetleri arasındaki boşluğu oldukça küçük bırakır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-108">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="c34ca-109">WF4'te iş akışı gecikmesi önemli ölçüde azaltıldı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-109">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="c34ca-110">Kalıcılık performansı 2,5 - 3,0 faktörüyle artmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-110">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="c34ca-111">İş akışı izleme yoluyla sistem durumu izleme nin önemli ölçüde daha az yükü vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-111">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="c34ca-112">Bunlar, uygulamalarınızda WF4'e geçiş yapmak veya benimsemek için zorlayıcı nedenlerdir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-112">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="c34ca-113">Terminoloji</span><span class="sxs-lookup"><span data-stu-id="c34ca-113">Terminology</span></span>

 <span data-ttu-id="c34ca-114">.NET [!INCLUDE[wf1](../../../includes/wf1-md.md)] Framework 4'te tanıtılan sürümü, bu konunun geri kalanı için WF4 olarak anılacaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-114">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in .NET Framework 4 will be referred to as WF4 for the rest of this topic.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="c34ca-115">.NET Framework 3.0'da tanıtıldı ve .NET Framework 3.5 SP1 üzerinden birkaç küçük revizyon yapıldı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-115">was introduced in .NET Framework 3.0 and had a few minor revisions through .NET Framework 3.5 SP1.</span></span> <span data-ttu-id="c34ca-116">İş Akışı Vakfı'nın .NET Framework 3.5 sürümü bu konunun geri kalanı için WF3 olarak anılacaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-116">The .NET Framework 3.5 version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="c34ca-117">WF3,.NET Framework 4'te WF4 ile yan yana gönderilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-117">WF3 is shipped in .NET Framework 4 side-by-side with WF4.</span></span> <span data-ttu-id="c34ca-118">WF3 yapılarını WF4'e geçirme hakkında daha fazla bilgi için bkz: [Windows İş Akışı Vakfı 4 Geçiş Kılavuzu.](migration-guidance.md)</span><span class="sxs-lookup"><span data-stu-id="c34ca-118">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](migration-guidance.md).</span></span>

 <span data-ttu-id="c34ca-119">Windows Communication Foundation (WCF), Microsoft'un hizmet odaklı uygulamalar oluşturmak için birleştirilmiş programlama modelidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-119">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="c34ca-120">İlk olarak .NET 3.0'ın bir parçası olarak WF3 ile birlikte tanıtıldı ve şimdi .NET Framework'ün temel bileşenlerinden biri.</span><span class="sxs-lookup"><span data-stu-id="c34ca-120">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="c34ca-121">Windows Server AppFabric, IIS'de çalışan Web ve bileşik uygulamaları oluşturmayı, ölçeklendirmeyi ve yönetmeyi kolaylaştıran bir dizi entegre teknolojidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-121">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="c34ca-122">Hizmetleri ve iş akışlarını izlemek ve yönetmek için araçlar sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-122">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="c34ca-123">Daha fazla bilgi için [Windows Server AppFabric 1.0'a](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10))bakın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-123">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="c34ca-124">Hedefler</span><span class="sxs-lookup"><span data-stu-id="c34ca-124">Goals</span></span>
 <span data-ttu-id="c34ca-125">Bu konunun amacı, farklı senaryolar için ölçülen verilerle WF4'ün performans özelliklerini göstermektir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-125">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="c34ca-126">Ayrıca WF4 ve WF3 arasında ayrıntılı karşılaştırmalar sağlar ve böylece bu yeni revizyon yapılmış büyük iyileştirmeler gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-126">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="c34ca-127">Bu makalede sunulan senaryolar ve veriler, WF4 ve WF3'ün farklı yönlerinin temel maliyetini ölçer.</span><span class="sxs-lookup"><span data-stu-id="c34ca-127">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="c34ca-128">Bu veriler WF4'ün performans özelliklerini anlamada yararlıdır ve WF3'ten WF4'e geçişlerin planlanmasında veya uygulama geliştirmede WF4'ün kullanılmasında yararlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-128">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="c34ca-129">Ancak, bu makalede sunulan verilerden elde edilen sonuçlara dikkat edilmelidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-129">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="c34ca-130">Bileşik iş akışı uygulamasının performansı, iş akışının nasıl uygulandığına ve farklı bileşenlerin nasıl entegre edildiğine bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-130">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="c34ca-131">Bu uygulamanın performans özelliklerini belirlemek için her uygulamayı ölçmek gerekir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-131">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="c34ca-132">WF4 Performans Geliştirmelerine Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="c34ca-132">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="c34ca-133">WF4, aşağıdaki bölümlerde açıklanan yüksek performans ve ölçeklenebilirlik ile özenle tasarlanmış ve uygulanmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-133">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="c34ca-134">WF Çalışma Süresi</span><span class="sxs-lookup"><span data-stu-id="c34ca-134">WF Runtime</span></span>
 <span data-ttu-id="c34ca-135">[!INCLUDE[wf1](../../../includes/wf1-md.md)] Çalışma zamanının özünde, bir iş akışındaki etkinliklerin yürütülmesini sağlayan eşzamanlı bir zamanlayıcı yer alan bir zamanlama yer alan bir programcıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-135">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="c34ca-136">Etkinlikler için performant, öngörülebilir bir yürütme ortamı sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-136">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="c34ca-137">Ortamın yürütme, devamı, tamamlanması, iptali, özel durumlar ve öngörülebilir bir iş parçacığı modeli için iyi tanımlanmış bir sözleşmesi vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-137">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="c34ca-138">WF3 ile karşılaştırıldığında, WF4 çalışma süresi daha verimli bir zamanlayıcıya sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-138">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="c34ca-139">Bu, toplu iş öğelerinin yürütülmesinde çok verimli olan WCF için kullanılan aynı G/Ç iş parçacığı havuzundan yararlanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-139">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="c34ca-140">İç iş öğesi zamanlayıcı sırası en yaygın kullanım desenleri için en iyi duruma getirilmiş.</span><span class="sxs-lookup"><span data-stu-id="c34ca-140">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="c34ca-141">WF4 çalışma süresi de en az eşitleme ve olay işleme mantığı ile çok hafif bir şekilde yürütme durumları yönetir, WF3 ağır olay kaydı ve devlet geçişleri için karmaşık senkronizasyon gerçekleştirmek için çağırma bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-141">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="c34ca-142">Veri Depolama ve Akış</span><span class="sxs-lookup"><span data-stu-id="c34ca-142">Data Storage and Flow</span></span>
 <span data-ttu-id="c34ca-143">WF3'te, bir etkinlikle ilişkili veriler, türe <xref:System.Windows.DependencyProperty>göre uygulanan bağımlılık özellikleri yle modellenir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-143">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="c34ca-144">Bağımlılık özelliği deseni Windows Sunu Temeli'nde (WPF) tanıtıldı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-144">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="c34ca-145">Genel olarak, bu desen kolay veri bağlama ve diğer UI özelliklerini desteklemek için çok esnektir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-145">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="c34ca-146">Ancak, desen özellikleri iş akışı tanımında statik alanlar olarak tanımlanmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-146">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="c34ca-147">[!INCLUDE[wf1](../../../includes/wf1-md.md)] Çalışma zamanı, özellik değerlerini her aldığında veya aldığında, ağırlıklı arama mantığı içerir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-147">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="c34ca-148">WF4, verilerin iş akışında nasıl işleneceğini büyük ölçüde iyileştirmek için net veri kapsam mantığı kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-148">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="c34ca-149">Bir etkinlikte depolanan verileri, değişkenler ve bağımsız değişkenler olmak üzere iki farklı kavram kullanarak etkinlik sınırları boyunca akan verilerden ayırır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-149">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="c34ca-150">Değişkenler ve "In/Out/InOut" bağımsız değişkenleri için açık bir hiyerarşik kapsam kullanılarak, etkinlikler için veri kullanım karmaşıklığı önemli ölçüde azalır ve verilerin ömrü de otomatik olarak kapsamlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-150">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="c34ca-151">Etkinlikler, bağımsız değişkenleri tarafından açıklanan iyi tanımlanmış bir imzaya sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-151">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="c34ca-152">Bir etkinliği inceleyerek hangi verilerin almayı beklediğini ve yürütülmesi sonucunda hangi verilerin üretileceğini belirleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c34ca-152">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="c34ca-153">WF3'te bir iş akışı oluşturulduğunda faaliyetler başharfe çevrildi.</span><span class="sxs-lookup"><span data-stu-id="c34ca-153">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="c34ca-154">WF 4'teki etkinlikler yalnızca ilgili etkinlikler yürütüldüğünde başolarak başolarak verilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-154">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="c34ca-155">Bu, yeni bir iş akışı örneği oluşturulduğunda Initialize/Uninitialize işlemleri gerçekleştirmeden daha basit bir etkinlik yaşam döngüsü sağlar ve böylece daha fazla verimlilik elde etmiştir</span><span class="sxs-lookup"><span data-stu-id="c34ca-155">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="c34ca-156">Denetim Akışı</span><span class="sxs-lookup"><span data-stu-id="c34ca-156">Control Flow</span></span>
 <span data-ttu-id="c34ca-157">Her programlama dilinde olduğu [!INCLUDE[wf1](../../../includes/wf1-md.md)] gibi, sıralama, döngü, dallanma ve diğer desenler için bir dizi denetim akışı aktivitesi sunarak iş akışı tanımları için denetim akışları için destek sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-157">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="c34ca-158">WF3'te, aynı etkinliğin yeniden yürütülmesi gerektiğinde, <xref:System.Workflow.ComponentModel.ActivityExecutionContext> yeni bir etkinlik oluşturulur ve etkinlik, <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>'ye dayalı ağır bir serileştirme ve deserialization mantığı ile klonlanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-158">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="c34ca-159">Genellikle yinelemeli denetim akışları için performans çok daha yavaş bir dizi etkinlik yürütme daha.</span><span class="sxs-lookup"><span data-stu-id="c34ca-159">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="c34ca-160">WF4 bu oldukça farklı işler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-160">WF4 handles this quite differently.</span></span> <span data-ttu-id="c34ca-161">Etkinlik şablonunu alır, yeni bir ActivityInstance nesnesi oluşturur ve zamanlayıcı sırasına ekler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-161">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="c34ca-162">Tüm bu işlem yalnızca açık nesne oluşturma içerir ve çok hafiftir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-162">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="c34ca-163">Zaman Uyumsuz Programlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-163">Asynchronous Programming</span></span>
 <span data-ttu-id="c34ca-164">Uygulamalar genellikle G/Ç veya dağıtılmış bilgi işlem işlemleri gibi uzun süreli engelleme işlemleri için eşzamanlı programlama ile daha iyi performans ve ölçeklenebilirlik sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-164">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="c34ca-165">WF4, temel etkinlik türleri <xref:System.Activities.AsyncCodeActivity>aracılığıyla eşzamanlı <xref:System.Activities.AsyncCodeActivity%601>destek sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-165">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="c34ca-166">Çalışma zamanı, eşzamanlı etkinlikleri yerel olarak anlar ve bu nedenle, eşzamanlı çalışma olağanüstüyken örneği otomatik olarak kalıcı olmayan bir bölgeye koyabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-166">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="c34ca-167">Özel etkinlikler, iş akışı zamanlayıcısı iş parçacığı tutmadan ve paralel olarak çalıştırmak mümkün olabilecek herhangi bir etkinlikleri engellemeden eşzamanlı çalışma gerçekleştirmek için bu tür tür türlerden türetebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c34ca-167">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="c34ca-168">Mesajlaşma</span><span class="sxs-lookup"><span data-stu-id="c34ca-168">Messaging</span></span>
 <span data-ttu-id="c34ca-169">Başlangıçta WF3 dış olaylar veya web hizmetleri çağrıları ile çok sınırlı mesajlaşma desteği vardı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-169">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="c34ca-170">.NET 3.5'te, iş akışları WCF istemcileri olarak uygulanabilir <xref:System.Workflow.Activities.SendActivity> veya <xref:System.Workflow.Activities.ReceiveActivity>WCF hizmetleri yoluyla ve .</span><span class="sxs-lookup"><span data-stu-id="c34ca-170">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="c34ca-171">WF4'te, iş akışı tabanlı mesajlaşma programlama kavramı, WCF mesajlaşma mantığının WF'ye sıkı entegrasyonu yla daha da güçlendirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-171">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="c34ca-172">.NET 4'te WCF'de sağlanan birleşik ileti işleme ardışık hattı, WF4 hizmetlerinin WF3'ten önemli ölçüde daha iyi performans ve ölçeklenebilirliğe sahip olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-172">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="c34ca-173">WF4 ayrıca karmaşık İleti Değişim Desenleri (MEPs) modelleyebilir zengin mesajlaşma programlama desteği sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="c34ca-174">Geliştiriciler, serileştirme maliyetleri ödemeden daha iyi performans elde etmek için kolay programlama veya yazılmamış hizmet sözleşmeleri elde etmek için yazılı hizmet sözleşmelerini kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-174">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="c34ca-175">WF4'te <xref:System.ServiceModel.Activities.SendMessageChannelCache> sınıf boyunca istemci tarafındaki kanal önbelleğe alma desteği, geliştiricilerin en az çabayla hızlı uygulamalar oluşturmasına yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-175">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="c34ca-176">Daha fazla bilgi için, [Etkinlikler Gönder için Önbellek Paylaşım Düzeylerini Değiştirme'ye](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-176">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="c34ca-177">Bildirimsel Programlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-177">Declarative Programming</span></span>
 <span data-ttu-id="c34ca-178">WF4, iş süreçlerini ve hizmetlerini modellemek için temiz ve basit bir bildirimsel programlama çerçevesi sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-178">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="c34ca-179">Programlama modeli, iş akışı yetkilendirmeyi büyük ölçüde basitleştirerek, hiçbir kod yanında olmayan, tam olarak bildirimsel etkinlik bileşimini destekler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-179">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="c34ca-180">.NET Framework 4'te, XAML tabanlı bildirimsel programlama çerçevesi, hem WPF hem de WF'yi desteklemek için tek montaj System.Xaml.dll'de birleştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-180">In .NET Framework 4, the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="c34ca-181">WF4'te XAML gerçekten açıklayıcı bir deneyim sağlar ve iş akışının tüm tanımının XML biçimlendirmesinde tanımlanmasına izin verir, etkinliklere ve .NET kullanılarak oluşturulmuş türlere başvurur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-181">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="c34ca-182">Bu özel kod arkası mantığı dahil olmadan XOML biçimi ile WF3 yapmak zordu.</span><span class="sxs-lookup"><span data-stu-id="c34ca-182">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="c34ca-183">.NET 4'teki yeni XAML yığını, iş akışı yapılarını serileştirme/deserializing'de çok daha iyi performansa sahiptir ve bildirimsel programlamayı daha çekici ve sağlam hale getirir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-183">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="c34ca-184">İş Akışı Tasarımcısı</span><span class="sxs-lookup"><span data-stu-id="c34ca-184">Workflow Designer</span></span>
 <span data-ttu-id="c34ca-185">WF4 için tam bildirimsel programlama desteği, büyük iş akışları için tasarım süresi performansı için daha yüksek gereksinimler açıkça uygular.</span><span class="sxs-lookup"><span data-stu-id="c34ca-185">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="c34ca-186">WF4'teki İş Akışı tasarımcısı, büyük iş akışları için WF3'ten çok daha iyi ölçeklenebilirliğe sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-186">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="c34ca-187">UI sanallaştırma desteği ile tasarımcı, WF3 tasarımcısıyla birkaç yüz aktiviteden oluşan bir iş akışını yüklemek neredeyse imkansızken, birkaç saniye içinde 1000 aktiviteden oluşan büyük bir iş akışını kolayca yükleyebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-187">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="c34ca-188">Bileşen düzeyinde Performans Karşılaştırmaları</span><span class="sxs-lookup"><span data-stu-id="c34ca-188">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="c34ca-189">Bu bölümde, WF3 ve WF4 iş akışlarındaki tek tek etkinlikler arasındaki doğrudan karşılaştırmalar hakkında veriler yer almaktadır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-189">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="c34ca-190">Kalıcılık gibi temel alanlar, performans üzerinde tek tek etkinlik bileşenlerine göre daha derin bir etkiye sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-190">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="c34ca-191">WF4'teki tek tek bileşenlerdeki performans iyileştirmeleri önemlidir, çünkü bileşenler artık elle kodlanmış orkestrasyon mantığıyla karşılaştırılacak kadar hızlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-191">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="c34ca-192">Bir sonraki bölümde ele alınan bir örnek: "Hizmet Kompozisyonu Senaryosu."</span><span class="sxs-lookup"><span data-stu-id="c34ca-192">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c34ca-193">Ortamı Ayarlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-193">Environment Setup</span></span>
 ![İş akışı performans ölçümü için ortam kurulumu](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="c34ca-195">Yukarıdaki şekil, bileşen düzeyinde performans ölçümü için kullanılan makine yapılandırmasını gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-195">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="c34ca-196">Tek bir sunucu ve beş istemci bir 1 Gbps Ethernet ağ arabirimi üzerinden bağlanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-196">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="c34ca-197">Kolay ölçümler için sunucu, Windows Server 2008 x86 çalıştıran çift proc/dört çekirdekli sunucunun tek bir çekirdeğini kullanacak şekilde yapılandırılmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-197">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="c34ca-198">Sistem CPU kullanımı yaklaşık% 100 korunur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-198">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="c34ca-199">Test Detayları</span><span class="sxs-lookup"><span data-stu-id="c34ca-199">Test Details</span></span>
 <span data-ttu-id="c34ca-200">WF3 <xref:System.Workflow.Activities.CodeActivity> büyük olasılıkla bir WF3 iş akışında kullanılabilecek en basit etkinliktir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-200">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="c34ca-201">Etkinlik, iş akışı programcısının özel kodu koyabileceği kod arkasında bir yöntem çağırır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-201">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="c34ca-202">WF4'te, aynı işlevselliği sağlayan WF3'e <xref:System.Workflow.Activities.CodeActivity> doğrudan analog yoktur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-202">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="c34ca-203">WF4'te <xref:System.Activities.CodeActivity> WF3 <xref:System.Workflow.Activities.CodeActivity>ile ilgili olmayan bir taban sınıf olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-203">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="c34ca-204">İş akışı yazarlarının özel etkinlikler oluşturması ve yalnızca XAML iş akışları oluşturması teşvik edilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-204">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="c34ca-205">Aşağıdaki testlerde, WF4 iş akışlarında `Comment` <xref:System.Workflow.Activities.CodeActivity> boş bir boş yerine bir etkinlik kullanılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-205">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="c34ca-206">Etkinlikteki `Comment` kod aşağıdaki gibidir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-206">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="c34ca-207">Boş İş Akışı</span><span class="sxs-lookup"><span data-stu-id="c34ca-207">Empty Workflow</span></span>
 <span data-ttu-id="c34ca-208">Bu test, alt etkinlik olmayan bir dizi iş akışı kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-208">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="c34ca-209">Tek Etkinlik</span><span class="sxs-lookup"><span data-stu-id="c34ca-209">Single Activity</span></span>
 <span data-ttu-id="c34ca-210">İş akışı, bir alt etkinlik içeren bir dizi iş akışıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-210">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="c34ca-211">Etkinlik, <xref:System.Workflow.Activities.CodeActivity> WF3 örneğinde kod olmayan ve `Comment` WF4 durumunda ki bir etkinliktir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-211">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="c34ca-212">1000 Yinelemeli iken</span><span class="sxs-lookup"><span data-stu-id="c34ca-212">While with 1000 Iterations</span></span>
 <span data-ttu-id="c34ca-213">Sıra iş akışı, <xref:System.Activities.Statements.While> döngüde herhangi bir çalışma gerçekleştirmeyen bir alt etkinlik içeren bir etkinlik içerir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-213">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="c34ca-214">ParallelForEach ile karşılaştırıldığında çoğaltıcı</span><span class="sxs-lookup"><span data-stu-id="c34ca-214">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="c34ca-215"><xref:System.Workflow.Activities.ReplicatorActivity>WF3 sıralı ve paralel yürütme modları vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="c34ca-216">Sıralı modda, etkinliğin performansı <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="c34ca-216">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="c34ca-217">Paralel <xref:System.Workflow.Activities.ReplicatorActivity> yürütme için en yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-217">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="c34ca-218">Bunun için WF4 analog <xref:System.Activities.Statements.ParallelForEach%601> faaliyettir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-218">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="c34ca-219">Aşağıdaki diyagram, bu test için kullanılan iş akışlarını gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-219">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="c34ca-220">WF3 iş akışı solda, WF4 iş akışı sağdadır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-220">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 ÇoğalıcıAktivite ve WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="c34ca-222">Beş Etkinlikli Sıralı İş Akışı</span><span class="sxs-lookup"><span data-stu-id="c34ca-222">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="c34ca-223">Bu test, sırayla yürütülmesi birkaç etkinlik olan etkisini göstermek içindir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-223">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="c34ca-224">Dizide beş etkinlik vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-224">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="c34ca-225">İşlem Kapsamı</span><span class="sxs-lookup"><span data-stu-id="c34ca-225">Transaction Scope</span></span>
 <span data-ttu-id="c34ca-226">Her yineleme için yeni bir iş akışı örneği oluşturulmamasına göre, işlem kapsamı sınaması diğer testlerden biraz farklıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-226">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="c34ca-227">Bunun yerine, iş akışı, hiçbir iş <xref:System.Activities.Statements.TransactionScope> yok tek bir etkinlik içeren bir aktivite içeren bir while döngüsü ile yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-227">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="c34ca-228">While döngüsü boyunca 50 yinelemeden oluşan bir toplu işlemin her çalışması tek bir işlem olarak sayılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-228">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="c34ca-229">Dengeleme</span><span class="sxs-lookup"><span data-stu-id="c34ca-229">Compensation</span></span>
 <span data-ttu-id="c34ca-230">WF3 iş akışı adlı `WorkScope`tek bir telafi edici etkinlik vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-230">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="c34ca-231">Etkinlik yalnızca <xref:System.Workflow.ComponentModel.ICompensatableActivity> arabirimi uygular:</span><span class="sxs-lookup"><span data-stu-id="c34ca-231">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="c34ca-232">Hata işleyicisi `WorkScope` etkinliği hedefler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-232">The fault handler targets the `WorkScope` activity.</span></span> <span data-ttu-id="c34ca-233">WF4 iş akışı eşit derecede basittir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-233">The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="c34ca-234">A'nın <xref:System.Activities.Statements.CompensableActivity> bir gövdesi ve bir tazminat işleyicisi vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-234">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="c34ca-235">Sırada açık bir telafi sonraki sıradadır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-235">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="c34ca-236">Gövde aktivitesi ve tazminat işleyicisi etkinliği her ikisi de boş uygulamalardır:</span><span class="sxs-lookup"><span data-stu-id="c34ca-236">The body activity and compensation handler activity are both empty implementations:</span></span>

```csharp
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="c34ca-237">Aşağıdaki diyagram, temel kompanzasyon iş akışını gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-237">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="c34ca-238">WF3 iş akışı solda, WF4 iş akışı sağdadır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-238">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![WF3 ve WF4 temel kompanzasyon iş akışları](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="c34ca-240">Performans Testi Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-240">Performance Test Results</span></span>

 ![Performans testi sonuçları verilerini gösteren tablo](./media/performance/performance-test-data.gif)

 ![WF3 ve WF4 performans testi verilerini karşılaştıran sütun grafiği](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="c34ca-243">Tüm testler, işlem kapsamı testi dışında saniyede iş akışları cinsinden ölçülür.</span><span class="sxs-lookup"><span data-stu-id="c34ca-243">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="c34ca-244">Yukarıda da görüleceği [!INCLUDE[wf1](../../../includes/wf1-md.md)] gibi, çalışma zamanı performansı, özellikle while döngüsü gibi aynı etkinliğin birden fazla yürütülmesini gerektiren alanlarda, yönetim kurulu genelinde iyileşmiştir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-244">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="c34ca-245">Hizmet Kompozisyonu Senaryosu</span><span class="sxs-lookup"><span data-stu-id="c34ca-245">Service Composition Scenario</span></span>
 <span data-ttu-id="c34ca-246">Önceki bölümde gösterildiği gibi, "Bileşen düzeyinde Performans Karşılaştırmaları," WF3 ve WF4 arasında genel olarak önemli bir azalma olmuştur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-246">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="c34ca-247">WCF iş akışı hizmetleri artık neredeyse elle kodlanmış WCF hizmetlerinin performansıyla eşleşebilir, ancak çalışma süresinin [!INCLUDE[wf1](../../../includes/wf1-md.md)] tüm avantajlarına sahip olabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-247">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="c34ca-248">Bu test senaryosu, WCF hizmetini WF4'teki bir WCF iş akışı hizmetiyle karşılaştırır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-248">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="c34ca-249">Online Mağaza Hizmeti</span><span class="sxs-lookup"><span data-stu-id="c34ca-249">Online Store Service</span></span>
 <span data-ttu-id="c34ca-250">Windows İş Akışı Temeli'nin güçlü yanlarından biri, çeşitli hizmetleri kullanarak işlem oluşturabilmektir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-250">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="c34ca-251">Bu örnekte, sipariş satın almak için iki servis çağrısı düzenleyen bir çevrimiçi mağaza hizmeti vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-251">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="c34ca-252">İlk adım, sipariş doğrulama hizmetini kullanarak siparişi doğrulamaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-252">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="c34ca-253">İkinci adım, ambar hizmetini kullanarak siparişi doldurmaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-253">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="c34ca-254">İki arka uç hizmeti, Sipariş Doğrulama Hizmeti ve Ambar Hizmeti, her iki test için de aynı kalır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-254">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="c34ca-255">Değişen bölüm, orkestrasyonu gerçekleştiren Çevrimiçi Mağaza Hizmeti'dir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-255">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="c34ca-256">Bir durumda, hizmet wcf hizmeti olarak elle kodlanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-256">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="c34ca-257">Diğer durumda, hizmet WF4'te WCF iş akışı hizmeti olarak yazılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-257">For the other case, the service is written as a WCF workflow service in WF4.</span></span> [!INCLUDE[wf1](../../../includes/wf1-md.md)]<span data-ttu-id="c34ca-258">-izleme ve kalıcılık gibi belirli özellikler bu test için kapatılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-258">-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="c34ca-259">Ortam</span><span class="sxs-lookup"><span data-stu-id="c34ca-259">Environment</span></span>
![Performans ölçümü için ortam kurulumu](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="c34ca-261">İstemci istekleri, birden çok bilgisayardan HTTP aracılığıyla Çevrimiçi Mağaza Hizmeti'ne yapılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-261">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="c34ca-262">Tek bir bilgisayar üç hizmeti de barındırabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-262">A single computer hosts all three services.</span></span>  <span data-ttu-id="c34ca-263">Çevrimiçi Mağaza Hizmeti ile arka uç hizmetleri arasındaki aktarım katmanı TCP veya HTTP'dir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-263">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="c34ca-264">İşlemlerin/saniyelerin ölçümü, Çevrimiçi Mağaza `PurchaseOrder` Hizmeti'ne yapılan tamamlanmış arama ların sayısına bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-264">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="c34ca-265">Kanal havuzu WF4'te kullanılabilen yeni bir özelliktir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-265">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="c34ca-266">Bu test kanalı havuzunun WCF bölümünde kutudan dışarı sağlanamamaktadır, bu nedenle Çevrimiçi Mağaza Hizmeti'nde basit bir havuzlama tekniğinin elle kodlanmış bir uygulaması kullanılmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-266">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="c34ca-267">Performans</span><span class="sxs-lookup"><span data-stu-id="c34ca-267">Performance</span></span>
![Çevrimiçi Mağaza Hizmeti performansını gösteren sütun grafiği](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="c34ca-269">Kanal havuzu olmadan arka uç TCP hizmetlerine [!INCLUDE[wf1](../../../includes/wf1-md.md)] bağlanan hizmet, iş yaratma üzerinde %17,2'lik bir etkiye sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-269">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="c34ca-270">Kanal havuzu ile, ceza yaklaşık% 23,8 olduğunu.</span><span class="sxs-lookup"><span data-stu-id="c34ca-270">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="c34ca-271">HTTP için, etkisi çok daha azdır: 4.3% havuzlama olmadan ve% 8.1 havuzlama ile.</span><span class="sxs-lookup"><span data-stu-id="c34ca-271">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="c34ca-272">Ayrıca, http kullanırken kanal havuzu çok az fayda sağladığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-272">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="c34ca-273">WF4 çalışma zamanından genel olarak bu testte elle kodlanmış bir WCF hizmetiyle karşılaştırıldığında, en kötü durum senaryosu olarak kabul edilebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-273">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="c34ca-274">Bu testte iki arka uç hizmetleri çok az iş yapmak.</span><span class="sxs-lookup"><span data-stu-id="c34ca-274">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="c34ca-275">Gerçek bir uçtan uca senaryoda, bu hizmetler veritabanı çağrıları gibi daha pahalı işlemler gerçekleştirerek aktarım katmanının performans etkisini daha az önemli hale getirir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-275">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="c34ca-276">Bu ve WF4'te bulunan özelliklerin avantajları, İş Akışı Vakfı'nı orkestrasyon hizmetleri oluşturmak için uygun bir seçim haline getirir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-276">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="c34ca-277">Önemli Performans Hususları</span><span class="sxs-lookup"><span data-stu-id="c34ca-277">Key Performance Considerations</span></span>
 <span data-ttu-id="c34ca-278">Bu bölümdeki özellik alanları, interop hariç, WF3 ve WF4 arasında önemli ölçüde değişti.</span><span class="sxs-lookup"><span data-stu-id="c34ca-278">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="c34ca-279">Bu, iş akışı uygulamalarının tasarımını ve performansı etkiler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-279">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="c34ca-280">İş Akışı Etkinleştirme Gecikmesi</span><span class="sxs-lookup"><span data-stu-id="c34ca-280">Workflow Activation Latency</span></span>
 <span data-ttu-id="c34ca-281">WCF iş akışı hizmeti uygulamasında, yeni bir iş akışı başlatma veya varolan bir iş akışını yükleme gecikmesi, engelleyici olabileceğinden önemlidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-281">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="c34ca-282">Bu test çalışması, tipik bir senaryoda wf4 XAMLX ana bilgisayara karşı bir WF3 XOML ana bilgisayarölçer.</span><span class="sxs-lookup"><span data-stu-id="c34ca-282">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="c34ca-283">Ortamı Ayarlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-283">Environment Setup</span></span>
 ![Gecikme ve iş sonu testleri için ortam kurulumu](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="c34ca-285">Test Kurulumu</span><span class="sxs-lookup"><span data-stu-id="c34ca-285">Test Setup</span></span>
 <span data-ttu-id="c34ca-286">Senaryoda, istemci bilgisayar bağlam tabanlı korelasyon kullanarak bir WCF iş akışı hizmetiyle bağlantı kurur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-286">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="c34ca-287">Bağlam bağıntısı özel bir bağlam bağlama gerektirir ve iletileri doğru iş akışı örneğiyle ilişkilendirmek için bir bağlam üstbilgisi veya çerez kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-287">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="c34ca-288">İleti gövdesinin ayrıştırılması gerekmesin diye, korelasyon Kimliğinin ileti üstbilgisinde bulunması nda bir performans avantajı vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-288">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="c34ca-289">Hizmet, istekle birlikte yeni bir iş akışı oluşturur ve gecikme ölçüsünün iş akışını çalıştırmak için harcanan zamanı içermemesi için anında yanıt gönderir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-289">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="c34ca-290">WF3 iş akışı, kod arkası xoml'dir ve WF4 iş akışı tamamen XAML'dir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-290">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="c34ca-291">WF4 iş akışı aşağıdaki gibi görünür:</span><span class="sxs-lookup"><span data-stu-id="c34ca-291">The WF4 workflow looks like this:</span></span>

 ![WF4 Korelasyon Kapsamı iş akışı](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="c34ca-293">Etkinlik <xref:System.ServiceModel.Activities.Receive> iş akışı örneğini oluşturur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-293">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="c34ca-294">Alınan iletide geçirilen bir değer yanıt iletisinde yankılanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-294">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="c34ca-295">Yanıtı izleyen bir sıra, iş akışının geri kalanını içerir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-295">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="c34ca-296">Yukarıdaki durumda, yalnızca bir yorum etkinliği gösterilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-296">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="c34ca-297">İş akışı karmaşıklığını simüle etmek için yorum etkinliklerinin sayısı değiştirilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-297">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="c34ca-298">Yorum etkinliği, hiçbir iş gerçekleştirmeden wf3'e <xref:System.Workflow.Activities.CodeActivity> eşdeğerdir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-298">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="c34ca-299">Yorum etkinliği hakkında daha fazla bilgi için, bu makalenin daha önceki "Bileşen Düzeyinde Performans Karşılaştırması" bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-299">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="c34ca-300">Test Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-300">Test Results</span></span>

 <span data-ttu-id="c34ca-301">WCF iş akışı hizmetleri için soğuk ve sıcak gecikme:</span><span class="sxs-lookup"><span data-stu-id="c34ca-301">Cold and warm latency for WCF workflow services:</span></span>

 ![WF3 ve WF4 kullanarak WCF iş akışı hizmetleri için soğuk ve sıcak gecikmeyi gösteren sütun grafiği](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="c34ca-303">Önceki grafikte, soğuk, verilen iş akışı için <xref:System.ServiceModel.WorkflowServiceHost> varolan bir durum olmadığı durumu ifade eder.</span><span class="sxs-lookup"><span data-stu-id="c34ca-303">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="c34ca-304">Başka bir deyişle, soğuk gecikme iş akışının ilk kez kullanılması ve XOML veya XAML'nin derlenmesine ihtiyaç olduğu zamandır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-304">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="c34ca-305">Sıcak gecikme süresi, iş akışı türü zaten derlenmişken yeni bir iş akışı örneği oluşturma zamanıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-305">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="c34ca-306">İş akışının karmaşıklığı WF4 durumunda çok az fark yaratır, ancak WF3 durumunda doğrusal bir ilerleme vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-306">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="c34ca-307">Korelasyon İşi</span><span class="sxs-lookup"><span data-stu-id="c34ca-307">Correlation Throughput</span></span>
 <span data-ttu-id="c34ca-308">WF4 yeni bir içerik tabanlı korelasyon özelliği sunar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-308">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="c34ca-309">WF3 yalnızca bağlam tabanlı korelasyon sağladı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-309">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="c34ca-310">Bağlam tabanlı korelasyon yalnızca belirli WCF kanal bağlamaları üzerinden yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-310">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="c34ca-311">İş akışı Kimliği, bu bağlamaları kullanırken ileti üstbilgisine eklenir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-311">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="c34ca-312">WF3 çalışma süresi yalnızca kimliğiyle bir iş akışını tanımlayabilir.  İçerik tabanlı korelasyonla, iş akışı yazarı hesap numarası veya müşteri Kimliği gibi ilgili bir veri parçasının korelasyon anahtarıoluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-312">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="c34ca-313">Bağlam tabanlı korelasyon, bağıntı anahtarının ileti üstbilgisinde bulunması açısından bir performans avantajına sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-313">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="c34ca-314">Anahtar, seri dışılaştırma/ileti kopyalama olmadan iletiden okunabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-314">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="c34ca-315">İçerik tabanlı korelasyonda, korelasyon anahtarı ileti gövdesinde depolanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-315">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="c34ca-316">Anahtarı bulmak için xpath ifadesi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-316">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="c34ca-317">Bu ek işlemin maliyeti iletinin boyutuna, gövdedeki anahtarın derinliğine ve anahtar sayısına bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-317">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="c34ca-318">Bu test bağlam ve içerik tabanlı korelasyon karşılaştırır ve aynı zamanda birden çok anahtar kullanırken performans bozulması gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-318">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="c34ca-319">Ortamı Ayarlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-319">Environment Setup</span></span>
![İş akışı performans testi için ortam kurulumu](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="c34ca-321">Test Kurulumu</span><span class="sxs-lookup"><span data-stu-id="c34ca-321">Test Setup</span></span>
<span data-ttu-id="c34ca-322">![Korelasyon İş Akışı Testi](./media/performance/correlation-throughput-workflow.gif "Korelasyon iş akışı testi kurulumu")</span><span class="sxs-lookup"><span data-stu-id="c34ca-322">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="c34ca-323">Önceki iş akışı [Kalıcılık](#persistence) bölümünde kullanılanla aynıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-323">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="c34ca-324">Kalıcılık olmadan korelasyon testleri için, çalışma zamanında yüklü hiçbir kalıcılık sağlayıcısı yoktur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-324">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="c34ca-325">Korelasyon iki yerde gerçekleşir: CreateOrder ve CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="c34ca-325">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="c34ca-326">Test Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-326">Test Results</span></span>
<span data-ttu-id="c34ca-327">![Korelasyon İşi](./media/performance/correlation-throughput-graph.gif "Korelasyon iş girdisi grafiği")</span><span class="sxs-lookup"><span data-stu-id="c34ca-327">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="c34ca-328">Bu grafik, içerik tabanlı korelasyonda kullanılan anahtar sayısı arttıkça performansta bir düşüş gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-328">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="c34ca-329">TCP ve HTTP arasındaki eğrilerde benzerlik, bu protokollerle ilişkili ek yükü gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-329">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="c34ca-330">Kalıcılık ile Korelasyon</span><span class="sxs-lookup"><span data-stu-id="c34ca-330">Correlation with Persistence</span></span>
 <span data-ttu-id="c34ca-331">Kalıcı bir iş akışıyla, içerik tabanlı korelasyondan CPU basıncı iş akışı çalışma zamanından SQL veritabanına geçer.</span><span class="sxs-lookup"><span data-stu-id="c34ca-331">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="c34ca-332">SQL kalıcılık sağlayıcısında depolanan yordamlar, uygun iş akışını bulmak için anahtarları eşleştirme işini yapar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-332">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Korelasyon ve kalıcılık sonuçlarını gösteren çizgi grafiği](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="c34ca-334">Bağlam tabanlı korelasyon hala içerik tabanlı korelasyon daha hızlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-334">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="c34ca-335">Ancak, kalıcılık korelasyon daha performans üzerinde daha fazla etkisi olduğu gibi fark daha az belirgindir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-335">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="c34ca-336">Karmaşık İş Akışı İş Akışı</span><span class="sxs-lookup"><span data-stu-id="c34ca-336">Complex Workflow Throughput</span></span>
 <span data-ttu-id="c34ca-337">İş akışının karmaşıklığı yalnızca etkinlik sayısıyla ölçülmez.</span><span class="sxs-lookup"><span data-stu-id="c34ca-337">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="c34ca-338">Kompozit aktiviteler birçok çocuk içerebilir ve bu çocuklar da kompozit aktiviteler olabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-338">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="c34ca-339">İç içe geçme düzeylerinin sayısı arttıkça, şu anda yürütme durumunda olabilecek etkinlik sayısı ve durum içinde olabilecek değişken lerin sayısı da artar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-339">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="c34ca-340">Bu test, karmaşık iş akışları çalıştırırken WF3 ve WF4 arasındaki iş akışını karşılaştırır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-340">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="c34ca-341">Test Kurulumu</span><span class="sxs-lookup"><span data-stu-id="c34ca-341">Test Setup</span></span>
 <span data-ttu-id="c34ca-342">Bu testler Windows Server 2008 x64 çalıştıran 4GB RAM ile bir Intel Xeon X5355 @ 2.66GHz 4 yönlü bilgisayarda yürütülmüştür.</span><span class="sxs-lookup"><span data-stu-id="c34ca-342">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="c34ca-343">Test kodu, %100 CPU kullanımına ulaşmak için çekirdek başına tek bir iş parçacığı yla tek bir işlemde çalışır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-343">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="c34ca-344">Bu test için oluşturulan iş akışlarıiki ana değişkene sahiptir: her dizideki etkinlik derinliği ve sayısı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-344">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="c34ca-345">Her derinlik düzeyi paralel bir etkinlik içerirken döngü, kararlar, atamalar ve diziler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-345">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="c34ca-346">Aşağıda resimde bulunan WF4 tasarımcısında, üst düzey akış grafiği resmedilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-346">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="c34ca-347">Her akış şeması aktivitesi ana akış şemasına benzer.</span><span class="sxs-lookup"><span data-stu-id="c34ca-347">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="c34ca-348">Derinliğitest parametreleri ile sınırlı olduğu bu iş akışını hayal ederken bir fraktal düşünmek yararlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-348">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="c34ca-349">Belirli bir testteki etkinlik sayısı, dizi başına etkinlik derinliği ve sayısına göre belirlenir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-349">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="c34ca-350">Aşağıdaki denklem WF4 testindeki etkinlik sayısını hesaplar:</span><span class="sxs-lookup"><span data-stu-id="c34ca-350">The following equation computes the number of activities in the WF4 test:</span></span>

 ![İşlem sayısını hesaplamak için denklem](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="c34ca-352">WF3 testinin etkinlik sayısı, ekstra bir dizi nedeniyle biraz daha farklı bir denklemle hesaplanabilir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-352">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![WF3 etkinliklerinin hesaplama numarasını hesaplamak için denklem](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="c34ca-354">D'nin derinliği ve a olduğu yer, dizi başına etkinlik sayısıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-354">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="c34ca-355">Bu denklemlerin arkasındaki mantık, a ile çarpılarak ilk sabitin dizi sayısı, ikinci sabitin ise geçerli düzeydeki statik etkinlik sayısı olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-355">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="c34ca-356">Her akış şemasında üç akış şeması çocuk aktivitesi vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-356">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="c34ca-357">Alt derinlik düzeyinde, bu akış şemaları boşama diğer düzeylerde ana akış şemasının kopyalarıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-357">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="c34ca-358">Her test varyasyonunun iş akışı tanımındaki etkinlik sayısı aşağıdaki tabloda gösterilir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-358">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Her testte kullanılan etkinlik sayısını gösteren bir tablo](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="c34ca-360">İş akışı tanımındaki etkinlik sayısı her derinlik düzeyiyle keskin bir şekilde artar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-360">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="c34ca-361">Ancak, belirli bir iş akışı örneğinde karar noktası başına yalnızca bir yol yürütülür, bu nedenle gerçek etkinliklerin yalnızca küçük bir alt kümesi yürütülür.</span><span class="sxs-lookup"><span data-stu-id="c34ca-361">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Karmaşık iş akışının akış şeması](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="c34ca-363">WF3 için eşdeğer bir iş akışı oluşturuldu.</span><span class="sxs-lookup"><span data-stu-id="c34ca-363">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="c34ca-364">WF3 tasarımcısı iç içe geçme yerine tasarım alanındaki tüm iş akışını gösterir, bu nedenle bu konuda görüntülenemeyecek kadar büyüktür.</span><span class="sxs-lookup"><span data-stu-id="c34ca-364">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="c34ca-365">İş akışının bir bölümü aşağıda gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-365">A snippet of the workflow is shown below.</span></span>

 ![WF3 iş akışının akış şeması](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="c34ca-367">Aşırı bir durumda iç içe geçme alıştırması yapmak için, bu testin bir parçası olan başka bir iş akışı 100 iç içe dizi kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-367">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="c34ca-368">En içteki sırada tek `Comment` <xref:System.Workflow.Activities.CodeActivity>veya .</span><span class="sxs-lookup"><span data-stu-id="c34ca-368">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![İç içe bir dizinin akış şeması](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="c34ca-370">İzleme ve kalıcılık bu testin bir parçası olarak kullanılmaz.</span><span class="sxs-lookup"><span data-stu-id="c34ca-370">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="c34ca-371">Test Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-371">Test Results</span></span>
 ![İş sonu performansı sonuçlarını gösteren sütun grafiği](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="c34ca-373">Çok sayıda derinliğe ve çok sayıda aktiviteye sahip karmaşık iş akışlarına rağmen, performans sonuçları bu makalede daha önce gösterilen diğer iş akışı numaralarıyla tutarlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-373">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="c34ca-374">WF4'ün iş letimatları daha hızlı büyüklüktedir ve logaritmik ölçekte karşılaştırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-374">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="c34ca-375">Bellek</span><span class="sxs-lookup"><span data-stu-id="c34ca-375">Memory</span></span>
 <span data-ttu-id="c34ca-376">Windows İş Akışı Temeli'nin bellek yükü iki temel alanda ölçülür: iş akışı karmaşıklığı ve iş akışı tanımlarının sayısı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-376">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="c34ca-377">Windows 7 64 bit iş istasyonunda bellek ölçümleri yapıldı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-377">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="c34ca-378">Performans sayaçlarını izleme, Environment.WorkingSet yoklama veya VMMap gibi bir aracı [VMMap'ten](/sysinternals/downloads/vmmap)temin edilebilen bir araç kullanma gibi çalışma kümesi boyutunun ölçümünü elde etmenin birçok yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-378">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="c34ca-379">Her testin sonuçlarını elde etmek ve doğrulamak için bir yöntem kombinasyonu kullanıldı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-379">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="c34ca-380">İş Akışı Karmaşıklığı Testi</span><span class="sxs-lookup"><span data-stu-id="c34ca-380">Workflow Complexity Test</span></span>
 <span data-ttu-id="c34ca-381">İş akışı karmaşıklığı testi, iş akışının karmaşıklığına bağlı olarak çalışma kümesi farkını ölçer.</span><span class="sxs-lookup"><span data-stu-id="c34ca-381">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="c34ca-382">Önceki bölümde kullanılan karmaşık iş akışlarına ek olarak, iki temel servis örneğini kapsayacak şekilde yeni varyasyonlar eklenir: tek bir etkinlik iş akışı ve 1000 aktiviteiçeren bir dizi.</span><span class="sxs-lookup"><span data-stu-id="c34ca-382">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="c34ca-383">Bu testler için iş akışları baş harfe getirilir ve bir dakika süreyle tek bir seri döngüiçinde tamamlanmak üzere çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-383">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="c34ca-384">Her test varyasyonu üç kez çalıştırılır ve kaydedilen veriler bu üç çalıştırmanın ortalamasıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-384">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="c34ca-385">İki yeni temel test, aşağıda gösterilengibi görünen iş akışlarına sahiptir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-385">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Hem WF3 hem de WF4 için karmaşık iş akışı](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="c34ca-387">Yukarıda gösterilen WF3 iş akışında boş <xref:System.Workflow.Activities.CodeActivity> etkinlikler kullanılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-387">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="c34ca-388">Yukarıdaki WF4 iş `Comment` akışı etkinlikleri kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-388">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="c34ca-389">Etkinlik, `Comment` bu makalenin daha önceki Bileşen düzeyinde performans karşılaştırmaları bölümünde açıklanmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-389">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![WF3 ve WF4 iş akışları için karmaşık iş akışı bellek kullanımını gösteren sütun grafiği](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="c34ca-391">Bu grafikte dikkat edilebilen açık eğilimlerden biri, iç içe geçmenin hem WF3 hem de WF4'te bellek kullanımı üzerinde nispeten en az etkiye sahip olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-391">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="c34ca-392">En önemli bellek etkisi, belirli bir iş akışındaki etkinlik sayısından gelir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-392">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="c34ca-393">1000 dizisi, karmaşık derinlik 5 sıra 5 ve karmaşık derinlik 7 sıra 1 varyasyonları verileri göz önüne alındığında, etkinlik sayısı binlerce girdikçe, bellek kullanım artışı daha belirgin hale olduğu açıktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-393">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="c34ca-394">~29K aktivitelerinin olduğu aşırı durumda (derinlik 7 sıra 1), WF4 WF3'e göre neredeyse %79 daha az bellek kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-394">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="c34ca-395">Çoklu İş Akışı Tanımları Testi</span><span class="sxs-lookup"><span data-stu-id="c34ca-395">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="c34ca-396">WF3 ve WF4'te iş akışlarını barındırmak için kullanılabilir seçenekler nedeniyle iş akışı başına bellek ölçümü iki farklı sına ayrılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-396">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="c34ca-397">Testler, belirli bir iş akışının örnekli olması ve tanım başına yalnızca bir kez yürütülmesinde iş akışı karmaşıklığı testinden farklı bir şekilde çalıştırılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-397">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="c34ca-398">Bunun nedeni, iş akışı tanımının ve ana bilgisayar ının AppDomain'in ömrü boyunca bellekte kalmasıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-398">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="c34ca-399">Belirli bir iş akışı örneğini çalıştırarak kullanılan bellek çöp toplama sırasında temizlenmelidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-399">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="c34ca-400">WF4 için geçiş kılavuzu barındırma seçenekleri hakkında daha ayrıntılı bilgi içerir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-400">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="c34ca-401">Daha fazla bilgi için [WF Migration Cookbook: Workflow Hosting'e](migration-guidance.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-401">For more information, see [WF Migration Cookbook: Workflow Hosting](migration-guidance.md).</span></span>

 <span data-ttu-id="c34ca-402">İş akışı tanımı sınaması için birçok iş akışı tanımı oluşturma çeşitli şekillerde yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-402">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="c34ca-403">Örneğin, ad dışında aynı olan 1000 iş akışı kümesi oluşturmak ve bu iş akışlarının her birini ayrı dosyalara kaydetmek için kod oluşturma kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="c34ca-403">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="c34ca-404">Bu yaklaşım konsol tarafından barındırılan test için alınmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-404">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="c34ca-405">WF3'te, <xref:System.Workflow.Runtime.WorkflowRuntime> sınıf iş akışı tanımlarını çalıştırmak için kullanıldı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-405">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="c34ca-406">WF4, tek <xref:System.Activities.WorkflowApplication> bir iş akışı örneği oluşturmak <xref:System.Activities.WorkflowInvoker> için veya etkinliği bir yöntem çağrısıymış gibi çalıştırmak için doğrudan kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-406">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="c34ca-407"><xref:System.Activities.WorkflowApplication>tek bir iş akışı örneğinin ana bilgisayarıdır <xref:System.Workflow.Runtime.WorkflowRuntime> ve bu testte kullanılan bu nedenle daha yakın özellik paritesi vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-407"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="c34ca-408">IIS'de iş akışlarını barındırırken, <xref:System.Web.Hosting.VirtualPathProvider> xamlx veya XOML dosyalarının tümünün oluşturulması yerine yeni <xref:System.ServiceModel.WorkflowServiceHost> bir iş oluşturmak için bir kullanmak mümkündür.</span><span class="sxs-lookup"><span data-stu-id="c34ca-408">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="c34ca-409">Gelen <xref:System.Web.Hosting.VirtualPathProvider> isteği işler ve veritabanından yüklenebilen veya bu durumda anında oluşturulan bir "sanal dosya" ile yanıt verir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-409">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="c34ca-410">Bu nedenle 1000 fiziksel dosya oluşturmak gereksizdir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-410">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="c34ca-411">Konsol testinde kullanılan iş akışı tanımları, tek bir etkinlikiçeren basit sıralı iş akışlarıydı.</span><span class="sxs-lookup"><span data-stu-id="c34ca-411">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="c34ca-412">Tek etkinlik WF3 durumda için boş <xref:System.Workflow.Activities.CodeActivity> `Comment` ve WF4 durumda için bir etkinlik oldu.</span><span class="sxs-lookup"><span data-stu-id="c34ca-412">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="c34ca-413">IIS tarafından barındırılan servis talebi, ileti almaya başlayan ve yanıt göndermeye son veren iş akışlarını kullandı:</span><span class="sxs-lookup"><span data-stu-id="c34ca-413">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="c34ca-414">Aşağıdaki resimde ReceiveActivity içeren bir WF3 iş akışı ve istek/yanıt deseni içeren bir WF4 iş akışı gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-414">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![WF3 ve WF4'te İş Akışı Hizmetleri](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="c34ca-416">Aşağıdaki tablo, tek bir iş akışı tanımı ve 1001 tanımları arasında çalışma kümesinde delta gösterir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-416">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="c34ca-417">Hosting Seçenekleri</span><span class="sxs-lookup"><span data-stu-id="c34ca-417">Hosting Options</span></span>|<span data-ttu-id="c34ca-418">WF3 Çalışma Seti Delta</span><span class="sxs-lookup"><span data-stu-id="c34ca-418">WF3 Working Set Delta</span></span>|<span data-ttu-id="c34ca-419">WF4 Çalışma Seti Delta</span><span class="sxs-lookup"><span data-stu-id="c34ca-419">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="c34ca-420">Konsol Uygulaması Barındırılan İş Akışları</span><span class="sxs-lookup"><span data-stu-id="c34ca-420">Console Application Hosted Workflows</span></span>|<span data-ttu-id="c34ca-421">18 MB</span><span class="sxs-lookup"><span data-stu-id="c34ca-421">18 MB</span></span>|<span data-ttu-id="c34ca-422">9 MB</span><span class="sxs-lookup"><span data-stu-id="c34ca-422">9 MB</span></span>|
|<span data-ttu-id="c34ca-423">IIS Hosted İş Akışı Hizmetleri</span><span class="sxs-lookup"><span data-stu-id="c34ca-423">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="c34ca-424">446 MB</span><span class="sxs-lookup"><span data-stu-id="c34ca-424">446 MB</span></span>|<span data-ttu-id="c34ca-425">364 MB</span><span class="sxs-lookup"><span data-stu-id="c34ca-425">364 MB</span></span>|

 <span data-ttu-id="c34ca-426">IIS'de iş akışı tanımlarını <xref:System.ServiceModel.WorkflowServiceHost>barındırmak, ayrıntılı WCF hizmet yapıları ve ana bilgisayarla ilişkili ileti işleme mantığı nedeniyle çok daha fazla bellek tüketir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-426">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="c34ca-427">WF3 konsol barındırma için iş akışları XOML yerine kod uygulanmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-427">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="c34ca-428">WF4'te varsayılan değer XAML kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-428">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="c34ca-429">XAML, derlemede gömülü bir kaynak olarak depolanır ve iş akışının uygulanmasını sağlamak için çalışma zamanı derlenir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-429">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="c34ca-430">Bu işlemle ilişkili bazı genel merkezler vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-430">There is some overhead associated with this process.</span></span>  <span data-ttu-id="c34ca-431">WF3 ve WF4 arasında adil bir karşılaştırma yapmak için XAML yerine kodlanmış iş akışları kullanılmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-431">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="c34ca-432">WF4 iş akışlarından birine bir örnek aşağıda gösterilmiştir:</span><span class="sxs-lookup"><span data-stu-id="c34ca-432">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="c34ca-433">Bellek tüketimini etkileyebilecek birçok faktör vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-433">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="c34ca-434">Yönetilen tüm programlar için aynı tavsiye hala geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-434">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="c34ca-435">IIS tarafından barındırılan <xref:System.ServiceModel.WorkflowServiceHost> ortamlarda, iş akışı tanımı için oluşturulan nesne, uygulama havuzu geri dönüştürülene kadar bellekte kalır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-435">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="c34ca-436">Uzantıları yazarken bu akılda tutulmalıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-436">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="c34ca-437">Ayrıca, "genel" değişkenlerden (tüm iş akışına göre kapsamlı değişkenler) kaçınmak ve değişkenlerin kapsamını mümkün olan her yerde sınırlamak en iyisidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-437">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="c34ca-438">İş Akışı Runtime Hizmetleri</span><span class="sxs-lookup"><span data-stu-id="c34ca-438">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="c34ca-439">Kalıcılık</span><span class="sxs-lookup"><span data-stu-id="c34ca-439">Persistence</span></span>
 <span data-ttu-id="c34ca-440">WF3 ve WF4 her iki gemi bir SQL kalıcılık sağlayıcısı ile.</span><span class="sxs-lookup"><span data-stu-id="c34ca-440">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="c34ca-441">WF3 SQL kalıcılık sağlayıcısı, iş akışı örneğini seri hale getiren ve bir blob'da depolayan basit bir uygulamadır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-441">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="c34ca-442">Bu nedenle, bu sağlayıcının performansı büyük ölçüde iş akışı örneğinin boyutuna bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-442">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="c34ca-443">WF3'te, bu makalede daha önce de ele alındığı gibi, örnek boyutu birçok nedenden dolayı artabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-443">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="c34ca-444">Bir veritabanında serileştirilmiş bir örneği depolamak iş akışının durumuna görünürlük vermediğinden, birçok müşteri varsayılan SQL kalıcılığı sağlayıcısını kullanmamayı tercih eder.</span><span class="sxs-lookup"><span data-stu-id="c34ca-444">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="c34ca-445">İş akışı kimliğini bilmeden belirli bir iş akışını bulmak için, kalıcı her örneği deserialize etmek ve içeriğini incelemek gerekir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-445">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="c34ca-446">Birçok geliştirici bu engeli aşmak için kendi kalıcılık sağlayıcıları yazmayı tercih.</span><span class="sxs-lookup"><span data-stu-id="c34ca-446">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="c34ca-447">WF4 SQL kalıcılık sağlayıcısı bu endişelerin bazılarını gidermeye çalışmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-447">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="c34ca-448">Kalıcılık tabloları, etkin yer imleri ve tanıtılabilir özellikler gibi belirli bilgileri ortaya çıkarır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-448">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="c34ca-449">WF4'teki yeni içerik tabanlı korelasyon özelliği, kalıcı iş akışı örneğinin organizasyonunda bazı değişikliklere yol açan WF3 SQL kalıcılık yaklaşımını kullanarak iyi performans gösteremez.</span><span class="sxs-lookup"><span data-stu-id="c34ca-449">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="c34ca-450">Bu kalıcılık sağlayıcının iş daha karmaşık hale getirir ve veritabanı üzerinde ekstra stres koyar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-450">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c34ca-451">Ortamı Ayarlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-451">Environment Setup</span></span>
![İş akışı performans testi için ortam kurulumu](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="c34ca-453">Test Kurulumu</span><span class="sxs-lookup"><span data-stu-id="c34ca-453">Test Setup</span></span>
 <span data-ttu-id="c34ca-454">Geliştirilmiş bir özellik kümesi ve daha iyi eşzamanlılık işleme ile bile, WF4'teki SQL kalıcılık sağlayıcısı WF3'teki sağlayıcıdan daha hızlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-454">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="c34ca-455">Bunu göstermek için, WF3 ve WF4'te temelde aynı işlemleri gerçekleştiren iki iş akışı aşağıda karşılaştırılabır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-455">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Solda WF3'te, sağda WF4'te kalıcılık iş akışı](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="c34ca-457">İki iş akışı da alınan bir ileti tarafından oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-457">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="c34ca-458">İlk yanıt gönderdikten sonra, iş akışı devam eder.</span><span class="sxs-lookup"><span data-stu-id="c34ca-458">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="c34ca-459">WF3 durumunda, kalıcılığı <xref:System.Workflow.ComponentModel.TransactionScopeActivity> başlatmak için boş bir boş kullanılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-459">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="c34ca-460">Aynı şey WF3'te bir etkinliği "yakına devam" olarak işaretleyerek elde edilebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-460">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="c34ca-461">İkinci, ilişkili ileti iş akışını tamamlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-461">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="c34ca-462">İş akışları kalıcıdır, ancak boşaltılmaz.</span><span class="sxs-lookup"><span data-stu-id="c34ca-462">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="c34ca-463">Test Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-463">Test Results</span></span>
 ![Elde girdi kalıcılığını gösteren sütun grafiği](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="c34ca-465">İstemci ve orta katman arasındaki aktarım HTTP olduğunda, WF4'teki kalıcılık 2,6 kat lık bir iyileşme gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-465">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="c34ca-466">TCP taşıma bu faktörü 3,0 kata yükseltir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-466">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="c34ca-467">Her durumda, orta katmandaki CPU kullanımı %98 veya daha yüksektir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-467">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="c34ca-468">WF4 iş akışının daha büyük olmasının nedeni daha hızlı iş akışı çalışma süresidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-468">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="c34ca-469">Serileştirilmiş örneğin boyutu her iki durumda da düşüktür ve bu durumda önemli bir katkıda bulunan öğe değildir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-469">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="c34ca-470">Bu testteki Hem WF3 hem de WF4 iş akışları, kalıcılığın ne zaman gerçekleşmesi gerektiğini açıkça belirtmek için bir etkinlik kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-470">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="c34ca-471">Bu, iş akışını boşaltmadan kalıcı hale alma nın avantajına sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-471">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="c34ca-472">WF3'te, <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> özelliği kullanarak devam etmek de mümkündür, ancak bu iş akışı örneğini bellekten boşaltır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-472">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="c34ca-473">WF3 kullanan bir geliştirici iş akışının belirli noktalarda devam etmesini sağlamak istiyorsa, iş akışı tanımını değiştirmesi veya iş akışı örneğini boşaltma ve yeniden yükleme maliyetini ödemesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-473">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="c34ca-474">WF4'teki yeni bir özellik, boşaltmadan <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>devam etmeyi mümkün kılar: .</span><span class="sxs-lookup"><span data-stu-id="c34ca-474">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="c34ca-475">Bu özellik, iş akışı örneğinin boşta kalmasını, <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> ancak eşik karşılanana veya yürütmeye devam edilene kadar bellekte kalmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-475">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="c34ca-476">WF4 SQL kalıcılık sağlayıcısının veritabanı katmanında daha fazla iş gerçekleştirdiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-476">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="c34ca-477">ORADA CPU ve disk kullanımını izlemek önemlidir bu yüzden SQL veritabanı bir darboğaz haline gelebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-477">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="c34ca-478">Performans testi iş akışı uygulamaları sırasında SQL veritabanından aşağıdaki performans sayaçlarını eklediğinizden emin olun:</span><span class="sxs-lookup"><span data-stu-id="c34ca-478">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="c34ca-479">PhysicalDisk\\%Disk Okuma Süresi</span><span class="sxs-lookup"><span data-stu-id="c34ca-479">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="c34ca-480">PhysicalDisk\\% Disk Süresi</span><span class="sxs-lookup"><span data-stu-id="c34ca-480">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="c34ca-481">PhysicalDisk\\% Disk Yazma Süresi</span><span class="sxs-lookup"><span data-stu-id="c34ca-481">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="c34ca-482">PhysicalDisk\\% Avg. Disk Sıra Uzunluğu</span><span class="sxs-lookup"><span data-stu-id="c34ca-482">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="c34ca-483">PhysicalDisk\Avg. Disk Okuma Sırası Uzunluğu</span><span class="sxs-lookup"><span data-stu-id="c34ca-483">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="c34ca-484">PhysicalDisk\Avg. Disk Yazma Sıra Uzunluğu</span><span class="sxs-lookup"><span data-stu-id="c34ca-484">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="c34ca-485">PhysicalDisk\Geçerli Disk Sıra Uzunluğu</span><span class="sxs-lookup"><span data-stu-id="c34ca-485">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="c34ca-486">İşlemci\\Bilgileri % İşlemci Süresi</span><span class="sxs-lookup"><span data-stu-id="c34ca-486">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="c34ca-487">SQLServer:Mandal\Ortalama Mandal Bekleme Süresi (ms)</span><span class="sxs-lookup"><span data-stu-id="c34ca-487">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="c34ca-488">SQLServer:Mandal\Mandal Bekler/sn</span><span class="sxs-lookup"><span data-stu-id="c34ca-488">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="c34ca-489">İzleme</span><span class="sxs-lookup"><span data-stu-id="c34ca-489">Tracking</span></span>
 <span data-ttu-id="c34ca-490">İş akışı izleme, bir iş akışının ilerlemesini izlemek için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-490">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="c34ca-491">İzleme olaylarında yer alan bilgiler bir izleme profili tarafından belirlenir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-491">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="c34ca-492">İzleme profili ne kadar karmaşıksa, izleme de o kadar pahalı hale gelir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-492">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="c34ca-493">WF3, SQL tabanlı bir izleme hizmetiyle gönderilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-493">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="c34ca-494">Bu hizmet toplu ve toplu olmayan modlarda çalışabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-494">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="c34ca-495">Toplu olmayan modda, izleme olayları doğrudan veritabanına yazılır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-495">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="c34ca-496">Toplu modda, izleme olayları iş akışı örneği durumuyla aynı toplu iş partisinde toplanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-496">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="c34ca-497">Toplu mod, en geniş iş akışı tasarımları için en iyi performansa sahiptir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-497">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="c34ca-498">Ancak, iş akışı devam etmeden birçok etkinlik çalıştırırsa ve bu etkinlikler izlenirse, toplu iş işlemi olumsuz bir performans etkisi ne olabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-498">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="c34ca-499">Bu genellikle döngüler halinde olur ve bu senaryoyu önlemek için en iyi yolu bir kalıcılık noktası içerecek şekilde büyük döngüler tasarlamaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-499">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="c34ca-500">Bir döngüye kalıcılık noktası nın getirilmesi performansı olumsuz yönde etkileyebilir, bu nedenle her birinin maliyetlerini ölçmek ve bir denge bulmak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-500">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="c34ca-501">WF4 bir SQL izleme hizmeti ile sevk edilmez.</span><span class="sxs-lookup"><span data-stu-id="c34ca-501">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="c34ca-502">İzleme bilgilerini bir SQL veritabanına kaydetme,.NET Framework'de yerleşik yerine bir uygulama sunucusundan daha iyi işlenebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-502">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="c34ca-503">Bu nedenle SQL izleme artık AppFabric tarafından işlenir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-503">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="c34ca-504">WF4'teki kutudan çıkma izleme sağlayıcısı, Windows için Olay İzleme'yi (ETW) temel alıyor.</span><span class="sxs-lookup"><span data-stu-id="c34ca-504">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="c34ca-505">ETW, Windows'da yerleşik çekirdek düzeyinde, düşük gecikmeli bir olay sistemidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-505">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="c34ca-506">Bu mümkün sadece aslında bir tüketici olduğunda olay izleme için ceza tabi kılan bir sağlayıcı / tüketici modeli kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-506">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="c34ca-507">İşlemci, disk, bellek ve ağ kullanımı gibi çekirdek olaylarına ek olarak, birçok uygulama ETW'den de yararlanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-507">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="c34ca-508">ETW olayları, uygulamalara göre özelleştirilebilen performans sayaçlarından daha güçlüdür.</span><span class="sxs-lookup"><span data-stu-id="c34ca-508">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="c34ca-509">Olay, iş akışı kimliği veya bilgi iletisi gibi metin içerebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-509">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="c34ca-510">Ayrıca, olaylar bit maskeleriyle sınıflandırılır, böylece belirli bir olay alt kümesini tüketmek tüm olayları yakalamaktan daha az performans etkisine sahip olur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-510">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="c34ca-511">SQL yerine izleme için ETW kullanma yaklaşımının yararları şunlardır:</span><span class="sxs-lookup"><span data-stu-id="c34ca-511">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="c34ca-512">İzleme olaylarının toplanması başka bir işleme ayrılabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-512">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="c34ca-513">Bu, olayların nasıl kaydedildiği konusunda daha fazla esneklik sağlar.</span><span class="sxs-lookup"><span data-stu-id="c34ca-513">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="c34ca-514">ETW izleme olayları, WCF ETW olayları veya SQL Server veya çekirdek sağlayıcısı gibi diğer ETW sağlayıcılarıyla kolayca birleştirilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-514">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="c34ca-515">İş akışı yazarlarının, WF3 SQL izleme hizmetinin toplu iş modu gibi belirli bir izleme uygulamasıyla daha iyi çalışması için iş akışını değiştirmeleri gerekmez.</span><span class="sxs-lookup"><span data-stu-id="c34ca-515">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="c34ca-516">Yönetici, ana bilgisayar işlemini geri dönüştürmeden izlemeyi açabilir veya kapatabilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-516">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="c34ca-517">ETW izleme için performans yararları bir dezavantajı ile birlikte gelir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-517">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="c34ca-518">Sistem yoğun kaynak baskısı altındaysa ETW olayları kaybedilebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-518">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="c34ca-519">Olayların işlenmesi normal program yürütmesini engellemek için değildir ve bu nedenle tüm ETW olaylarının abonelerine yayınlanacağı garanti edilmez.</span><span class="sxs-lookup"><span data-stu-id="c34ca-519">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="c34ca-520">Bu, ETW izleme sağlık izleme için büyük yapar ama denetim için uygun değil.</span><span class="sxs-lookup"><span data-stu-id="c34ca-520">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="c34ca-521">WF4'ün bir SQL izleme sağlayıcısı olmasa da, AppFabric'in yoktur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-521">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="c34ca-522">AppFabric'in SQL izleme yaklaşımı, olayları toplu hale getiren ve bunları hızlı ekler için tasarlanmış bir SQL tablosuna yazan bir Windows Hizmeti ile ETW olaylarına abone olmaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-522">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="c34ca-523">Ayrı bir iş, bu tablodaki verileri boşaltıyor ve AppFabric panosunda görüntülenebilen raporlama tablolarına dönüştürüyor.</span><span class="sxs-lookup"><span data-stu-id="c34ca-523">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="c34ca-524">Bu, bir dizi izleme olayının geldiği iş akışından bağımsız olarak işlendiği ve bu nedenle kaydedilmeden önce kalıcıbir noktayı beklemesi gerekmediği anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-524">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="c34ca-525">ETW olayları logman veya xperf gibi araçlarla kaydedilebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-525">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="c34ca-526">Kompakt ETL dosyası xperfview gibi bir araçla görüntülenebilir veya tracerpt ile XML gibi daha okunabilir bir biçime dönüştürülebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-526">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="c34ca-527">WF3'te, SQL veritabanı olmadan olayları izlemenin tek seçeneği özel bir izleme hizmeti oluşturmaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-527">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="c34ca-528">ETW hakkında daha fazla bilgi için [WCF Hizmetleri ve Windows ve Olay](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) İzleme - Windows uygulamaları için [Olay](/windows/desktop/etw/event-tracing-portal)İzleme'ye bakın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-528">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="c34ca-529">İş akışı izlemeyi etkinleştirmek performansı farklı derecelerde etkiler.</span><span class="sxs-lookup"><span data-stu-id="c34ca-529">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="c34ca-530">Aşağıdaki kıyaslama, ETW izleme olaylarını tüketmek ve bunları bir ETL dosyasına kaydetmek için logman aracını kullanır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-530">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="c34ca-531">AppFabric'teki SQL izleme maliyeti bu makalenin kapsamında değildir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-531">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="c34ca-532">AppFabric'te de kullanılan temel izleme profili bu kıyaslamada gösterilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-532">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="c34ca-533">Ayrıca sadece sağlık izleme olayları izleme maliyeti dahildir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-533">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="c34ca-534">Bu olaylar, sorun giderme ve sistemin ortalama iş ortasını belirlemek için yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-534">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c34ca-535">Ortamı Ayarlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-535">Environment Setup</span></span>
 ![İş akışı performans testi için ortam kurulumu](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="c34ca-537">Test Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-537">Test Results</span></span>

 ![İş akışı izleme maliyetlerini gösteren sütun grafiği](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="c34ca-539">Sağlık izleme nin iş artışı üzerinde kabaca %3'lük bir etkisi vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-539">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="c34ca-540">Temel profilin maliyeti %8 civarındadır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-540">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="c34ca-541">Interop</span><span class="sxs-lookup"><span data-stu-id="c34ca-541">Interop</span></span>
 <span data-ttu-id="c34ca-542">WF4 neredeyse tam bir [!INCLUDE[wf1](../../../includes/wf1-md.md)] yeniden yazmak ve bu nedenle WF3 iş akışları ve faaliyetleri doğrudan WF4 ile uyumlu değildir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-542">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="c34ca-543">Windows İş Akışı Temeli'ni erken benimseyen birçok müşteri, WF3 için şirket içi veya üçüncü taraf iş akışı tanımlarına ve özel etkinliklere sahip olur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-543">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="c34ca-544">WF4'e geçişi kolaylaştıran yollardan biri, WF4 iş akışı içinden WF3 etkinliklerini yürütebilen Interop etkinliğini kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-544">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="c34ca-545"><xref:System.Activities.Statements.Interop> Etkinliğin yalnızca gerektiğinde kullanılması önerilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-545">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="c34ca-546">WF4'e geçiş hakkında daha fazla bilgi için [WF4 Geçiş Kılavuzu'na](migration-guidance.md)göz atın.</span><span class="sxs-lookup"><span data-stu-id="c34ca-546">For more information about migrating to WF4 check out the [WF4 Migration Guidance](migration-guidance.md).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="c34ca-547">Ortamı Ayarlama</span><span class="sxs-lookup"><span data-stu-id="c34ca-547">Environment Setup</span></span>
 ![İş akışı performans testi için ortam kurulumu](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="c34ca-549">Test Sonuçları</span><span class="sxs-lookup"><span data-stu-id="c34ca-549">Test Results</span></span>

<span data-ttu-id="c34ca-550">Aşağıdaki tablo, çeşitli yapılandırmalarda sırayla beş etkinlik içeren bir iş akışını çalıştırmanın sonuçlarını gösterir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-550">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="c34ca-551">Test</span><span class="sxs-lookup"><span data-stu-id="c34ca-551">Test</span></span>|<span data-ttu-id="c34ca-552">İş akışı (iş akışları/sn)</span><span class="sxs-lookup"><span data-stu-id="c34ca-552">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="c34ca-553">WF3 çalışma zamanında WF3 Sırası</span><span class="sxs-lookup"><span data-stu-id="c34ca-553">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="c34ca-554">1,576</span><span class="sxs-lookup"><span data-stu-id="c34ca-554">1,576</span></span>|
|<span data-ttu-id="c34ca-555">WF3 Sequence in WF4 çalışma zamanında Interop kullanarak</span><span class="sxs-lookup"><span data-stu-id="c34ca-555">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="c34ca-556">2,745</span><span class="sxs-lookup"><span data-stu-id="c34ca-556">2,745</span></span>|
|<span data-ttu-id="c34ca-557">WF4 Dizisi</span><span class="sxs-lookup"><span data-stu-id="c34ca-557">WF4 Sequence</span></span>|<span data-ttu-id="c34ca-558">153,582</span><span class="sxs-lookup"><span data-stu-id="c34ca-558">153,582</span></span>|

 <span data-ttu-id="c34ca-559">Düz WF3 üzerinde Interop kullanarak önemli bir performans artışı vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-559">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="c34ca-560">Ancak, WF4 faaliyetleri ile karşılaştırıldığında, artış ihmal edilebilir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-560">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="c34ca-561">Özet</span><span class="sxs-lookup"><span data-stu-id="c34ca-561">Summary</span></span>
 <span data-ttu-id="c34ca-562">WF4 için performans ağır yatırımlar birçok önemli alanlarda ödedi.</span><span class="sxs-lookup"><span data-stu-id="c34ca-562">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="c34ca-563">Bireysel iş akışı bileşen performansı, wf4'te bazı durumlarda daha yalın [!INCLUDE[wf1](../../../includes/wf1-md.md)] çalışma süresi nedeniyle WF3'e göre yüzlerce kat daha hızlıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-563">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="c34ca-564">Gecikme sayıları da önemli ölçüde daha iyidir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-564">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="c34ca-565">Bu el kodlama WCF orkestrasyon hizmetleri aksine kullanmak [!INCLUDE[wf1](../../../includes/wf1-md.md)] için performans cezası kullanarak [!INCLUDE[wf1](../../../includes/wf1-md.md)]ek yararları dikkate alınarak çok küçük olduğu anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="c34ca-565">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="c34ca-566">Kalıcılık performansı 2,5 - 3,0 faktörüyle artmıştır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-566">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="c34ca-567">İş akışı izleme yoluyla sistem durumu izleme nin artık çok az yükü vardır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-567">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="c34ca-568">WF3'ten WF4'e taşınmayı düşünenler için kapsamlı bir geçiş kılavuzu kümesi mevcuttur.</span><span class="sxs-lookup"><span data-stu-id="c34ca-568">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="c34ca-569">Tüm bu WF4 karmaşık uygulamalar yazmak için cazip bir seçenek yapmalıdır.</span><span class="sxs-lookup"><span data-stu-id="c34ca-569">All of this should make WF4 an attractive option for writing complex applications.</span></span>
