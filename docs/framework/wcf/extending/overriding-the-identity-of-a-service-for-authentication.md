---
title: Bir Hizmetin Kimliğini Kimlik Doğrulama için Geçersiz Kılma
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: 5649ef4cc05c9c16b1f8f626ba5e2e584b0e52eb
ms.sourcegitcommit: 7980a91f90ae5eca859db7e6bfa03e23e76a1a50
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/14/2020
ms.locfileid: "81278918"
---
# <a name="override-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="3cfad-102">Kimlik doğrulama için bir hizmetin kimliğini geçersiz kılma</span><span class="sxs-lookup"><span data-stu-id="3cfad-102">Override the identity of a service for authentication</span></span>

<span data-ttu-id="3cfad-103">Genellikle, istemci kimlik bilgisi türü seçimi hizmet meta verilerinde açığa çıkan kimlik türünü belirlediğinden, bir hizmette kimliği ayarlamanız gerekmez.</span><span class="sxs-lookup"><span data-stu-id="3cfad-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="3cfad-104">Örneğin, aşağıdaki yapılandırma kodu [ \<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) öğesini `clientCredentialType` kullanır ve Windows özniteliğini ayarlar.</span><span class="sxs-lookup"><span data-stu-id="3cfad-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  

 <span data-ttu-id="3cfad-105">Aşağıdaki Web Hizmetleri Açıklama Dili (WSDL) parçası, daha önce tanımlanan bitiş noktasının kimliğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="3cfad-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="3cfad-106">Bu örnekte, hizmet belirli bir kullanıcı hesabı altında kendiusername@contoso.comkendine barındırılan bir hizmet olarak çalışıyor ( ) ve bu nedenle kullanıcı anaadı (UPN) kimliği hesap adını içerir.</span><span class="sxs-lookup"><span data-stu-id="3cfad-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="3cfad-107">UPN, windows etki alanında kullanıcı oturum açma adı olarak da bilinir.</span><span class="sxs-lookup"><span data-stu-id="3cfad-107">The UPN is also known as the user sign-in name in a Windows domain.</span></span>  

 <span data-ttu-id="3cfad-108">Kimlik ayarını gösteren örnek bir uygulama için [Hizmet Kimliği Örneği'ne](../samples/service-identity-sample.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="3cfad-109">Hizmet kimliği hakkında daha fazla bilgi için [Hizmet Kimliği ve Kimlik Doğrulama'ya](../feature-details/service-identity-and-authentication.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-109">For more information about service identity, see [Service Identity and Authentication](../feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="3cfad-110">Kerberos Kimlik Doğrulama ve Kimlik</span><span class="sxs-lookup"><span data-stu-id="3cfad-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="3cfad-111">Varsayılan olarak, bir hizmet Windows kimlik bilgilerini kullanacak şekilde yapılandırıldığında, WSDL'de [ \<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) veya [ \<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) öğesi içeren bir [ \<kimlik>](../../configure-apps/file-schema/wcf/identity.md) öğesi oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="3cfad-112">`LocalSystem`Hizmet `LocalService`, , veya `NetworkService` hesap altında çalışıyorsa, bu hesaplar bilgisayarın SPN verilerine `host/` \<erişebildiği için varsayılan olarak *ana bilgisayar adı*> şeklinde bir hizmet anaadı (SPN) oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="3cfad-113">Hizmet farklı bir hesap altında çalışıyorsa, Windows Communication Foundation (WCF) \< *kullanıcı adı*>@<*alan adı*`>`şeklinde bir UPN oluşturur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="3cfad-114">Bunun nedeni, Kerberos kimlik doğrulaması, hizmetin kimliğini doğrulamak için istemciye bir UPN veya SPN sağlanmasını gerektirdiğinden oluşur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="3cfad-115">Bir etki alanında bir hizmetin hesabına ek bir SPN kaydetmek için [Setspn](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731241(v=ws.10)?redirectedfrom=MSDN) aracını da kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="3cfad-115">You can also use the [Setspn](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731241(v=ws.10)?redirectedfrom=MSDN) tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="3cfad-116">Daha sonra Hizmetin kimliği olarak SPN kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="3cfad-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="3cfad-117">Araç hakkında daha fazla bilgi için [Setspn Genel Bakış'a](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10))bakın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-117">For more information about the tool, see [Setspn Overview](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3cfad-118">Windows kimlik bilgisi türünü anlaşma olmadan kullanmak için, hizmetin kullanıcı hesabının Active Directory etki alanına kayıtlı SPN erişimi olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="3cfad-118">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="3cfad-119">Bunu aşağıdaki şekillerde yapabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="3cfad-119">You can do this in the following ways:</span></span>  
  
- <span data-ttu-id="3cfad-120">Hizmetinizi çalıştırmak için NetworkService veya LocalSystem hesabını kullanın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-120">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="3cfad-121">Bu hesaplar, makine Active Directory etki alanına katıldığında kurulan makine SPN'sine erişebildiği için, WCF hizmetin meta verilerinde (WSDL) hizmetin bitiş noktası içinde uygun SPN öğesini otomatik olarak oluşturur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-121">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
- <span data-ttu-id="3cfad-122">Hizmetinizi çalıştırmak için rasgele bir Active Directory etki alanı hesabı kullanın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-122">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="3cfad-123">Bu durumda, setspn.exe yardımcı programı aracını kullanarak yapabileceğiniz bu etki alanı hesabı için bir SPN belirleyin.</span><span class="sxs-lookup"><span data-stu-id="3cfad-123">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="3cfad-124">Hizmetin hesabı için SPN oluşturduktan sonra, WCF'yi bu SPN'yi meta verileri (WSDL) aracılığıyla hizmetin istemcilerine yayımlayacak şekilde yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-124">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="3cfad-125">Bu, bir uygulama yapılandırma dosyası veya kodu aracılığıyla, açıklanmış uç nokta için uç nokta kimliğini ayarlayarak yapılır.</span><span class="sxs-lookup"><span data-stu-id="3cfad-125">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="3cfad-126">SPN'ler, Kerberos protokolü ve Active Directory hakkında daha fazla bilgi [için Windows için Kerberos Teknik Eki'ne](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10))bakın.</span><span class="sxs-lookup"><span data-stu-id="3cfad-126">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="3cfad-127">SPN veya UPN Boş Dize Eşit olduğunda</span><span class="sxs-lookup"><span data-stu-id="3cfad-127">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="3cfad-128">SPN veya UPN'yi boş bir dize eşit ayarlarsanız, kullanılan güvenlik düzeyine ve kimlik doğrulama moduna bağlı olarak bir dizi farklı şey olur:</span><span class="sxs-lookup"><span data-stu-id="3cfad-128">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
- <span data-ttu-id="3cfad-129">Aktarım düzeyi güvenliğini kullanıyorsanız, NT LanMan (NTLM) kimlik doğrulaması seçilir.</span><span class="sxs-lookup"><span data-stu-id="3cfad-129">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
- <span data-ttu-id="3cfad-130">İleti düzeyi güvenliği kullanıyorsanız, kimlik doğrulama moduna bağlı olarak kimlik doğrulama başarısız olabilir:</span><span class="sxs-lookup"><span data-stu-id="3cfad-130">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
- <span data-ttu-id="3cfad-131">Modu kullanıyorsanız `spnego` ve `AllowNtlm` öznitelik `false`ayarlanmışsa, kimlik doğrulama başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-131">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fails.</span></span>  
  
- <span data-ttu-id="3cfad-132">Modu kullanıyorsanız `spnego` ve `AllowNtlm` öznitelik `true`ayarlanmışsa, UPN boşsa kimlik doğrulama başarısız olur, ancak SPN boşsa başarılı olur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty but succeeds if the SPN is empty.</span></span>  
  
- <span data-ttu-id="3cfad-133">Kerberos direct kullanıyorsanız ("tek çekim" olarak da bilinir), kimlik doğrulama başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="3cfad-133">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="use-the-identity-element-in-configuration"></a><span data-ttu-id="3cfad-134">Yapılandırmada \<> Öğe kimliğini kullanma</span><span class="sxs-lookup"><span data-stu-id="3cfad-134">Use the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="3cfad-135">Daha önce gösterilen bağlamadaki istemci kimlik bilgilerini `Certificate`değiştirirseniz, oluşturulan WSDL, aşağıdaki kodda gösterildiği gibi kimlik değeri için base64 seri leştirilmiş X.509 sertifikası içerir.</span><span class="sxs-lookup"><span data-stu-id="3cfad-135">If you change the client credential type in the binding previously shown to `Certificate`, then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="3cfad-136">Bu, Windows dışındaki tüm istemci kimlik bilgileri türleri için varsayılan dır.</span><span class="sxs-lookup"><span data-stu-id="3cfad-136">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="3cfad-137">Yapılandırmada <`identity`> öğesini kullanarak veya kimliği kodda ayarlayarak varsayılan hizmet kimliğinin değerini değiştirebilir veya kimlik türünü değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="3cfad-137">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="3cfad-138">Aşağıdaki yapılandırma kodu değeri `contoso.com`ile bir etki alanı adı sistemi (DNS) kimlik ayarlar.</span><span class="sxs-lookup"><span data-stu-id="3cfad-138">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

### <a name="set-identity-programmatically"></a><span data-ttu-id="3cfad-139">Kimlik Programlamalı Olarak Ayarlayın</span><span class="sxs-lookup"><span data-stu-id="3cfad-139">Set Identity Programmatically</span></span>  
 <span data-ttu-id="3cfad-140">WCF otomatik olarak belirlediğinden, hizmetiniz bir kimliği açıkça belirtmek zorunda değildir.</span><span class="sxs-lookup"><span data-stu-id="3cfad-140">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="3cfad-141">Ancak WCF, gerekirse bir bitiş noktasında bir kimlik belirtmenize olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="3cfad-141">However, WCF allows you to specify an identity on an endpoint, if necessary.</span></span> <span data-ttu-id="3cfad-142">Aşağıdaki kod, belirli bir DNS kimliğine sahip yeni bir hizmet bitiş noktası ekler.</span><span class="sxs-lookup"><span data-stu-id="3cfad-142">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="3cfad-143">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="3cfad-143">See also</span></span>

- [<span data-ttu-id="3cfad-144">Nasıl yapılır: Özel İstemci Kimliği Doğrulayıcı Oluşturma</span><span class="sxs-lookup"><span data-stu-id="3cfad-144">How to: Create a Custom Client Identity Verifier</span></span>](how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="3cfad-145">Kimlik Doğrulama ile Hizmet Kimliği</span><span class="sxs-lookup"><span data-stu-id="3cfad-145">Service Identity and Authentication</span></span>](../feature-details/service-identity-and-authentication.md)
