---
title: Bağlam Değişimi Protokolü
ms.date: 03/30/2017
ms.assetid: 3dfd38e0-ae52-491c-94f4-7a862b9843d4
ms.openlocfilehash: 00adb68d96f77ce0953811d13b5377ec4ed1e0ea
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185260"
---
# <a name="context-exchange-protocol"></a><span data-ttu-id="d4e83-102">Bağlam Değişimi Protokolü</span><span class="sxs-lookup"><span data-stu-id="d4e83-102">Context Exchange Protocol</span></span>
<span data-ttu-id="d4e83-103">Bu bölümde, Windows Communication Foundation (WCF) sürümü .NET Framework sürüm 3.5'te tanıtılan bağlam değişimi protokolü açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-103">This section describes the context exchange protocol introduced in Windows Communication Foundation (WCF) release .NET Framework version 3.5.</span></span> <span data-ttu-id="d4e83-104">Bu iletişim kuralı, istemci kanalının bir hizmet tarafından sağlanan bir bağlamı kabul etmesine ve aynı istemci kanalı örneği üzerinden gönderilen bu hizmete sonraki tüm isteklere uygulamasına olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-104">This protocol allows the client channel to accept a context supplied by a service and apply it to all subsequent requests to that service sent over the same client channel instance.</span></span> <span data-ttu-id="d4e83-105">Bağlam değişimi protokolünün uygulanması, sunucu ve istemci arasındaki bağlamı yaymak için aşağıdaki iki mekanizmadan birini kullanabilir: HTTP çerezleri veya soap üstbilgisi.</span><span class="sxs-lookup"><span data-stu-id="d4e83-105">The implementation of the context exchange protocol can use one of the following two mechanisms to propagate the context between the server and the client: HTTP cookies or a SOAP header.</span></span>  
  
 <span data-ttu-id="d4e83-106">Bağlam değiştirme protokolü özel bir kanal katmanında uygulanır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-106">The context exchange protocol is implemented in a custom channel layer.</span></span> <span data-ttu-id="d4e83-107">Kanal, bir <xref:System.ServiceModel.Channels.ContextMessageProperty> özelliği kullanarak bağlamı uygulama katmanına ve uygulama katmanından ileter.</span><span class="sxs-lookup"><span data-stu-id="d4e83-107">The channel communicates the context to and from the application layer using a <xref:System.ServiceModel.Channels.ContextMessageProperty> property.</span></span> <span data-ttu-id="d4e83-108">Uç noktalar arasındaki iletim için bağlamın değeri kanal katmanında SOAP üstbilgisi olarak serihale edilir veya http isteği ve yanıtını temsil eden ileti özelliklerine dönüştürülür.</span><span class="sxs-lookup"><span data-stu-id="d4e83-108">For transmission between endpoints, the value of the context is either serialized as a SOAP header at the channel layer, or converted to or from the message properties that represent a HTTP request and response.</span></span> <span data-ttu-id="d4e83-109">İkinci durumda, temel kanal katmanlarından birinin, http isteği ve yanıt iletisi özelliklerini sırasıyla HTTP tanımlama bilgilerine ve bu tanımlama bilgilerine dönüştürmesi beklenmektedir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-109">In the latter case, it is expected that one of the underlying channel layers converts the HTTP request and response message properties to and from HTTP cookies, respectively.</span></span> <span data-ttu-id="d4e83-110">Bağlam değişimi için kullanılan mekanizmanın seçimi üzerinde <xref:System.ServiceModel.Channels.ContextExchangeMechanism> özellik <xref:System.ServiceModel.Channels.ContextBindingElement>kullanılarak yapılır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-110">The choice of the mechanism used to exchange the context is done using the <xref:System.ServiceModel.Channels.ContextExchangeMechanism> property on the <xref:System.ServiceModel.Channels.ContextBindingElement>.</span></span> <span data-ttu-id="d4e83-111">Geçerli değerler `HttpCookie` `SoapHeader`veya .</span><span class="sxs-lookup"><span data-stu-id="d4e83-111">Valid values are `HttpCookie` or `SoapHeader`.</span></span>  
  
 <span data-ttu-id="d4e83-112">İstemcide, bir kanal örneği, kanal özelliğindeki ayarlara göre iki <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>modda çalışabilir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-112">On the client, an instance of a channel can operate in two modes based on the settings on the channel property, <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A>.</span></span>  
  
## <a name="mode-1-channel-context-management"></a><span data-ttu-id="d4e83-113">Mod 1: Kanal Bağlam Yönetimi</span><span class="sxs-lookup"><span data-stu-id="d4e83-113">Mode 1: Channel Context Management</span></span>  
 <span data-ttu-id="d4e83-114">Bu varsayılan mod <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> olarak `true`ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-114">This is the default mode where <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `true`.</span></span> <span data-ttu-id="d4e83-115">Bu modda bağlam kanalı bağlamı yönetir ve kullanım ömrü boyunca bağlamı önbelleğe getirir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-115">In this mode the context channel manages the context and caches the context during its lifetime.</span></span> <span data-ttu-id="d4e83-116">`GetContext` Bağlam, yöntem `IContextManager` çağırılarak kanal özelliği üzerinden kanaldan alınabilir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-116">Context can be retrieved from the channel through channel property `IContextManager` by calling the `GetContext` method.</span></span> <span data-ttu-id="d4e83-117">Kanal özelliği üzerinde `SetContext` yöntem çağırarak açılmadan önce belirli bir bağlam ile ön önolarak önolarak açılabilir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-117">The channel can also be pre-initialized with specific context before being opened by calling the `SetContext` method on the channel property.</span></span> <span data-ttu-id="d4e83-118">Kanal bağlamla başharfe basıldıktan sonra sıfırlanamaz.</span><span class="sxs-lookup"><span data-stu-id="d4e83-118">Once the channel is initialized with context it cannot be reset.</span></span>  
  
 <span data-ttu-id="d4e83-119">Bu modda değişmezlerin listesi aşağıda veda edinilir:</span><span class="sxs-lookup"><span data-stu-id="d4e83-119">The following is a list of invariants in this mode:</span></span>  
  
- <span data-ttu-id="d4e83-120">Kanal açıldıktan sonra bağlamı sıfırlamaya `SetContext` yönelik herhangi <xref:System.InvalidOperationException>bir girişim bir .</span><span class="sxs-lookup"><span data-stu-id="d4e83-120">Any attempt to reset the context using `SetContext` after the channel has been opened throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="d4e83-121">Giden bir <xref:System.ServiceModel.Channels.ContextMessageProperty> iletide kullanarak bağlam gönderme girişimi bir <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="d4e83-121">Any attempt to send context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty> in an outgoing message throws an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="d4e83-122">Bir ileti sunucudan belirli bir bağlamla alınırsa, kanal zaten belirli bir bağlamla baş <xref:System.ServiceModel.ProtocolException>harfe batmışsa, bu bir .</span><span class="sxs-lookup"><span data-stu-id="d4e83-122">If a message is received from server with a specific context, when the channel has already been initialized with a specific context, this results in a <xref:System.ServiceModel.ProtocolException>.</span></span>  
  
    > [!NOTE]
    > <span data-ttu-id="d4e83-123">Yalnızca kanal açık olarak ayarlanan herhangi bir bağlam olmadan açıldığında sunucudan bir başlangıç bağlamı almak uygundur.</span><span class="sxs-lookup"><span data-stu-id="d4e83-123">It is appropriate to receive an initial context from the server only if the channel is opened without any context set explicitly.</span></span>  
  
- <span data-ttu-id="d4e83-124"><xref:System.ServiceModel.Channels.ContextMessageProperty> Gelen ileti her zaman geçersizdir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-124">The <xref:System.ServiceModel.Channels.ContextMessageProperty> on incoming message is always null.</span></span>  
  
## <a name="mode-2-application-context-management"></a><span data-ttu-id="d4e83-125">Mod 2: Uygulama Bağlam Yönetimi</span><span class="sxs-lookup"><span data-stu-id="d4e83-125">Mode 2: Application Context Management</span></span>  
 <span data-ttu-id="d4e83-126">Bu mod da <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> `false`ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-126">This is the mode when <xref:System.ServiceModel.Channels.IContextManager.Enabled%2A> is set to `false`.</span></span> <span data-ttu-id="d4e83-127">Bu modda bağlam kanalı bağlamı yönetmez.</span><span class="sxs-lookup"><span data-stu-id="d4e83-127">In this mode the context channel does not manage context.</span></span> <span data-ttu-id="d4e83-128">Bağlamı kullanarak bağlamı almak, yönetmek ve uygulamak <xref:System.ServiceModel.Channels.ContextMessageProperty>uygulamanın sorumluluğudur.</span><span class="sxs-lookup"><span data-stu-id="d4e83-128">It is the application's responsibility to retrieve, manage and apply context by using the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="d4e83-129">Herhangi `GetContext` bir arama `SetContext` girişimi <xref:System.InvalidOperationException>veya sonuç bir .</span><span class="sxs-lookup"><span data-stu-id="d4e83-129">Any attempt to call `GetContext` or `SetContext` results in an <xref:System.InvalidOperationException>.</span></span>  
  
 <span data-ttu-id="d4e83-130">Hangi mod seçilirse seçilsin, istemci kanal fabrikası destekler <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>ve <xref:System.ServiceModel.Channels.IDuplexSessionChannel> ileti alışverişi desenleri.</span><span class="sxs-lookup"><span data-stu-id="d4e83-130">No matter which mode is chosen the client channel factory supports <xref:System.ServiceModel.Channels.IRequestChannel>, <xref:System.ServiceModel.Channels.IRequestSessionChannel>, and <xref:System.ServiceModel.Channels.IDuplexSessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="d4e83-131">Hizmette, kanalın bir örneği, istemci tarafından gelen iletilerde sağlanan bağlamı <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span><span class="sxs-lookup"><span data-stu-id="d4e83-131">On the service, an instance of the channel is responsible for converting the context supplied by the client on incoming messages to the <xref:System.ServiceModel.Channels.ContextMessageProperty>.</span></span> <span data-ttu-id="d4e83-132">İleti özelliğine daha sonra uygulama katmanı veya arama yığınının diğer kanalları tarafından erişilebilir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-132">The message property can then be accessed by the application layer or other channels further up in the call stack.</span></span> <span data-ttu-id="d4e83-133">Hizmet kanalları ayrıca, yanıt iletisine bir ileti <xref:System.ServiceModel.Channels.ContextMessageProperty> ekleyerek istemciye yeniden yayılacak yeni bir bağlam değeri belirtmek için uygulama katmanına da izin verir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-133">The service channels also allow the application layer to specify a new context value to be propagated back to the client by attaching a <xref:System.ServiceModel.Channels.ContextMessageProperty> to the response message.</span></span> <span data-ttu-id="d4e83-134">Bu özellik, bağlama yapılandırmasına bağlı bağlamı içeren SOAP üstbilgisine veya HTTP çerezine dönüştürülür.</span><span class="sxs-lookup"><span data-stu-id="d4e83-134">This property is converted to the SOAP header or HTTP cookie that contains the context, which depends on the configuration of the binding.</span></span> <span data-ttu-id="d4e83-135">Servis kanalı dinleyicisi, <xref:System.ServiceModel.Channels.IReplyChannel> <xref:System.ServiceModel.Channels.IReplySessionChannel> <xref:System.ServiceModel.Channels.IReplySessionChannel> ve ileti alışverişi desenlerini destekler.</span><span class="sxs-lookup"><span data-stu-id="d4e83-135">The service channel listener supports <xref:System.ServiceModel.Channels.IReplyChannel>, <xref:System.ServiceModel.Channels.IReplySessionChannel>, and <xref:System.ServiceModel.Channels.IReplySessionChannel> message exchange patterns.</span></span>  
  
 <span data-ttu-id="d4e83-136">Bağlam değiştirme protokolü, http `wsc:Context` tanımlama bilgileri bağlamı yaymak için kullanılmadığında bağlam bilgilerini temsil edecek yeni bir SOAP üstbilgisi sunar.</span><span class="sxs-lookup"><span data-stu-id="d4e83-136">The context exchange protocol introduces a new `wsc:Context` SOAP header to represent the context information when HTTP cookies are not used to propagate the context.</span></span> <span data-ttu-id="d4e83-137">Bağlam üstbilgi şeması, her biri dize tuşu ve dize içeriğine sahip her biri olan herhangi bir sayıda alt öğeye izin verir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-137">The context header schema allows for any number of child elements, each with a string key and string content.</span></span> <span data-ttu-id="d4e83-138">Aşağıda bir bağlam üstbilgi örneği verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-138">The following is an example of a context header.</span></span>  
  
 `<Context xmlns="http://schemas.microsoft.com/ws/2006/05/context">`  
  
 `<property name="myContext">context-2</property>`  
  
 `</Context>`  
  
 <span data-ttu-id="d4e83-139">Moddayken, `HttpCookie` çerezler `SetCookie` üstbilgi kullanılarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-139">When in `HttpCookie` mode, cookies are set using the `SetCookie` header.</span></span> <span data-ttu-id="d4e83-140">Çerez `WscContext`adı.</span><span class="sxs-lookup"><span data-stu-id="d4e83-140">The cookie name is `WscContext`.</span></span> <span data-ttu-id="d4e83-141">Çerezin değeri üstbilginin Base64 kodlamasidır. `wsc:Context`</span><span class="sxs-lookup"><span data-stu-id="d4e83-141">The value of the cookie is the Base64 encoding of the `wsc:Context` header.</span></span> <span data-ttu-id="d4e83-142">Bu değer tırnak içinde eklenir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-142">This value is enclosed in quotes.</span></span>  
  
 <span data-ttu-id="d4e83-143">Bağlamın değeri, WS Adresleme üstbilgileriyle aynı nedenle geçiş sırasında değişiklikten korunmalıdır – üstbilgi, isteğin hizmete nereye gönderilen yeri belirlemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-143">The value of the context must be protected from modification while in transit for the same reason WS-Addressing headers are protected – the header is used to determine where to dispatch the request to on the service.</span></span> <span data-ttu-id="d4e83-144">Bu `wsc:Context` nedenle üstbilginin, bağlama ileti koruma özelliği sunduğunda, sabun veya aktarım düzeyinde dijital olarak imzalanması veya imzalanması ve şifrelemesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-144">The `wsc:Context` header is therefore required to be digitally signed or signed and encrypted at either the SOAP or transport level when the binding offers message protection capability.</span></span> <span data-ttu-id="d4e83-145">BAĞLAMi yaymak için HTTP tanımlama bilgileri kullanıldığında, aktarım güvenliği kullanılarak korunmalıdır.</span><span class="sxs-lookup"><span data-stu-id="d4e83-145">When HTTP cookies are used to propagate context, they should be protected using transport security.</span></span>  
  
 <span data-ttu-id="d4e83-146">Bağlam değişimi protokolü için destek gerektiren hizmet uç noktaları, yayımlanmış ilkede bunu açıkça belirtebilir.</span><span class="sxs-lookup"><span data-stu-id="d4e83-146">Service endpoints that require support for the context exchange protocol can make it explicit in the published policy.</span></span> <span data-ttu-id="d4e83-147">İstemcinin bağlam değişim protokolünü SOAP düzeyinde desteklemesi veya HTTP çerez desteğini etkinleştirme gereksinimini temsil etmek için iki yeni ilke iddiası sunulmuştur.</span><span class="sxs-lookup"><span data-stu-id="d4e83-147">Two new policy assertions have been introduced to represent the requirement for the client to support the context exchange protocol at the SOAP level or to enable HTTP cookie support.</span></span> <span data-ttu-id="d4e83-148">Hizmet ilkesine bu iddiaların nesil aşağıdaki gibi <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> özelliğin değeri tarafından denetlenir:</span><span class="sxs-lookup"><span data-stu-id="d4e83-148">Generation of these assertions into the policy on the service is controlled by the value of the <xref:System.ServiceModel.Channels.ContextBindingElement.ContextExchangeMechanism%2A> property as follows:</span></span>  
  
- <span data-ttu-id="d4e83-149">Bunun <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>için, aşağıdaki iddia oluşturulur:</span><span class="sxs-lookup"><span data-stu-id="d4e83-149">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.ContextSoapHeader>, the following assertion is generated:</span></span>  
  
    ```xml  
    <IncludeContext
    xmlns="http://schemas.microsoft.com/ws/2006/05/context"  
    protectionLevel="Sign" />  
    ```  
  
- <span data-ttu-id="d4e83-150">Bunun <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>için, aşağıdaki iddia oluşturulur:</span><span class="sxs-lookup"><span data-stu-id="d4e83-150">For <xref:System.ServiceModel.Channels.ContextExchangeMechanism.HttpCookie>, the following assertion is generated:</span></span>  
  
    ```xml  
    <HttpUseCookie xmlns="http://schemas.xmlsoap.org/soap/http"/>  
    ```  
  
## <a name="see-also"></a><span data-ttu-id="d4e83-151">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="d4e83-151">See also</span></span>

- [<span data-ttu-id="d4e83-152">Web Hizmetleri Protokolleri Birlikte Çalışabilirlik Kılavuzu</span><span class="sxs-lookup"><span data-stu-id="d4e83-152">Web Services Protocols Interoperability Guide</span></span>](../../../../docs/framework/wcf/feature-details/web-services-protocols-interoperability-guide.md)
