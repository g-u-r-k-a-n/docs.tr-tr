---
title: Sürüm 3.5 SP1’de HttpWebRequest için NTLM kimlik doğrulamasındaki değişiklikler
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 388e6dc648e1fd68e24a852cb08de107f09f9c9f
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/15/2020
ms.locfileid: "64754885"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="80161-102">Sürüm 3.5 SP1’de HttpWebRequest için NTLM kimlik doğrulamasındaki değişiklikler</span><span class="sxs-lookup"><span data-stu-id="80161-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>

<span data-ttu-id="80161-103">Güvenlik değişiklikleri .NET Framework sürüm 3.5 SP1'de yapıldı ve daha sonra <xref:System.Net.HttpWebRequest> <xref:System.Net.HttpListener>tümleşik Windows kimlik doğrulamasının System.Net ad alanında , , <xref:System.Net.Security.NegotiateStream>ve ilgili sınıflar tarafından nasıl işleneceğini etkiler.</span><span class="sxs-lookup"><span data-stu-id="80161-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="80161-104">Bu değişiklikler, web istekleri yapmak ve NTLM'ye dayalı tümleşik Windows kimlik doğrulaması kullanıldığında yanıt almak için bu sınıfları kullanan uygulamaları etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="80161-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="80161-105">Bu değişiklik, tümleşik Windows kimlik doğrulaması kullanmak üzere yapılandırılan web sunucularını ve istemci uygulamalarını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="80161-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>

## <a name="overview"></a><span data-ttu-id="80161-106">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="80161-106">Overview</span></span>

<span data-ttu-id="80161-107">Tümleşik Windows kimlik doğrulamasının tasarımı, bazı kimlik bilgisi yanıtlarının evrensel olmasını sağlar, bu da yeniden kullanılabilir veya iletilebilir.</span><span class="sxs-lookup"><span data-stu-id="80161-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="80161-108">Bu özel tasarım özelliği gerekli değilse, kimlik doğrulama protokolleri hedef belirli bilgilerin yanı sıra kanala özgü bilgileri de taşımalıdır.</span><span class="sxs-lookup"><span data-stu-id="80161-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="80161-109">Hizmetler daha sonra, kimlik bilgisi yanıtlarının Hizmet Temel Adı (SPN) gibi hizmete özgü bilgiler içerdiğinden emin olmak için genişletilmiş koruma sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="80161-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="80161-110">Kimlik bilgisi alışverişindeki bu bilgilerle, hizmetler yanlış alınmış olabilecek kimlik bilgilerinin kötü amaçlı kullanımına karşı daha iyi koruma sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="80161-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>

<span data-ttu-id="80161-111">Ad <xref:System.Net> alanlarındave <xref:System.Net.Security> ad alanlarındaki birden çok bileşen, bir arama uygulaması adına tümleşik Windows kimlik doğrulaması gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="80161-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="80161-112">Bu bölümde, tümleşik Windows kimlik doğrulaması kullanımında genişletilmiş koruma eklemek için System.Net bileşenlerine yapılan değişiklikler açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="80161-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>

## <a name="changes"></a><span data-ttu-id="80161-113">Değişiklikler</span><span class="sxs-lookup"><span data-stu-id="80161-113">Changes</span></span>

<span data-ttu-id="80161-114">Tümleşik Windows kimlik doğrulamasıyla kullanılan NTLM kimlik doğrulama işlemi, hedef bilgisayar tarafından verilen ve istemci bilgisayara geri gönderilen bir meydan okuma içerir.</span><span class="sxs-lookup"><span data-stu-id="80161-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="80161-115">Bir bilgisayar kendi oluşturduğu bir meydan okuma aldığında, bağlantı döngü geri bağlantısı olmadığı sürece kimlik doğrulama başarısız olur (Örneğin IPv4 adresi 127.0.0.1).</span><span class="sxs-lookup"><span data-stu-id="80161-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>

<span data-ttu-id="80161-116">Dahili bir Web sunucusunda çalışan bir hizmete erişirken, hizmete `http://contoso/service` `https://contoso/service`benzer bir URL kullanarak hizmete erişmek yaygındır.</span><span class="sxs-lookup"><span data-stu-id="80161-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="80161-117">"Contoso" adı genellikle hizmetin dağıtıldığı bilgisayarın bilgisayar adı değildir.</span><span class="sxs-lookup"><span data-stu-id="80161-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="80161-118">Adları <xref:System.Net> adreslere çözmek için Active Directory, DNS, NetBIOS, yerel bilgisayarın ana bilgisayarları dosyası (örneğin, genellikle WINDOWS\system32\drivers\etc\hosts) veya yerel bilgisayarın lmhosts dosyasını (genellikle WINDOWS\system32\drivers\etc\lmhosts) kullanarak ve ilgili ad alanları desteği.</span><span class="sxs-lookup"><span data-stu-id="80161-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="80161-119">"Contoso" adı, "contoso"ya gönderilen isteklerin uygun sunucu bilgisayarına gönderilmesi için çözülür.</span><span class="sxs-lookup"><span data-stu-id="80161-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>

<span data-ttu-id="80161-120">Büyük dağıtımlar için yapılandırıldığında, istemci uygulamaları ve son kullanıcılar tarafından hiç kullanılmayan temel makine adları ile dağıtıma tek bir sanal sunucu adı verilmesi de yaygındır.</span><span class="sxs-lookup"><span data-stu-id="80161-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="80161-121">Örneğin, sunucuyu `www.contoso.com`arayabilirsiniz, ancak dahili bir ağda yalnızca "contoso" kullanın.</span><span class="sxs-lookup"><span data-stu-id="80161-121">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="80161-122">Bu ad, istemci web isteğinde Ana Bilgisayar üstbilgisi olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="80161-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="80161-123">HTTP protokolünde belirtildiği gibi, Ana Bilgisayar istek üstbilgi alanı, istenen kaynağın Internet ana bilgisayarını ve bağlantı noktası numarasını belirtir.</span><span class="sxs-lookup"><span data-stu-id="80161-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="80161-124">Bu bilgiler, kullanıcı veya yönlendiren kaynak (genellikle bir HTTP URL) tarafından verilen orijinal URI elde edilir.</span><span class="sxs-lookup"><span data-stu-id="80161-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="80161-125">.NET Framework sürüm 4'te, bu bilgiler istemci tarafından <xref:System.Net.HttpWebRequest.Host%2A> yeni özelliği kullanarak da ayarlanabilir.</span><span class="sxs-lookup"><span data-stu-id="80161-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>

<span data-ttu-id="80161-126">Sınıf, <xref:System.Net.AuthenticationManager> türemiş sınıflar ve sınıf tarafından <xref:System.Net.WebRequest> kullanılan yönetilen kimlik doğrulama <xref:System.Net.WebClient> bileşenlerini ("modüller") denetler.</span><span class="sxs-lookup"><span data-stu-id="80161-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="80161-127">Sınıf, <xref:System.Net.AuthenticationManager> uygulamaların kimlik doğrulaması <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> sırasında kullanılacak özel bir SPN dizesini sağlaması için URI dizetarafından dizine eklenmiş bir nesneyi ortaya çıkaran bir özellik sağlar.</span><span class="sxs-lookup"><span data-stu-id="80161-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>

<span data-ttu-id="80161-128">Sürüm 3.5 SP1, <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> özellik ayarlanmadığında NTLM (NT LAN Manager) kimlik doğrulama değişiminde SPN'deki istek URL'sinde kullanılan ana bilgisayar adını belirtmeyi varsayılan olarak belirtir.</span><span class="sxs-lookup"><span data-stu-id="80161-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="80161-129">İstek URL'sinde kullanılan ana bilgisayar adı, istemci <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> isteğinde belirtilen Ana Bilgisayar üstbilgisinden farklı olabilir.</span><span class="sxs-lookup"><span data-stu-id="80161-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="80161-130">İstek URL'sinde kullanılan ana bilgisayar adı, sunucunun gerçek ana bilgisayar adından, sunucunun makine adından, bilgisayarın IP adresinden veya geri dönüş adresinden farklı olabilir.</span><span class="sxs-lookup"><span data-stu-id="80161-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="80161-131">Bu gibi durumlarda, Windows kimlik doğrulama isteğini başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="80161-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="80161-132">Sorunu gidermek için, Windows'a istemci isteğinde istek URL'sinde kullanılan ana bilgisayar adının (örneğin kontoso) aslında yerel bilgisayar için alternatif bir ad olduğunu bildirmemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="80161-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>

<span data-ttu-id="80161-133">Bir sunucu uygulamasının bu değişikliği geçici olarak çalışması için birkaç olası yöntem vardır.</span><span class="sxs-lookup"><span data-stu-id="80161-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="80161-134">Önerilen yaklaşım, istek URL'sinde kullanılan ana bilgisayar `BackConnectionHostNames` adını sunucudaki kayıt defterindeki anahtarla eşlemektir.</span><span class="sxs-lookup"><span data-stu-id="80161-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="80161-135">`BackConnectionHostNames` Kayıt defteri anahtarı normalde bir ana bilgisayar adını geri alma adresiyle eşlemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="80161-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="80161-136">Adımlar aşağıda listelenmiştir.</span><span class="sxs-lookup"><span data-stu-id="80161-136">The steps are listed below.</span></span>

<span data-ttu-id="80161-137">Geri dönüş adresine eşlenen ve yerel bir bilgisayardaki Web sitelerine bağlanabilen ana bilgisayar adlarını belirtmek için aşağıdaki adımları izleyin:</span><span class="sxs-lookup"><span data-stu-id="80161-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>

1. <span data-ttu-id="80161-138">Başlat'ı tıklatın, Çalıştır'ı tıklatın, regedit yazın ve sonra Tamam'ı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="80161-138">Click Start, click Run, type regedit, and then click OK.</span></span>

2. <span data-ttu-id="80161-139">Kayıt Defteri Düzenleyicisi'nde aşağıdaki kayıt defteri anahtarını bulun ve ardından tıklatın:</span><span class="sxs-lookup"><span data-stu-id="80161-139">In Registry Editor, locate and then click the following registry key:</span></span>

    `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`

3. <span data-ttu-id="80161-140">MSV1_0 sağ tıklatın, Yeni'yi işaret edin ve ardından Multi-String Değeri'ni tıklatın.</span><span class="sxs-lookup"><span data-stu-id="80161-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>

4. <span data-ttu-id="80161-141">`BackConnectionHostNames` yazın ve sonra ENTER tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="80161-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>

5. <span data-ttu-id="80161-142">Sağ tıklatın `BackConnectionHostNames`ve sonra Değiştir'i tıklatın.</span><span class="sxs-lookup"><span data-stu-id="80161-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>

6. <span data-ttu-id="80161-143">Değer veri kutusuna, yerel bilgisayarda bulunan sitelerin ana bilgisayar adını veya ana bilgisayar adlarını (istek URL'sinde kullanılan ana bilgisayar adı) yazın ve ardından Tamam'ı tıklatın.</span><span class="sxs-lookup"><span data-stu-id="80161-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>

7. <span data-ttu-id="80161-144">Kayıt Defteri Düzenleyicisi çıkın ve ardından IISAdmin hizmetini yeniden başlatın ve IISReset'i çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="80161-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>

<span data-ttu-id="80161-145">Daha az güvenli bir çözüm döngü geri kontrol devre <https://support.microsoft.com/kb/896861>dışı, olarak açıklanan .</span><span class="sxs-lookup"><span data-stu-id="80161-145">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="80161-146">Bu yansıma saldırılarına karşı koruma devre dışı kalmaktadır.</span><span class="sxs-lookup"><span data-stu-id="80161-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="80161-147">Bu nedenle, alternatif adkümesini yalnızca makinenin gerçekten kullanmasını beklediğiniz adlarla kısıtlamak daha iyidir.</span><span class="sxs-lookup"><span data-stu-id="80161-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>

## <a name="see-also"></a><span data-ttu-id="80161-148">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="80161-148">See also</span></span>

- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
