---
title: Kullanıcı Kodu İzleri Yayma
ms.date: 03/30/2017
ms.assetid: fa54186a-8ffa-4332-b0e7-63867126fd49
ms.openlocfilehash: e8b2031165a83e24ba15a2fcf847a170f47e696a
ms.sourcegitcommit: cdb295dd1db589ce5169ac9ff096f01fd0c2da9d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/09/2020
ms.locfileid: "84589298"
---
# <a name="emitting-user-code-traces"></a><span data-ttu-id="5cf50-102">Kullanıcı Kodu İzleri Yayma</span><span class="sxs-lookup"><span data-stu-id="5cf50-102">Emitting User-Code Traces</span></span>

<span data-ttu-id="5cf50-103">Yapılandırmada izlemeyi Windows Communication Foundation (WCF) tarafından oluşturulan izleme verilerini toplamak üzere etkinleştirmenin yanı sıra, izlemeleri Kullanıcı kodunda programlı bir şekilde de getirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-103">In addition to enabling tracing in configuration to collect instrumentation data generated by Windows Communication Foundation (WCF), you can also emit traces programmatically in user code.</span></span> <span data-ttu-id="5cf50-104">Bu şekilde, daha sonra tanılama amacıyla kullanabileceğiniz izleme verilerini önceden oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-104">In this way, you can proactively create instrumentation data that you can peruse later for diagnostic purpose.</span></span> <span data-ttu-id="5cf50-105">Bu konu, bunu nasıl yapabileceğinizi anlatmaktadır.</span><span class="sxs-lookup"><span data-stu-id="5cf50-105">This topic discusses how you can do this.</span></span>

<span data-ttu-id="5cf50-106">Ayrıca, [genişletme izleme](../../samples/extending-tracing.md) örneği aşağıdaki bölümlerde gösterilen tüm kodu içerir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-106">In addition, the [Extending Tracing](../../samples/extending-tracing.md) sample includes all the code demonstrated in the following sections.</span></span>

## <a name="creating-a-trace-source"></a><span data-ttu-id="5cf50-107">Izleme kaynağı oluşturma</span><span class="sxs-lookup"><span data-stu-id="5cf50-107">Creating a Trace Source</span></span>

<span data-ttu-id="5cf50-108">Bir kullanıcı izleme kaynağı oluşturmak için aşağıdaki kodu kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-108">You can use the following code to create a user trace source.</span></span>

```csharp
TraceSource ts = new TraceSource("myUserTraceSource");
```

## <a name="creating-activities"></a><span data-ttu-id="5cf50-109">Etkinlik oluşturma</span><span class="sxs-lookup"><span data-stu-id="5cf50-109">Creating Activities</span></span>

<span data-ttu-id="5cf50-110">Etkinlikler mantıksal işleme birimidir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-110">Activities are logical unit of processing.</span></span> <span data-ttu-id="5cf50-111">İzlemelerin birlikte gruplandırılmasına istediğiniz her önemli işlem birimi için bir etkinlik oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-111">You can create one activity for each major processing unit in which you want traces to be grouped together.</span></span> <span data-ttu-id="5cf50-112">Örneğin, hizmete her istek için bir etkinlik oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-112">For example, you can create one activity for each request to the service.</span></span> <span data-ttu-id="5cf50-113">Bunu yapmak için aşağıdaki adımları gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="5cf50-113">To do so, perform the following steps.</span></span>

1. <span data-ttu-id="5cf50-114">Etkinlik KIMLIĞINI kapsama alanına kaydedin.</span><span class="sxs-lookup"><span data-stu-id="5cf50-114">Save the activity ID in scope.</span></span>

2. <span data-ttu-id="5cf50-115">Yeni bir etkinlik KIMLIĞI oluşturun.</span><span class="sxs-lookup"><span data-stu-id="5cf50-115">Create a new activity ID.</span></span>

3. <span data-ttu-id="5cf50-116">Kapsamdaki etkinlikten yeni bir öğesine aktarın, kapsamdaki yeni etkinliği ayarlayın ve bu etkinlik için bir başlangıç izlemesi yapın.</span><span class="sxs-lookup"><span data-stu-id="5cf50-116">Transfer from the activity in scope to the new one, set the new activity in scope and emit a start trace for that activity.</span></span>

<span data-ttu-id="5cf50-117">Aşağıdaki kod bunun nasıl yapılacağını göstermektedir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-117">The following code demonstrates how to do this.</span></span>

```csharp
Guid oldID = Trace.CorrelationManager.ActivityId;
Guid traceID = Guid.NewGuid();
ts.TraceTransfer(0, "transfer", traceID);
Trace.CorrelationManager.ActivityId = traceID; // Trace is static
ts.TraceEvent(TraceEventType.Start, 0, "Add request");
```

## <a name="emitting-traces-within-a-user-activity"></a><span data-ttu-id="5cf50-118">Bir kullanıcı etkinliği içinde Izlemeleri yayma</span><span class="sxs-lookup"><span data-stu-id="5cf50-118">Emitting Traces within a User Activity</span></span>

<span data-ttu-id="5cf50-119">Aşağıdaki kod, izlemeleri bir kullanıcı etkinliği içinde yayar.</span><span class="sxs-lookup"><span data-stu-id="5cf50-119">The following code emits traces within a user activity.</span></span>

```csharp
double value1 = 100.00D;
double value2 = 15.99D;
ts.TraceInformation("Client sends message to Add " + value1 + ", " + value2);
double result = client.Add(value1, value2);
ts.TraceInformation("Client receives Add response '" + result + "'");
```

## <a name="stopping-the-activities"></a><span data-ttu-id="5cf50-120">Etkinlikler durduruluyor</span><span class="sxs-lookup"><span data-stu-id="5cf50-120">Stopping the Activities</span></span>

<span data-ttu-id="5cf50-121">Etkinlikleri durdurmak için eski etkinliğe geri aktarın, geçerli etkinlik kimliğini durdurun ve kapsamdaki eski etkinlik kimliğini sıfırlayın.</span><span class="sxs-lookup"><span data-stu-id="5cf50-121">To stop the activities, transfer back to the old activity, stop the current activity id, and reset the old activity id in scope.</span></span>

<span data-ttu-id="5cf50-122">Aşağıdaki kod bunun nasıl yapılacağını göstermektedir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-122">The following code demonstrates how to do this.</span></span>

```csharp
ts.TraceTransfer(0, "transfer", oldID);
ts.TraceEvent(TraceEventType.Stop, 0, "Add request");
Trace.CorrelationManager.ActivityId = oldID;
```

## <a name="propagating-the-activity-id-to-a-service"></a><span data-ttu-id="5cf50-123">Etkinlik KIMLIĞI bir hizmete yayılıyor</span><span class="sxs-lookup"><span data-stu-id="5cf50-123">Propagating the Activity ID to A Service</span></span>

<span data-ttu-id="5cf50-124">`propagateActivity` `true` `System.ServiceModel` Öğesini hem istemci hem de hizmet yapılandırma dosyalarında izleme kaynağı için olarak ayarlarsanız, ekleme isteği için hizmet işleme, istemcide tanımlananla aynı etkinlikte oluşur.</span><span class="sxs-lookup"><span data-stu-id="5cf50-124">If you set the `propagateActivity` attribute to `true` for the `System.ServiceModel` trace source in both the client and service configuration files, the service processing for the Add request occurs in the same activity as the one defined in the client.</span></span> <span data-ttu-id="5cf50-125">Hizmet kendi etkinliklerini ve aktarımlarını tanımlıyorsa, hizmet izlemeleri istemci tarafından yayılan etkinlikte görünmez.</span><span class="sxs-lookup"><span data-stu-id="5cf50-125">If the service defines its own activities and transfers, the service traces do not appear in the client-propagated activity.</span></span> <span data-ttu-id="5cf50-126">Bunun yerine, aktarım izlemelerinden bağıntılı bir etkinlikte, KIMLIĞI istemci tarafından yayılan etkinliğe görünürler.</span><span class="sxs-lookup"><span data-stu-id="5cf50-126">Instead, they appear in an activity correlated by transfer traces to the activity whose ID is propagated by the client.</span></span>

> [!NOTE]
> <span data-ttu-id="5cf50-127">`propagateActivity`Özniteliği `true` hem istemci hem de hizmette olarak ayarlandıysa, hizmetin işlem kapsamındaki çevresel etkinlik WCF tarafından ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="5cf50-127">If the `propagateActivity` attribute is set to `true` on both the client and service, the ambient activity in the operation scope of the service is set by WCF.</span></span>

<span data-ttu-id="5cf50-128">Bir etkinliğin WCF tarafından kapsamda ayarlanmış olup olmadığını denetlemek için aşağıdaki kodu kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-128">You can use the following code to check whether an activity was set in scope by WCF.</span></span>

```csharp
// Check if an activity was set in scope by WCF, if it was
// propagated from the client. If not, ( ambient activity is
// equal to Guid.Empty), create a new one.
if(Trace.CorrelationManager.ActivityId == Guid.Empty)
{
    Guid newGuid = Guid.NewGuid();
    Trace.CorrelationManager.ActivityId = newGuid;
}
// Emit your Start trace.
ts.TraceEvent(TraceEventType.Start, 0, "Add Activity");

// Emit the processing traces for that request.
serviceTs.TraceInformation("Service receives Add "
                            + n1 + ", " + n2);
// double result = n1 + n2;
serviceTs.TraceInformation("Service sends Add result" + result);

// Emit the Stop trace and exit the method scope.
ts.TraceEvent(TraceEventType.Stop, 0, "Add Activity");
// return result;
```

## <a name="tracing-exceptions-thrown-in-code"></a><span data-ttu-id="5cf50-129">Kodda oluşturulan özel durumlar izleniyor</span><span class="sxs-lookup"><span data-stu-id="5cf50-129">Tracing Exceptions Thrown in Code</span></span>

<span data-ttu-id="5cf50-130">Kodda bir özel durum oluşturduğunuzda, özel durumu uyarı düzeyinde veya aşağıdaki kodu kullanarak da izleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-130">When you throw an exception in code, you can also trace the exception at Warning level or up using the following code.</span></span>

```csharp
ts.TraceEvent(TraceEventType.Warning, 0, "Throwing exception " + "exceptionMessage");
```

## <a name="viewing-user-traces-in-the-service-trace-viewer-tool"></a><span data-ttu-id="5cf50-131">Hizmet Izleme Görüntüleyicisi aracında Kullanıcı Izlemelerini görüntüleme</span><span class="sxs-lookup"><span data-stu-id="5cf50-131">Viewing User Traces in the Service Trace Viewer Tool</span></span>

<span data-ttu-id="5cf50-132">Bu bölüm, [hizmet Izleme Görüntüleyicisi Aracı (SvcTraceViewer. exe)](../../service-trace-viewer-tool-svctraceviewer-exe.md)kullanılarak görüntülenirken, [genişletme izleme](../../samples/extending-tracing.md) örneği çalıştırılarak oluşturulan izlemelerin ekran görüntülerini içerir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-132">This section contains screenshots of traces generated by running the [Extending Tracing](../../samples/extending-tracing.md) sample, when viewed using the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../../service-trace-viewer-tool-svctraceviewer-exe.md).</span></span>

<span data-ttu-id="5cf50-133">Aşağıdaki diyagramda, daha önce oluşturulan "istek ekle" etkinliği sol bölmede seçilidir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-133">In the following diagram, the "Add request" activity created previously is selected on the left panel.</span></span> <span data-ttu-id="5cf50-134">Uygulama istemci programını oluşturan üç farklı matematik işlemi etkinliği (Böl, çıkart, çarpma) ile listelenir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-134">It is listed with three other Math operation activities (Divide, Subtract, Multiply) that constitute the application client program.</span></span> <span data-ttu-id="5cf50-135">Kullanıcı kodu, farklı isteklerindeki olası hata oluşumlarını yalıtmak için her işlem için bir yeni etkinlik tanımladı.</span><span class="sxs-lookup"><span data-stu-id="5cf50-135">The user code has defined one new activity for each operation to isolate potential error occurrences in different requests.</span></span>

<span data-ttu-id="5cf50-136">[Genişletme izleme](../../samples/extending-tracing.md) örneğinde aktarımların kullanımını göstermek için, dört işlem isteğini kapsülleyen bir hesap makinesi etkinliği de oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="5cf50-136">To demonstrate the use of transfers in the [Extending Tracing](../../samples/extending-tracing.md) sample, a Calculator activity that encapsulates the four operation requests is also created.</span></span> <span data-ttu-id="5cf50-137">Her istek için, hesap makinesi etkinliğinden istek etkinliğine geri ve geriye doğru bir aktarım vardır (izleme, şekildeki sağ üst bölmede vurgulanır).</span><span class="sxs-lookup"><span data-stu-id="5cf50-137">For each request, there is a transfer back and forth from the Calculator activity to the request activity (trace is highlighted in the upper right panel in the figure).</span></span>

<span data-ttu-id="5cf50-138">Sol panelde bir etkinlik seçtiğinizde, bu etkinliğin içerdiği izlemeler sağ üst bölmede gösterilir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-138">When you select an activity on the left panel, the traces included by this activity are shown on the upper right panel.</span></span> <span data-ttu-id="5cf50-139">`propagateActivity` `true` İstek yolundaki her uç noktada, istek etkinliğindeki izlemeler, isteğe katılan tüm işlemlerden alınır.</span><span class="sxs-lookup"><span data-stu-id="5cf50-139">If `propagateActivity` is `true` at every endpoint in the request path, traces in the request activity are from all processes that participate in the request.</span></span> <span data-ttu-id="5cf50-140">Bu örnekte, paneldeki 4 sütununda hem istemci hem de hizmetten izlemeleri görebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-140">In this example, you can see traces from both the client and service in the 4th column in the panel.</span></span>

<span data-ttu-id="5cf50-141">Bu etkinlik aşağıdaki işleme sırasını gösterir:</span><span class="sxs-lookup"><span data-stu-id="5cf50-141">This activity shows the following order of processing:</span></span>

1. <span data-ttu-id="5cf50-142">İstemci eklemek için ileti gönderir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-142">Client sends message to Add.</span></span>

2. <span data-ttu-id="5cf50-143">Hizmet, ekleme isteği iletisi alır.</span><span class="sxs-lookup"><span data-stu-id="5cf50-143">Service receives Add request message.</span></span>

3. <span data-ttu-id="5cf50-144">Hizmet, Add yanıtı gönderir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-144">Service sends Add response.</span></span>

4. <span data-ttu-id="5cf50-145">İstemci, ekleme yanıtı alır.</span><span class="sxs-lookup"><span data-stu-id="5cf50-145">Client receives Add response.</span></span>

<span data-ttu-id="5cf50-146">Tüm bu izlemeler bilgi düzeyine yayılmıştı.</span><span class="sxs-lookup"><span data-stu-id="5cf50-146">All these traces were emitted at Information level.</span></span> <span data-ttu-id="5cf50-147">Sağ üst panelde bir izlemeye tıkladığınızda sağ alt panelde bu izlemenin ayrıntıları gösterilir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-147">Clicking a trace in the upper-right panel shows the details of that trace in the lower-right panel.</span></span>

<span data-ttu-id="5cf50-148">Aşağıdaki diyagramda Ayrıca, hesap ve hizmet için bir tane olmak üzere (her izleme kaynağı için bir tane) bir tane olmak üzere, bir veya daha fazla istek için izleme ve durdurma ve hesaplama etkinliklerini de görtik.</span><span class="sxs-lookup"><span data-stu-id="5cf50-148">In the following diagram, we also see transfer traces from and to the Calculator activity, as well as two pairs of Start and Stop traces per request activity, one for the client and one for the service (one for each trace source).</span></span>

<span data-ttu-id="5cf50-149">![Izleme Görüntüleyicisi: kullanıcı&#45;kod Izlemelerini yayma](media/242c9358-475a-4baf-83f3-4227aa942fcd.gif "242c9358-475A-4BAF-83f3-4227aa942fcd") Oluşturma zamanına göre etkinlik listesi (sol panel) ve iç içe geçmiş Etkinlikleri (sağ üst panel)</span><span class="sxs-lookup"><span data-stu-id="5cf50-149">![Trace Viewer: Emitting User&#45;code traces](media/242c9358-475a-4baf-83f3-4227aa942fcd.gif "242c9358-475a-4baf-83f3-4227aa942fcd") List of activities by creation time (left panel) and their nested activities (upper-right panel)</span></span>

<span data-ttu-id="5cf50-150">Hizmet kodu, istemcinin oluşturmasına neden olan bir özel durum oluşturursa (örneğin, istemci isteğine yanıt alamazsanız), hem hizmet hem de istemci uyarısı veya hata iletileri doğrudan bağıntı için aynı etkinlikte oluşur.</span><span class="sxs-lookup"><span data-stu-id="5cf50-150">If the service code throws an exception that causes the client to throw as well (for example, when the client did not get the response to its request), both the service and client warning or error messages occur in the same activity for direct correlation.</span></span> <span data-ttu-id="5cf50-151">Aşağıdaki görüntüde hizmet, "hizmet bu isteği Kullanıcı kodunda işlemeye reddediyor" durumunu belirten bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5cf50-151">In the following image, the service throws an exception that states "The service refuses to process this request in user code."</span></span> <span data-ttu-id="5cf50-152">İstemci Ayrıca "sunucu bir iç hata nedeniyle isteği işleyemedi" adlı bir özel durum oluşturur.</span><span class="sxs-lookup"><span data-stu-id="5cf50-152">The client also throws an exception that states "The server was unable to process the request due to an internal error."</span></span>

<span data-ttu-id="5cf50-153">Aşağıdaki görüntüler, istek etkinlik kimliği yayıldığında, belirli bir istek için uç noktalar arasındaki hataların aynı etkinlikte göründüğünü gösterir:</span><span class="sxs-lookup"><span data-stu-id="5cf50-153">The following images shows that errors across endpoints for a given request appear in the same activity if the request activity id was propagated:</span></span>

![Belirli bir istek için uç noktalar arasındaki hataları gösteren ekran görüntüsü.](./media/emitting-user-code-traces/trace-viewer-endpoint-errors.gif)

<span data-ttu-id="5cf50-155">Sol paneldeki çarpma etkinliğine çift tıklamak, ilgili her bir işlemin çarpılacağı izlemeleri içeren aşağıdaki grafiği gösterir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-155">Double-clicking the Multiply activity on the left panel shows the following graph, with the traces for the Multiply activity for each process involved.</span></span> <span data-ttu-id="5cf50-156">Hizmette (özel durum oluştu) bir uyarı görüyoruz, bu, isteğin işlenemediği için istemcideki uyarılar ve hatalar tarafından izlenir.</span><span class="sxs-lookup"><span data-stu-id="5cf50-156">We can see a warning first occurred at the service (exception thrown), which is followed by warnings and errors on the client because the request could not be processed.</span></span> <span data-ttu-id="5cf50-157">Bu nedenle, uç noktalar arasındaki causal hata ilişkisini belirleyebilir ve hatanın kök nedenini türetebiliriz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-157">Therefore, we can imply the causal error relationship between endpoints and derive the root cause of the error.</span></span>

<span data-ttu-id="5cf50-158">Aşağıdaki görüntüde hata bağıntısı grafik görünümü gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="5cf50-158">The following image shows a graph view of error correlation:</span></span>

![Hatanın bağıntı grafik görünümünü gösteren ekran görüntüsü.](./media/emitting-user-code-traces/trace-viewer-error-correlation.gif)

<span data-ttu-id="5cf50-160">Önceki izlemeleri almak için `ActivityTracing` Kullanıcı izleme kaynakları ve izleme kaynağı için ayarlandık `propagateActivity=true` `System.ServiceModel` .</span><span class="sxs-lookup"><span data-stu-id="5cf50-160">To obtain the previous traces, we set `ActivityTracing` for the user trace sources and `propagateActivity=true` for the `System.ServiceModel` trace source.</span></span> <span data-ttu-id="5cf50-161">Kullanıcı kodu `ActivityTracing` `System.ServiceModel` etkinlik yayılmaya kullanıcı kodunun etkinleştirilmesi için izleme kaynağı için ayarlanmadınız.</span><span class="sxs-lookup"><span data-stu-id="5cf50-161">We did not set `ActivityTracing` for the `System.ServiceModel` trace source to enable user code to user code activity propagation.</span></span> <span data-ttu-id="5cf50-162">(ServiceModel etkinlik izleme açık olduğunda, istemcide tanımlanan etkinlik KIMLIĞI, hizmet kullanıcı koduna tüm şekilde yayılmaz; Ancak, istemci ve hizmet Kullanıcı kodu etkinliklerini ara WCF etkinlikleriyle ilişkilendirmenize karşın aktarır.)</span><span class="sxs-lookup"><span data-stu-id="5cf50-162">(When ServiceModel activity tracing is on, the activity ID defined in the client is not propagated all the way to the service user code; Transfers, however, correlate the client and service user code activities to the intermediate WCF activities.)</span></span>

<span data-ttu-id="5cf50-163">Etkinlikleri tanımlama ve etkinlik KIMLIĞI yaymaya bitiş noktaları arasında doğrudan hata bağıntısı gerçekleştirmemizi sağlar.</span><span class="sxs-lookup"><span data-stu-id="5cf50-163">Defining activities and propagating the activity ID enables us to perform direct error correlation across endpoints.</span></span> <span data-ttu-id="5cf50-164">Bu şekilde, hatanın kök nedenini daha hızlı bulabiliriz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-164">In this way, we can locate the root cause of an error more quickly.</span></span>

## <a name="see-also"></a><span data-ttu-id="5cf50-165">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="5cf50-165">See also</span></span>

- [<span data-ttu-id="5cf50-166">İzlemeyi Genişletme</span><span class="sxs-lookup"><span data-stu-id="5cf50-166">Extending Tracing</span></span>](../../samples/extending-tracing.md)
