---
title: SQL Server’da Veritabanı Yansıtması
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: 7e2c1c8ea1cbc1bb22452b9ef9d1f250c96118ea
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91173542"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="1a2a5-102">SQL Server’da Veritabanı Yansıtması</span><span class="sxs-lookup"><span data-stu-id="1a2a5-102">Database Mirroring in SQL Server</span></span>

<span data-ttu-id="1a2a5-103">SQL Server veritabanı yansıtma, bir SQL Server veritabanının kopyasını veya yansıtmasını bekleyen bir sunucuda tutmanıza olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="1a2a5-104">Yansıtma, verilerin iki ayrı kopyasının her zaman olmasını sağlar ve yüksek kullanılabilirlik ve tamamen veri artıklığı sağlar.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="1a2a5-105">SQL Server için .NET Veri Sağlayıcısı, veritabanı yansıtma için örtülü destek sağlar; böylece Geliştirici, bir SQL Server veritabanı için yapılandırıldıktan sonra herhangi bir eylemde bulunan veya herhangi bir kod yazmanıza gerek kalmaz.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="1a2a5-106">Ayrıca, <xref:System.Data.SqlClient.SqlConnection> nesnesi, içinde bir yük devretme ortağı sunucusunun adı sağlamaya izin veren bir açık bağlantı modunu destekler <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A> .</span><span class="sxs-lookup"><span data-stu-id="1a2a5-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="1a2a5-107"><xref:System.Data.SqlClient.SqlConnection>Yansıtma için yapılandırılmış bir veritabanını hedefleyen bir nesne için aşağıdaki Basitleştirilmiş olay dizisi oluşur:</span><span class="sxs-lookup"><span data-stu-id="1a2a5-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="1a2a5-108">İstemci uygulaması başarıyla asıl veritabanına bağlanır ve sunucu daha sonra istemci üzerinde önbelleğe alınmış olan ortak sunucunun adını geri gönderir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="1a2a5-109">Asıl veritabanını içeren sunucu başarısız olursa veya bağlantı kesintiye uğrarsa bağlantı ve işlem durumu kaybedilir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="1a2a5-110">İstemci uygulaması, asıl veritabanıyla bir bağlantıyı yeniden kurmaya çalışır ve başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="1a2a5-111">İstemci uygulaması daha sonra, ortak sunucusundaki yansıtma veritabanıyla bir bağlantı kurmaya çalışır.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="1a2a5-112">Başarılı olursa bağlantı, yansıtma veritabanına yönlendirilir ve bu da yeni sorumlu veritabanı olur.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="1a2a5-113">Bağlantı dizesinde yük devretme ortağını belirtme</span><span class="sxs-lookup"><span data-stu-id="1a2a5-113">Specifying the Failover Partner in the Connection String</span></span>  

 <span data-ttu-id="1a2a5-114">Bağlantı dizesinde bir yük devretme iş ortağı sunucusunun adını sağlarsanız, istemci uygulaması ilk kez bağlanırken asıl veritabanı kullanılamadığında, istemci, yük devretme ortağıyla birlikte bir bağlantı kurmayı dener.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```csharp
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="1a2a5-115">Yük devretme ortağı sunucusunun adını atlarsanız ve istemci uygulaması ilk kez bağlandığında asıl veritabanı kullanılabilir değilse, bir oluşturulur <xref:System.Data.SqlClient.SqlException> .</span><span class="sxs-lookup"><span data-stu-id="1a2a5-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="1a2a5-116">Bir <xref:System.Data.SqlClient.SqlConnection> başarıyla açıldığında, yük devretme ortağı adı sunucu tarafından döndürülür ve bağlantı dizesinde sağlanan tüm değerlerin yerini alır.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1a2a5-117">Veritabanı yansıtma senaryoları için bağlantı dizesinde başlangıç kataloğunu veya veritabanı adını açıkça belirtmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="1a2a5-118">İstemci, açıkça belirtilen bir başlangıç kataloğu veya veritabanına sahip olmayan bir bağlantıda yük devretme bilgileri alırsa, yük devretme bilgileri önbelleğe alınmaz ve asıl sunucu başarısız olursa uygulama yük devretmeye çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="1a2a5-119">Bir bağlantı dizesinde yük devretme ortağı için bir değer varsa, ancak ilk katalog veya veritabanı için değer yoksa bir `InvalidArgumentException` oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="1a2a5-120">Geçerli sunucu adı alınıyor</span><span class="sxs-lookup"><span data-stu-id="1a2a5-120">Retrieving the Current Server Name</span></span>  

 <span data-ttu-id="1a2a5-121">Yük devretme durumunda, geçerli bağlantının gerçekten bağlı olduğu sunucu adını <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> bir nesnenin özelliğini kullanarak alabilirsiniz <xref:System.Data.SqlClient.SqlConnection> .</span><span class="sxs-lookup"><span data-stu-id="1a2a5-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="1a2a5-122">Aşağıdaki kod parçası, bağlantı değişkeninin açık bir başvuru olduğunu varsayarak, etkin sunucunun adını alır <xref:System.Data.SqlClient.SqlConnection> .</span><span class="sxs-lookup"><span data-stu-id="1a2a5-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="1a2a5-123">Bir yük devretme olayı gerçekleştiğinde ve bağlantı yansıtma sunucusuna dönüştürüldüğünde, **DataSource** özelliği yansıtma adını yansıtacak şekilde güncelleştirilir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="1a2a5-124">SqlClient yansıtma davranışı</span><span class="sxs-lookup"><span data-stu-id="1a2a5-124">SqlClient Mirroring Behavior</span></span>  

 <span data-ttu-id="1a2a5-125">İstemci her zaman geçerli asıl sunucuya bağlanmayı dener.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="1a2a5-126">Başarısız olursa, yük devretme ortağını dener.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="1a2a5-127">Yansıtma veritabanı zaten ortak sunucusunda sorumlu rolüne geçdiyse, bağlantı başarılı olur ve yeni asıl yansıtma eşlemesi istemciye gönderilir ve çağırmanın ömrü boyunca önbelleğe alınır <xref:System.AppDomain> .</span><span class="sxs-lookup"><span data-stu-id="1a2a5-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="1a2a5-128">Kalıcı depolamada depolanmaz ve farklı bir **AppDomain** veya işlemdeki sonraki bağlantılarda kullanılamaz.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="1a2a5-129">Ancak, aynı **AppDomain**içindeki sonraki bağlantılar için de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="1a2a5-130">Aynı ya da farklı bir bilgisayar üzerinde çalışan başka bir **AppDomain** veya işlemin her zaman bağlantı havuzu olduğunu ve bu bağlantıların sıfırlanmadığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="1a2a5-131">Bu durumda, birincil veritabanı kapalıysa, her işlem veya **AppDomain** bir kez başarısız olur ve havuz otomatik olarak temizlenir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1a2a5-132">Sunucuda yansıtma desteği, veritabanı başına temelinde yapılandırılır.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="1a2a5-133">Veri işleme işlemleri sorumlu/yansıtma kümesine dahil olmayan diğer veritabanlarına karşı yürütülürse, çok parçalı adlar kullanarak veya geçerli veritabanını değiştirerek, diğer veritabanlarında yapılan değişiklikler hata durumunda yayılmaz.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="1a2a5-134">Yansıtılmış olmayan bir veritabanında veri değiştirildiğinde hiçbir hata oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="1a2a5-135">Geliştirici, bu işlemlerin olası etkisini değerlendirmelidir.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="1a2a5-136">Veritabanı yansıtma kaynakları</span><span class="sxs-lookup"><span data-stu-id="1a2a5-136">Database Mirroring Resources</span></span>  

 <span data-ttu-id="1a2a5-137">Yansıtma yapılandırma, dağıtma ve yönetme hakkında kavramsal belgeler ve bilgiler için SQL Server belgelerine bakın.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="1a2a5-138">Kaynak</span><span class="sxs-lookup"><span data-stu-id="1a2a5-138">Resource</span></span>|<span data-ttu-id="1a2a5-139">Açıklama</span><span class="sxs-lookup"><span data-stu-id="1a2a5-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="1a2a5-140">Veritabanı Yansıtması</span><span class="sxs-lookup"><span data-stu-id="1a2a5-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="1a2a5-141">SQL Server yansıtma ayarlamayı ve yapılandırmayı açıklar.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="1a2a5-142">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="1a2a5-142">See also</span></span>

- [<span data-ttu-id="1a2a5-143">ADO.NET’e Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="1a2a5-143">ADO.NET Overview</span></span>](../ado-net-overview.md)
