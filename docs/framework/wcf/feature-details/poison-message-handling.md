---
title: Zehirli İleti İşleme
ms.date: 03/30/2017
ms.assetid: 8d1c5e5a-7928-4a80-95ed-d8da211b8595
ms.openlocfilehash: 378849815617f6556a7d9cc7e89c6697bfdd895d
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/09/2020
ms.locfileid: "77095001"
---
# <a name="poison-message-handling"></a><span data-ttu-id="aa000-102">Zehirli İleti İşleme</span><span class="sxs-lookup"><span data-stu-id="aa000-102">Poison Message Handling</span></span>
<span data-ttu-id="aa000-103">*Zararlı ileti* , uygulamaya yönelik en fazla teslim deneme sayısını aşmış bir iletidir.</span><span class="sxs-lookup"><span data-stu-id="aa000-103">A *poison message* is a message that has exceeded the maximum number of delivery attempts to the application.</span></span> <span data-ttu-id="aa000-104">Bu durum, kuyruk tabanlı bir uygulama hatalar nedeniyle bir iletiyi işleyemediği zaman ortaya çıkabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-104">This situation can arise when a queue-based application cannot process a message because of errors.</span></span> <span data-ttu-id="aa000-105">Bir sıraya alınmış uygulama, güvenilirlik taleplerini karşılamak için bir işlem altında iletileri alır.</span><span class="sxs-lookup"><span data-stu-id="aa000-105">To meet reliability demands, a queued application receives messages under a transaction.</span></span> <span data-ttu-id="aa000-106">Sıraya alınan bir iletinin alındığı işlemi iptal etmek, iletinin yeni bir işlem altında yeniden deneneceği şekilde kuyruktaki iletiyi bırakır.</span><span class="sxs-lookup"><span data-stu-id="aa000-106">Aborting the transaction in which a queued message was received leaves the message in the queue so that the message is retried under a new transaction.</span></span> <span data-ttu-id="aa000-107">İşlemin iptaline neden olan sorun düzeltilmezse, alıcı uygulama, en fazla sayıda teslim denemesi aşılıncaya ve bir zarar iletisi sonuçlarıyla aynı iletiyi alıp iptal etmeden bir döngüde kalabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-107">If the problem that caused the transaction to abort is not corrected, the receiving application can get stuck in a loop receiving and aborting the same message until the maximum number of delivery attempts has been exceeded and a poison message results.</span></span>  
  
 <span data-ttu-id="aa000-108">Birçok nedenden dolayı bir ileti bir zarar iletisi olabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-108">A message can become a poison message for many reasons.</span></span> <span data-ttu-id="aa000-109">En yaygın nedenler uygulamaya özgüdür.</span><span class="sxs-lookup"><span data-stu-id="aa000-109">The most common reasons are application-specific.</span></span> <span data-ttu-id="aa000-110">Örneğin, bir uygulama kuyruktan bir ileti okur ve bazı veritabanı işlemlerini gerçekleştirdiğinde, uygulama veritabanında bir kilit alamaz ve işlemin iptal edilmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="aa000-110">For example, if an application reads a message from a queue and performs some database processing, the application may fail to get a lock on the database, causing it to abort the transaction.</span></span> <span data-ttu-id="aa000-111">Veritabanı işlemi durdurulduğundan, ileti kuyrukta kalır, bu da uygulamanın iletiyi ikinci kez yeniden kullanmasına ve veritabanında kilit edinmeye yönelik başka bir girişim yapmasına neden olur.</span><span class="sxs-lookup"><span data-stu-id="aa000-111">Because the database transaction was aborted, the message remains in the queue, which causes the application to reread the message a second time and make another attempt to acquire a lock on the database.</span></span> <span data-ttu-id="aa000-112">Ayrıca, geçersiz bilgiler içeriyorsa iletiler zarar verebilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-112">Messages can also become poison if they contain invalid information.</span></span> <span data-ttu-id="aa000-113">Örneğin, bir satınalma siparişi geçersiz bir müşteri numarası içerebilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-113">For example, a purchase order may contain an invalid customer number.</span></span> <span data-ttu-id="aa000-114">Bu durumlarda, uygulama gönüllü olarak işlemi iptal edebilir ve iletiyi bir zarar iletisi haline zorlayabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-114">In these cases, the application may voluntarily abort the transaction and force the message to become a poison message.</span></span>  
  
 <span data-ttu-id="aa000-115">Nadir durumlarda, iletiler uygulamaya dağıtılması başarısız olabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-115">On rare occasions, messages can fail to get dispatched to the application.</span></span> <span data-ttu-id="aa000-116">Windows Communication Foundation (WCF) katmanı, iletide yanlış çerçeve varsa, kendisine bağlı geçersiz ileti kimlik bilgileri veya geçersiz bir eylem üstbilgisi gibi iletiyle ilgili bir sorun bulabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-116">The Windows Communication Foundation (WCF) layer may find a problem with the message, such as if the message has the wrong frame, invalid message credentials attached to it, or an invalid action header.</span></span> <span data-ttu-id="aa000-117">Bu durumlarda, uygulama hiçbir zaman iletiyi almaz; Ancak, ileti hala zarar görmüş bir ileti haline gelebilir ve el ile işlenebilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-117">In these cases, the application never receives the message; however, the message can still become a poison message and be processed manually.</span></span>  
  
## <a name="handling-poison-messages"></a><span data-ttu-id="aa000-118">Zarar Iletilerini işleme</span><span class="sxs-lookup"><span data-stu-id="aa000-118">Handling Poison Messages</span></span>  
 <span data-ttu-id="aa000-119">WCF 'de, zehirli ileti işleme, uygulamaya dağıtılan ancak uygulamaya özgü bir nedenle işlenemeyecek olan, uygulama veya iletilere iletilemez olan iletilerle ilgilenmesi için alıcı bir uygulama mekanizması sağlar olası.</span><span class="sxs-lookup"><span data-stu-id="aa000-119">In WCF, poison message handling provides a mechanism for a receiving application to deal with messages that cannot be dispatched to the application or messages that are dispatched to the application but that fail to be processed because of application-specific reasons.</span></span> <span data-ttu-id="aa000-120">Her kullanılabilir sıraya alınmış bağlamaların her birinde aşağıdaki özelliklerle, zehirli ileti işlemeyi yapılandırın:</span><span class="sxs-lookup"><span data-stu-id="aa000-120">Configure poison message handling with the following properties in each of the available queued bindings:</span></span>  
  
- <span data-ttu-id="aa000-121">`ReceiveRetryCount`.</span><span class="sxs-lookup"><span data-stu-id="aa000-121">`ReceiveRetryCount`.</span></span> <span data-ttu-id="aa000-122">Uygulama kuyruğundan uygulamaya bir ileti teslimini yeniden deneme sayısının üst sınırını belirten bir tamsayı değeri.</span><span class="sxs-lookup"><span data-stu-id="aa000-122">An integer value that indicates the maximum number of times to retry delivery of a message from the application queue to the application.</span></span> <span data-ttu-id="aa000-123">Varsayılan değer 5 ' tir.</span><span class="sxs-lookup"><span data-stu-id="aa000-123">The default value is 5.</span></span> <span data-ttu-id="aa000-124">Bu, bir veritabanında geçici bir kilitlenme gibi bir anında yeniden denemenin sorunu düzelttiği durumlarda yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="aa000-124">This is sufficient in cases where an immediate retry fixes the problem, such as with a temporary deadlock on a database.</span></span>  
  
- <span data-ttu-id="aa000-125">`MaxRetryCycles`.</span><span class="sxs-lookup"><span data-stu-id="aa000-125">`MaxRetryCycles`.</span></span> <span data-ttu-id="aa000-126">En fazla yeniden deneme döngüsü sayısını belirten bir tamsayı değeri.</span><span class="sxs-lookup"><span data-stu-id="aa000-126">An integer value that indicates the maximum number of retry cycles.</span></span> <span data-ttu-id="aa000-127">Yeniden deneme çevrimi, bir iletiyi uygulama kuyruğundan yeniden deneme alt sırasına ve yapılandırılabilir bir gecikmeden sonra yeniden deneme alt sırasından yeniden uygulama kuyruğuna aktarma işleminden oluşur.</span><span class="sxs-lookup"><span data-stu-id="aa000-127">A retry cycle consists of transferring a message from the application queue to the retry subqueue and, after a configurable delay, from the retry subqueue back into the application queue to reattempt delivery.</span></span> <span data-ttu-id="aa000-128">Varsayılan değer 2 ' dir.</span><span class="sxs-lookup"><span data-stu-id="aa000-128">The default value is 2.</span></span> <span data-ttu-id="aa000-129">Windows Vista 'da ileti en fazla (`ReceiveRetryCount` + 1) \* (`MaxRetryCycles` + 1) kez denenir.</span><span class="sxs-lookup"><span data-stu-id="aa000-129">On Windows Vista, the message is tried a maximum of (`ReceiveRetryCount` +1) \* (`MaxRetryCycles` + 1) times.</span></span> <span data-ttu-id="aa000-130">`MaxRetryCycles`, Windows Server 2003 ve Windows XP 'de yok sayılır.</span><span class="sxs-lookup"><span data-stu-id="aa000-130">`MaxRetryCycles` is ignored on Windows Server 2003 and Windows XP.</span></span>  
  
- <span data-ttu-id="aa000-131">`RetryCycleDelay`.</span><span class="sxs-lookup"><span data-stu-id="aa000-131">`RetryCycleDelay`.</span></span> <span data-ttu-id="aa000-132">Yeniden deneme döngüleri arasındaki gecikme süresi.</span><span class="sxs-lookup"><span data-stu-id="aa000-132">The time delay between retry cycles.</span></span> <span data-ttu-id="aa000-133">Varsayılan değer 30 dakikadır.</span><span class="sxs-lookup"><span data-stu-id="aa000-133">The default value is 30 minutes.</span></span> <span data-ttu-id="aa000-134">`MaxRetryCycles` ve `RetryCycleDelay` birlikte, bir düzenli gecikmeden sonra yeniden deneme sorunu çözdükleri sorunu gidermeye yönelik bir mekanizma sağlar.</span><span class="sxs-lookup"><span data-stu-id="aa000-134">`MaxRetryCycles` and `RetryCycleDelay` together provide a mechanism to address the problem where a retry after a periodic delay fixes the problem.</span></span> <span data-ttu-id="aa000-135">Örneğin, bu, bekleyen işlem işleme SQL Server bir kilitli satırı işler.</span><span class="sxs-lookup"><span data-stu-id="aa000-135">For example, this handles a locked row set in SQL Server pending transaction commit.</span></span>  
  
- <span data-ttu-id="aa000-136">`ReceiveErrorHandling`.</span><span class="sxs-lookup"><span data-stu-id="aa000-136">`ReceiveErrorHandling`.</span></span> <span data-ttu-id="aa000-137">En fazla yeniden deneme sayısı denendikten sonra teslim başarısız olan bir ileti için gerçekleştirilecek eylemi belirten bir sabit listesi.</span><span class="sxs-lookup"><span data-stu-id="aa000-137">An enumeration that indicates the action to take for a message that has failed delivery after the maximum number of retries has been attempted.</span></span> <span data-ttu-id="aa000-138">Değerler hata, bırakma, reddetme ve taşıma olabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-138">The values can be Fault, Drop, Reject, and Move.</span></span> <span data-ttu-id="aa000-139">Varsayılan seçenek hatadır.</span><span class="sxs-lookup"><span data-stu-id="aa000-139">The default option is Fault.</span></span>  
  
- <span data-ttu-id="aa000-140">Dayanıklı.</span><span class="sxs-lookup"><span data-stu-id="aa000-140">Fault.</span></span> <span data-ttu-id="aa000-141">Bu seçenek, `ServiceHost` hataya neden olan dinleyiciye bir hata gönderir.</span><span class="sxs-lookup"><span data-stu-id="aa000-141">This option sends a fault to the listener that caused the `ServiceHost` to fault.</span></span> <span data-ttu-id="aa000-142">Uygulamanın sıradan iletileri işlemeye devam edebilmesi için, iletinin bazı dış mekanizmadan uygulama kuyruğundan kaldırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="aa000-142">The message must be removed from the application queue by some external mechanism before the application can continue to process messages from the queue.</span></span>  
  
- <span data-ttu-id="aa000-143">Açılan.</span><span class="sxs-lookup"><span data-stu-id="aa000-143">Drop.</span></span> <span data-ttu-id="aa000-144">Bu seçenek, zarar iletisini bırakır ve ileti hiçbir şekilde uygulamaya teslim değildir.</span><span class="sxs-lookup"><span data-stu-id="aa000-144">This option drops the poison message and the message is never delivered to the application.</span></span> <span data-ttu-id="aa000-145">Bu noktada iletinin `TimeToLive` özelliğinin süresi dolmuşsa ileti, gönderenin teslim edilemeyen ileti kuyruğunda görünebilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-145">If the message's `TimeToLive` property has expired at this point, then the message may appear in the sender's dead-letter queue.</span></span> <span data-ttu-id="aa000-146">Aksi takdirde, ileti herhangi bir yerde görünmez.</span><span class="sxs-lookup"><span data-stu-id="aa000-146">If not, the message does not appear anywhere.</span></span> <span data-ttu-id="aa000-147">Bu seçenek, iletinin kaybolması durumunda kullanıcının ne yapılacağını belirtmediğini belirtir.</span><span class="sxs-lookup"><span data-stu-id="aa000-147">This option indicates that the user has not specified what to do if the message is lost.</span></span>  
  
- <span data-ttu-id="aa000-148">Mesi.</span><span class="sxs-lookup"><span data-stu-id="aa000-148">Reject.</span></span> <span data-ttu-id="aa000-149">Bu seçenek yalnızca Windows Vista 'da kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-149">This option is available only on Windows Vista.</span></span> <span data-ttu-id="aa000-150">Bu, Message Queuing (MSMQ) ' nin, uygulamanın iletiyi alamaması için gönderme kuyruğu yöneticisine olumsuz bir bildirim göndermesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="aa000-150">This instructs Message Queuing (MSMQ) to send a negative acknowledgment back to the sending queue manager that the application cannot receive the message.</span></span> <span data-ttu-id="aa000-151">İleti, gönderme kuyruğu yöneticisinin atılacak ileti kuyruğuna yerleştirilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-151">The message is placed in the sending queue manager's dead-letter queue.</span></span>  
  
- <span data-ttu-id="aa000-152">Geçiş.</span><span class="sxs-lookup"><span data-stu-id="aa000-152">Move.</span></span> <span data-ttu-id="aa000-153">Bu seçenek yalnızca Windows Vista 'da kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-153">This option is available only on Windows Vista.</span></span> <span data-ttu-id="aa000-154">Bu, zarar iletisini daha sonra bir zarar iletisi işleme uygulaması tarafından işlenmek üzere bir zarar iletisi kuyruğuna taşIar.</span><span class="sxs-lookup"><span data-stu-id="aa000-154">This moves the poison message to a poison-message queue for later processing by a poison-message handling application.</span></span> <span data-ttu-id="aa000-155">Poison-Message kuyruğu, uygulama sırasının bir alt sıranız.</span><span class="sxs-lookup"><span data-stu-id="aa000-155">The poison-message queue is a subqueue of the application queue.</span></span> <span data-ttu-id="aa000-156">Zararlı ileti işleme uygulaması, zarar sırasındaki iletileri okuyan bir WCF hizmeti olabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-156">A poison-message handling application can be a WCF service that reads messages out of the poison queue.</span></span> <span data-ttu-id="aa000-157">Zarar sırası, uygulama sırasının bir alt sıranız ve net. MSMQ://\<*makine adı*>/*applicationQueue*;p oison olarak çözülebilir. burada *makine adı* , sıranın bulunduğu bilgisayarın adı ve *applicationQueue* uygulamaya özgü kuyruğun adıdır.</span><span class="sxs-lookup"><span data-stu-id="aa000-157">The poison queue is a subqueue of the application queue and can be addressed as net.msmq://\<*machine-name*>/*applicationQueue*;poison, where *machine-name* is the name of the computer on which the queue resides and the *applicationQueue* is the name of the application-specific queue.</span></span>  
  
<span data-ttu-id="aa000-158">Aşağıda, bir ileti için yapılan en fazla teslim denemesi sayısı verilmiştir:</span><span class="sxs-lookup"><span data-stu-id="aa000-158">The following are the maximum number of delivery attempts made for a message:</span></span>  
  
- <span data-ttu-id="aa000-159">((ReceiveRetryCount + 1) \* (Maxretrydöngülerini + 1)) Windows Vista 'da.</span><span class="sxs-lookup"><span data-stu-id="aa000-159">((ReceiveRetryCount+1) \* (MaxRetryCycles + 1)) on Windows Vista.</span></span>  
  
- <span data-ttu-id="aa000-160">(ReceiveRetryCount + 1) Windows Server 2003 ve Windows XP 'de.</span><span class="sxs-lookup"><span data-stu-id="aa000-160">(ReceiveRetryCount + 1) on Windows Server 2003 and Windows XP.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="aa000-161">Başarıyla teslim edilen bir ileti için yeniden deneme yapılmadı.</span><span class="sxs-lookup"><span data-stu-id="aa000-161">No retries are made for a message that is delivered successfully.</span></span>  
  
 <span data-ttu-id="aa000-162">İleti okuma girişimi sayısını izlemek için, Windows Vista, uygulamanın sırası ve alt sıraları arasında iletinin kaç kez hareket edeceğini sayan bir taşıma sayısı özelliğinin sayısını sayan sürekli bir ileti özelliği tutar.</span><span class="sxs-lookup"><span data-stu-id="aa000-162">To keep track of the number of times a message read is attempted, Windows Vista maintains a durable message property that counts the number of aborts and a move count property that counts the number of times the message moves between the application queue and subqueues.</span></span> <span data-ttu-id="aa000-163">WCF kanalı, alma yeniden deneme sayısı ve yeniden deneme döngüsü sayısını hesaplamak için bunları kullanır.</span><span class="sxs-lookup"><span data-stu-id="aa000-163">The WCF channel uses these to compute the receive retry count and the retry cycles count.</span></span> <span data-ttu-id="aa000-164">Windows Server 2003 ve Windows XP 'de, durdurma sayısı WCF kanalı tarafından bellekte tutulur ve uygulama başarısız olursa sıfırlanır.</span><span class="sxs-lookup"><span data-stu-id="aa000-164">On Windows Server 2003 and Windows XP, the abort count is maintained in memory by the WCF channel and is reset if the application fails.</span></span> <span data-ttu-id="aa000-165">Ayrıca, WCF kanalı, her zaman bellekte en fazla 256 ileti için iptal sayısını tutabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-165">Also, the WCF channel can hold the abort counts for up to 256 messages in memory at any time.</span></span> <span data-ttu-id="aa000-166">Bir 257th iletisi okunsa, en eski iletinin durdurma sayısı sıfırlanır.</span><span class="sxs-lookup"><span data-stu-id="aa000-166">If a 257th message is read, then the oldest message's abort count is reset.</span></span>  
  
 <span data-ttu-id="aa000-167">Durdurma sayısı ve taşıma sayısı özellikleri, işlem bağlamı aracılığıyla hizmet işlemi için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-167">The abort count and move count properties are available to the service operation through the operation context.</span></span> <span data-ttu-id="aa000-168">Aşağıdaki kod örneğinde nasıl erişebileceğiniz gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="aa000-168">The following code example shows how to access them.</span></span>  
  
 [!code-csharp[S_UE_MSMQ_Poison#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ue_msmq_poison/cs/service.cs#1)]  
  
 <span data-ttu-id="aa000-169">WCF, iki standart sıraya alınmış bağlama sağlar:</span><span class="sxs-lookup"><span data-stu-id="aa000-169">WCF provides two standard queued bindings:</span></span>  
  
- <span data-ttu-id="aa000-170"><xref:System.ServiceModel.NetMsmqBinding>.</span><span class="sxs-lookup"><span data-stu-id="aa000-170"><xref:System.ServiceModel.NetMsmqBinding>.</span></span> <span data-ttu-id="aa000-171">Diğer WCF uç noktaları ile sıra tabanlı iletişim gerçekleştirmek için uygun bir .NET Framework bağlama.</span><span class="sxs-lookup"><span data-stu-id="aa000-171">A .NET Framework binding suitable for performing queue-based communication with other WCF endpoints.</span></span>  
  
- <span data-ttu-id="aa000-172"><xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span><span class="sxs-lookup"><span data-stu-id="aa000-172"><xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="aa000-173">Mevcut Message Queuing uygulamalarla iletişim kurmak için uygun bir bağlama.</span><span class="sxs-lookup"><span data-stu-id="aa000-173">A binding suitable for communicating with existing Message Queuing applications.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="aa000-174">WCF hizmetinizin gereksinimlerine bağlı olarak bu bağlamalardaki özellikleri değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-174">You can alter properties in these bindings based on the requirements of your WCF service.</span></span> <span data-ttu-id="aa000-175">Tüm zarar iletisi işleme mekanizması, alıcı uygulamada yereldir.</span><span class="sxs-lookup"><span data-stu-id="aa000-175">The entire poison message handling mechanism is local to the receiving application.</span></span> <span data-ttu-id="aa000-176">Alma uygulaması son olarak durdurulmadığı ve gönderene olumsuz bir bildirim gönderen sürece işlem gönderme uygulaması tarafından görünmez.</span><span class="sxs-lookup"><span data-stu-id="aa000-176">The process is invisible to the sending application unless the receiving application ultimately stops and sends a negative acknowledgment back to the sender.</span></span> <span data-ttu-id="aa000-177">Bu durumda, ileti gönderenin teslim edilemeyen ileti kuyruğuna taşınır.</span><span class="sxs-lookup"><span data-stu-id="aa000-177">In that case, the message is moved to the sender's dead-letter queue.</span></span>  
  
## <a name="best-practice-handling-msmqpoisonmessageexception"></a><span data-ttu-id="aa000-178">En iyi yöntem: Msmqkirmessageexception Işleme</span><span class="sxs-lookup"><span data-stu-id="aa000-178">Best Practice: Handling MsmqPoisonMessageException</span></span>  
 <span data-ttu-id="aa000-179">Hizmet bir iletinin Poison olduğunu belirlediğinde, sıraya alınan aktarım, zarar iletisinin `LookupId` içeren bir <xref:System.ServiceModel.MsmqPoisonMessageException> oluşturur.</span><span class="sxs-lookup"><span data-stu-id="aa000-179">When the service determines that a message is poison, the queued transport throws a <xref:System.ServiceModel.MsmqPoisonMessageException> that contains the `LookupId` of the poison message.</span></span>  
  
 <span data-ttu-id="aa000-180">Alıcı bir uygulama, uygulamanın gerektirdiği hataları işlemek için <xref:System.ServiceModel.Dispatcher.IErrorHandler> arabirimini uygulayabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-180">A receiving application can implement the <xref:System.ServiceModel.Dispatcher.IErrorHandler> interface to handle any errors that the application requires.</span></span> <span data-ttu-id="aa000-181">Daha fazla bilgi için bkz. [hata işleme ve raporlama üzerinde denetimi genişletme](../../../../docs/framework/wcf/samples/extending-control-over-error-handling-and-reporting.md).</span><span class="sxs-lookup"><span data-stu-id="aa000-181">For more information, see [Extending Control Over Error Handling and Reporting](../../../../docs/framework/wcf/samples/extending-control-over-error-handling-and-reporting.md).</span></span>  
  
 <span data-ttu-id="aa000-182">Uygulama, bir hizmetin sıradaki iletilerin geri kalanına erişebilmeleri için, zarar iletilerini bir zarar iletisi kuyruğuna taşırken, zarar iletilerinin bir dizi otomatik işlemesini gerektirebilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-182">The application may require some kind of automated handling of poison messages that moves the poison messages to a poison message queue so that the service can access the rest of the messages in the queue.</span></span> <span data-ttu-id="aa000-183">Yalnızca, bir hata işleyicisi mekanizmasını, zehirli ileti özel durumlarını dinlemek için kullanmaya yönelik tek senaryo, <xref:System.ServiceModel.Configuration.MsmqBindingElementBase.ReceiveErrorHandling%2A> ayarı <xref:System.ServiceModel.ReceiveErrorHandling.Fault>olarak ayarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="aa000-183">The only scenario for using the error-handler mechanism to listen for poison-message exceptions is when the <xref:System.ServiceModel.Configuration.MsmqBindingElementBase.ReceiveErrorHandling%2A> setting is set to <xref:System.ServiceModel.ReceiveErrorHandling.Fault>.</span></span> <span data-ttu-id="aa000-184">Message Queuing 3,0 için zehirli ileti örneği bu davranışı gösterir.</span><span class="sxs-lookup"><span data-stu-id="aa000-184">The poison-message sample for Message Queuing 3.0 demonstrates this behavior.</span></span> <span data-ttu-id="aa000-185">Aşağıda, en iyi yöntemler de dahil olmak üzere, zarar iletilerini işlemek için gereken adımlar özetlenmektedir:</span><span class="sxs-lookup"><span data-stu-id="aa000-185">The following outlines the steps to take to handle poison messages, including best practices:</span></span>  
  
1. <span data-ttu-id="aa000-186">Zarar ayarlarınızın uygulamanızın gereksinimlerini yansıttığından emin olun.</span><span class="sxs-lookup"><span data-stu-id="aa000-186">Ensure your poison settings reflect the requirements of your application.</span></span> <span data-ttu-id="aa000-187">Ayarlarla çalışırken, Windows Vista, Windows Server 2003 ve Windows XP 'de Message Queuing özellikleri arasındaki farklılıkları anladığınızdan emin olun.</span><span class="sxs-lookup"><span data-stu-id="aa000-187">When working with the settings, ensure that you understand the differences between the capabilities of Message Queuing on Windows Vista, Windows Server 2003, and Windows XP.</span></span>  
  
2. <span data-ttu-id="aa000-188">Gerekirse, zarar iletisi hatalarını işlemek için `IErrorHandler` uygulayın.</span><span class="sxs-lookup"><span data-stu-id="aa000-188">If necessary, implement the `IErrorHandler` to handle poison-message errors.</span></span> <span data-ttu-id="aa000-189">`Fault` `ReceiveErrorHandling` ayarı, zarar iletisini kuyruktan taşımak için el ile bir mekanizma gerektirdiğinden veya bir dış bağımlı sorunu düzelttiğinden, aşağıdaki kodda gösterildiği gibi, `ReceiveErrorHandling` `Fault`olarak ayarlandığında, tipik kullanım `IErrorHandler` uygulamadır.</span><span class="sxs-lookup"><span data-stu-id="aa000-189">Because setting `ReceiveErrorHandling` to `Fault` requires a manual mechanism to move the poison message out of the queue or to correct an external dependent issue, the typical usage is to implement `IErrorHandler` when `ReceiveErrorHandling` is set to `Fault`, as shown in the following code.</span></span>  
  
     [!code-csharp[S_UE_MSMQ_Poison#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ue_msmq_poison/cs/poisonerrorhandler.cs#2)]  
  
3. <span data-ttu-id="aa000-190">Hizmet davranışının kullanabileceği bir `PoisonBehaviorAttribute` oluşturun.</span><span class="sxs-lookup"><span data-stu-id="aa000-190">Create a `PoisonBehaviorAttribute` that the service behavior can use.</span></span> <span data-ttu-id="aa000-191">Davranışı dağıtıcıya `IErrorHandler` yüklenir.</span><span class="sxs-lookup"><span data-stu-id="aa000-191">The behavior installs the `IErrorHandler` on the dispatcher.</span></span> <span data-ttu-id="aa000-192">Aşağıdaki kod örneğine bakın.</span><span class="sxs-lookup"><span data-stu-id="aa000-192">See the following code example.</span></span>  
  
     [!code-csharp[S_UE_MSMQ_Poison#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/s_ue_msmq_poison/cs/poisonbehaviorattribute.cs#3)]  
  
4. <span data-ttu-id="aa000-193">Hizmetinizin Poison Behavior özniteliğiyle açıklaneklendiğinden emin olun.</span><span class="sxs-lookup"><span data-stu-id="aa000-193">Ensure that your service is annotated with the poison behavior attribute.</span></span>  

 <span data-ttu-id="aa000-194">Ayrıca, `ReceiveErrorHandling` `Fault`olarak ayarlanırsa, zarar iletisiyle karşılaşıldığında `ServiceHost` hataları.</span><span class="sxs-lookup"><span data-stu-id="aa000-194">In addition, if the `ReceiveErrorHandling` is set to `Fault`, the `ServiceHost` faults when encountering the poison message.</span></span> <span data-ttu-id="aa000-195">Hatalı olaya bağlanabilir ve hizmeti kapatabilir, düzeltici eylemler gerçekleştirebilir ve yeniden başlatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-195">You can hook up to the faulted event and shut down the service, take corrective actions, and restart.</span></span> <span data-ttu-id="aa000-196">Örneğin, `IErrorHandler` yayılan <xref:System.ServiceModel.MsmqPoisonMessageException> `LookupId` ve hizmet ana bilgisayarı hataları olduğunda, iletiyi kuyruktan kaldırmak ve iletiyi bazı harici depolardan veya başka bir sıraya depolamak için `LookupId` kullanarak sıradan iletiyi almak için `System.Messaging` API 'sini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-196">For example, the `LookupId` in the <xref:System.ServiceModel.MsmqPoisonMessageException> propagated to the `IErrorHandler` can be noted and when the service host faults, you could use the `System.Messaging` API to receive the message from the queue using the `LookupId` to remove the message from the queue and store the message in some external store or another queue.</span></span> <span data-ttu-id="aa000-197">Daha sonra normal işlemeyi sürdürmeye `ServiceHost` yeniden başlatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-197">You can then restart `ServiceHost` to resume normal processing.</span></span> <span data-ttu-id="aa000-198">[MSMQ 4,0 ' de zarar Iletisi işleme](../../../../docs/framework/wcf/samples/poison-message-handling-in-msmq-4-0.md) bu davranışı gösterir.</span><span class="sxs-lookup"><span data-stu-id="aa000-198">The [Poison Message Handling in MSMQ 4.0](../../../../docs/framework/wcf/samples/poison-message-handling-in-msmq-4-0.md) demonstrates this behavior.</span></span>  
  
## <a name="transaction-time-out-and-poison-messages"></a><span data-ttu-id="aa000-199">İşlem zaman aşımı ve zarar Iletileri</span><span class="sxs-lookup"><span data-stu-id="aa000-199">Transaction Time-Out and Poison Messages</span></span>  
 <span data-ttu-id="aa000-200">Sıraya alınan aktarım kanalı ve Kullanıcı kodu arasında bir hata sınıfı meydana gelebilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-200">A class of errors can occur between the queued transport channel and the user code.</span></span> <span data-ttu-id="aa000-201">Bu hatalar, ileti güvenliği katmanı veya hizmet dağıtma mantığı gibi içindeki katmanlar tarafından algılanabilir.</span><span class="sxs-lookup"><span data-stu-id="aa000-201">These errors can be detected by layers in-between, such as the message security layer or the service dispatching logic.</span></span> <span data-ttu-id="aa000-202">Örneğin, SOAP güvenlik katmanında eksik bir X. 509.440 sertifikası algılandı ve eksik bir eylem, iletinin uygulamaya dağıtıldığı durumlardır.</span><span class="sxs-lookup"><span data-stu-id="aa000-202">For example, a missing X.509 certificate detected in the SOAP security layer and a missing action are cases where the message does get dispatched to the application.</span></span> <span data-ttu-id="aa000-203">Bu durumda, hizmet modeli iletiyi bırakır.</span><span class="sxs-lookup"><span data-stu-id="aa000-203">When this happens, the service model drops the message.</span></span> <span data-ttu-id="aa000-204">İleti bir işlem içinde okunduğu ve bu işlem için bir sonuç sağlanamadığından, işlem zaman aşımına uğrar, iptal edilir ve ileti kuyruğa geri konur.</span><span class="sxs-lookup"><span data-stu-id="aa000-204">Because the message is read in a transaction and an outcome for that transaction cannot be provided, the transaction eventually times out, aborts, and the message is put back into the queue.</span></span> <span data-ttu-id="aa000-205">Diğer bir deyişle, belirli bir hata sınıfı için işlem hemen iptal edilmez ancak işlem zaman aşımına uğrayana kadar bekler. <xref:System.ServiceModel.ServiceBehaviorAttribute>kullanarak bir hizmet için işlem zaman aşımını değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-205">In other words, for a certain class of errors, the transaction does not immediately abort but waits until the transaction times out. You can modify the transaction time-out for a service using <xref:System.ServiceModel.ServiceBehaviorAttribute>.</span></span>  
  
 <span data-ttu-id="aa000-206">Bilgisayar genelinde işlem zaman aşımını değiştirmek için Machine. config dosyasını değiştirin ve uygun işlem zaman aşımını ayarlayın. İşlem sırasında ayarlanan zaman aşımına bağlı olarak, işlemin sonunda iptal edilir ve kuyruğa geri döner ve iptal sayısının artmasını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="aa000-206">To change the transaction time-out on a computer-wide basis, modify the machine.config file and set the appropriate transaction time-out. It is important to note that, depending on the time-out set in the transaction, the transaction eventually aborts and goes back to the queue and its abort count is incremented.</span></span> <span data-ttu-id="aa000-207">Sonuç olarak, ileti zarar haline gelir ve doğru değerlendirme Kullanıcı ayarlarına göre yapılır.</span><span class="sxs-lookup"><span data-stu-id="aa000-207">Eventually, the message becomes poison and the right disposition is made according to the user settings.</span></span>  
  
## <a name="sessions-and-poison-messages"></a><span data-ttu-id="aa000-208">Oturumlar ve zarar Iletileri</span><span class="sxs-lookup"><span data-stu-id="aa000-208">Sessions and Poison Messages</span></span>  
 <span data-ttu-id="aa000-209">Bir oturum, aynı yeniden deneme ve zarar iletisi işleme yordamlarına tek bir ileti olarak girer.</span><span class="sxs-lookup"><span data-stu-id="aa000-209">A session undergoes the same retry and poison-message handling procedures as a single message.</span></span> <span data-ttu-id="aa000-210">Daha önce zarar iletileri için listelenen özellikler tüm oturum için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="aa000-210">The properties previously listed for poison messages apply to the entire session.</span></span> <span data-ttu-id="aa000-211">Bu, tüm oturumun yeniden deneneceği ve ileti reddedilirse son bir zarar iletisi kuyruğuna ya da gönderenin atılacak ileti kuyruğuna gittiği anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="aa000-211">This means that the entire session is retried and goes to a final poison-message queue or the sender’s dead-letter queue if the message is rejected.</span></span>  
  
## <a name="batching-and-poison-messages"></a><span data-ttu-id="aa000-212">Toplu ve zarar Iletileri</span><span class="sxs-lookup"><span data-stu-id="aa000-212">Batching and Poison Messages</span></span>  
 <span data-ttu-id="aa000-213">Bir ileti bir zarar iletisi haline gelirse ve bir toplu işin parçasıysa, tüm toplu işlem geri alınır ve kanal tek seferde bir ileti okumak üzere döndürülür.</span><span class="sxs-lookup"><span data-stu-id="aa000-213">If a message becomes a poison message and is part of a batch, then the entire batch is rolled back and the channel returns to reading one message at a time.</span></span> <span data-ttu-id="aa000-214">Toplu işleme hakkında daha fazla bilgi için bkz. [işlem Içindeki Iletileri toplu işleme](../../../../docs/framework/wcf/feature-details/batching-messages-in-a-transaction.md)</span><span class="sxs-lookup"><span data-stu-id="aa000-214">For more information about batching, see [Batching Messages in a Transaction](../../../../docs/framework/wcf/feature-details/batching-messages-in-a-transaction.md)</span></span>  
  
## <a name="poison-message-handling-for-messages-in-a-poison-queue"></a><span data-ttu-id="aa000-215">Zarar sırasındaki Iletiler için zehirli ileti Işleme</span><span class="sxs-lookup"><span data-stu-id="aa000-215">Poison-message Handling for Messages in a Poison Queue</span></span>  
 <span data-ttu-id="aa000-216">Poison-Message kuyruğuna bir ileti yerleştirildiğinde, zehirli ileti işleme bitmez.</span><span class="sxs-lookup"><span data-stu-id="aa000-216">Poison-message handling does not end when a message is placed in the poison-message queue.</span></span> <span data-ttu-id="aa000-217">Zarar iletisi sırasındaki iletiler yine de okunmalıdır ve işlenmelidir.</span><span class="sxs-lookup"><span data-stu-id="aa000-217">Messages in the poison-message queue must still be read and handled.</span></span> <span data-ttu-id="aa000-218">Son zarar alt sırasından gelen iletileri okurken, zarar iletisi işleme ayarlarının bir alt kümesini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-218">You can use a subset of the poison-message handling settings when reading messages from the final poison subqueue.</span></span> <span data-ttu-id="aa000-219">Geçerli ayarlar `ReceiveRetryCount` ve `ReceiveErrorHandling`.</span><span class="sxs-lookup"><span data-stu-id="aa000-219">The applicable settings are `ReceiveRetryCount` and `ReceiveErrorHandling`.</span></span> <span data-ttu-id="aa000-220">`ReceiveErrorHandling` bırakma, reddetme veya hata olarak ayarlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="aa000-220">You can set `ReceiveErrorHandling` to Drop, Reject, or Fault.</span></span> <span data-ttu-id="aa000-221">`MaxRetryCycles` yok sayılır ve `ReceiveErrorHandling` Move olarak ayarlandıysa bir özel durum oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="aa000-221">`MaxRetryCycles` is ignored and an exception is thrown if `ReceiveErrorHandling` is set to Move.</span></span>  
  
## <a name="windows-vista-windows-server-2003-and-windows-xp-differences"></a><span data-ttu-id="aa000-222">Windows Vista, Windows Server 2003 ve Windows XP farkları</span><span class="sxs-lookup"><span data-stu-id="aa000-222">Windows Vista, Windows Server 2003, and Windows XP Differences</span></span>  
 <span data-ttu-id="aa000-223">Daha önce belirtildiği gibi, tüm Poison-Message işleme ayarları Windows Server 2003 ve Windows XP için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="aa000-223">As noted earlier, not all poison-message handling settings apply to Windows Server 2003 and Windows XP.</span></span> <span data-ttu-id="aa000-224">Windows Server 2003, Windows XP ve Windows Vista 'daki Message Queuing arasındaki aşağıdaki önemli farklılıklar, zehirli ileti işleme ile ilgilidir:</span><span class="sxs-lookup"><span data-stu-id="aa000-224">The following key differences between Message Queuing on Windows Server 2003, Windows XP, and Windows Vista are relevant to poison-message handling:</span></span>  
  
- <span data-ttu-id="aa000-225">Windows Vista 'daki Message Queuing alt sıraları destekler, ancak Windows Server 2003 ve Windows XP alt sıraları desteklemez.</span><span class="sxs-lookup"><span data-stu-id="aa000-225">Message Queuing in Windows Vista supports subqueues, while Windows Server 2003 and Windows XP do not support subqueues.</span></span> <span data-ttu-id="aa000-226">Alt sıralar, zehirli ileti işlemede kullanılır.</span><span class="sxs-lookup"><span data-stu-id="aa000-226">Subqueues are used in poison-message handling.</span></span> <span data-ttu-id="aa000-227">Yeniden deneme kuyrukları ve zarar sırası, zarar iletisi işleme ayarlarına göre oluşturulan uygulama kuyruğu için alt çizglardır.</span><span class="sxs-lookup"><span data-stu-id="aa000-227">The retry queues and the poison queue are subqueues to the application queue that is created based on the poison-message handling settings.</span></span> <span data-ttu-id="aa000-228">`MaxRetryCycles`, kaç yeniden deneme alt için oluşturulacağını belirler.</span><span class="sxs-lookup"><span data-stu-id="aa000-228">The `MaxRetryCycles` dictates how many retry subqueues to create.</span></span> <span data-ttu-id="aa000-229">Bu nedenle, Windows Server 2003 veya Windows XP 'de çalışırken `MaxRetryCycles` yok sayılır ve `ReceiveErrorHandling.Move` izin verilmez.</span><span class="sxs-lookup"><span data-stu-id="aa000-229">Therefore, when running on Windows Server 2003 or Windows XP, `MaxRetryCycles` are ignored and `ReceiveErrorHandling.Move` is not allowed.</span></span>  
  
- <span data-ttu-id="aa000-230">Windows Vista 'daki Message Queuing negatif bildirimi destekler, ancak Windows Server 2003 ve Windows XP desteklemez.</span><span class="sxs-lookup"><span data-stu-id="aa000-230">Message Queuing in Windows Vista supports negative acknowledgment, while Windows Server 2003 and Windows XP do not.</span></span> <span data-ttu-id="aa000-231">Alma kuyruğu yöneticisinin olumsuz bir bildirimi, gönderme kuyruğu yöneticisinin reddedilen iletiyi atılacak ileti kuyruğuna yerleştirmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="aa000-231">A negative acknowledgment from the receiving queue manager causes the sending queue manager to place the rejected message in the dead-letter queue.</span></span> <span data-ttu-id="aa000-232">Bu nedenle, Windows Server 2003 ve Windows XP 'de `ReceiveErrorHandling.Reject` izin verilmez.</span><span class="sxs-lookup"><span data-stu-id="aa000-232">As such, `ReceiveErrorHandling.Reject` is not allowed with Windows Server 2003 and Windows XP.</span></span>  
  
- <span data-ttu-id="aa000-233">Windows Vista 'daki Message Queuing ileti tesliminin denenme sayısını tutan bir ileti özelliğini destekler.</span><span class="sxs-lookup"><span data-stu-id="aa000-233">Message Queuing in Windows Vista supports a message property that keeps count of the number of times message delivery is attempted.</span></span> <span data-ttu-id="aa000-234">Bu Abort Count özelliği Windows Server 2003 ve Windows XP 'de kullanılamaz.</span><span class="sxs-lookup"><span data-stu-id="aa000-234">This abort count property is not available on Windows Server 2003 and Windows XP.</span></span> <span data-ttu-id="aa000-235">WCF, bellekteki durdurma sayısını korur, bu nedenle aynı ileti bir grupta birden fazla WCF hizmeti tarafından okunabildiği zaman bu özelliğin doğru bir değer içermemesi olasıdır.</span><span class="sxs-lookup"><span data-stu-id="aa000-235">WCF maintains the abort count in memory, so it is possible that this property may not contain an accurate value when the same message is read by more than one WCF service in a farm.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="aa000-236">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="aa000-236">See also</span></span>

- [<span data-ttu-id="aa000-237">Kuyruklara Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="aa000-237">Queues Overview</span></span>](../../../../docs/framework/wcf/feature-details/queues-overview.md)
- [<span data-ttu-id="aa000-238">Windows Vista, Windows Server 2003 ve Windows XP'de Kuyruğa Alma Özelliği Arasındaki Farklar</span><span class="sxs-lookup"><span data-stu-id="aa000-238">Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP</span></span>](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md)
- [<span data-ttu-id="aa000-239">Sözleşme ve Hizmetlerde Hataları Belirtme ve İşleme</span><span class="sxs-lookup"><span data-stu-id="aa000-239">Specifying and Handling Faults in Contracts and Services</span></span>](../../../../docs/framework/wcf/specifying-and-handling-faults-in-contracts-and-services.md)
