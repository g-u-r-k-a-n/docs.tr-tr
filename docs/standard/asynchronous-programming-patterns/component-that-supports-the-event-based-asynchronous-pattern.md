---
title: 'Nasıl yapılır: Olay Tabanlı Zaman Uyumsuz Deseni Destekleyen Bir Bileşeni Uygulama'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- Asynchronous Pattern
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- components [.NET Framework], asynchronous
- AsyncOperation class
- threading [Windows Forms], asynchronous features
- AsyncCompletedEventArgs class
ms.assetid: 61f676b5-936f-40f6-83ce-f22805ec9c2f
ms.openlocfilehash: 44a1019ac8169138aa95b03e2027d9539cbf8391
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/15/2020
ms.locfileid: "71957364"
---
# <a name="how-to-implement-a-component-that-supports-the-event-based-asynchronous-pattern"></a><span data-ttu-id="93428-102">Nasıl yapılır: Olay Tabanlı Zaman Uyumsuz Deseni Destekleyen Bir Bileşeni Uygulama</span><span class="sxs-lookup"><span data-stu-id="93428-102">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="93428-103">Fark edilebilir gecikmelere neden olabilecek bazı işlemlere sahip bir sınıf yazıyorsanız, Olay tabanlı [Asynchronous Desen Genel Bakış'ı](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)uygulayarak bu sınıfa eşzamanlı işlevsellik vermeyi düşünün.</span><span class="sxs-lookup"><span data-stu-id="93428-103">If you are writing a class with some operations that may incur noticeable delays, consider giving it asynchronous functionality by implementing the [Event-based Asynchronous Pattern Overview](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
 <span data-ttu-id="93428-104">Bu izbis, Olay tabanlı Asynchronous Deseni'ni uygulayan bir bileşenin nasıl oluşturulacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="93428-104">This walkthrough illustrates how to create a component that implements the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="93428-105">Ad alanından <xref:System.ComponentModel?displayProperty=nameWithType> yardımcı sınıflar kullanılarak uygulanır, bu da bileşenin ASP.NET, Konsol uygulamaları ve Windows Forms uygulamaları da dahil olmak üzere herhangi bir uygulama modeli altında doğru çalışmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="93428-105">It is implemented using helper classes from the <xref:System.ComponentModel?displayProperty=nameWithType> namespace, which ensures that the component works correctly under any application model, including ASP.NET, Console applications and Windows Forms applications.</span></span> <span data-ttu-id="93428-106">Bu bileşen aynı zamanda <xref:System.Windows.Forms.PropertyGrid> bir kontrol ve kendi özel tasarımcılar ile tasarlanabilir.</span><span class="sxs-lookup"><span data-stu-id="93428-106">This component is also designable with a <xref:System.Windows.Forms.PropertyGrid> control and your own custom designers.</span></span>  
  
 <span data-ttu-id="93428-107">İşi bittiğinde, asal sayıları eşit olarak hesaplayan bir uygulamanız olacaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-107">When you are through, you will have an application that computes prime numbers asynchronously.</span></span> <span data-ttu-id="93428-108">Uygulamanızda bir ana kullanıcı arabirimi (UI) iş parçacığı ve her asal sayı hesaplaması için bir iş parçacığı olacaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-108">Your application will have a main user interface (UI) thread and a thread for each prime number calculation.</span></span> <span data-ttu-id="93428-109">Çok sayıda asal olup olmadığını test etmek belirgin bir süre alabilir, ancak ana UI iş parçacığı bu gecikme tarafından kesintiye uğramaz ve form hesaplamalar sırasında yanıt olacaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-109">Although testing whether a large number is prime can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculations.</span></span> <span data-ttu-id="93428-110">Aynı anda istediğiniz kadar hesaplama çalıştırabilir ve bekleyen hesaplamaları seçarak iptal edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-110">You will be able to run as many calculations as you like concurrently and selectively cancel pending calculations.</span></span>  
  
 <span data-ttu-id="93428-111">Bu gözden geçirmede gösterilen görevler şunlardır:</span><span class="sxs-lookup"><span data-stu-id="93428-111">Tasks illustrated in this walkthrough include:</span></span>  
  
- <span data-ttu-id="93428-112">Bileşeni Oluşturma</span><span class="sxs-lookup"><span data-stu-id="93428-112">Creating the Component</span></span>  
  
- <span data-ttu-id="93428-113">Genel Eşzamanlı Olayları ve Temsilcileri Tanımlama</span><span class="sxs-lookup"><span data-stu-id="93428-113">Defining Public Asynchronous Events and Delegates</span></span>  
  
- <span data-ttu-id="93428-114">Özel Delegelerin Tanımlanması</span><span class="sxs-lookup"><span data-stu-id="93428-114">Defining Private Delegates</span></span>  
  
- <span data-ttu-id="93428-115">Genel Etkinliklerin Uygulanması</span><span class="sxs-lookup"><span data-stu-id="93428-115">Implementing Public Events</span></span>  
  
- <span data-ttu-id="93428-116">Tamamlama Yönteminin Uygulanması</span><span class="sxs-lookup"><span data-stu-id="93428-116">Implementing the Completion Method</span></span>  
  
- <span data-ttu-id="93428-117">İşçi Yöntemlerinin Uygulanması</span><span class="sxs-lookup"><span data-stu-id="93428-117">Implementing the Worker Methods</span></span>  
  
- <span data-ttu-id="93428-118">Başlat ve İptal Yöntemlerini Uygulama</span><span class="sxs-lookup"><span data-stu-id="93428-118">Implementing Start and Cancel Methods</span></span>  
  
 <span data-ttu-id="93428-119">Bu konudaki kodu tek bir giriş olarak kopyalamak [için bkz: Olay tabanlı Asynchronous Deseni'nin istemcisini uygulama.](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="93428-119">To copy the code in this topic as a single listing, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="creating-the-component"></a><span data-ttu-id="93428-120">Bileşeni Oluşturma</span><span class="sxs-lookup"><span data-stu-id="93428-120">Creating the Component</span></span>  
 <span data-ttu-id="93428-121">İlk adım, Olay tabanlı Asynchronous Modelini uygulayacak bileşeni oluşturmaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-121">The first step is to create the component that will implement the Event-based Asynchronous Pattern.</span></span>  
  
### <a name="to-create-the-component"></a><span data-ttu-id="93428-122">Bileşeni oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="93428-122">To create the component</span></span>  
  
- <span data-ttu-id="93428-123">'den `PrimeNumberCalculator` <xref:System.ComponentModel.Component>devralan adlı bir sınıf oluşturun.</span><span class="sxs-lookup"><span data-stu-id="93428-123">Create a class called `PrimeNumberCalculator` that inherits from <xref:System.ComponentModel.Component>.</span></span>  
  
## <a name="defining-public-asynchronous-events-and-delegates"></a><span data-ttu-id="93428-124">Genel Eşzamanlı Olayları ve Temsilcileri Tanımlama</span><span class="sxs-lookup"><span data-stu-id="93428-124">Defining Public Asynchronous Events and Delegates</span></span>  
 <span data-ttu-id="93428-125">Bileşeniniz olayları kullanarak istemcilere iletişim kurar.</span><span class="sxs-lookup"><span data-stu-id="93428-125">Your component communicates to clients using events.</span></span> <span data-ttu-id="93428-126">_MethodName_**Completed** olay asynchronous görevin tamamlanması için istemcileri uyarır ve _MethodName_**ProgressChanged** olay istemcileri bir eşzamanlı görevin ilerleme bilgilendirir.</span><span class="sxs-lookup"><span data-stu-id="93428-126">The _MethodName_**Completed** event alerts clients to the completion of an asynchronous task, and the _MethodName_**ProgressChanged** event informs clients of the progress of an asynchronous task.</span></span>  
  
### <a name="to-define-asynchronous-events-for-clients-of-your-component"></a><span data-ttu-id="93428-127">Bileşeninizin istemcileri için eşzamanlı olaylar tanımlamak için:</span><span class="sxs-lookup"><span data-stu-id="93428-127">To define asynchronous events for clients of your component:</span></span>  
  
1. <span data-ttu-id="93428-128">Dosyanızın <xref:System.Threading?displayProperty=nameWithType> <xref:System.Collections.Specialized?displayProperty=nameWithType> en üstündeki ad alanlarını ve ad alanlarını içeri aktarın.</span><span class="sxs-lookup"><span data-stu-id="93428-128">Import the <xref:System.Threading?displayProperty=nameWithType> and <xref:System.Collections.Specialized?displayProperty=nameWithType> namespaces at the top of your file.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#11)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#11](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#11)]  
  
2. <span data-ttu-id="93428-129">Sınıf `PrimeNumberCalculator` tanımından önce, ilerleme ve tamamlama olayları için temsilci bildirin.</span><span class="sxs-lookup"><span data-stu-id="93428-129">Before the `PrimeNumberCalculator` class definition, declare delegates for progress and completion events.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#7)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#7](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#7)]  
  
3. <span data-ttu-id="93428-130">Sınıf `PrimeNumberCalculator` tanımında, ilerleme ve tamamlama yı bildiren olayları istemcilere bildirin.</span><span class="sxs-lookup"><span data-stu-id="93428-130">In the `PrimeNumberCalculator` class definition, declare events for reporting progress and completion to clients.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#8)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#8](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#8)]  
  
4. <span data-ttu-id="93428-131">Sınıf `PrimeNumberCalculator` tanımından sonra, `CalculatePrimeCompletedEventArgs` her hesaplamanın sonucunu .event için istemcinin olay işleyicisine bildirmek için `CalculatePrimeCompleted`sınıfı türetin.</span><span class="sxs-lookup"><span data-stu-id="93428-131">After the `PrimeNumberCalculator` class definition, derive the `CalculatePrimeCompletedEventArgs` class for reporting the outcome of each calculation to the client's event handler for the `CalculatePrimeCompleted`.event.</span></span> <span data-ttu-id="93428-132">Bu sınıf, `AsyncCompletedEventArgs` özelliklere ek olarak istemcinin hangi sayının test edildiğini, asal olup olmadığını ve asal değilse ilk bölenin ne olduğunu belirlemesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="93428-132">In addition to the `AsyncCompletedEventArgs` properties, this class enables the client to determine what number was tested, whether it is prime, and what the first divisor is if it is not prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#6)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#6](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#6)]  
  
## <a name="checkpoint"></a><span data-ttu-id="93428-133">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="93428-133">Checkpoint</span></span>  
 <span data-ttu-id="93428-134">Bu noktada, bileşeni oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-134">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="93428-135">Bileşeninizi sınamak için</span><span class="sxs-lookup"><span data-stu-id="93428-135">To test your component</span></span>  
  
- <span data-ttu-id="93428-136">Bileşeni derle.</span><span class="sxs-lookup"><span data-stu-id="93428-136">Compile the component.</span></span>  
  
     <span data-ttu-id="93428-137">İki derleyici uyarısı alacaksınız:</span><span class="sxs-lookup"><span data-stu-id="93428-137">You will receive two compiler warnings:</span></span>  
  
    ```console  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.ProgressChanged' is never used  
    warning CS0067: The event 'AsynchronousPatternExample.PrimeNumberCalculator.CalculatePrimeCompleted' is never used  
    ```  
  
     <span data-ttu-id="93428-138">Bu uyarılar bir sonraki bölümde temizlenecektir.</span><span class="sxs-lookup"><span data-stu-id="93428-138">These warnings will be cleared in the next section.</span></span>  
  
## <a name="defining-private-delegates"></a><span data-ttu-id="93428-139">Özel Delegelerin Tanımlanması</span><span class="sxs-lookup"><span data-stu-id="93428-139">Defining Private Delegates</span></span>  
 <span data-ttu-id="93428-140">Bileşenin `PrimeNumberCalculator` eşzamanlı yönleri, ". <xref:System.Threading.SendOrPostCallback></span><span class="sxs-lookup"><span data-stu-id="93428-140">The asynchronous aspects of the `PrimeNumberCalculator` component are implemented internally with a special delegate known as a <xref:System.Threading.SendOrPostCallback>.</span></span> <span data-ttu-id="93428-141">A, <xref:System.Threading.SendOrPostCallback> iş parçacığı üzerinde çalıştıran <xref:System.Threading.ThreadPool> bir geri arama yöntemini temsil eder.</span><span class="sxs-lookup"><span data-stu-id="93428-141">A <xref:System.Threading.SendOrPostCallback> represents a callback method that executes on a <xref:System.Threading.ThreadPool> thread.</span></span> <span data-ttu-id="93428-142">Geri arama yöntemi, tek bir tür <xref:System.Object>parametresi alan bir imzaya sahip olmalıdır, bu da bir sarıcı sınıfındaki temsilciler arasında durumu geçmeniz gerektiği anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="93428-142">The callback method must have a signature that takes a single parameter of type <xref:System.Object>, which means you will need to pass state among delegates in a wrapper class.</span></span> <span data-ttu-id="93428-143">Daha fazla bilgi için bkz. <xref:System.Threading.SendOrPostCallback>.</span><span class="sxs-lookup"><span data-stu-id="93428-143">For more information, see <xref:System.Threading.SendOrPostCallback>.</span></span>  
  
### <a name="to-implement-your-components-internal-asynchronous-behavior"></a><span data-ttu-id="93428-144">Bileşeninizin dahili eşzamanlı davranışını uygulamak için:</span><span class="sxs-lookup"><span data-stu-id="93428-144">To implement your component's internal asynchronous behavior:</span></span>  
  
1. <span data-ttu-id="93428-145">Sınıftaki delegeleri <xref:System.Threading.SendOrPostCallback> bildirin `PrimeNumberCalculator` ve oluşturun.</span><span class="sxs-lookup"><span data-stu-id="93428-145">Declare and create the <xref:System.Threading.SendOrPostCallback> delegates in the `PrimeNumberCalculator` class.</span></span> <span data-ttu-id="93428-146"><xref:System.Threading.SendOrPostCallback> Nesneleri ' yi adı verilen `InitializeDelegates`bir yardımcı program yönteminde oluşturun.</span><span class="sxs-lookup"><span data-stu-id="93428-146">Create the <xref:System.Threading.SendOrPostCallback> objects in a utility method called `InitializeDelegates`.</span></span>  
  
     <span data-ttu-id="93428-147">Biri ilerlemeyi istemciye raporlamak için, diğeri de tamamlanmasını istemciye raporlamak için olmak üzere iki temsilciye ihtiyacınız olacaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-147">You will need two delegates: one for reporting progress to the client, and one for reporting completion to the client.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#9)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#9](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#9)]  
    [!code-csharp[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#20)]
    [!code-vb[System.ComponentModel.AsyncOperationManager#20](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#20)]  
  
2. <span data-ttu-id="93428-148">Bileşeninizin oluşturucusundaki `InitializeDelegates` yöntemi arayın.</span><span class="sxs-lookup"><span data-stu-id="93428-148">Call the `InitializeDelegates` method in your component's constructor.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#21)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#21](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#21)]  
  
3. <span data-ttu-id="93428-149">Eşit bir şekilde `PrimeNumberCalculator` yapılacak fiili işi işleyen sınıfta bir temsilci bildirin.</span><span class="sxs-lookup"><span data-stu-id="93428-149">Declare a delegate in the `PrimeNumberCalculator` class that handles the actual work to be done asynchronously.</span></span> <span data-ttu-id="93428-150">Bu temsilci, bir sayının asal olup olmadığını sınayan alt yöntemi sarar.</span><span class="sxs-lookup"><span data-stu-id="93428-150">This delegate wraps the worker method that tests whether a number is prime.</span></span> <span data-ttu-id="93428-151">Temsilci, eşzamanlı <xref:System.ComponentModel.AsyncOperation> işlemin ömrünü izlemek için kullanılacak bir parametre alır.</span><span class="sxs-lookup"><span data-stu-id="93428-151">The delegate takes an <xref:System.ComponentModel.AsyncOperation> parameter, which will be used to track the lifetime of the asynchronous operation.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#22)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#22](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#22)]  
  
4. <span data-ttu-id="93428-152">Bekleyen eşzamanlı işlemlerin ömür lerini yönetmek için bir koleksiyon oluşturun.</span><span class="sxs-lookup"><span data-stu-id="93428-152">Create a collection for managing lifetimes of pending asynchronous operations.</span></span> <span data-ttu-id="93428-153">İstemci, yürütülürken ve tamamlanırken işlemleri izlemek için bir yol gerekir ve bu izleme, istemci çağrıyı eşzamanlı yönteme yaptığında istemcinin benzersiz bir belirteci veya görev kimliği geçirmesini gerektirerek yapılır.</span><span class="sxs-lookup"><span data-stu-id="93428-153">The client needs a way to track operations as they are executed and completed, and this tracking is done by requiring the client to pass a unique token, or task ID, when the client makes the call to the asynchronous method.</span></span> <span data-ttu-id="93428-154">Bileşen, `PrimeNumberCalculator` görev kimliğini ilgili çağırmayla ilişkilendirerek her aramayı takip etmelidir.</span><span class="sxs-lookup"><span data-stu-id="93428-154">The `PrimeNumberCalculator` component must keep track of each call by associating the task ID with its corresponding invocation.</span></span> <span data-ttu-id="93428-155">İstemci benzersiz olmayan bir görev kimliği `PrimeNumberCalculator` geçerse, bileşenbir özel durum yükseltmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="93428-155">If the client passes a task ID that is not unique, the `PrimeNumberCalculator` component must raise an exception.</span></span>  
  
     <span data-ttu-id="93428-156">Bileşen, `PrimeNumberCalculator` a <xref:System.Collections.Specialized.HybridDictionary>adı verilen özel bir koleksiyon sınıfı kullanarak görev kimliğini izler.</span><span class="sxs-lookup"><span data-stu-id="93428-156">The `PrimeNumberCalculator` component keeps track of task ID by using a special collection class called a <xref:System.Collections.Specialized.HybridDictionary>.</span></span> <span data-ttu-id="93428-157">Sınıf <xref:System.Collections.Specialized.HybridDictionary> tanımında, bir `userTokenToLifetime`.</span><span class="sxs-lookup"><span data-stu-id="93428-157">In the class definition, create a <xref:System.Collections.Specialized.HybridDictionary> called `userTokenToLifetime`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#23)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#23](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#23)]  
  
## <a name="implementing-public-events"></a><span data-ttu-id="93428-158">Genel Etkinliklerin Uygulanması</span><span class="sxs-lookup"><span data-stu-id="93428-158">Implementing Public Events</span></span>  
 <span data-ttu-id="93428-159">Olay tabanlı Asynchronous Modelini uygulayan bileşenler, olayları kullanarak istemcilere iletin.</span><span class="sxs-lookup"><span data-stu-id="93428-159">Components that implement the Event-based Asynchronous Pattern communicate to clients using events.</span></span> <span data-ttu-id="93428-160">Bu olaylar <xref:System.ComponentModel.AsyncOperation> sınıfın yardımıyla uygun iş parçacığı üzerinde çağrılır.</span><span class="sxs-lookup"><span data-stu-id="93428-160">These events are invoked on the proper thread with the help of the <xref:System.ComponentModel.AsyncOperation> class.</span></span>  
  
### <a name="to-raise-events-to-your-components-clients"></a><span data-ttu-id="93428-161">Bileşeninizin istemcilerine olayları yükseltmek için:</span><span class="sxs-lookup"><span data-stu-id="93428-161">To raise events to your component's clients:</span></span>  
  
1. <span data-ttu-id="93428-162">İstemcilere raporlama kiçin herkese açık etkinlikleri uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93428-162">Implement public events for reporting to clients.</span></span> <span data-ttu-id="93428-163">İlerlemeyi raporlamak için bir olay ve tamamlanma yı raporlamak için bir olay gerekir.</span><span class="sxs-lookup"><span data-stu-id="93428-163">You will need an event for reporting progress and one for reporting completion.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#24)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#24](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#24)]  
  
## <a name="implementing-the-completion-method"></a><span data-ttu-id="93428-164">Tamamlama Yönteminin Uygulanması</span><span class="sxs-lookup"><span data-stu-id="93428-164">Implementing the Completion Method</span></span>  
 <span data-ttu-id="93428-165">Tamamlama temsilcisi, eş zamanlı işlem başarılı tamamlama, hata veya iptal ile sona erdiğinde altta yatan, serbest iş parçacığı eşzamanlı eşzamanlı davranışın çağıracağı yöntemdir.</span><span class="sxs-lookup"><span data-stu-id="93428-165">The completion delegate is the method that the underlying, free-threaded asynchronous behavior will invoke when the asynchronous operation ends by successful completion, error, or cancellation.</span></span> <span data-ttu-id="93428-166">Bu çağırma rasgele bir iş parçacığı üzerinde olur.</span><span class="sxs-lookup"><span data-stu-id="93428-166">This invocation happens on an arbitrary thread.</span></span>  
  
 <span data-ttu-id="93428-167">Bu yöntem, istemcinin görev kimliğinin benzersiz istemci belirteçleri iç koleksiyonundan kaldırıldığı yöntemdir.</span><span class="sxs-lookup"><span data-stu-id="93428-167">This method is where the client's task ID is removed from the internal collection of unique client tokens.</span></span> <span data-ttu-id="93428-168">Bu yöntem aynı zamanda ilgili <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> <xref:System.ComponentModel.AsyncOperation>yöntem çağırarak belirli bir eşzamanlı işlemin ömrünü sona erdiriyor.</span><span class="sxs-lookup"><span data-stu-id="93428-168">This method also ends the lifetime of a particular asynchronous operation by calling the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method on the corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="93428-169">Bu çağrı, uygulama modeli için uygun iş parçacığı üzerinde tamamlama olay yükseltir.</span><span class="sxs-lookup"><span data-stu-id="93428-169">This call raises the completion event on the thread that is appropriate for the application model.</span></span> <span data-ttu-id="93428-170"><xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> Yöntem çağrıldıktan sonra, bu <xref:System.ComponentModel.AsyncOperation> örnek artık kullanılamaz ve sonraki herhangi bir sonraki kullanılma girişimleri bir özel durum atacaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-170">After the <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> method is called, this instance of <xref:System.ComponentModel.AsyncOperation> can no longer be used, and any subsequent attempts to use it will throw an exception.</span></span>  
  
 <span data-ttu-id="93428-171">İmza, `CompletionMethod` eşzamanlı işlemin sonucunu açıklamak için gerekli tüm durumu tutmalıdır.</span><span class="sxs-lookup"><span data-stu-id="93428-171">The `CompletionMethod` signature must hold all state necessary to describe the outcome of the asynchronous operation.</span></span> <span data-ttu-id="93428-172">Bu özel eşzamanlı işlem tarafından test edilen sayı için durum tutar, sayı asal olup olmadığını, ve bir asal sayı değilse ilk bölenin değeri.</span><span class="sxs-lookup"><span data-stu-id="93428-172">It holds state for the number that was tested by this particular asynchronous operation, whether the number is prime, and the value of its first divisor if it is not a prime number.</span></span> <span data-ttu-id="93428-173">Ayrıca, oluşan herhangi bir özel durum açıklayan <xref:System.ComponentModel.AsyncOperation> devlet tutar ve bu özel göreve karşılık gelen.</span><span class="sxs-lookup"><span data-stu-id="93428-173">It also holds state describing any exception that occurred, and the <xref:System.ComponentModel.AsyncOperation> corresponding to this particular task.</span></span>  
  
### <a name="to-complete-an-asynchronous-operation"></a><span data-ttu-id="93428-174">Bir eşzamanlı işlemi tamamlamak için:</span><span class="sxs-lookup"><span data-stu-id="93428-174">To complete an asynchronous operation:</span></span>  
  
- <span data-ttu-id="93428-175">Tamamlama yöntemini uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93428-175">Implement the completion method.</span></span> <span data-ttu-id="93428-176">İstemci aracılığıyla istemciye döndürülen `CalculatePrimeCompletedEventArgs` bir paramı doldurmak için kullandığı `CalculatePrimeCompletedEventHandler`altı parametre alır.</span><span class="sxs-lookup"><span data-stu-id="93428-176">It takes six parameters, which it uses to populate a `CalculatePrimeCompletedEventArgs` that is returned to the client through the client's `CalculatePrimeCompletedEventHandler`.</span></span> <span data-ttu-id="93428-177">İstemcinin görev kimliği belirtecisini iç koleksiyondan kaldırır ve eşzamanlı işlemin kullanım ömrünü <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>bir çağrıyla sona erdirir.</span><span class="sxs-lookup"><span data-stu-id="93428-177">It removes the client's task ID token from the internal collection, and it ends the asynchronous operation's lifetime with a call to <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A>.</span></span> <span data-ttu-id="93428-178">Çağrıyı, <xref:System.ComponentModel.AsyncOperation> uygulama modeline uygun olan iş parçacığına veya içeriğe çağırır.</span><span class="sxs-lookup"><span data-stu-id="93428-178">The <xref:System.ComponentModel.AsyncOperation> marshals the call to the thread or context that is appropriate for the application model.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#26)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#26](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#26)]  
  
## <a name="checkpoint"></a><span data-ttu-id="93428-179">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="93428-179">Checkpoint</span></span>  
 <span data-ttu-id="93428-180">Bu noktada, bileşeni oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-180">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="93428-181">Bileşeninizi sınamak için</span><span class="sxs-lookup"><span data-stu-id="93428-181">To test your component</span></span>  
  
- <span data-ttu-id="93428-182">Bileşeni derle.</span><span class="sxs-lookup"><span data-stu-id="93428-182">Compile the component.</span></span>  
  
     <span data-ttu-id="93428-183">Bir derleyici uyarısı alacaksınız:</span><span class="sxs-lookup"><span data-stu-id="93428-183">You will receive one compiler warning:</span></span>  
  
    ```console  
    warning CS0169: The private field 'AsynchronousPatternExample.PrimeNumberCalculator.workerDelegate' is never used  
    ```  
  
     <span data-ttu-id="93428-184">Bu uyarı sonraki bölümde çözülür.</span><span class="sxs-lookup"><span data-stu-id="93428-184">This warning will be resolved in the next section.</span></span>  
  
## <a name="implementing-the-worker-methods"></a><span data-ttu-id="93428-185">İşçi Yöntemlerinin Uygulanması</span><span class="sxs-lookup"><span data-stu-id="93428-185">Implementing the Worker Methods</span></span>  
 <span data-ttu-id="93428-186">Şimdiye kadar, bileşen için destekleyici asynchronous kodu `PrimeNumberCalculator` uyguladınız.</span><span class="sxs-lookup"><span data-stu-id="93428-186">So far, you have implemented the supporting asynchronous code for the `PrimeNumberCalculator` component.</span></span> <span data-ttu-id="93428-187">Artık fiili işi yapan kodu uygulayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-187">Now you can implement the code that does the actual work.</span></span> <span data-ttu-id="93428-188">Üç yöntem `CalculateWorker`uygulayacak: `BuildPrimeNumberList`, `IsPrime`, ve .</span><span class="sxs-lookup"><span data-stu-id="93428-188">You will implement three methods: `CalculateWorker`, `BuildPrimeNumberList`, and `IsPrime`.</span></span> <span data-ttu-id="93428-189">Birlikte, `BuildPrimeNumberList` `IsPrime` ve test numarasının kare köküne kadar tüm asal sayıları bularak bir sayının asal olup olmadığını belirleyen Eratosthenes Elek adlı tanınmış bir algoritma oluşur.</span><span class="sxs-lookup"><span data-stu-id="93428-189">Together, `BuildPrimeNumberList` and `IsPrime` comprise a well-known algorithm called the Sieve of Eratosthenes, which determines if a number is prime by finding all the prime numbers up to the square root of the test number.</span></span> <span data-ttu-id="93428-190">Bu noktada bölen bulunmazsa, test numarası asal olur.</span><span class="sxs-lookup"><span data-stu-id="93428-190">If no divisors are found by that point, the test number is prime.</span></span>  
  
 <span data-ttu-id="93428-191">Bu bileşen maksimum verimlilik için yazılmışsa, farklı test numaraları için çeşitli çağırmalar tarafından keşfedilen tüm asal sayıları hatırlar.</span><span class="sxs-lookup"><span data-stu-id="93428-191">If this component were written for maximum efficiency, it would remember all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="93428-192">Ayrıca 2, 3 ve 5 gibi önemsiz bölenler için kontrol edecek.</span><span class="sxs-lookup"><span data-stu-id="93428-192">It would also check for trivial divisors like 2, 3, and 5.</span></span> <span data-ttu-id="93428-193">Bu örneğin amacı, zaman alan işlemlerin nasıl eşzamanlı olarak yürütülebileceğini göstermektir, böylece bu optimizasyonlar sizin için bir alıştırma olarak bırakılır.</span><span class="sxs-lookup"><span data-stu-id="93428-193">The intent of this example is to demonstrate how time-consuming operations can be executed asynchronously, however, so these optimizations are left as an exercise for you.</span></span>  
  
 <span data-ttu-id="93428-194">Yöntem `CalculateWorker` bir temsilciye sarılır ve `BeginInvoke`'' için bir çağrı ile eş senkronize olarak çağrılır</span><span class="sxs-lookup"><span data-stu-id="93428-194">The `CalculateWorker` method is wrapped in a delegate and is invoked asynchronously with a call to `BeginInvoke`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="93428-195">İlerleme raporlama `BuildPrimeNumberList` yönteminde uygulanır.</span><span class="sxs-lookup"><span data-stu-id="93428-195">Progress reporting is implemented in the `BuildPrimeNumberList` method.</span></span> <span data-ttu-id="93428-196">Hızlı bilgisayarlarda `ProgressChanged` olaylar art arda yükseltilebilir.</span><span class="sxs-lookup"><span data-stu-id="93428-196">On fast computers, `ProgressChanged` events can be raised in rapid succession.</span></span> <span data-ttu-id="93428-197">Bu olayların yükseltildiği istemci iş parçacığı, bu durumu ele alabilmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="93428-197">The client thread, on which these events are raised, must be able to handle this situation.</span></span> <span data-ttu-id="93428-198">Kullanıcı arabirim kodu iletilerle dolup taşabilir ve buna yetişemez ve yanıt vermemeye neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="93428-198">User interface code may be flooded with messages and unable to keep up, resulting in unresponsiveness.</span></span> <span data-ttu-id="93428-199">Bu durumu işleyen örnek bir kullanıcı arabirimi için [bkz.](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="93428-199">For an example user interface that handles this situation, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
### <a name="to-execute-the-prime-number-calculation-asynchronously"></a><span data-ttu-id="93428-200">Asal sayı hesaplamasını eşzamanlı olarak yürütmek için:</span><span class="sxs-lookup"><span data-stu-id="93428-200">To execute the prime number calculation asynchronously:</span></span>  
  
1. <span data-ttu-id="93428-201">Yardımcı `TaskCanceled` program yöntemini uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93428-201">Implement the `TaskCanceled` utility method.</span></span> <span data-ttu-id="93428-202">Bu, verilen görev kimliği için görev yaşam `true` boyu koleksiyonunu denetler ve görev kimliği bulunmazsa döndürür.</span><span class="sxs-lookup"><span data-stu-id="93428-202">This checks the task lifetime collection for the given task ID, and returns `true` if the task ID is not found.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#32)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#32](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#32)]  
  
2. <span data-ttu-id="93428-203">Yöntemi `CalculateWorker` uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93428-203">Implement the `CalculateWorker` method.</span></span> <span data-ttu-id="93428-204">Bu iki parametre alır: test <xref:System.ComponentModel.AsyncOperation>etmek için bir sayı ve bir .</span><span class="sxs-lookup"><span data-stu-id="93428-204">It takes two parameters: a number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#27)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#27](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#27)]  
  
3. <span data-ttu-id="93428-205">Uygulayın. `BuildPrimeNumberList`</span><span class="sxs-lookup"><span data-stu-id="93428-205">Implement `BuildPrimeNumberList`.</span></span> <span data-ttu-id="93428-206">Bu iki parametre alır: test <xref:System.ComponentModel.AsyncOperation>etmek için sayı ve bir .</span><span class="sxs-lookup"><span data-stu-id="93428-206">It takes two parameters: the number to test, and an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="93428-207">İlerleme ve <xref:System.ComponentModel.AsyncOperation> artımlı sonuçları bildirmek için kullanır.</span><span class="sxs-lookup"><span data-stu-id="93428-207">It uses the <xref:System.ComponentModel.AsyncOperation> to report progress and incremental results.</span></span> <span data-ttu-id="93428-208">Bu, istemcinin olay işleyicilerinin uygulama modeli için uygun iş parçacığı veya bağlam üzerinde çağrılması sağlar.</span><span class="sxs-lookup"><span data-stu-id="93428-208">This assures that the client's event handlers are called on the proper thread or context for the application model.</span></span> <span data-ttu-id="93428-209">Bir `BuildPrimeNumberList` asal sayı bulduğunda, bunu `ProgressChanged` istemcinin olay işleyicisine artımlı bir sonuç olarak bildirir.</span><span class="sxs-lookup"><span data-stu-id="93428-209">When `BuildPrimeNumberList` finds a prime number, it reports this as an incremental result to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="93428-210">Bu, bir ek özelliği `CalculatePrimeProgressChangedEventArgs`olan " , `LatestPrimeNumber`"türetilmiş" bir sınıf gerektirir. <xref:System.ComponentModel.ProgressChangedEventArgs></span><span class="sxs-lookup"><span data-stu-id="93428-210">This requires a class derived from <xref:System.ComponentModel.ProgressChangedEventArgs>, called `CalculatePrimeProgressChangedEventArgs`, which has one added property called `LatestPrimeNumber`.</span></span>  
  
     <span data-ttu-id="93428-211">Yöntem `BuildPrimeNumberList` de periyodik olarak `TaskCanceled` yöntem çağırır ve yöntem `true`dönerse çıkar.</span><span class="sxs-lookup"><span data-stu-id="93428-211">The `BuildPrimeNumberList` method also periodically calls the `TaskCanceled` method and exits if the method returns `true`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#5)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#5](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#5)]  
  
4. <span data-ttu-id="93428-212">Uygulayın. `IsPrime`</span><span class="sxs-lookup"><span data-stu-id="93428-212">Implement `IsPrime`.</span></span> <span data-ttu-id="93428-213">Üç parametre alır: bilinen asal sayıların listesi, test edilecek sayı ve bulunan ilk bölen için bir çıktı parametresi.</span><span class="sxs-lookup"><span data-stu-id="93428-213">It takes three parameters: a list of known prime numbers, the number to test, and an output parameter for the first divisor found.</span></span> <span data-ttu-id="93428-214">Asal sayılar listesi göz önüne alındığında, test numarasının asal olup olmadığını belirler.</span><span class="sxs-lookup"><span data-stu-id="93428-214">Given the list of prime numbers, it determines if the test number is prime.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#28)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#28](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#28)]  
  
5. <span data-ttu-id="93428-215">`CalculatePrimeProgressChangedEventArgs` Türetin <xref:System.ComponentModel.ProgressChangedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="93428-215">Derive `CalculatePrimeProgressChangedEventArgs` from <xref:System.ComponentModel.ProgressChangedEventArgs>.</span></span> <span data-ttu-id="93428-216">Bu sınıf, olay için istemcinin olay işleyicisine artımlı sonuçları raporlamak `ProgressChanged` için gereklidir.</span><span class="sxs-lookup"><span data-stu-id="93428-216">This class is necessary for reporting incremental results to the client's event handler for the `ProgressChanged` event.</span></span> <span data-ttu-id="93428-217">Bu denilen `LatestPrimeNumber`bir ek özelliği vardır.</span><span class="sxs-lookup"><span data-stu-id="93428-217">It has one added property called `LatestPrimeNumber`.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#29)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#29](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#29)]  
  
## <a name="checkpoint"></a><span data-ttu-id="93428-218">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="93428-218">Checkpoint</span></span>  
 <span data-ttu-id="93428-219">Bu noktada, bileşeni oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-219">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="93428-220">Bileşeninizi sınamak için</span><span class="sxs-lookup"><span data-stu-id="93428-220">To test your component</span></span>  
  
- <span data-ttu-id="93428-221">Bileşeni derle.</span><span class="sxs-lookup"><span data-stu-id="93428-221">Compile the component.</span></span>  
  
     <span data-ttu-id="93428-222">Yazılması gereken tek şey, eşzamanlı işlemleri başlatmak ve iptal `CalculatePrimeAsync` etmek `CancelAsync`için kullanılan yöntemlerdir ve.</span><span class="sxs-lookup"><span data-stu-id="93428-222">All that remains to be written are the methods to start and cancel asynchronous operations, `CalculatePrimeAsync` and `CancelAsync`.</span></span>  
  
## <a name="implementing-the-start-and-cancel-methods"></a><span data-ttu-id="93428-223">Başlat ve İptal Yöntemlerini Uygulama</span><span class="sxs-lookup"><span data-stu-id="93428-223">Implementing the Start and Cancel Methods</span></span>  
 <span data-ttu-id="93428-224">İşçi yöntemini, onu saran `BeginInvoke` temsilciyi çağırarak kendi iş parçacığı üzerinde başlamalısınız.</span><span class="sxs-lookup"><span data-stu-id="93428-224">You start the worker method on its own thread by calling `BeginInvoke` on the delegate that wraps it.</span></span> <span data-ttu-id="93428-225">Belirli bir eşzamanlı işlemin kullanım ömrünü yönetmek <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> <xref:System.ComponentModel.AsyncOperationManager> için, yardımcı sınıftayöntemi çağırırsınız.</span><span class="sxs-lookup"><span data-stu-id="93428-225">To manage the lifetime of a particular asynchronous operation, you call the <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> method on the <xref:System.ComponentModel.AsyncOperationManager> helper class.</span></span> <span data-ttu-id="93428-226">Bu, <xref:System.ComponentModel.AsyncOperation>istemcinin olay işleyicilerini uygun iş parçacığına veya içeriğe çağıran bir , döndürür.</span><span class="sxs-lookup"><span data-stu-id="93428-226">This returns an <xref:System.ComponentModel.AsyncOperation>, which marshals calls on the client's event handlers to the proper thread or context.</span></span>  
  
 <span data-ttu-id="93428-227">Bekleyen belirli bir işlemi <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> ilgili <xref:System.ComponentModel.AsyncOperation>işlemi çağırarak iptal emzsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-227">You cancel a particular pending operation by calling <xref:System.ComponentModel.AsyncOperation.PostOperationCompleted%2A> on its corresponding <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="93428-228">Bu işlem sona erer ve sonraki <xref:System.ComponentModel.AsyncOperation> çağrılar bir özel durum ortaya atar.</span><span class="sxs-lookup"><span data-stu-id="93428-228">This ends that operation, and any subsequent calls to its <xref:System.ComponentModel.AsyncOperation> will throw an exception.</span></span>  
  
### <a name="to-implement-start-and-cancel-functionality"></a><span data-ttu-id="93428-229">Başlat ve İptal işlevini uygulamak için:</span><span class="sxs-lookup"><span data-stu-id="93428-229">To implement Start and Cancel functionality:</span></span>  
  
1. <span data-ttu-id="93428-230">Yöntemi `CalculatePrimeAsync` uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93428-230">Implement the `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="93428-231">İstemci tarafından sağlanan belirteç (görev kimliği) şu anda bekleyen görevleri temsil eden tüm belirteçleri ile ilgili benzersiz olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="93428-231">Make sure the client-supplied token (task ID) is unique with respect to all the tokens representing currently pending tasks.</span></span> <span data-ttu-id="93428-232">İstemci benzersiz olmayan bir belirteç geçerse, `CalculatePrimeAsync` bir özel durum yükseltir.</span><span class="sxs-lookup"><span data-stu-id="93428-232">If the client passes in a non-unique token, `CalculatePrimeAsync` raises an exception.</span></span> <span data-ttu-id="93428-233">Aksi takdirde, belirteç görev kimliği koleksiyonuna eklenir.</span><span class="sxs-lookup"><span data-stu-id="93428-233">Otherwise, the token is added to the task ID collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#3)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#3](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#3)]  
  
2. <span data-ttu-id="93428-234">Yöntemi `CancelAsync` uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93428-234">Implement the `CancelAsync` method.</span></span> <span data-ttu-id="93428-235">`taskId` Parametre belirteç koleksiyonunda varsa, kaldırılır.</span><span class="sxs-lookup"><span data-stu-id="93428-235">If the `taskId` parameter exists in the token collection, it is removed.</span></span> <span data-ttu-id="93428-236">Bu, çalışmaya başlamamış iptal edilen görevleri önler.</span><span class="sxs-lookup"><span data-stu-id="93428-236">This prevents canceled tasks that have not started from running.</span></span> <span data-ttu-id="93428-237">Görev çalışıyorsa, `BuildPrimeNumberList` görev kimliğinin yaşam boyu koleksiyondan kaldırıldığını algıladığında yöntem çıkar.</span><span class="sxs-lookup"><span data-stu-id="93428-237">If the task is running, the `BuildPrimeNumberList` method exits when it detects that the task ID has been removed from the lifetime collection.</span></span>  
  
     [!code-csharp[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/CS/primenumbercalculatormain.cs#4)]
     [!code-vb[System.ComponentModel.AsyncOperationManager#4](../../../samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.AsyncOperationManager/VB/primenumbercalculatormain.vb#4)]  
  
## <a name="checkpoint"></a><span data-ttu-id="93428-238">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="93428-238">Checkpoint</span></span>  
 <span data-ttu-id="93428-239">Bu noktada, bileşeni oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-239">At this point, you can build the component.</span></span>  
  
### <a name="to-test-your-component"></a><span data-ttu-id="93428-240">Bileşeninizi sınamak için</span><span class="sxs-lookup"><span data-stu-id="93428-240">To test your component</span></span>  
  
- <span data-ttu-id="93428-241">Bileşeni derle.</span><span class="sxs-lookup"><span data-stu-id="93428-241">Compile the component.</span></span>  
  
 <span data-ttu-id="93428-242">Bileşen `PrimeNumberCalculator` artık tamamlandı ve kullanıma hazır.</span><span class="sxs-lookup"><span data-stu-id="93428-242">The `PrimeNumberCalculator` component is now complete and ready to use.</span></span>  
  
 <span data-ttu-id="93428-243">`PrimeNumberCalculator` Bileşeni kullanan örnek bir istemci için [bkz: Olay tabanlı Asynchronous Deseni'nin istemcisini uygulama.](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md)</span><span class="sxs-lookup"><span data-stu-id="93428-243">For an example client that uses the `PrimeNumberCalculator` component, see [How to: Implement a Client of the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/how-to-implement-a-client-of-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="93428-244">Sonraki Adımlar</span><span class="sxs-lookup"><span data-stu-id="93428-244">Next Steps</span></span>  
 <span data-ttu-id="93428-245">Bu örneği yöntemin eşzamanlı `CalculatePrime`eşdeğerini `CalculatePrimeAsync` yazarak doldurabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-245">You can fill out this example by writing `CalculatePrime`, the synchronous equivalent of `CalculatePrimeAsync` method.</span></span> <span data-ttu-id="93428-246">Bu, `PrimeNumberCalculator` bileşeni Olay tabanlı Asynchronous Deseni ile tam olarak uyumlu hale getirecektir.</span><span class="sxs-lookup"><span data-stu-id="93428-246">This will make the `PrimeNumberCalculator` component fully compliant with the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="93428-247">Bu örneği, farklı test numaraları için çeşitli çağırmalar tarafından keşfedilen tüm asal sayıların listesini koruyarak geliştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-247">You can improve this example by retaining the list of all the prime numbers discovered by various invocations for different test numbers.</span></span> <span data-ttu-id="93428-248">Bu yaklaşımı kullanarak, her görev önceki görevler tarafından yapılan işten yararlanacaktır.</span><span class="sxs-lookup"><span data-stu-id="93428-248">Using this approach, each task will benefit from the work done by previous tasks.</span></span> <span data-ttu-id="93428-249">Bölgelerle `lock` bu listeyi korumaya dikkat edin, bu nedenle listeye farklı iş parçacıklarına göre erişim seri hale getirilir.</span><span class="sxs-lookup"><span data-stu-id="93428-249">Be careful to protect this list with `lock` regions, so access to the list by different threads is serialized.</span></span>  
  
 <span data-ttu-id="93428-250">Ayrıca, 2, 3 ve 5 gibi önemsiz bölenler için test ederek bu örneği geliştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="93428-250">You can also improve this example by testing for trivial divisors, like 2, 3, and 5.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="93428-251">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="93428-251">See also</span></span>

- [<span data-ttu-id="93428-252">Nasıl Yapılır: Arka Planda İşlem Çalıştırma</span><span class="sxs-lookup"><span data-stu-id="93428-252">How to: Run an Operation in the Background</span></span>](../../../docs/framework/winforms/controls/how-to-run-an-operation-in-the-background.md)
- [<span data-ttu-id="93428-253">Olay Tabanlı Zaman Uyumsuz Desene Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="93428-253">Event-based Asynchronous Pattern Overview</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)
- [<span data-ttu-id="93428-254">Olay Tabanlı Zaman Uyumsuz Desen (EAP)</span><span class="sxs-lookup"><span data-stu-id="93428-254">Event-based Asynchronous Pattern (EAP)</span></span>](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)
