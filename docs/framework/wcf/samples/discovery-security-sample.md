---
title: Keşif Güvenliği Örneği
ms.date: 03/30/2017
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
ms.openlocfilehash: cfee226f52bc5f001b2952b76b40ce0eb8aebceb
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/24/2020
ms.locfileid: "76728857"
---
# <a name="discovery-security-sample"></a><span data-ttu-id="8f6ed-102">Keşif Güvenliği Örneği</span><span class="sxs-lookup"><span data-stu-id="8f6ed-102">Discovery Security Sample</span></span>

<span data-ttu-id="8f6ed-103">Bulma belirtimi, bulma işlemine katılan uç noktaların güvenli olmasını gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="8f6ed-104">Bulma iletilerini güvenlikle birlikte geliştirmek, çeşitli saldırı türlerini azaltır (ileti değişikliği, hizmet reddi, yeniden kimlik sahtekarlığı).</span><span class="sxs-lookup"><span data-stu-id="8f6ed-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="8f6ed-105">Bu örnek, sıkıştırılmış imza biçimini kullanarak ileti imzalarını hesapladığı ve doğrulayan özel kanallar uygular (WS-Discovery belirtiminin 8,2 bölümünde açıklanmıştır).</span><span class="sxs-lookup"><span data-stu-id="8f6ed-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="8f6ed-106">Örnek, hem [2005 bulma belirtimini](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) hem de [1,1 sürümünü](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf)destekler.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-106">The sample supports both the [2005 Discovery specification](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) and the [1.1 version](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf).</span></span>  
  
 <span data-ttu-id="8f6ed-107">Özel kanal, bulma ve duyuru uç noktaları için mevcut kanal yığınının üzerine uygulanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="8f6ed-108">Bu şekilde, gönderilen her ileti için bir imza üst bilgisi uygulanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="8f6ed-109">İmza, alınan iletilerde doğrulanır ve eşleşmediği zaman veya iletilerde imza yoksa iletiler bırakılır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="8f6ed-110">İletileri imzalamak ve doğrulamak için, örnek sertifikaları kullanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="8f6ed-111">Tartışma</span><span class="sxs-lookup"><span data-stu-id="8f6ed-111">Discussion</span></span>  
 <span data-ttu-id="8f6ed-112">WCF çok genişletilebilir ve kullanıcılara kanalları istenen şekilde özelleştirme olasılığa izin verir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="8f6ed-113">Örnek, güvenli kanallar oluşturan bir bulgu güvenli bağlama öğesi uygular.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="8f6ed-114">Güvenli kanallar, ileti imzalarını uygular ve doğrular ve geçerli yığının üzerine uygulanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="8f6ed-115">Güvenli bağlama öğesi, güvenli kanal fabrikaları ve kanal dinleyicileri oluşturur.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="8f6ed-116">Güvenli kanal fabrikası</span><span class="sxs-lookup"><span data-stu-id="8f6ed-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="8f6ed-117">Güvenli kanal fabrikası, ileti üst bilgilerine bir küçük imza ekleyen çıkış veya çift yönlü kanallar oluşturur.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="8f6ed-118">Sıkıştırılmış imza biçimi kullanılan iletileri olabildiğince küçük tutmak için.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="8f6ed-119">Bir Compact imzasının yapısı aşağıdaki örnekte gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >   
  [<d:Sig Scheme="xs:anyURI"   
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"   
          Sig="xs:base64Binary"   
          ... />]?  
  ...   
</d:Security>  
```  
  
> [!NOTE]
> <span data-ttu-id="8f6ed-120">`PrefixList`, 2008 bulma sürümü protokolüne eklenmiştir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="8f6ed-121">İmzayı hesaplamak için, örnek genişletilmiş imza öğelerini belirler.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="8f6ed-122">WS-Discovery belirtiminin gerektirdiği şekilde `ds` ad alanı öneki kullanılarak bir XML imzası (`SignedInfo`) oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="8f6ed-123">Bulma ve adresleme ad alanlarındaki gövdeye ve tüm üst bilgilere imza içinde başvuruluyor, bu nedenle üzerinde değişiklik yapılamaz.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="8f6ed-124">Başvurulan her öğe, dışlamalı kurallı kullanım (http://www.w3.org/2001/10/xml-exc-c14n#) kullanılarak dönüştürülür ve ardından bir SHA-1 Özet değeri hesaplanır (http://www.w3.org/2000/09/xmldsig#sha1).</span><span class="sxs-lookup"><span data-stu-id="8f6ed-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="8f6ed-125">Başvurulan tüm öğelere ve bunların Özet değerlerine göre imza değeri, RSA algoritması (http://www.w3.org/2000/09/xmldsig#rsa-sha1) kullanılarak hesaplanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="8f6ed-126">İletiler, istemci tarafından belirtilen sertifikayla imzalanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="8f6ed-127">Bağlama öğesi oluşturulduğunda depo konumu, ad ve sertifika konu adı belirtilmelidir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="8f6ed-128">Sıkıştırılmış İmzadaki `KeyId`, imzalama belirtecinin anahtar tanımlayıcısını temsil eder ve imzalama belirtecinin konu anahtar tanımlayıcısı (kayak) veya imza belirtecinin ortak anahtarının bir SHA-1 karmasını vardır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="8f6ed-129">Güvenli kanal dinleyicisi</span><span class="sxs-lookup"><span data-stu-id="8f6ed-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="8f6ed-130">Güvenli kanal dinleyicisi, alınan iletilerde sıkıştırılmış imzayı doğrulayan giriş veya çift yönlü kanallar oluşturur.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="8f6ed-131">İmzayı doğrulamak için, iletiye eklenen sıkıştırılmış İmzada belirtilen `KeyId`, belirtilen mağazadan bir sertifika seçmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="8f6ed-132">İletinin imzası yoksa veya imza denetimi başarısız olursa iletiler bırakılır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="8f6ed-133">Güvenli bağlamayı kullanmak için örnek, eklenen bulgu güvenli bağlama öğesiyle özel <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> ve <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> oluşturan bir fabrika tanımlar.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="8f6ed-134">Bu güvenli uç noktalar, bulma duyurusu dinleyicileri ve keşfedilebilir hizmetlerde kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="8f6ed-135">Örnek Ayrıntılar</span><span class="sxs-lookup"><span data-stu-id="8f6ed-135">Sample Details</span></span>  
 <span data-ttu-id="8f6ed-136">Örnek, bir kitaplık ve 4 konsol uygulaması içerir:</span><span class="sxs-lookup"><span data-stu-id="8f6ed-136">The sample includes a library and 4 console applications:</span></span>  
  
- <span data-ttu-id="8f6ed-137">**DiscoverySecurityChannels**: güvenli bağlamayı kullanıma sunan bir kitaplık.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="8f6ed-138">Kitaplık, giden/gelen iletiler için sıkıştırılmış imzayı hesaplar ve doğrular.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
- <span data-ttu-id="8f6ed-139">**Hizmet**: kendi kendine barındırılan bir hizmet olan icalbir hizmet sözleşmesi 'ni kullanıma sunma.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="8f6ed-140">Hizmet bulunabilir olarak işaretlendi.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="8f6ed-141">Kullanıcı, sertifika için depolama konumunu ve adı ve konu adını ya da diğer benzersiz tanımlayıcıyı ve istemci sertifikalarının bulunduğu mağazayı (için kullanılan sertifikalar) belirterek iletileri imzalamak için kullanılan sertifikanın ayrıntılarını belirtir. gelen iletiler için imzayı denetleyin).</span><span class="sxs-lookup"><span data-stu-id="8f6ed-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="8f6ed-142">Bu ayrıntılara dayanarak, ek güvenlik içeren bir UdpDiscoveryEndpoint oluşturulur ve kullanılır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
- <span data-ttu-id="8f6ed-143">**İstemci**: Bu sınıf bir Icalbir torservice bulmaya çalışır ve hizmette yöntemleri çağırabilir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="8f6ed-144">Yeniden, ek güvenlik özellikli bir <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> oluşturulur ve iletileri imzalamak ve doğrulamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
- <span data-ttu-id="8f6ed-145">**Announcementlistener**: çevrimiçi ve çevrimdışı duyuruları dinleyen ve güvenli duyuru uç noktasını kullanan kendiliğinden konak bir hizmet.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="8f6ed-146">Setup. bat birden çok kez çalışıyorsa, Sertifika Yöneticisi yinelenen sertifikalar olduğu için eklemek üzere bir sertifika seçmenizi ister.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="8f6ed-147">Bu durumda, yinelemeleri zaten oluşturulduğundan Setup. bat durdurulmalı ve Cleanup. bat çağrılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="8f6ed-148">Cleanup. bat Ayrıca, silinecek sertifikayı seçmenizi ister.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="8f6ed-149">Listeden bir sertifika seçin ve hiçbir sertifika geri alınana kadar Cleanup. bat çalıştırmaya devam edin.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="8f6ed-150">Bu örneği kullanmak için</span><span class="sxs-lookup"><span data-stu-id="8f6ed-150">To use this sample</span></span>  
  
1. <span data-ttu-id="8f6ed-151">Visual Studio için Geliştirici Komut İstemi Setup. bat betiğini yürütün.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-151">Execute the Setup.bat script from a Developer Command Prompt for Visual Studio.</span></span> <span data-ttu-id="8f6ed-152">Örnek, iletileri imzalamak ve doğrulamak için sertifikaları kullanır.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="8f6ed-153">Betik, MakeCert. exe kullanarak sertifikaları oluşturur ve sonra certmgr. exe ' yi kullanarak bunları kurar.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="8f6ed-154">Betiğin yönetici ayrıcalıklarıyla çalıştırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-154">The script must be run with administrator privileges.</span></span>  
  
2. <span data-ttu-id="8f6ed-155">Örneği derlemek ve çalıştırmak için, Visual Studio 'da Security. sln dosyasını açın ve **tümünü yeniden derle**' yi seçin.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="8f6ed-156">Birden çok proje başlatmak için çözüm özelliklerini güncelleştirin: DiscoverySecureChannels hariç tüm projeler için **Başlat** ' ı seçin.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="8f6ed-157">Çözümü normal olarak çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-157">Run the solution normally.</span></span>  
  
3. <span data-ttu-id="8f6ed-158">Örnekle işiniz bittiğinde, bu örnek için oluşturulan sertifikaları kaldıran Cleanup. bat betiğini yürütün.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="8f6ed-159">Örnekler makinenizde zaten yüklü olabilir.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="8f6ed-160">Devam etmeden önce aşağıdaki (varsayılan) dizini denetleyin.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-160">Check for the following (default) directory before continuing.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples`  
>   
> <span data-ttu-id="8f6ed-161">Bu dizin yoksa, tüm Windows Communication Foundation (WCF) ve [!INCLUDE[wf1](../../../../includes/wf1-md.md)] örneklerini indirmek üzere [.NET Framework 4 için Windows Communication Foundation (WCF) ve Windows Workflow Foundation (WF) örneklerine](https://www.microsoft.com/download/details.aspx?id=21459) gidin.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="8f6ed-162">Bu örnek, aşağıdaki dizinde bulunur.</span><span class="sxs-lookup"><span data-stu-id="8f6ed-162">This sample is located in the following directory.</span></span>  
>   
> `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
