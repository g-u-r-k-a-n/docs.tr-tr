---
title: Keşif Güvenliği Örneği
ms.date: 03/30/2017
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
ms.openlocfilehash: 00f81d1879d9157a7ecdfa0db8d2ea0d505ad5b6
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79183740"
---
# <a name="discovery-security-sample"></a><span data-ttu-id="d6708-102">Keşif Güvenliği Örneği</span><span class="sxs-lookup"><span data-stu-id="d6708-102">Discovery Security Sample</span></span>

<span data-ttu-id="d6708-103">Bulma belirtimi, bulma işlemine katılan uç noktaların güvenli olmasını gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="d6708-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="d6708-104">Keşif iletilerini güvenlikle birlikte geliştirmek çeşitli saldırı türlerini azaltır (ileti değişikliği, hizmet reddi, yeniden oynatma, sızdırma).</span><span class="sxs-lookup"><span data-stu-id="d6708-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="d6708-105">Bu örnek, ileti imzalarını kompakt imza biçimini kullanarak (WS-Discovery belirtiminin Bölüm 8.2'sinde açıklanan) oluşturan ve doğrulayan özel kanallar uygular.</span><span class="sxs-lookup"><span data-stu-id="d6708-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="d6708-106">Örnek hem [2005 Discovery belirtimi](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) ve [1.1 sürümünü](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf)destekler.</span><span class="sxs-lookup"><span data-stu-id="d6708-106">The sample supports both the [2005 Discovery specification](http://specs.xmlsoap.org/ws/2005/04/discovery/ws-discovery.pdf) and the [1.1 version](http://docs.oasis-open.org/ws-dd/discovery/1.1/cs-01/wsdd-discovery-1.1-spec-cs-01.pdf).</span></span>  
  
 <span data-ttu-id="d6708-107">Özel kanal, Bulma ve Duyuru uç noktaları için varolan kanal yığınının üstüne uygulanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="d6708-108">Bu şekilde, gönderilen her ileti için imza üstbilgisi uygulanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="d6708-109">İmza alınan iletilerde doğrulanır ve eşleşmediğinde veya iletilerin imzası olmadığında iletiler bırakılır.</span><span class="sxs-lookup"><span data-stu-id="d6708-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="d6708-110">İletileri imzalamak ve doğrulamak için örnek sertifikalar kullanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="d6708-111">Tartışma</span><span class="sxs-lookup"><span data-stu-id="d6708-111">Discussion</span></span>  
 <span data-ttu-id="d6708-112">WCF çok genişletilebilir ve kullanıcıların istediği gibi kanalları özelleştirme olanağı sağlar.</span><span class="sxs-lookup"><span data-stu-id="d6708-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="d6708-113">Örnek, güvenli kanallar oluşturan bir keşif güvenli bağlama öğesi uygular.</span><span class="sxs-lookup"><span data-stu-id="d6708-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="d6708-114">Güvenli kanallar ileti imzalarını uygular ve doğrular ve geçerli yığının üstüne uygulanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="d6708-115">Güvenli bağlama öğesi güvenli kanal fabrikaları ve kanal dinleyicileri oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d6708-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="d6708-116">Güvenli Kanal Fabrikası</span><span class="sxs-lookup"><span data-stu-id="d6708-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="d6708-117">Güvenli kanal fabrikası, ileti üstbilgilerine kompakt imza ekleyen çıktı veya çift yönlü kanallar oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d6708-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="d6708-118">İletileri mümkün olduğunca küçük tutmak için kompakt imza biçimi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d6708-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="d6708-119">Kompakt imzanın yapısı aşağıdaki örnekte gösterilmiştir.</span><span class="sxs-lookup"><span data-stu-id="d6708-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >
  [<d:Sig Scheme="xs:anyURI"
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"
          Sig="xs:base64Binary"
          ... />]?  
  ...
</d:Security>  
```  
  
> [!NOTE]
> <span data-ttu-id="d6708-120">2008 `PrefixList` Discovery sürüm protokolüne eklendi.</span><span class="sxs-lookup"><span data-stu-id="d6708-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="d6708-121">İmzayı hesaplamak için, örnek genişletilmiş imza öğelerini belirler.</span><span class="sxs-lookup"><span data-stu-id="d6708-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="d6708-122">WS-Discovery belirtiminin gerektirdiği`SignedInfo` `ds` ad alanı öneki kullanılarak bir XML imzası ( ) oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="d6708-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="d6708-123">Gövde ve bulma ve adresleme ad boşluklarındaki tüm üstbilgileri imzada başvurulur, bu nedenle değiştirilemezler.</span><span class="sxs-lookup"><span data-stu-id="d6708-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="d6708-124">Başvurulan her öğe Özel Kanonializasyonhttp://www.w3.org/2001/10/xml-exc-c14n# (), kullanılarak dönüştürülür ve ardından SHA-1 özet değerihttp://www.w3.org/2000/09/xmldsig#sha1 () olarak hesaplanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="d6708-125">Başvurulan tüm öğeler ve bunların özet değerlerine göre imza değeri RSAhttp://www.w3.org/2000/09/xmldsig#rsa-sha1 algoritması kullanılarak hesaplanır .</span><span class="sxs-lookup"><span data-stu-id="d6708-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="d6708-126">İletiler istemci tarafından belirtilen bir sertifikayla imzalanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="d6708-127">Bağlama öğesi oluşturulduğunda mağaza konumu, adı ve sertifika özne adı belirtilmelidir.</span><span class="sxs-lookup"><span data-stu-id="d6708-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="d6708-128">Kompakt `KeyId` imza, imza belirtecinin anahtar tanımlayıcısını temsil eder ve imza belirtecinin Özne Anahtarı Tanımlayıcısi 'dir (SKI yoksa) veya (SKI yoksa) imza belirtecinin ortak anahtarının SHA-1 karmasidır.</span><span class="sxs-lookup"><span data-stu-id="d6708-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="d6708-129">Güvenli Kanal Dinleyicisi</span><span class="sxs-lookup"><span data-stu-id="d6708-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="d6708-130">Güvenli kanal dinleyicisi, alınan iletilerde kompakt imzayı doğrulayan giriş veya çift yönlü kanallar oluşturur.</span><span class="sxs-lookup"><span data-stu-id="d6708-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="d6708-131">İmzayı doğrulamak için, iletiye iliştirilen kompakt imzada `KeyId` belirtilen belge, belirtilen mağazadan bir sertifika seçmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d6708-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="d6708-132">İletinin imzası yoksa veya imza denetimi başarısız olursa, iletiler bırakılır.</span><span class="sxs-lookup"><span data-stu-id="d6708-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="d6708-133">Güvenli bağlamayı kullanmak için, örnek özel <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> ve eklenen <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> bulma güvenli bağlama öğesi ile bir fabrika tanımlar.</span><span class="sxs-lookup"><span data-stu-id="d6708-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="d6708-134">Bu güvenli uç noktalar keşif duyuru dinleyicilerinde ve bulunabilir hizmetlerde kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="d6708-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="d6708-135">Örnek Ayrıntılar</span><span class="sxs-lookup"><span data-stu-id="d6708-135">Sample Details</span></span>  
 <span data-ttu-id="d6708-136">Örnek bir kitaplık ve 4 konsol uygulamaları içerir:</span><span class="sxs-lookup"><span data-stu-id="d6708-136">The sample includes a library and 4 console applications:</span></span>  
  
- <span data-ttu-id="d6708-137">**DiscoverySecurityChannels**: Güvenli bağlamayı ortaya çıkaran kitaplık.</span><span class="sxs-lookup"><span data-stu-id="d6708-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="d6708-138">Kitaplık, giden/gelen iletiler için kompakt imzayı bilgive doğrular.</span><span class="sxs-lookup"><span data-stu-id="d6708-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
- <span data-ttu-id="d6708-139">**Hizmet**: ICalculatorService sözleşmesini ortaya çıkaran bir hizmet, kendi kendine barındırılan.</span><span class="sxs-lookup"><span data-stu-id="d6708-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="d6708-140">Hizmet Keşfedilebilir olarak işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="d6708-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="d6708-141">Kullanıcı, mağaza konumunu ve adını ve sertifikanın özadını veya diğer benzersiz tanımlayıcısını belirterek iletileri imzalamak için kullanılan sertifikanın ayrıntılarını ve istemci sertifikalarının bulunduğu mağazayı (kullanılan sertifikalar gelen iletiler için imzayı denetleyin).</span><span class="sxs-lookup"><span data-stu-id="d6708-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="d6708-142">Bu ayrıntılara dayanarak, ek güvenliğe sahip bir UdpDiscoveryEndpoint oluşturulur ve kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d6708-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
- <span data-ttu-id="d6708-143">**İstemci**: Bu sınıf bir ICalculatorService keşfetmeye ve hizmetteki yöntemleri çağırmaya çalışır.</span><span class="sxs-lookup"><span data-stu-id="d6708-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="d6708-144">Yine, <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> ek güvenlik ile bir yapılı ve imzalamak ve iletileri doğrulamak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d6708-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
- <span data-ttu-id="d6708-145">**AnnouncementListener**: Çevrimiçi ve çevrimdışı duyuruları dinleyen ve güvenli duyuru bitiş noktasını kullanan kendi kendine barındırılan bir hizmet.</span><span class="sxs-lookup"><span data-stu-id="d6708-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d6708-146">Setup.bat birden çok kez çalıştırılırsa, sertifika yöneticisi yinelenen sertifikalar olduğu için ekleyeceğiniz bir sertifika seçmenizi ister.</span><span class="sxs-lookup"><span data-stu-id="d6708-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="d6708-147">Bu durumda, Setup.bat iptal edilmeli ve Temizleme.bat çağrılmalıdır, çünkü yinelenenler zaten oluşturulmuştur.</span><span class="sxs-lookup"><span data-stu-id="d6708-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="d6708-148">Cleanup.bat ayrıca silmek için bir sertifika seçmenize de izin ister.</span><span class="sxs-lookup"><span data-stu-id="d6708-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="d6708-149">Listeden bir sertifika seçin ve sertifika kalmayıp kalana kadar Cleanup.bat'ı yürütmeye devam edin.</span><span class="sxs-lookup"><span data-stu-id="d6708-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="d6708-150">Bu örneği kullanmak için</span><span class="sxs-lookup"><span data-stu-id="d6708-150">To use this sample</span></span>  
  
1. <span data-ttu-id="d6708-151">Setup.bat komut dosyasını Visual Studio için Geliştirici Komut Komut Ustem'den çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d6708-151">Execute the Setup.bat script from a Developer Command Prompt for Visual Studio.</span></span> <span data-ttu-id="d6708-152">Örnek, iletileri imzalamak ve doğrulamak için sertifikalar kullanır.</span><span class="sxs-lookup"><span data-stu-id="d6708-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="d6708-153">Komut dosyası, Sertifikaları Makecert.exe kullanarak oluşturur ve certmgr.exe kullanarak yükler.</span><span class="sxs-lookup"><span data-stu-id="d6708-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="d6708-154">Komut dosyası yönetici ayrıcalıkları ile çalıştırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="d6708-154">The script must be run with administrator privileges.</span></span>  
  
2. <span data-ttu-id="d6708-155">Örneği oluşturmak ve çalıştırmak için Visual Studio'da Security.sln dosyasını açın ve **Tümlerini Yeniden Oluştur'u**seçin.</span><span class="sxs-lookup"><span data-stu-id="d6708-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="d6708-156">Birden çok proje başlatmak için çözüm özelliklerini güncelleştirin: DiscoverySecureChannels dışındaki tüm projeler için **Başlat'ı** seçin.</span><span class="sxs-lookup"><span data-stu-id="d6708-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="d6708-157">Çözümü normal çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d6708-157">Run the solution normally.</span></span>  
  
3. <span data-ttu-id="d6708-158">Örnekle birlikte bittikten sonra, bu örnek için oluşturulan sertifikaları kaldıran Cleanup.bat komut dosyasını çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="d6708-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d6708-159">Numuneler makinenize zaten yüklenmiş olabilir.</span><span class="sxs-lookup"><span data-stu-id="d6708-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="d6708-160">Devam etmeden önce aşağıdaki (varsayılan) dizini denetleyin.</span><span class="sxs-lookup"><span data-stu-id="d6708-160">Check for the following (default) directory before continuing.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples`  
>
> <span data-ttu-id="d6708-161">Bu dizin yoksa, tüm Windows Communication Foundation (WCF) ve örneklerini indirmek için .NET Framework 4 için Windows Communication [!INCLUDE[wf1](../../../../includes/wf1-md.md)] Foundation [(WCF) ve Windows İş Akışı Temeli (WF) Örneklerine](https://www.microsoft.com/download/details.aspx?id=21459) gidin.</span><span class="sxs-lookup"><span data-stu-id="d6708-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="d6708-162">Bu örnek aşağıdaki dizinde yer almaktadır.</span><span class="sxs-lookup"><span data-stu-id="d6708-162">This sample is located in the following directory.</span></span>  
>
> `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
