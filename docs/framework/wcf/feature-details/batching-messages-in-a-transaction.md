---
description: 'Hakkında daha fazla bilgi edinin: Işlem içindeki Iletileri toplu Işleme'
title: Bir İşlemde Toplu İleti İşleme
ms.date: 03/30/2017
helpviewer_keywords:
- batching messages [WCF]
ms.assetid: 53305392-e82e-4e89-aedc-3efb6ebcd28c
ms.openlocfilehash: 0c84d87bc043f4ce1ae4d0a7674e862aa10011ac
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/06/2021
ms.locfileid: "99643702"
---
# <a name="batching-messages-in-a-transaction"></a><span data-ttu-id="a1db0-103">Bir İşlemde Toplu İleti İşleme</span><span class="sxs-lookup"><span data-stu-id="a1db0-103">Batching Messages in a Transaction</span></span>

<span data-ttu-id="a1db0-104">Kuyruğa alınan uygulamalar, iletilerin doğruluğu ve güvenilir bir şekilde teslim edilmesini sağlamak için işlemleri kullanır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-104">Queued applications use transactions to ensure correctness and reliable delivery of messages.</span></span> <span data-ttu-id="a1db0-105">Ancak işlemler, pahalı işlemlerdir ve ileti verimini önemli ölçüde azaltabilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-105">Transactions, however, are expensive operations and can dramatically reduce message throughput.</span></span> <span data-ttu-id="a1db0-106">İleti aktarım hızını artırmanın bir yolu, bir uygulamanın tek bir işlem içinde birden fazla iletiyi okumasını ve işlemesini kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-106">One way to improve message throughput is to have an application read and process multiple messages within a single transaction.</span></span> <span data-ttu-id="a1db0-107">Denge, performans ve kurtarma arasındadır: bir toplu işteki ileti sayısı arttıkça, işlemler geri alınırsa kurtarma işinin miktarı artar.</span><span class="sxs-lookup"><span data-stu-id="a1db0-107">The trade-off is between performance and recovery: as the number of messages in a batch increases, so does the amount of recovery work that required if transactions are rolled back.</span></span> <span data-ttu-id="a1db0-108">İşlem ve oturumlardaki toplu işleme iletileri arasındaki farkı göz önünde bulundurulmamak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-108">It is important to note the difference between batching messages in a transaction and sessions.</span></span> <span data-ttu-id="a1db0-109">*Oturum* , tek bir uygulama tarafından işlenen ve tek bir birim olarak yürütülen ilgili mesajların bir gruplandırmasıdır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-109">A *session* is a grouping of related messages that are processed by a single application and committed as a single unit.</span></span> <span data-ttu-id="a1db0-110">Oturumlar genellikle ilgili bir grup ileti birlikte işlenmeli şekilde kullanılır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-110">Sessions are generally used when a group of related messages must be processed together.</span></span> <span data-ttu-id="a1db0-111">Bu, bir çevrimiçi alışveriş web sitesi örneğidir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-111">An example of this is an online shopping Web site.</span></span> <span data-ttu-id="a1db0-112">*Toplu işlemler* , birden fazla ilişkisiz iletiyi ileti aktarım hızını arttırabileceğiniz bir şekilde işlemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-112">*Batches* are used to process multiple, unrelated messages in a way that increases message throughput.</span></span> <span data-ttu-id="a1db0-113">Oturumlar hakkında daha fazla bilgi için bkz. [bir oturumda sıraya alınmış Iletileri gruplandırma](grouping-queued-messages-in-a-session.md).</span><span class="sxs-lookup"><span data-stu-id="a1db0-113">For more information about sessions, see [Grouping Queued Messages in a Session](grouping-queued-messages-in-a-session.md).</span></span> <span data-ttu-id="a1db0-114">Toplu işteki iletiler aynı zamanda tek bir uygulama tarafından işlenir ve tek bir birim olarak kaydedilir, ancak toplu işteki iletiler arasında hiçbir ilişki bulunmayabilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-114">Messages in a batch are also processed by a single application and committed as a single unit, but there may be no relationship between the messages in the batch.</span></span> <span data-ttu-id="a1db0-115">İşlem içindeki iletileri toplu işleme, uygulamanın nasıl çalıştığını değiştirmayan bir iyileştirmedir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-115">Batching messages in a transaction is an optimization that does not change how the application runs.</span></span>  
  
## <a name="entering-batching-mode"></a><span data-ttu-id="a1db0-116">Toplu Işleme moduna giriliyor</span><span class="sxs-lookup"><span data-stu-id="a1db0-116">Entering Batching Mode</span></span>  

 <span data-ttu-id="a1db0-117"><xref:System.ServiceModel.Description.TransactedBatchingBehavior>Uç nokta davranışı toplu işlemeyi denetler.</span><span class="sxs-lookup"><span data-stu-id="a1db0-117">The <xref:System.ServiceModel.Description.TransactedBatchingBehavior> endpoint behavior controls batching.</span></span> <span data-ttu-id="a1db0-118">Bu uç nokta davranışının bir hizmet uç noktasına eklenmesi, bir işlemdeki toplu iletilere Windows Communication Foundation (WCF) bildirir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-118">Adding this endpoint behavior to a service endpoint tells Windows Communication Foundation (WCF) to batch messages in a transaction.</span></span> <span data-ttu-id="a1db0-119">Tüm iletiler bir işlem gerektirmez, bu nedenle yalnızca bir işlem gerektiren iletiler bir toplu işe konur ve yalnızca ile işaretlenmiş işlemlerden gönderilen iletiler `TransactionScopeRequired`  =  `true` `TransactionAutoComplete`  =  `true` bir toplu iş için kabul edilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-119">Not all messages require a transaction, so only messages that require a transaction are placed in a batch, and only messages sent from operations marked with `TransactionScopeRequired` = `true` and `TransactionAutoComplete` = `true` are considered for a batch.</span></span> <span data-ttu-id="a1db0-120">Hizmet sözleşmesindeki tüm işlemler ve ile işaretlenmişse `TransactionScopeRequired`  =  `false` `TransactionAutoComplete`  =  `false` , toplu işleme modu hiçbir şekilde girilmez.</span><span class="sxs-lookup"><span data-stu-id="a1db0-120">If all operations on the service contract are marked with `TransactionScopeRequired` = `false` and `TransactionAutoComplete` = `false`, then batching mode is never entered.</span></span>  
  
## <a name="committing-a-transaction"></a><span data-ttu-id="a1db0-121">Işlem yürütülüyor</span><span class="sxs-lookup"><span data-stu-id="a1db0-121">Committing a Transaction</span></span>  

 <span data-ttu-id="a1db0-122">Bir toplu işlem, aşağıdakilere göre kaydedilir:</span><span class="sxs-lookup"><span data-stu-id="a1db0-122">A batched transaction is committed based on the following:</span></span>  
  
- <span data-ttu-id="a1db0-123">`MaxBatchSize`.</span><span class="sxs-lookup"><span data-stu-id="a1db0-123">`MaxBatchSize`.</span></span> <span data-ttu-id="a1db0-124"><xref:System.ServiceModel.Description.TransactedBatchingBehavior>Davranışın özelliği.</span><span class="sxs-lookup"><span data-stu-id="a1db0-124">A property of the <xref:System.ServiceModel.Description.TransactedBatchingBehavior> behavior.</span></span> <span data-ttu-id="a1db0-125">Bu özellik bir toplu işe yerleştirilmiş en fazla ileti sayısını belirler.</span><span class="sxs-lookup"><span data-stu-id="a1db0-125">This property determines the maximum number of messages that are placed into a batch.</span></span> <span data-ttu-id="a1db0-126">Bu sayıya ulaşıldığında, toplu iş kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-126">When this number is reached, the batch is committed.</span></span> <span data-ttu-id="a1db0-127">Bu değer katı bir sınır değildir, bu sayıda iletiyi almadan önce bir toplu işlem yürütmek mümkündür.</span><span class="sxs-lookup"><span data-stu-id="a1db0-127">This is value is not a strict limit, it is possible to commit a batch before receiving this number of messages.</span></span>  
  
- <span data-ttu-id="a1db0-128">`Transaction Timeout`.</span><span class="sxs-lookup"><span data-stu-id="a1db0-128">`Transaction Timeout`.</span></span> <span data-ttu-id="a1db0-129">İşlemin zaman aşımını yüzde 80 ' i geçtiğinde, toplu iş kaydedilir ve yeni bir toplu iş oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="a1db0-129">After 80 percent of the transaction's time-out has elapsed, the batch is committed and a new batch is created.</span></span> <span data-ttu-id="a1db0-130">Bu, bir işlemin tamamlanabilmesi için verilen sürenin yüzde 20 ' sini veya daha azını kalırsa toplu işin tamamlandığı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-130">This means that if 20 percent or less of the time given for a transaction to complete remains, the batch is committed.</span></span>  
  
- <span data-ttu-id="a1db0-131">`TransactionScopeRequired`.</span><span class="sxs-lookup"><span data-stu-id="a1db0-131">`TransactionScopeRequired`.</span></span> <span data-ttu-id="a1db0-132">Bir toplu ileti işlenirken, WCF bir tane bulursa, `TransactionScopeRequired`  =  `false` toplu işi kaydeder ve ve ile ilk iletinin alınması sırasında yeni bir toplu işi yeniden açar `TransactionScopeRequired`  =  `true` `TransactionAutoComplete`  =  `true` .</span><span class="sxs-lookup"><span data-stu-id="a1db0-132">When processing a batch of messages, if WCF finds one that has `TransactionScopeRequired` = `false`, it commits the batch and reopens a new batch on receipt of the first message with `TransactionScopeRequired` = `true` and `TransactionAutoComplete` = `true`.</span></span>  
  
- <span data-ttu-id="a1db0-133">Kuyrukta daha fazla ileti yoksa, geçerli toplu işlem işlenir, ancak `MaxBatchSize` ulaşılmasa bile veya işlemin zaman aşımı süresinin yüzde 80 ' unun aşılmadığını belirtmez.</span><span class="sxs-lookup"><span data-stu-id="a1db0-133">If no more messages exist in the queue, then the current batch is committed, even if the `MaxBatchSize` has not been reached or 80 percent of the transaction's time-out has not elapsed.</span></span>  
  
## <a name="leaving-batching-mode"></a><span data-ttu-id="a1db0-134">Toplu Işleme modundan çıkma</span><span class="sxs-lookup"><span data-stu-id="a1db0-134">Leaving Batching Mode</span></span>  

 <span data-ttu-id="a1db0-135">Bir toplu işteki bir ileti işlemin iptal edilmesine neden oluyorsa, aşağıdaki adımlar oluşur:</span><span class="sxs-lookup"><span data-stu-id="a1db0-135">If a message in a batch causes the transaction to abort, the following steps occur:</span></span>  
  
1. <span data-ttu-id="a1db0-136">Tüm ileti toplu işi geri alınır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-136">The entire batch of messages is rolled back.</span></span>  
  
2. <span data-ttu-id="a1db0-137">Okunan ileti sayısı en büyük toplu iş boyutunu iki kez aşana kadar iletiler bir kez okunabilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-137">Messages are read one at a time until the number of messages read exceeds twice the maximum batch size.</span></span>  
  
3. <span data-ttu-id="a1db0-138">Toplu işlem modu yeniden girildi.</span><span class="sxs-lookup"><span data-stu-id="a1db0-138">Batch mode is re-entered.</span></span>  
  
## <a name="choosing-the-batch-size"></a><span data-ttu-id="a1db0-139">Toplu Iş boyutunu seçme</span><span class="sxs-lookup"><span data-stu-id="a1db0-139">Choosing the Batch Size</span></span>  

 <span data-ttu-id="a1db0-140">Bir toplu işin boyutu uygulamaya bağımlıdır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-140">The size of a batch is application-dependent.</span></span> <span data-ttu-id="a1db0-141">Empırical yöntemi, uygulama için en iyi toplu iş boyutuna ulaşmanız için en iyi yoldur.</span><span class="sxs-lookup"><span data-stu-id="a1db0-141">The empirical method is the best way to arrive at an optimal batch size for the application.</span></span> <span data-ttu-id="a1db0-142">Uygulamanızın gerçek dağıtım modeline göre boyutu seçmek için bir toplu iş boyutu seçerken unutmamak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-142">It is important to remember when choosing a batch size to choose the size according to your application's actual deployment model.</span></span> <span data-ttu-id="a1db0-143">Örneğin, uygulamayı dağıttığınızda, uzak bir makinede bir SQL Server ve sırayı ve SQL Server 'ı kapsayan bir işlem gerekiyorsa, toplu iş boyutu bu tam yapılandırma çalıştırılarak en iyi şekilde belirlenir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-143">For example, when deploying the application, if you need an SQL server on a remote machine and a transaction that spans the queue and the SQL server, then the batch size is best determined by running this exact configuration.</span></span>  
  
## <a name="concurrency-and-batching"></a><span data-ttu-id="a1db0-144">Eşzamanlılık ve toplu Işleme</span><span class="sxs-lookup"><span data-stu-id="a1db0-144">Concurrency and Batching</span></span>  

 <span data-ttu-id="a1db0-145">Aktarım hızını artırmak için aynı anda çok sayıda toplu işi de çalıştırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a1db0-145">To increase throughput, you can also have many batches run concurrently.</span></span> <span data-ttu-id="a1db0-146">' De ayarı yaparak `ConcurrencyMode.Multiple` `ServiceBehaviorAttribute` , eşzamanlı toplu işlemeyi etkinleştirirsiniz.</span><span class="sxs-lookup"><span data-stu-id="a1db0-146">By setting `ConcurrencyMode.Multiple` in `ServiceBehaviorAttribute`, you enable concurrent batching.</span></span>  
  
 <span data-ttu-id="a1db0-147">*Hizmet azaltma* , hizmette kaç maksimum eşzamanlı çağrının kullanılabileceğini göstermek için kullanılan bir hizmet davranışıdır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-147">*Service throttling* is a service behavior that is used to indicate how many maximum concurrent calls can be made on the service.</span></span> <span data-ttu-id="a1db0-148">Toplu işlem ile kullanıldığında, bu, kaç tane eşzamanlı toplu iş çalıştırılaacağına göre yorumlanır.</span><span class="sxs-lookup"><span data-stu-id="a1db0-148">When used with batching, this is interpreted as how many concurrent batches can be run.</span></span> <span data-ttu-id="a1db0-149">Hizmet kısıtlaması ayarlanmamışsa, WCF varsayılan en fazla eşzamanlı olarak 16 ' ya çağrı yapar.</span><span class="sxs-lookup"><span data-stu-id="a1db0-149">If the service throttling is not set, WCF defaults the maximum concurrent calls to 16.</span></span> <span data-ttu-id="a1db0-150">Bu nedenle, varsayılan olarak toplu işlem davranışı eklendiyse, en fazla 16 toplu iş aynı anda etkin olabilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-150">Thus, if batching behavior were added by default, a maximum of 16 batches can be active at the same time.</span></span> <span data-ttu-id="a1db0-151">Kapasiteniz temelinde hizmet azaltma ve toplu işleme ayarlamak en iyisidir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-151">It is best to tune the service throttling and batching based on your capacity.</span></span> <span data-ttu-id="a1db0-152">Örneğin, kuyruğun 100 iletisi varsa ve toplu iş 20 ' si isteniyorsa, aktarım hızına bağlı olarak 16 işlem etkin olabilir, çünkü işleme açık olmadan benzer.</span><span class="sxs-lookup"><span data-stu-id="a1db0-152">For example, if the queue has 100 messages and a batch of 20 is desired, having the maximum concurrent calls set to 16 is not useful because, depending on throughput, 16 transactions could be active, similar to not having batching turned on.</span></span> <span data-ttu-id="a1db0-153">Bu nedenle, performans için ince ayar yaparken, eşzamanlı toplu işleme yok ya da doğru hizmet kısıtlama boyutuyla eşzamanlı toplu işleme sahip değil.</span><span class="sxs-lookup"><span data-stu-id="a1db0-153">Therefore, when fine-tuning for performance, either do not have concurrent batching or have concurrent batching with the correct service throttle size.</span></span>  
  
## <a name="batching-and-multiple-endpoints"></a><span data-ttu-id="a1db0-154">Toplu işleme ve birden çok uç nokta</span><span class="sxs-lookup"><span data-stu-id="a1db0-154">Batching and Multiple Endpoints</span></span>  

 <span data-ttu-id="a1db0-155">Bir uç nokta bir adresten ve sözleşmeden oluşur.</span><span class="sxs-lookup"><span data-stu-id="a1db0-155">An endpoint is composed of an address and a contract.</span></span> <span data-ttu-id="a1db0-156">Aynı bağlamayı paylaşan birden fazla uç nokta olabilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-156">There may be multiple endpoints that share the same binding.</span></span> <span data-ttu-id="a1db0-157">İki uç noktanın aynı bağlamayı paylaşması ve Tekdüzen Kaynak tanımlayıcısı (URI) veya kuyruk adresi dinlemesi mümkündür.</span><span class="sxs-lookup"><span data-stu-id="a1db0-157">It is possible for two endpoints to share the same binding and listen Uniform Resource Identifier (URI), or queue address.</span></span> <span data-ttu-id="a1db0-158">İki uç nokta aynı kuyruktan okunacağından ve her iki uç noktaya işlenen toplu işlem davranışı eklenirse, belirtilen toplu iş boyutlarında bir çakışma ortaya çıkabilir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-158">If two endpoints are reading from the same queue, and transacted batching behavior is added to both endpoints, a conflict in the batch sizes specified could arise.</span></span> <span data-ttu-id="a1db0-159">Bu, iki işlem temelli toplu işlem davranışı arasında belirtilen en küçük toplu iş boyutu kullanılarak toplu işleme uygulayarak çözümlenir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-159">This is resolved by implementing batching using the minimal batch size specified between the two transacted batching behaviors.</span></span> <span data-ttu-id="a1db0-160">Bu senaryoda, uç noktalardan biri işlenen toplu işleme belirtmezse her iki uç nokta de toplu işlem kullanmaz.</span><span class="sxs-lookup"><span data-stu-id="a1db0-160">In this scenario, if one of the endpoints does not specify transacted batching, then both endpoints would not use batching.</span></span>  
  
## <a name="example"></a><span data-ttu-id="a1db0-161">Örnek</span><span class="sxs-lookup"><span data-stu-id="a1db0-161">Example</span></span>  

 <span data-ttu-id="a1db0-162">Aşağıdaki örnek, `TransactedBatchingBehavior` bir yapılandırma dosyasında nasıl ekleneceğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="a1db0-162">The following example shows how to specify the `TransactedBatchingBehavior` in a configuration file.</span></span>  
  
```xml  
<behaviors>
  <endpointBehaviors>
    <behavior name="TransactedBatchingBehavior"
              maxBatchSize="100" />
  </endpointBehaviors>
</behaviors>
```  
  
 <span data-ttu-id="a1db0-163">Aşağıdaki örnek, içinde kodunun nasıl ekleneceğini gösterir <xref:System.ServiceModel.Description.TransactedBatchingBehavior> .</span><span class="sxs-lookup"><span data-stu-id="a1db0-163">The following example shows how to specify the <xref:System.ServiceModel.Description.TransactedBatchingBehavior> in code.</span></span>  
  
```csharp
using (ServiceHost serviceHost = new ServiceHost(typeof(OrderProcessorService)))
{
     ServiceEndpoint sep = ServiceHost.AddServiceEndpoint(typeof(IOrderProcessor), new NetMsmqBinding(), "net.msmq://localhost/private/ServiceModelSamplesTransacted");
     sep.Behaviors.Add(new TransactedBatchingBehavior(100));

     // Open the ServiceHost to create listeners and start listening for messages.
    serviceHost.Open();
  
    // The service can now be accessed.
    Console.WriteLine("The service is ready.");
    Console.WriteLine("Press <ENTER> to terminate service.");
    Console.WriteLine();
    Console.ReadLine();
  
    // Close the ServiceHostB to shut down the service.
    serviceHost.Close();
}  
```  
  
## <a name="see-also"></a><span data-ttu-id="a1db0-164">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="a1db0-164">See also</span></span>

- [<span data-ttu-id="a1db0-165">Kuyruklar Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="a1db0-165">Queues Overview</span></span>](queues-overview.md)
- [<span data-ttu-id="a1db0-166">WCF'de Kuyruğa Alma</span><span class="sxs-lookup"><span data-stu-id="a1db0-166">Queuing in WCF</span></span>](queuing-in-wcf.md)
