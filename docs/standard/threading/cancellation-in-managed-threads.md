---
title: Yönetilen İş Parçacıklarında İptal
description: Yönetilen iş parçacıklarında iptali anlayın. Zaman uyumsuz veya uzun süreli zaman uyumlu işlemler için birlikte çalışırken iptal belirteçleri hakkında bilgi edinin.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cancellation in .NET, overview
ms.assetid: eea11fe5-d8b0-4314-bb5d-8a58166fb1c3
ms.openlocfilehash: 9af4a64e50eff65023d5ed5bda868af2f8323a96
ms.sourcegitcommit: 7137e12f54c4e83a94ae43ec320f8cf59c1772ea
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/10/2020
ms.locfileid: "84662842"
---
# <a name="cancellation-in-managed-threads"></a><span data-ttu-id="f5656-104">Yönetilen İş Parçacıklarında İptal</span><span class="sxs-lookup"><span data-stu-id="f5656-104">Cancellation in Managed Threads</span></span>
<span data-ttu-id="f5656-105">.NET Framework 4 ' te başlayarak, .NET Framework zaman uyumsuz veya uzun süre çalışan zaman uyumlu işlemler için bir birleştirilmiş model kullanır.</span><span class="sxs-lookup"><span data-stu-id="f5656-105">Starting with the .NET Framework 4, the .NET Framework uses a unified model for cooperative cancellation of asynchronous or long-running synchronous operations.</span></span> <span data-ttu-id="f5656-106">Bu model, iptal belirteci adlı hafif bir nesneyi temel alır.</span><span class="sxs-lookup"><span data-stu-id="f5656-106">This model is based on a lightweight object called a cancellation token.</span></span> <span data-ttu-id="f5656-107">Bir veya daha fazla iptal edilebilen işlemi çağıran nesne (örneğin, yeni iş parçacıkları veya görevler oluşturarak) belirteci her bir işleme geçirir.</span><span class="sxs-lookup"><span data-stu-id="f5656-107">The object that invokes one or more cancelable operations, for example by creating new threads or tasks, passes the token to each operation.</span></span> <span data-ttu-id="f5656-108">Tek tek işlemler, belirtecin kopyalarını diğer işlemlere geçirebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-108">Individual operations can in turn pass copies of the token to other operations.</span></span> <span data-ttu-id="f5656-109">Daha sonra, belirteci oluşturan nesne, işlemin ne yaptığını durdurmasını istemek için bunu kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-109">At some later time, the object that created the token can use it to request that the operations stop what they are doing.</span></span> <span data-ttu-id="f5656-110">Yalnızca istenen nesne iptal isteğini verebilir ve her dinleyici, isteği yaşıyorsanız ve uygun ve zamanında yanıt verecek şekilde sorumludur.</span><span class="sxs-lookup"><span data-stu-id="f5656-110">Only the requesting object can issue the cancellation request, and each listener is responsible for noticing the request and responding to it in an appropriate and timely manner.</span></span>  
  
 <span data-ttu-id="f5656-111">Birlikte çalışırken iptal modelinin uygulanması için genel bir örüntü şunlardır:</span><span class="sxs-lookup"><span data-stu-id="f5656-111">The general pattern for implementing the cooperative cancellation model is:</span></span>  
  
- <span data-ttu-id="f5656-112"><xref:System.Threading.CancellationTokenSource>Ayrı ayrı iptal belirteçlerine yönelik iptali bildirimini yöneten ve gönderen bir nesne örneği oluşturur.</span><span class="sxs-lookup"><span data-stu-id="f5656-112">Instantiate a <xref:System.Threading.CancellationTokenSource> object, which manages and sends cancellation notification to the individual cancellation tokens.</span></span>  
  
- <span data-ttu-id="f5656-113">Özelliği tarafından döndürülen belirteci, <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> iptal için dinleyen her bir göreve veya iş parçacığına geçirin.</span><span class="sxs-lookup"><span data-stu-id="f5656-113">Pass the token returned by the <xref:System.Threading.CancellationTokenSource.Token%2A?displayProperty=nameWithType> property to each task or thread that listens for cancellation.</span></span>  
  
- <span data-ttu-id="f5656-114">Her görev veya iş parçacığının iptaline yanıt vermesi için bir mekanizma sağlar.</span><span class="sxs-lookup"><span data-stu-id="f5656-114">Provide a mechanism for each task or thread to respond to cancellation.</span></span>  
  
- <span data-ttu-id="f5656-115"><xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType>İptal bildirimi sağlamak için yöntemini çağırın.</span><span class="sxs-lookup"><span data-stu-id="f5656-115">Call the <xref:System.Threading.CancellationTokenSource.Cancel%2A?displayProperty=nameWithType> method to provide notification of cancellation.</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="f5656-116"><xref:System.Threading.CancellationTokenSource> sınıfı, <xref:System.IDisposable> arabirimini uygular.</span><span class="sxs-lookup"><span data-stu-id="f5656-116">The <xref:System.Threading.CancellationTokenSource> class implements the <xref:System.IDisposable> interface.</span></span> <span data-ttu-id="f5656-117"><xref:System.Threading.CancellationTokenSource.Dispose%2A?displayProperty=nameWithType>Tuttuğu yönetilmeyen kaynakları serbest bırakmak için iptal belirteci kaynağını kullanmayı bitirdiğinizde yöntemini çağırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="f5656-117">You should be sure to call the <xref:System.Threading.CancellationTokenSource.Dispose%2A?displayProperty=nameWithType> method when you have finished using the cancellation token source to free any unmanaged resources it holds.</span></span>  
  
 <span data-ttu-id="f5656-118">Aşağıdaki çizimde, belirteç kaynağı ve belirtecinin tüm kopyalarından oluşan ilişki gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="f5656-118">The following illustration shows the relationship between a token source and all the copies of its token.</span></span>  
  
 <span data-ttu-id="f5656-119">![CancellationTokenSource ve iptal belirteçleri](media/vs-cancellationtoken.png "VS_CancellationToken")</span><span class="sxs-lookup"><span data-stu-id="f5656-119">![CancellationTokenSource and cancellation tokens](media/vs-cancellationtoken.png "VS_CancellationToken")</span></span>  
  
 <span data-ttu-id="f5656-120">Yeni iptal modeli, iptal kullanan uygulamalar ve kitaplıklar oluşturmayı kolaylaştırır ve aşağıdaki özellikleri destekler:</span><span class="sxs-lookup"><span data-stu-id="f5656-120">The new cancellation model makes it easier to create cancellation-aware applications and libraries, and it supports the following features:</span></span>  
  
- <span data-ttu-id="f5656-121">İptal etme birlikte çalışır ve dinleyicide zorlanmaz.</span><span class="sxs-lookup"><span data-stu-id="f5656-121">Cancellation is cooperative and is not forced on the listener.</span></span> <span data-ttu-id="f5656-122">Dinleyici, bir iptal isteğine yanıt olarak düzgün bir şekilde nasıl sonlandırıldığını belirler.</span><span class="sxs-lookup"><span data-stu-id="f5656-122">The listener determines how to gracefully terminate in response to a cancellation request.</span></span>  
  
- <span data-ttu-id="f5656-123">İstek, dinlemeye göre farklıdır.</span><span class="sxs-lookup"><span data-stu-id="f5656-123">Requesting is distinct from listening.</span></span> <span data-ttu-id="f5656-124">İptal edilebilen bir işlemi çağıran bir nesne, (varsa) iptalinin ne zaman istenmediğini denetleyebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-124">An object that invokes a cancelable operation can control when (if ever) cancellation is requested.</span></span>  
  
- <span data-ttu-id="f5656-125">İstekte bulunan nesne, yalnızca bir yöntem çağrısı kullanarak, iptal isteğini belirtecin tüm kopyalarına yayınlar.</span><span class="sxs-lookup"><span data-stu-id="f5656-125">The requesting object issues the cancellation request to all copies of the token by using just one method call.</span></span>  
  
- <span data-ttu-id="f5656-126">Bir dinleyici, tek bir *bağlı belirtece*katılarak birden fazla belirteci aynı anda dinleyebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-126">A listener can listen to multiple tokens simultaneously by joining them into one *linked token*.</span></span>  
  
- <span data-ttu-id="f5656-127">Kullanıcı kodu kitaplık kodundan gelen iptal isteklerini fark edebilir ve yanıtlayabilir ve kitaplık kodu kullanıcı kodundan gelen iptal isteklerini görebilir ve bunlara yanıt verebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-127">User code can notice and respond to cancellation requests from library code, and library code can notice and respond to cancellation requests from user code.</span></span>  
  
- <span data-ttu-id="f5656-128">Dinleyiciler yoklamaya, geri çağırma kaydına veya bekleme tanıtıcılarını beklemeye göre iptal istekleri hakkında bildirim alabilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-128">Listeners can be notified of cancellation requests by polling, callback registration, or waiting on wait handles.</span></span>  
  
## <a name="cancellation-types"></a><span data-ttu-id="f5656-129">İptal türleri</span><span class="sxs-lookup"><span data-stu-id="f5656-129">Cancellation Types</span></span>  
 <span data-ttu-id="f5656-130">İptal çerçevesi, aşağıdaki tabloda listelenen ilgili türler kümesi olarak uygulanır.</span><span class="sxs-lookup"><span data-stu-id="f5656-130">The cancellation framework is implemented as a set of related types, which are listed in the following table.</span></span>  
  
|<span data-ttu-id="f5656-131">Tür adı</span><span class="sxs-lookup"><span data-stu-id="f5656-131">Type name</span></span>|<span data-ttu-id="f5656-132">Description</span><span class="sxs-lookup"><span data-stu-id="f5656-132">Description</span></span>|  
|---------------|-----------------|  
|<xref:System.Threading.CancellationTokenSource>|<span data-ttu-id="f5656-133">İptal belirteci oluşturan ve ayrıca söz konusu belirtecin tüm kopyalarının iptal isteğini veren nesne.</span><span class="sxs-lookup"><span data-stu-id="f5656-133">Object that creates a cancellation token, and also issues the cancellation request for all copies of that token.</span></span>|  
|<xref:System.Threading.CancellationToken>|<span data-ttu-id="f5656-134">Hafif değer türü, genellikle yöntem parametresi olarak bir veya daha fazla dinleyicilerine geçirildi.</span><span class="sxs-lookup"><span data-stu-id="f5656-134">Lightweight value type passed to one or more listeners, typically as a method parameter.</span></span> <span data-ttu-id="f5656-135">Dinleyiciler, `IsCancellationRequested` belirteç özelliğinin değerini yoklama, geri çağırma veya bekleme tanıtıcısıyla izler.</span><span class="sxs-lookup"><span data-stu-id="f5656-135">Listeners monitor the value of the `IsCancellationRequested` property of the token by polling, callback, or wait handle.</span></span>|  
|<xref:System.OperationCanceledException>|<span data-ttu-id="f5656-136">Bu özel durumun oluşturucusunun aşırı yüklemeleri <xref:System.Threading.CancellationToken> parametre olarak bir parametresini kabul eder.</span><span class="sxs-lookup"><span data-stu-id="f5656-136">Overloads of this exception's constructor accept a <xref:System.Threading.CancellationToken> as a parameter.</span></span> <span data-ttu-id="f5656-137">Bu özel durum, İptalin kaynağını doğrulamak ve diğer kullanıcılara bir iptal isteğine yanıt verdiğini bildirmek için isteğe bağlı olarak bu özel durumu oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-137">Listeners can optionally throw this exception to verify the source of the cancellation and notify others that it has responded to a cancellation request.</span></span>|  
  
 <span data-ttu-id="f5656-138">Yeni iptal modeli, .NET Framework çeşitli türlerde tümleştirilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-138">The new cancellation model is integrated into the .NET Framework in several types.</span></span> <span data-ttu-id="f5656-139">En önemli olanlar <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> , ve ' <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> dir <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="f5656-139">The most important ones are <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType> and <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType>.</span></span> <span data-ttu-id="f5656-140">Tüm yeni kitaplık ve uygulama kodu için bu yeni iptal modelini kullanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="f5656-140">We recommend that you use this new cancellation model for all new library and application code.</span></span>  
  
## <a name="code-example"></a><span data-ttu-id="f5656-141">Kod Örneği</span><span class="sxs-lookup"><span data-stu-id="f5656-141">Code Example</span></span>  
 <span data-ttu-id="f5656-142">Aşağıdaki örnekte, istenen nesne bir <xref:System.Threading.CancellationTokenSource> nesne oluşturur ve sonra <xref:System.Threading.CancellationTokenSource.Token%2A> özelliğini iptal edilebilen işleme geçirir.</span><span class="sxs-lookup"><span data-stu-id="f5656-142">In the following example, the requesting object creates a <xref:System.Threading.CancellationTokenSource> object, and then passes its <xref:System.Threading.CancellationTokenSource.Token%2A> property to the cancelable operation.</span></span> <span data-ttu-id="f5656-143">İsteği alan işlem, <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> belirteç özelliğinin değerini yoklayarak izler.</span><span class="sxs-lookup"><span data-stu-id="f5656-143">The operation that receives the request monitors the value of the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property of the token by polling.</span></span> <span data-ttu-id="f5656-144">Değer ne olursa `true` olsun, dinleyici uygun şekilde sonlandırılır.</span><span class="sxs-lookup"><span data-stu-id="f5656-144">When the value becomes `true`, the listener can terminate in whatever manner is appropriate.</span></span> <span data-ttu-id="f5656-145">Bu örnekte, yöntemi birçok durumda gerekli olan tek çıkar.</span><span class="sxs-lookup"><span data-stu-id="f5656-145">In this example, the method just exits, which is all that is required in many cases.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="f5656-146">Örnek, <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> yeni iptal çerçevesinin eski API 'lerle uyumlu olduğunu göstermek için yöntemini kullanır.</span><span class="sxs-lookup"><span data-stu-id="f5656-146">The example uses the <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A> method to demonstrate that the new cancellation framework is compatible with legacy APIs.</span></span> <span data-ttu-id="f5656-147">Yeni ve tercih edilen türü kullanan bir örnek için <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> bkz. [nasıl yapılır: bir görevi ve alt öğelerini iptal etme](../parallel-programming/how-to-cancel-a-task-and-its-children.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-147">For an example that uses the new, preferred <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> type, see [How to: Cancel a Task and Its Children](../parallel-programming/how-to-cancel-a-task-and-its-children.md).</span></span>  
  
 [!code-csharp[Cancellation#1](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex1.cs#1)]
 [!code-vb[Cancellation#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex1.vb#1)]  
  
## <a name="operation-cancellation-versus-object-cancellation"></a><span data-ttu-id="f5656-148">İşlem Iptali ve nesne Iptaline karşı</span><span class="sxs-lookup"><span data-stu-id="f5656-148">Operation Cancellation Versus Object Cancellation</span></span>  
 <span data-ttu-id="f5656-149">Yeni iptal çerçevesinde, iptal, nesneleri değil, işlemler anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="f5656-149">In the new cancellation framework, cancellation refers to operations, not objects.</span></span> <span data-ttu-id="f5656-150">İptal isteği, gerekli temizleme gerçekleştirildikten sonra işlemin en kısa sürede durması gerektiği anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="f5656-150">The cancellation request means that the operation should stop as soon as possible after any required cleanup is performed.</span></span> <span data-ttu-id="f5656-151">Bir iptal belirtecinin "iptal edilebilen işlem" öğesine başvurması gerekir, ancak bu işlem programınızda uygulanabilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-151">One cancellation token should refer to one "cancelable operation," however that operation may be implemented in your program.</span></span> <span data-ttu-id="f5656-152"><xref:System.Threading.CancellationToken.IsCancellationRequested%2A>Belirtecinin özelliği olarak ayarlandıktan sonra `true` , ' a sıfırlanamaz `false` .</span><span class="sxs-lookup"><span data-stu-id="f5656-152">After the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property of the token has been set to `true`, it cannot be reset to `false`.</span></span> <span data-ttu-id="f5656-153">Bu nedenle, iptal belirteçleri iptal edildikten sonra yeniden kullanılamaz.</span><span class="sxs-lookup"><span data-stu-id="f5656-153">Therefore, cancellation tokens cannot be reused after they have been canceled.</span></span>  
  
 <span data-ttu-id="f5656-154">Bir nesne iptali mekanizmasına ihtiyacınız varsa, <xref:System.Threading.CancellationToken.Register%2A?displayProperty=nameWithType> Aşağıdaki örnekte gösterildiği gibi yöntemini çağırarak işlem iptali mekanizmasına temel alabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f5656-154">If you require an object cancellation mechanism, you can base it on the operation cancellation mechanism by calling the <xref:System.Threading.CancellationToken.Register%2A?displayProperty=nameWithType> method, as shown in the following example.</span></span>  
  
 [!code-csharp[Cancellation#2](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/objectcancellation1.cs#2)]
 [!code-vb[Cancellation#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/objectcancellation1.vb#2)]  
  
 <span data-ttu-id="f5656-155">Bir nesne birden fazla eşzamanlı iptal edilebilen işlemi destekliyorsa, ayrı bir iptal edilebilen her işlem için ayrı bir belirteç girişi olarak geçirin.</span><span class="sxs-lookup"><span data-stu-id="f5656-155">If an object supports more than one concurrent cancelable operation, pass a separate token as input to each distinct cancelable operation.</span></span> <span data-ttu-id="f5656-156">Bu şekilde, bir işlem diğerleri etkilenmeden iptal edilebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-156">That way, one operation can be cancelled without affecting the others.</span></span>  
  
## <a name="listening-and-responding-to-cancellation-requests"></a><span data-ttu-id="f5656-157">Iptal Isteklerini dinleme ve yanıtlama</span><span class="sxs-lookup"><span data-stu-id="f5656-157">Listening and Responding to Cancellation Requests</span></span>  
 <span data-ttu-id="f5656-158">Kullanıcı temsilcisinde, iptal edilebilen bir işlemin uygulayıcısı bir iptal isteğine yanıt olarak işlemin nasıl sonlandırıldığını belirler.</span><span class="sxs-lookup"><span data-stu-id="f5656-158">In the user delegate, the implementer of a cancelable operation determines how to terminate the operation in response to a cancellation request.</span></span> <span data-ttu-id="f5656-159">Çoğu durumda, kullanıcı temsilcisi gerekli temizleme işlemini gerçekleştirebilir ve hemen geri dönebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-159">In many cases, the user delegate can just perform any required cleanup and then return immediately.</span></span>  
  
 <span data-ttu-id="f5656-160">Bununla birlikte, daha karmaşık durumlarda, kullanıcı temsilcisinin iptal eden kitaplık kodunu bildirmesi gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-160">However, in more complex cases, it might be necessary for the user delegate to notify library code that cancellation has occurred.</span></span> <span data-ttu-id="f5656-161">Bu gibi durumlarda, işlemi sonlandırmak için doğru yol, <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A> bir, oluşturulmasına neden olacak şekilde temsilcinin, yöntemini çağırmasına yöneliktir <xref:System.OperationCanceledException> .</span><span class="sxs-lookup"><span data-stu-id="f5656-161">In such cases, the correct way to terminate the operation is for the delegate to call the <xref:System.Threading.CancellationToken.ThrowIfCancellationRequested%2A>, method, which will cause an <xref:System.OperationCanceledException> to be thrown.</span></span> <span data-ttu-id="f5656-162">Kitaplık kodu, kullanıcı temsilcisi iş parçacığında bu özel durumu yakalayabilir ve özel durumun, ortak iptali mi yoksa başka bir özel durum mi olduğunu anlamak için özel durumun belirtecini inceleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f5656-162">Library code can catch this exception on the user delegate thread and examine the exception's token to determine whether the exception indicates cooperative cancellation or some other exceptional situation.</span></span>  
  
 <span data-ttu-id="f5656-163"><xref:System.Threading.Tasks.Task>Sınıfı <xref:System.OperationCanceledException> Bu şekilde işler.</span><span class="sxs-lookup"><span data-stu-id="f5656-163">The <xref:System.Threading.Tasks.Task> class handles <xref:System.OperationCanceledException> in this way.</span></span> <span data-ttu-id="f5656-164">Daha fazla bilgi için bkz. [Görev iptali](../parallel-programming/task-cancellation.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-164">For more information, see [Task Cancellation](../parallel-programming/task-cancellation.md).</span></span>  
  
### <a name="listening-by-polling"></a><span data-ttu-id="f5656-165">Yoklamayla dinleme</span><span class="sxs-lookup"><span data-stu-id="f5656-165">Listening by Polling</span></span>  
 <span data-ttu-id="f5656-166">Döngü veya recurse sağlayan uzun süre çalışan hesaplamalar için, özelliğin değerini düzenli aralıklarla yoklayarak bir iptal isteği dinleyebilirsiniz <xref:System.Threading.CancellationToken.IsCancellationRequested%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="f5656-166">For long-running computations that loop or recurse, you can listen for a cancellation request by periodically polling the value of the <xref:System.Threading.CancellationToken.IsCancellationRequested%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="f5656-167">Değeri ise `true` , yöntemin en kısa sürede temizlenmesi ve sonlandırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="f5656-167">If its value is `true`, the method should clean up and terminate as quickly as possible.</span></span> <span data-ttu-id="f5656-168">En iyi yoklama sıklığı, uygulamanın türüne bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="f5656-168">The optimal frequency of polling depends on the type of application.</span></span> <span data-ttu-id="f5656-169">Bu, belirli bir program için en iyi yoklama sıklığını belirlemede geliştiriciye yöneliktir.</span><span class="sxs-lookup"><span data-stu-id="f5656-169">It is up to the developer to determine the best polling frequency for any given program.</span></span> <span data-ttu-id="f5656-170">Yoklama, performansı önemli ölçüde etkilemez.</span><span class="sxs-lookup"><span data-stu-id="f5656-170">Polling itself does not significantly impact performance.</span></span> <span data-ttu-id="f5656-171">Aşağıdaki örnekte, yoklamaya yönelik olası bir yol gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="f5656-171">The following example shows one possible way to poll.</span></span>  
  
 [!code-csharp[Cancellation#3](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex11.cs#3)]
 [!code-vb[Cancellation#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex11.vb#3)]  
  
 <span data-ttu-id="f5656-172">Daha kapsamlı bir örnek için bkz. [nasıl yapılır: yoklama Ile Iptal Isteklerini dinleme](how-to-listen-for-cancellation-requests-by-polling.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-172">For a more complete example, see [How to: Listen for Cancellation Requests by Polling](how-to-listen-for-cancellation-requests-by-polling.md).</span></span>  
  
### <a name="listening-by-registering-a-callback"></a><span data-ttu-id="f5656-173">Geri çağırma kaydederek dinleme</span><span class="sxs-lookup"><span data-stu-id="f5656-173">Listening by Registering a Callback</span></span>  
 <span data-ttu-id="f5656-174">Bazı işlemler, iptal belirtecinin değerini zamanında denetlenebilmeleri için bu şekilde engellenmiş hale gelebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-174">Some operations can become blocked in such a way that they cannot check the value of the cancellation token in a timely manner.</span></span> <span data-ttu-id="f5656-175">Bu gibi durumlarda, bir iptal isteği alındığında yöntemini engelleyen bir geri çağırma yöntemi kaydedebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f5656-175">For these cases, you can register a callback method that unblocks the method when a cancellation request is received.</span></span>  
  
 <span data-ttu-id="f5656-176"><xref:System.Threading.CancellationToken.Register%2A>Yöntemi, <xref:System.Threading.CancellationTokenRegistration> Bu amaçla özel olarak kullanılan bir nesne döndürür.</span><span class="sxs-lookup"><span data-stu-id="f5656-176">The <xref:System.Threading.CancellationToken.Register%2A> method returns a <xref:System.Threading.CancellationTokenRegistration> object that is used specifically for this purpose.</span></span> <span data-ttu-id="f5656-177">Aşağıdaki örnek, <xref:System.Threading.CancellationToken.Register%2A> zaman uyumsuz bir web isteğini iptal etmek için yönteminin nasıl kullanılacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="f5656-177">The following example shows how to use the <xref:System.Threading.CancellationToken.Register%2A> method to cancel an asynchronous Web request.</span></span>  
  
 [!code-csharp[Cancellation#4](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex4.cs#4)]
 [!code-vb[Cancellation#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex4.vb#4)]  
  
 <span data-ttu-id="f5656-178"><xref:System.Threading.CancellationTokenRegistration>Nesnesi, iş parçacığı eşitlemesini yönetir ve geri aramanın yürütme işlemini zaman içinde kesin bir noktada durdurmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="f5656-178">The <xref:System.Threading.CancellationTokenRegistration> object manages thread synchronization and ensures that the callback will stop executing at a precise point in time.</span></span>  
  
 <span data-ttu-id="f5656-179">Sistem yanıt verdiğini sağlamak ve kilitlenmeleri önlemek için geri çağrılar kaydedilirken aşağıdaki yönergelerin izlenmesi gerekir:</span><span class="sxs-lookup"><span data-stu-id="f5656-179">In order to ensure system responsiveness and to avoid deadlocks, the following guidelines must be followed when registering callbacks:</span></span>  
  
- <span data-ttu-id="f5656-180">Geri arama yöntemi, zaman uyumlu olarak çağrıldığı ve bu nedenle çağrısı <xref:System.Threading.CancellationTokenSource.Cancel%2A> geri çağırma görünene kadar döndürülmediği için hızlı olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="f5656-180">The callback method should be fast because it is called synchronously and therefore the call to <xref:System.Threading.CancellationTokenSource.Cancel%2A> does not return until the callback returns.</span></span>  
  
- <span data-ttu-id="f5656-181"><xref:System.Threading.CancellationTokenRegistration.Dispose%2A>Geri çağırma sırasında çağrı yaparsanız ve geri aramanın beklediği bir kilit tutarsanız, programınız kilitlenebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-181">If you call <xref:System.Threading.CancellationTokenRegistration.Dispose%2A> while the callback is running, and you hold a lock that the callback is waiting on, your program can deadlock.</span></span> <span data-ttu-id="f5656-182">`Dispose`Geri döndüğünde, geri çağırma için gereken tüm kaynakları serbest bırakabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f5656-182">After `Dispose` returns, you can free any resources required by the callback.</span></span>  
  
- <span data-ttu-id="f5656-183">Geri çağrılar hiçbir el ile iş parçacığı veya <xref:System.Threading.SynchronizationContext> bir geri aramada kullanım gerçekleştirmemelidir.</span><span class="sxs-lookup"><span data-stu-id="f5656-183">Callbacks should not perform any manual thread or <xref:System.Threading.SynchronizationContext> usage in a callback.</span></span> <span data-ttu-id="f5656-184">Belirli bir iş parçacığında bir geri çağırma çalışması gerekiyorsa, <xref:System.Threading.CancellationTokenRegistration?displayProperty=nameWithType> hedef syncContext 'in etkin olduğunu belirtmenize olanak sağlayan oluşturucuyu kullanın <xref:System.Threading.SynchronizationContext.Current%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="f5656-184">If a callback must run on a particular thread, use the <xref:System.Threading.CancellationTokenRegistration?displayProperty=nameWithType> constructor that enables you to specify that the target syncContext is the active <xref:System.Threading.SynchronizationContext.Current%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="f5656-185">Bir geri aramada el ile iş parçacığı gerçekleştirmek kilitlenmeye neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-185">Performing manual threading in a callback can cause deadlock.</span></span>  
  
 <span data-ttu-id="f5656-186">Daha kapsamlı bir örnek için bkz. [nasıl yapılır: Iptal istekleri Için geri çağırmaları kaydetme](how-to-register-callbacks-for-cancellation-requests.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-186">For a more complete example, see [How to: Register Callbacks for Cancellation Requests](how-to-register-callbacks-for-cancellation-requests.md).</span></span>  
  
### <a name="listening-by-using-a-wait-handle"></a><span data-ttu-id="f5656-187">Bekleme tutamacı kullanarak dinleme</span><span class="sxs-lookup"><span data-stu-id="f5656-187">Listening by Using a Wait Handle</span></span>  
 <span data-ttu-id="f5656-188">İptal edilebilen bir işlem, veya gibi bir eşitleme temel aldığı sırada engelleyebilen zaman, <xref:System.Threading.ManualResetEvent?displayProperty=nameWithType> <xref:System.Threading.Semaphore?displayProperty=nameWithType> <xref:System.Threading.CancellationToken.WaitHandle%2A?displayProperty=nameWithType> işlemin hem olay hem de iptal isteğinde beklemesini sağlamak için özelliğini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="f5656-188">When a cancelable operation can block while it waits on a synchronization primitive such as a <xref:System.Threading.ManualResetEvent?displayProperty=nameWithType> or <xref:System.Threading.Semaphore?displayProperty=nameWithType>, you can use the <xref:System.Threading.CancellationToken.WaitHandle%2A?displayProperty=nameWithType> property to enable the operation to wait on both the event and the cancellation request.</span></span> <span data-ttu-id="f5656-189">İptal belirtecinin bekleme tutamacı bir iptal isteğine yanıt olarak sinyal verecektir ve yöntemi, <xref:System.Threading.WaitHandle.WaitAny%2A> sinyal döndüren iptal belirteci olup olmadığını anlamak için yönteminin dönüş değerini kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-189">The wait handle of the cancellation token will become signaled in response to a cancellation request, and the method can use the return value of the <xref:System.Threading.WaitHandle.WaitAny%2A> method to determine whether it was the cancellation token that signaled.</span></span> <span data-ttu-id="f5656-190">İşlem daha sonra yalnızca çıkabilir veya uygun şekilde bir oluşturabilir <xref:System.OperationCanceledException> .</span><span class="sxs-lookup"><span data-stu-id="f5656-190">The operation can then just exit, or throw a <xref:System.OperationCanceledException>, as appropriate.</span></span>  
  
 [!code-csharp[Cancellation#5](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex9.cs#5)]
 [!code-vb[Cancellation#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex9.vb#5)]  
  
 <span data-ttu-id="f5656-191">.NET Framework 4 ' ü hedefleyen yeni kodda, <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType> <xref:System.Threading.SemaphoreSlim?displayProperty=nameWithType> her ikisi de yöntemlerinde yeni iptal çerçevesini destekler `Wait` .</span><span class="sxs-lookup"><span data-stu-id="f5656-191">In new code that targets the .NET Framework 4, <xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType> and <xref:System.Threading.SemaphoreSlim?displayProperty=nameWithType> both support the new cancellation framework in their `Wait` methods.</span></span> <span data-ttu-id="f5656-192"><xref:System.Threading.CancellationToken>Yöntemine geçirebilirsiniz ve iptal istendiğinde olay uyandırır ve bir oluşturur <xref:System.OperationCanceledException> .</span><span class="sxs-lookup"><span data-stu-id="f5656-192">You can pass the <xref:System.Threading.CancellationToken> to the method, and when the cancellation is requested, the event wakes up and throws an <xref:System.OperationCanceledException>.</span></span>  
  
 [!code-csharp[Cancellation#6](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex10.cs#6)]
 [!code-vb[Cancellation#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex10.vb#6)]  
  
 <span data-ttu-id="f5656-193">Daha kapsamlı bir örnek için bkz. [nasıl yapılır: bekleme tanıtıcıları Içeren Iptal Isteklerini dinleme](how-to-listen-for-cancellation-requests-that-have-wait-handles.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-193">For a more complete example, see [How to: Listen for Cancellation Requests That Have Wait Handles](how-to-listen-for-cancellation-requests-that-have-wait-handles.md).</span></span>  
  
### <a name="listening-to-multiple-tokens-simultaneously"></a><span data-ttu-id="f5656-194">Aynı anda birden çok belirtece dinleme</span><span class="sxs-lookup"><span data-stu-id="f5656-194">Listening to Multiple Tokens Simultaneously</span></span>  
 <span data-ttu-id="f5656-195">Bazı durumlarda, bir dinleyicinin aynı anda birden fazla iptal belirtecini dinlemesi gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-195">In some cases, a listener may have to listen to multiple cancellation tokens simultaneously.</span></span> <span data-ttu-id="f5656-196">Örneğin, bir iptal edilebilen işlemin, dışarıdan bir yöntem parametresine bağımsız değişken olarak geçirilen bir belirtece ek olarak iç iptal belirtecini izlemesi gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="f5656-196">For example, a cancelable operation may have to monitor an internal cancellation token in addition to a token passed in externally as an argument to a method parameter.</span></span> <span data-ttu-id="f5656-197">Bunu gerçekleştirmek için, aşağıdaki örnekte gösterildiği gibi, iki veya daha fazla belirteci bir belirtece birleştiren bağlantılı bir belirteç kaynağı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="f5656-197">To accomplish this, create a linked token source that can join two or more tokens into one token, as shown in the following example.</span></span>  
  
 [!code-csharp[Cancellation#7](../../../samples/snippets/csharp/VS_Snippets_Misc/cancellation/cs/cancellationex13.cs#7)]
 [!code-vb[Cancellation#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/cancellation/vb/cancellationex13.vb#7)]  
  
 <span data-ttu-id="f5656-198">`Dispose`İle işiniz bittiğinde bağlantılı belirteç kaynağını çağırmanız gerektiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="f5656-198">Notice that you must call `Dispose` on the linked token source when you are done with it.</span></span> <span data-ttu-id="f5656-199">Daha kapsamlı bir örnek için bkz. [nasıl yapılır: birden çok Iptal Isteğini dinleme](how-to-listen-for-multiple-cancellation-requests.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-199">For a more complete example, see [How to: Listen for Multiple Cancellation Requests](how-to-listen-for-multiple-cancellation-requests.md).</span></span>  
  
## <a name="cooperation-between-library-code-and-user-code"></a><span data-ttu-id="f5656-200">Kitaplık kodu ve Kullanıcı kodu arasındaki ortak işlem</span><span class="sxs-lookup"><span data-stu-id="f5656-200">Cooperation Between Library Code and User Code</span></span>  
 <span data-ttu-id="f5656-201">Birleşik iptal çerçevesi, kitaplık kodunun Kullanıcı kodunu iptal etmelerini ve kullanıcı kodunun kitaplık kodunu birlikte iptal edebilmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="f5656-201">The unified cancellation framework makes it possible for library code to cancel user code, and for user code to cancel library code in a cooperative manner.</span></span> <span data-ttu-id="f5656-202">Kesintisiz birlikte işlem, aşağıdaki yönergelerin ardından her bir tarafa bağlıdır:</span><span class="sxs-lookup"><span data-stu-id="f5656-202">Smooth cooperation depends on each side following these guidelines:</span></span>  
  
- <span data-ttu-id="f5656-203">Kitaplık kodu iptal edilebilen işlemler sağlıyorsa, kullanıcı kodunun iptali istemesi için bir dış iptal belirtecini kabul eden ortak yöntemler de sağlamalıdır.</span><span class="sxs-lookup"><span data-stu-id="f5656-203">If library code provides cancelable operations, it should also provide public methods that accept an external cancellation token so that user code can request cancellation.</span></span>  
  
- <span data-ttu-id="f5656-204">Kitaplık kodu kullanıcı koduna çağırırsa, kitaplık kodu bir Operationolaydexception (externalToken) ile *birlikte işlem iptali*olarak yorumlanmalıdır ve hata özel durumu olarak değildir.</span><span class="sxs-lookup"><span data-stu-id="f5656-204">If library code calls into user code, the library code should interpret an OperationCanceledException(externalToken) as *cooperative cancellation*, and not necessarily as a failure exception.</span></span>  
  
- <span data-ttu-id="f5656-205">Kullanıcı temsilcileri, kitaplık kodundaki iptal isteklerini zamanında yanıtlamayı denemelidir.</span><span class="sxs-lookup"><span data-stu-id="f5656-205">User-delegates should attempt to respond to cancellation requests from library code in a timely manner.</span></span>  
  
 <span data-ttu-id="f5656-206"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType>ve <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> Bu yönergeleri izleyen sınıfların örnekleridir.</span><span class="sxs-lookup"><span data-stu-id="f5656-206"><xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and <xref:System.Linq.ParallelEnumerable?displayProperty=nameWithType> are examples of classes that follow these guidelines.</span></span> <span data-ttu-id="f5656-207">Daha fazla bilgi için bkz. [Görev iptali](../parallel-programming/task-cancellation.md) ve [nasıl yapılır: PLINQ Sorgusunu İptal etme](../parallel-programming/how-to-cancel-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="f5656-207">For more information, see [Task Cancellation](../parallel-programming/task-cancellation.md) and [How to: Cancel a PLINQ Query](../parallel-programming/how-to-cancel-a-plinq-query.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f5656-208">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="f5656-208">See also</span></span>

- [<span data-ttu-id="f5656-209">Yönetilen İş Parçacığı Oluşturma Temelleri</span><span class="sxs-lookup"><span data-stu-id="f5656-209">Managed Threading Basics</span></span>](managed-threading-basics.md)
