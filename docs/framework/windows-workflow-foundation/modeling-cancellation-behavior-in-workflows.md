---
description: 'Daha fazla bilgi edinin: Iş akışlarında Iptal etme davranışını modelleme'
title: Iş akışlarında modelleme Iptali davranışı
ms.date: 03/30/2017
ms.assetid: d48f6cf3-cdde-4dd3-8265-a665acf32a03
ms.openlocfilehash: 971e044336eb0aed41e773e03f6e0fb70d959094
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/06/2021
ms.locfileid: "99792654"
---
# <a name="modeling-cancellation-behavior-in-workflows"></a><span data-ttu-id="d1a5a-103">Iş akışlarında modelleme Iptali davranışı</span><span class="sxs-lookup"><span data-stu-id="d1a5a-103">Modeling Cancellation Behavior in Workflows</span></span>

<span data-ttu-id="d1a5a-104">Etkinlikler, bir iş akışı içinde iptal edilebilir. Örneğin, bir etkinlik, bir işlem tarafından <xref:System.Activities.Statements.Parallel> <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> `true` , ya değerlendirildiğinde ya da iş akışının dışından, ana bilgisayar çağırırsa <xref:System.Activities.WorkflowApplication.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-104">Activities can be canceled inside a workflow, for example by a <xref:System.Activities.Statements.Parallel> activity canceling incomplete branches when its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true`, or from outside the workflow, if the host calls <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="d1a5a-105">İş akışı yazarları iptal işleme sağlamak için <xref:System.Activities.Statements.CancellationScope> etkinliği, <xref:System.Activities.Statements.CompensableActivity> etkinliği veya iptal mantığı sağlayan özel etkinlikler oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-105">To provide cancellation handling, workflow authors can use the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> activity, or create custom activities that provide cancellation logic.</span></span> <span data-ttu-id="d1a5a-106">Bu konuda, iş akışlarında iptale bir genel bakış sunulmaktadır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-106">This topic provides an overview of cancellation in workflows.</span></span>  
  
## <a name="cancellation-compensation-and-transactions"></a><span data-ttu-id="d1a5a-107">İptal, Dengeleme ve Işlemler</span><span class="sxs-lookup"><span data-stu-id="d1a5a-107">Cancellation, Compensation, and Transactions</span></span>  

 <span data-ttu-id="d1a5a-108">İşlemler, işlem işleminin herhangi bir bölümünde herhangi bir hata oluşursa, uygulamanıza işlem içinde yürütülen tüm değişiklikleri (geri alma) sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-108">Transactions give your application the ability to abort (roll back) all changes executed within the transaction if any errors occur during any part of the transaction process.</span></span> <span data-ttu-id="d1a5a-109">Bununla birlikte, iptal edilmesi veya geri yüklenmesi gerekebilecek tüm işler, uzun süreli çalışma veya işlem kaynakları içermeyen iş gibi işlemler için uygundur.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-109">However, not all work that may need to be canceled or undone is appropriate for transactions, such as long-running work or work that does not involve transactional resources.</span></span> <span data-ttu-id="d1a5a-110">Dengeleme, iş akışında sonraki bir hata varsa, daha önce tamamlanmış işlem dışı çalışmayı geri almak için bir model sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-110">Compensation provides a model for undoing previously completed non-transactional work if there is a subsequent failure in the workflow.</span></span> <span data-ttu-id="d1a5a-111">İptal işlemi, tamamlanmamış çalışmayı işlemek için iş akışı ve etkinlik yazarları için bir model sağlar.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-111">Cancellation provides a model for workflow and activity authors to handle non-transactional work that was not completed.</span></span> <span data-ttu-id="d1a5a-112">Bir etkinlik yürütmesini tamamlamamışsa ve iptal edilirse, varsa iptal mantığı çağrılır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-112">If an activity has not completed its execution and it is canceled, its cancellation logic will be invoked if it is available.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d1a5a-113">İşlemler ve dengeleme hakkında daha fazla bilgi için bkz. [işlemler](workflow-transactions.md) ve [Dengeleme](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="d1a5a-113">For more information about transactions and compensation, see [Transactions](workflow-transactions.md) and [Compensation](compensation.md).</span></span>  
  
## <a name="using-cancellationscope"></a><span data-ttu-id="d1a5a-114">CancellationScope Kullanma</span><span class="sxs-lookup"><span data-stu-id="d1a5a-114">Using CancellationScope</span></span>  

 <span data-ttu-id="d1a5a-115"><xref:System.Activities.Statements.CancellationScope>Etkinliğin alt etkinlikleri içerebilen iki bölümü vardır: <xref:System.Activities.Statements.CancellationScope.Body%2A> ve <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-115">The <xref:System.Activities.Statements.CancellationScope> activity has two sections that can contain child activities: <xref:System.Activities.Statements.CancellationScope.Body%2A> and <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>.</span></span> <span data-ttu-id="d1a5a-116">, <xref:System.Activities.Statements.CancellationScope.Body%2A> Etkinliğin mantığını oluşturan etkinliklerin yerleştirildiği ve <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> etkinlik için iptal mantığı sağlayan etkinliklerin yerleştirildiği yer olduğu yerdir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-116">The <xref:System.Activities.Statements.CancellationScope.Body%2A> is where the activities that make up the logic of the activity are placed, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> is where the activities that provide cancellation logic for the activity are placed.</span></span> <span data-ttu-id="d1a5a-117">Bir etkinlik yalnızca tamamlanmayan iptal edilebilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-117">An activity can be canceled only if it has not completed.</span></span> <span data-ttu-id="d1a5a-118">Etkinlik durumunda, <xref:System.Activities.Statements.CancellationScope> tamamlama içindeki etkinliklerin tamamlanmasını ifade eder <xref:System.Activities.Statements.CancellationScope.Body%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-118">In the case of the <xref:System.Activities.Statements.CancellationScope> activity, completion refers to the completion of the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A>.</span></span> <span data-ttu-id="d1a5a-119">Bir iptal isteği zamanlanırsa ve içindeki etkinlikler <xref:System.Activities.Statements.CancellationScope.Body%2A> tamamlanmamışsa, <xref:System.Activities.Statements.CancellationScope> olarak işaretlenir <xref:System.Activities.ActivityInstanceState.Canceled> ve <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> Etkinlikler yürütülür.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-119">If a cancellation request is scheduled and the activities in the <xref:System.Activities.Statements.CancellationScope.Body%2A> have not completed, then the <xref:System.Activities.Statements.CancellationScope> will be marked as <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> activities will be executed.</span></span>  
  
### <a name="canceling-a-workflow-from-the-host"></a><span data-ttu-id="d1a5a-120">Konaktan bir Iş akışını iptal etme</span><span class="sxs-lookup"><span data-stu-id="d1a5a-120">Canceling a Workflow from the Host</span></span>  

 <span data-ttu-id="d1a5a-121">Bir konak <xref:System.Activities.WorkflowApplication.Cancel%2A> , iş akışını barındıran örneğin yöntemini çağırarak bir iş akışını iptal edebilir <xref:System.Activities.WorkflowApplication> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-121">A host can cancel a workflow by calling the <xref:System.Activities.WorkflowApplication.Cancel%2A> method of the <xref:System.Activities.WorkflowApplication> instance that is hosting the workflow.</span></span> <span data-ttu-id="d1a5a-122">Aşağıdaki örnekte, içeren bir iş akışı oluşturulur <xref:System.Activities.Statements.CancellationScope> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-122">In the following example a workflow is created that has a <xref:System.Activities.Statements.CancellationScope>.</span></span> <span data-ttu-id="d1a5a-123">İş akışı çağrılır, sonra ana bilgisayar öğesine bir çağrı yapar <xref:System.Activities.WorkflowApplication.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-123">The workflow is invoked, and then the host makes a call to <xref:System.Activities.WorkflowApplication.Cancel%2A>.</span></span> <span data-ttu-id="d1a5a-124">İş akışının ana yürütmesi durdurulur, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> öğesinin <xref:System.Activities.Statements.CancellationScope> çağrılır ve sonra iş akışı durumu ile tamamlanır <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-124">The main execution of the workflow is stopped, the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the <xref:System.Activities.Statements.CancellationScope> is invoked, and then the workflow completes with a status of <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#35](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#35)]  
  
 <span data-ttu-id="d1a5a-125">Bu iş akışı çağrıldığında, konsola aşağıdaki çıktı görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-125">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d1a5a-126">**İş akışı başlatılıyor.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-126">**Starting the workflow.**</span></span>  
<span data-ttu-id="d1a5a-127">**CancellationHandler çağrıldı.** 
 **Iş akışı B30ebb30-df46-4d90-A211-e31c38d8db3c Iptal edildi.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-127">**CancellationHandler invoked.**
**Workflow b30ebb30-df46-4d90-a211-e31c38d8db3c Canceled.**</span></span>
> [!NOTE]
> <span data-ttu-id="d1a5a-128">Bir <xref:System.Activities.Statements.CancellationScope> etkinlik iptal edildiğinde ve <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> çağrıldığında, iptal edilen etkinliğin uygun iptal mantığını sağlamak üzere iptal edilmeden önce yaptığı ilerlemeyi belirlemede iş akışı yazarının sorumluluğundadır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-128">When a <xref:System.Activities.Statements.CancellationScope> activity is canceled and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> invoked, it is the responsibility of the workflow author to determine the progress that the canceled activity made before it was canceled in order to provide the appropriate cancellation logic.</span></span> <span data-ttu-id="d1a5a-129">, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> İptal edilen etkinliğin ilerlemesi hakkında herhangi bir bilgi sağlamaz.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-129">The <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> does not provide any information about the progress of the canceled activity.</span></span>  
  
 <span data-ttu-id="d1a5a-130">İşlenmemiş bir özel durum kabarcıkları, iş akışının kökünü aşıp işleyicinin döndürdüğü takdirde, bir iş akışı konaktan de iptal edilebilir <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> <xref:System.Activities.UnhandledExceptionAction.Cancel> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-130">A workflow can also be canceled from the host if an unhandled exception bubbles up past the root of the workflow and the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler returns <xref:System.Activities.UnhandledExceptionAction.Cancel>.</span></span> <span data-ttu-id="d1a5a-131">Bu örnekte, iş akışı başlar ve sonra bir oluşturur <xref:System.ApplicationException> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-131">In this example the workflow starts and then throws an <xref:System.ApplicationException>.</span></span> <span data-ttu-id="d1a5a-132">Bu özel durum iş akışı tarafından işlenmemiş olduğundan <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> işleyicinin çağrılması.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-132">This exception is unhandled by the workflow and so the <xref:System.Activities.WorkflowApplication.OnUnhandledException%2A> handler is invoked.</span></span> <span data-ttu-id="d1a5a-133">İşleyici, çalışma zamanına iş akışını iptal eder ve <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> Şu anda yürütülmekte olan <xref:System.Activities.Statements.CancellationScope> etkinliğin çağırılır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-133">The handler instructs the runtime to cancel the workflow, and the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of the currently executing <xref:System.Activities.Statements.CancellationScope> activity is invoked.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#36](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#36)]  
  
 <span data-ttu-id="d1a5a-134">Bu iş akışı çağrıldığında, konsola aşağıdaki çıktı görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-134">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d1a5a-135">**İş akışı başlatılıyor.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-135">**Starting the workflow.**</span></span>  
<span data-ttu-id="d1a5a-136">**Iş akışında OnUnhandledException, 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9** 
 **ApplicationException oluşturuldu.** 
 **CancellationHandler çağrıldı.** 
 **Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Iptal edildi.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-136">**OnUnhandledException in Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9**
**An ApplicationException was thrown.**
**CancellationHandler invoked.**
**Workflow 6bb2d5d6-f49a-4c6d-a988-478afb86dbe9 Canceled.**</span></span>

### <a name="canceling-an-activity-from-inside-a-workflow"></a><span data-ttu-id="d1a5a-137">Iş akışının Içinden etkinlik iptal ediliyor</span><span class="sxs-lookup"><span data-stu-id="d1a5a-137">Canceling an Activity from Inside a Workflow</span></span>  

 <span data-ttu-id="d1a5a-138">Etkinlik, üst öğesi tarafından da iptal edilebilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-138">An activity can also be canceled by its parent.</span></span> <span data-ttu-id="d1a5a-139">Örneğin, bir <xref:System.Activities.Statements.Parallel> etkinliğin birden fazla çalışan dalı varsa ve bu <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> durumda, onun `true` eksik dalları iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-139">For example, if a <xref:System.Activities.Statements.Parallel> activity has multiple executing branches and its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> evaluates to `true` then its incomplete branches will be canceled.</span></span> <span data-ttu-id="d1a5a-140">Bu örnekte <xref:System.Activities.Statements.Parallel> , iki dalı olan bir etkinlik oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-140">In this example a <xref:System.Activities.Statements.Parallel> activity is created that has two branches.</span></span> <span data-ttu-id="d1a5a-141">, <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> `true` <xref:System.Activities.Statements.Parallel> Dallarından herhangi biri tamamlandıktan hemen sonra tamamlanmasını sağlayacak şekilde ayarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-141">Its <xref:System.Activities.Statements.Parallel.CompletionCondition%2A> is set to `true` so the <xref:System.Activities.Statements.Parallel> completes as soon as any one of its branches is completed.</span></span> <span data-ttu-id="d1a5a-142">Bu örnekte 2. dal tamamlandığında, 1. dal iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-142">In this example branch 2 completes, and so branch 1 is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#37](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#37)]  
  
 <span data-ttu-id="d1a5a-143">Bu iş akışı çağrıldığında, konsola aşağıdaki çıktı görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-143">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d1a5a-144">**Şube 1 başlatılıyor.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-144">**Branch 1 starting.**</span></span>  
<span data-ttu-id="d1a5a-145">**2. dal tamam.** 
 **Şube 1 iptal edildi.** 
 **Iş akışı E0685e24-18ef-4A47-acf3-5c638732f3be tamamlandı.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-145">**Branch 2 complete.**
**Branch 1 canceled.**
**Workflow e0685e24-18ef-4a47-acf3-5c638732f3be Completed.**</span></span>  <span data-ttu-id="d1a5a-146">Etkinlik, etkinliğin kökünün ötesinde, ancak iş akışında daha yüksek bir düzeyde işlenirse etkinlikler de iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-146">Activities are also canceled if an exception bubbles up past the root of the activity but is handled at a higher level in the workflow.</span></span> <span data-ttu-id="d1a5a-147">Bu örnekte, iş akışının ana mantığı bir <xref:System.Activities.Statements.Sequence> etkinlikten oluşur.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-147">In this example, the main logic of the workflow consists of a <xref:System.Activities.Statements.Sequence> activity.</span></span> <span data-ttu-id="d1a5a-148">, <xref:System.Activities.Statements.Sequence> <xref:System.Activities.Statements.CancellationScope.Body%2A> <xref:System.Activities.Statements.CancellationScope> Bir etkinliğin içerdiği bir etkinliğin ' i olarak belirtilir <xref:System.Activities.Statements.TryCatch> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-148">The <xref:System.Activities.Statements.Sequence> is specified as the <xref:System.Activities.Statements.CancellationScope.Body%2A> of a <xref:System.Activities.Statements.CancellationScope> activity which is contained by a <xref:System.Activities.Statements.TryCatch> activity.</span></span> <span data-ttu-id="d1a5a-149">Öğesinin gövdesinden bir özel durum oluşturulur, <xref:System.Activities.Statements.Sequence> üst etkinlik tarafından işlenir <xref:System.Activities.Statements.TryCatch> ve <xref:System.Activities.Statements.Sequence> iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-149">An exception is thrown from the body of the <xref:System.Activities.Statements.Sequence>, is handled by the parent <xref:System.Activities.Statements.TryCatch> activity, and the <xref:System.Activities.Statements.Sequence> is canceled.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#39](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#39)]  
  
 <span data-ttu-id="d1a5a-150">Bu iş akışı çağrıldığında, konsola aşağıdaki çıktı görüntülenir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-150">When this workflow is invoked, the following output is displayed to the console.</span></span>  
  
 <span data-ttu-id="d1a5a-151">**Sıra başlatılıyor.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-151">**Sequence starting.**</span></span>  
<span data-ttu-id="d1a5a-152">**Sıra iptal edildi.** 
 **Özel durum yakalandı.** 
 **Iş akışı E3c18939-121E-4c43-af1c-ba1ce977ce55 tamamlandı.**</span><span class="sxs-lookup"><span data-stu-id="d1a5a-152">**Sequence canceled.**
**Exception caught.**
**Workflow e3c18939-121e-4c43-af1c-ba1ce977ce55 Completed.**</span></span>

### <a name="throwing-exceptions-from-a-cancellationhandler"></a><span data-ttu-id="d1a5a-153">CancellationHandler 'dan özel durumlar oluşturma</span><span class="sxs-lookup"><span data-stu-id="d1a5a-153">Throwing Exceptions from a CancellationHandler</span></span>  

 <span data-ttu-id="d1a5a-154">Kaynağından oluşan tüm özel durumlar <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> <xref:System.Activities.Statements.CancellationScope> iş akışı için önemli değildir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-154">Any exceptions thrown from the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> of a <xref:System.Activities.Statements.CancellationScope> are fatal to the workflow.</span></span> <span data-ttu-id="d1a5a-155">Bir için özel durum kaçış olasılığı varsa, <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> <xref:System.Activities.Statements.TryCatch> <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> Bu özel durumları yakalamak ve işlemek için içinde bir kullanın.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-155">If there is a possibility of exceptions escaping from a <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A>, use a <xref:System.Activities.Statements.TryCatch> in the <xref:System.Activities.Statements.CancellationScope.CancellationHandler%2A> to catch and handle these exceptions.</span></span>  
  
### <a name="cancellation-using-compensableactivity"></a><span data-ttu-id="d1a5a-156">CompensableActivity kullanarak iptal etme</span><span class="sxs-lookup"><span data-stu-id="d1a5a-156">Cancellation using CompensableActivity</span></span>  

 <span data-ttu-id="d1a5a-157">Etkinlik gibi, öğesine <xref:System.Activities.Statements.CancellationScope> <xref:System.Activities.Statements.CompensableActivity> sahiptir <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-157">Like the <xref:System.Activities.Statements.CancellationScope> activity, the <xref:System.Activities.Statements.CompensableActivity> has a <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A>.</span></span> <span data-ttu-id="d1a5a-158">Bir <xref:System.Activities.Statements.CompensableActivity> iptal edilirse, içindeki herhangi bir etkinlik <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> çağrılır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-158">If a <xref:System.Activities.Statements.CompensableActivity> is canceled, any activities in its <xref:System.Activities.Statements.CompensableActivity.CancellationHandler%2A> are invoked.</span></span> <span data-ttu-id="d1a5a-159">Bu, kısmen tamamlanmış dengelenebilir çalışmayı geri almak için yararlı olabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-159">This can be useful for undoing partially completed compensable work.</span></span> <span data-ttu-id="d1a5a-160">Dengeleme ve iptal için kullanma hakkında daha fazla bilgi için <xref:System.Activities.Statements.CompensableActivity> bkz. [Dengeleme](compensation.md).</span><span class="sxs-lookup"><span data-stu-id="d1a5a-160">For information about how to use <xref:System.Activities.Statements.CompensableActivity> for compensation and cancellation, see [Compensation](compensation.md).</span></span>  
  
## <a name="cancellation-using-custom-activities"></a><span data-ttu-id="d1a5a-161">Özel etkinlikleri kullanarak iptal etme</span><span class="sxs-lookup"><span data-stu-id="d1a5a-161">Cancellation using Custom Activities</span></span>  

 <span data-ttu-id="d1a5a-162">Özel etkinlik yazarları, özel etkinliklerine birkaç farklı şekilde iptal mantığı uygulayabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-162">Custom activity authors can implement cancellation logic into their custom activities in several different ways.</span></span> <span data-ttu-id="d1a5a-163">Öğesinden türetilen özel etkinlikler, <xref:System.Activities.Activity> <xref:System.Activities.Statements.CancellationScope> etkinliğin gövdesinde iptal mantığı içeren bir veya başka bir özel etkinlik yerleştirerek iptal mantığını uygulayabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-163">Custom activities that derive from <xref:System.Activities.Activity> can implement cancellation logic by placing a <xref:System.Activities.Statements.CancellationScope> or other custom activity that contains cancellation logic in the body of the activity.</span></span> <span data-ttu-id="d1a5a-164"><xref:System.Activities.AsyncCodeActivity> ve <xref:System.Activities.NativeActivity> türetilmiş etkinlikler ilgili yöntemini geçersiz kılabilir <xref:System.Activities.NativeActivity.Cancel%2A> ve burada iptal mantığı sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-164"><xref:System.Activities.AsyncCodeActivity> and <xref:System.Activities.NativeActivity> derived activities can override their respective <xref:System.Activities.NativeActivity.Cancel%2A> method and provide cancellation logic there.</span></span> <span data-ttu-id="d1a5a-165"><xref:System.Activities.CodeActivity> çalışma zamanı yöntemi çağırdığında, tüm işleri tek bir yürütme veri bloğu içinde gerçekleştirildiğinden, türetilmiş etkinlikler iptal için herhangi bir sağlama sağlamaz <xref:System.Activities.CodeActivity.Execute%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-165"><xref:System.Activities.CodeActivity> derived activities do not provide any provision for cancellation because all their work is performed in a single burst of execution when the runtime calls the <xref:System.Activities.CodeActivity.Execute%2A> method.</span></span> <span data-ttu-id="d1a5a-166">Execute yöntemi henüz çağrılmadıysa ve bir <xref:System.Activities.CodeActivity> tabanlı etkinlik iptal edilirse, etkinlik durumu ile kapanır <xref:System.Activities.ActivityInstanceState.Canceled> ve <xref:System.Activities.CodeActivity.Execute%2A> yöntemi çağrılmaz.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-166">If the execute method has not yet been called and a <xref:System.Activities.CodeActivity> based activity is canceled, the activity closes with a status of <xref:System.Activities.ActivityInstanceState.Canceled> and the <xref:System.Activities.CodeActivity.Execute%2A> method is not called.</span></span>  
  
### <a name="cancellation-using-nativeactivity"></a><span data-ttu-id="d1a5a-167">NativeActivity kullanarak iptal etme</span><span class="sxs-lookup"><span data-stu-id="d1a5a-167">Cancellation using NativeActivity</span></span>  

 <span data-ttu-id="d1a5a-168"><xref:System.Activities.NativeActivity> türetilmiş etkinlikler <xref:System.Activities.NativeActivity.Cancel%2A> özel iptal mantığı sağlamak için yöntemini geçersiz kılabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-168"><xref:System.Activities.NativeActivity> derived activities can override the <xref:System.Activities.NativeActivity.Cancel%2A> method to provide custom cancellation logic.</span></span> <span data-ttu-id="d1a5a-169">Bu yöntem geçersiz kılınmamışsa, varsayılan iş akışı iptali mantığı uygulanır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-169">If this method is not overridden, then the default workflow cancellation logic is applied.</span></span> <span data-ttu-id="d1a5a-170">Varsayılan iptal, <xref:System.Activities.NativeActivity> yöntemi geçersiz kılmayan <xref:System.Activities.NativeActivity.Cancel%2A> veya <xref:System.Activities.NativeActivity.Cancel%2A> yöntemi temel yöntemi çağıran bir <xref:System.Activities.NativeActivity> için gerçekleşen işlemdir <xref:System.Activities.NativeActivity.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-170">Default cancellation is the process that occurs for a <xref:System.Activities.NativeActivity> that does not override the <xref:System.Activities.NativeActivity.Cancel%2A> method or whose <xref:System.Activities.NativeActivity.Cancel%2A> method calls the base <xref:System.Activities.NativeActivity> <xref:System.Activities.NativeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="d1a5a-171">Bir etkinlik iptal edildiğinde, çalışma zamanı iptal için etkinliği işaretler ve belirli temizleme işlemini otomatik olarak işler.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-171">When an activity is canceled, the runtime flags the activity for cancellation and automatically handles certain cleanup.</span></span> <span data-ttu-id="d1a5a-172">Etkinliğin yalnızca bekleyen yer işaretleri varsa, yer işaretleri kaldırılır ve etkinlik olarak işaretlenir <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-172">If the activity only has outstanding bookmarks, the bookmarks will be removed and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="d1a5a-173">İptal edilen etkinliğin bekleyen tüm alt etkinlikleri iptal edilecek.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-173">Any outstanding child activities of the canceled activity will in turn be canceled.</span></span> <span data-ttu-id="d1a5a-174">Ek alt etkinliklerin planlanmasına yönelik herhangi bir girişim, denenmesine ve etkinliğin olarak işaretlenmesine neden olur <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-174">Any attempt to schedule additional child activities will result in the attempt being ignored and the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="d1a5a-175">Veya durumunda herhangi bir bekleyen alt etkinlik tamamlanırsa <xref:System.Activities.ActivityInstanceState.Canceled> <xref:System.Activities.ActivityInstanceState.Faulted> , etkinlik olarak işaretlenir <xref:System.Activities.ActivityInstanceState.Canceled> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-175">If any outstanding child activity completes in the <xref:System.Activities.ActivityInstanceState.Canceled> or <xref:System.Activities.ActivityInstanceState.Faulted> state, then the activity will be marked as <xref:System.Activities.ActivityInstanceState.Canceled>.</span></span> <span data-ttu-id="d1a5a-176">İptal isteğinin yoksayılıp yoksayılmadığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-176">Note that a cancellation request can be ignored.</span></span> <span data-ttu-id="d1a5a-177">Bir etkinlik bekleyen yer işaretlerine sahip değilse veya alt etkinlikleri yürütüp, iptal için işaretlendikten sonra ek iş öğeleri zamanlayamaz, işlem başarıyla tamamlanır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-177">If an activity does not have any outstanding bookmarks or executing child activities and does not schedule any additional work items after being flagged for cancellation, it will complete successfully.</span></span> <span data-ttu-id="d1a5a-178">Bu varsayılan iptal, birçok senaryo için yeterli olacaktır, ancak ek iptal mantığı gerekliyse, yerleşik iptal etkinlikleri veya özel etkinlikler kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-178">This default cancellation suffices for many scenarios, but if additional cancellation logic is needed, then the built-in cancellation activities or custom activities can be used.</span></span>  
  
 <span data-ttu-id="d1a5a-179">Aşağıdaki örnekte, <xref:System.Activities.NativeActivity.Cancel%2A> bir <xref:System.Activities.NativeActivity> tabanlı özel etkinliğin geçersiz kılınması `ParallelForEach` tanımlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-179">In the following example, the <xref:System.Activities.NativeActivity.Cancel%2A> override of a <xref:System.Activities.NativeActivity> based custom `ParallelForEach` activity is defined.</span></span> <span data-ttu-id="d1a5a-180">Etkinlik iptal edildiğinde, bu geçersiz kılma etkinliğin iptal mantığını işler.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-180">When the activity is canceled, this override handles the cancellation logic for the activity.</span></span> <span data-ttu-id="d1a5a-181">Bu örnek, [genel olmayan ParallelForEach](./samples/non-generic-parallelforeach.md) örneğinin bir parçasıdır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-181">This example is part of the [Non-Generic ParallelForEach](./samples/non-generic-parallelforeach.md) sample.</span></span>  
  
```csharp  
protected override void Cancel(NativeActivityContext context)  
{  
    // If we do not have a completion condition then we can just  
    // use default logic.  
    if (this.CompletionCondition == null)  
    {  
        base.Cancel(context);  
    }  
    else  
    {  
        context.CancelChildren();  
    }  
}  
```  
  
 <span data-ttu-id="d1a5a-182"><xref:System.Activities.NativeActivity> türetilmiş etkinlikler, özelliği inceleyerek iptal edilip edilmediğini tespit edebilir <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> ve yöntemi çağırarak, iptal edildi olarak işaretleyebilir <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-182"><xref:System.Activities.NativeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.NativeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> method.</span></span> <span data-ttu-id="d1a5a-183">Çağırma <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> etkinliği hemen tamamlamaz.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-183">Calling <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> does not immediately complete the activity.</span></span> <span data-ttu-id="d1a5a-184">Her zamanki gibi, çalışma zamanı daha fazla bekleyen iş olmadığında etkinliği tamamlar, ancak eğer <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> çağrılırsa son durum <xref:System.Activities.ActivityInstanceState.Canceled> yerine gelir <xref:System.Activities.ActivityInstanceState.Closed> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-184">As usual, the runtime will complete the activity when it has no more outstanding work, but if <xref:System.Activities.NativeActivityContext.MarkCanceled%2A> is called the final state will be <xref:System.Activities.ActivityInstanceState.Canceled> instead of <xref:System.Activities.ActivityInstanceState.Closed>.</span></span>  
  
### <a name="cancellation-using-asynccodeactivity"></a><span data-ttu-id="d1a5a-185">AsyncCodeActivity kullanarak iptal etme</span><span class="sxs-lookup"><span data-stu-id="d1a5a-185">Cancellation using AsyncCodeActivity</span></span>  

 <span data-ttu-id="d1a5a-186"><xref:System.Activities.AsyncCodeActivity> tabanlı etkinlikler, yöntemi geçersiz kılarak özel iptal mantığı da sağlayabilir <xref:System.Activities.AsyncCodeActivity.Cancel%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-186"><xref:System.Activities.AsyncCodeActivity> based activities can also provide custom cancellation logic by overriding the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> method.</span></span> <span data-ttu-id="d1a5a-187">Bu yöntem geçersiz kılınmamışsa, etkinlik iptal edildiğinde iptal işlemi gerçekleştirilmez.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-187">If this method is not overridden, then no cancellation handling is performed if the activity is canceled.</span></span> <span data-ttu-id="d1a5a-188">Aşağıdaki örnekte, <xref:System.Activities.AsyncCodeActivity.Cancel%2A> bir <xref:System.Activities.AsyncCodeActivity> tabanlı özel etkinliğin geçersiz kılınması `ExecutePowerShell` tanımlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-188">In the following example, the <xref:System.Activities.AsyncCodeActivity.Cancel%2A> override of an <xref:System.Activities.AsyncCodeActivity> based custom `ExecutePowerShell` activity is defined.</span></span> <span data-ttu-id="d1a5a-189">Etkinlik iptal edildiğinde, istenen iptal davranışını gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="d1a5a-189">When the activity is canceled, it performs the desired cancellation behavior.</span></span>
  
 [!code-csharp[CFX_WorkflowApplicationExample#1020](~/samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#1020)]  
  
 <span data-ttu-id="d1a5a-190"><xref:System.Activities.AsyncCodeActivity> türetilmiş etkinlikler, özelliği inceleyerek iptal edilip edilmediğini tespit edebilir <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> ve yöntemi çağırarak, iptal edildi olarak işaretleyebilir <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> .</span><span class="sxs-lookup"><span data-stu-id="d1a5a-190"><xref:System.Activities.AsyncCodeActivity> derived activities can determine if cancellation has been requested by inspecting the <xref:System.Activities.AsyncCodeActivityContext.IsCancellationRequested%2A> property, and mark themselves as canceled by calling the <xref:System.Activities.AsyncCodeActivityContext.MarkCanceled%2A> method.</span></span>
