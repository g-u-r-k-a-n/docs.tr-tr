---
title: 'Nasıl yapılır: özel güvenlik belirteci kimlik doğrulayıcısı oluşturma'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: 667dc82502ba881b067b5588271947f7c18c8810
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 11/26/2020
ms.locfileid: "96249260"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="3c358-102">Nasıl yapılır: özel güvenlik belirteci kimlik doğrulayıcısı oluşturma</span><span class="sxs-lookup"><span data-stu-id="3c358-102">How to: create a custom security token authenticator</span></span>

<span data-ttu-id="3c358-103">Bu konu, özel bir güvenlik belirteci kimlik doğrulayıcısı oluşturmayı ve bunu özel bir güvenlik belirteci Yöneticisi ile tümleştirmeyi gösterir.</span><span class="sxs-lookup"><span data-stu-id="3c358-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="3c358-104">Bir güvenlik belirteci kimlik doğrulayıcısı, gelen bir iletiyle birlikte sunulan bir güvenlik belirtecinin içeriğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="3c358-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="3c358-105">Doğrulama başarılı olursa, Authenticator, <xref:System.IdentityModel.Policy.IAuthorizationPolicy> değerlendirildiğinde bir talepler kümesi döndüren bir örnek koleksiyonu döndürür.</span><span class="sxs-lookup"><span data-stu-id="3c358-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="3c358-106">Windows Communication Foundation (WCF) içinde özel bir güvenlik belirteci kimlik doğrulayıcısı kullanmak için, önce özel kimlik bilgileri ve güvenlik belirteci Yöneticisi uygulamaları oluşturmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="3c358-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="3c358-107">Özel kimlik bilgileri ve bir güvenlik belirteci Yöneticisi oluşturma hakkında daha fazla bilgi için bkz. [Izlenecek yol: özel istemci ve hizmet kimlik bilgileri oluşturma](walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="3c358-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="3c358-108">Yordamlar</span><span class="sxs-lookup"><span data-stu-id="3c358-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="3c358-109">Özel bir güvenlik belirteci kimlik doğrulayıcısı oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="3c358-109">To create a custom security token authenticator</span></span>  
  
1. <span data-ttu-id="3c358-110">Sınıfından türetilmiş yeni bir sınıf tanımlayın <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> .</span><span class="sxs-lookup"><span data-stu-id="3c358-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2. <span data-ttu-id="3c358-111">Yöntemini geçersiz kılın <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="3c358-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="3c358-112">Yöntemi, `true` `false` özel Doğrulayıcı 'nın gelen belirteç türünü doğrulayıp doğrulamadığına bağlı olarak veya ' i döndürür.</span><span class="sxs-lookup"><span data-stu-id="3c358-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3. <span data-ttu-id="3c358-113">Yöntemini geçersiz kılın <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="3c358-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="3c358-114">Bu yöntemin, belirteç içeriğini uygun şekilde doğrulaması gerekir.</span><span class="sxs-lookup"><span data-stu-id="3c358-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="3c358-115">Belirteç doğrulama adımını geçerse, bir örnek koleksiyonu döndürür <xref:System.IdentityModel.Policy.IAuthorizationPolicy> .</span><span class="sxs-lookup"><span data-stu-id="3c358-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="3c358-116">Aşağıdaki örnek, bir sonraki yordamda oluşturulacak özel bir yetkilendirme ilkesi uygulamasını kullanır.</span><span class="sxs-lookup"><span data-stu-id="3c358-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="3c358-117">Önceki kod, yönteminde bir yetkilendirme ilkeleri koleksiyonu döndürür <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> .</span><span class="sxs-lookup"><span data-stu-id="3c358-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="3c358-118">WCF bu arabirimin genel bir uygulamasını sağlamıyor.</span><span class="sxs-lookup"><span data-stu-id="3c358-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="3c358-119">Aşağıdaki yordamda, kendi gereksinimleriniz için bunun nasıl yapılacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="3c358-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="3c358-120">Özel bir yetkilendirme ilkesi oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="3c358-120">To create a custom authorization policy</span></span>  
  
1. <span data-ttu-id="3c358-121">Arabirimi uygulayan yeni bir sınıf tanımlayın <xref:System.IdentityModel.Policy.IAuthorizationPolicy> .</span><span class="sxs-lookup"><span data-stu-id="3c358-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2. <span data-ttu-id="3c358-122"><xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A>Salt okunurdur özelliğini uygulayın.</span><span class="sxs-lookup"><span data-stu-id="3c358-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="3c358-123">Bu özelliği uygulamak için bir yol, sınıf oluşturucusunda bir genel benzersiz tanımlayıcı (GUID) oluşturmak ve bu özelliğin değeri her istendiğinde geri döndürmesidir.</span><span class="sxs-lookup"><span data-stu-id="3c358-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3. <span data-ttu-id="3c358-124"><xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A>Salt okunurdur özelliğini uygulayın.</span><span class="sxs-lookup"><span data-stu-id="3c358-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="3c358-125">Bu özelliğin, belirteçten elde edilen talep kümelerini veren bir veren döndürmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="3c358-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="3c358-126">Bu veren, belirtecin vereni veya belirteç içeriğini doğrulamaktan sorumlu bir yetkiyi karşımalıdır.</span><span class="sxs-lookup"><span data-stu-id="3c358-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="3c358-127">Aşağıdaki örnek, önceki yordamda oluşturulan özel güvenlik belirteci kimlik doğrulayıcısından bu sınıfa geçirilen veren talebini kullanır.</span><span class="sxs-lookup"><span data-stu-id="3c358-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="3c358-128">Özel güvenlik belirteci kimlik doğrulayıcısı, <xref:System.IdentityModel.Claims.ClaimSet.System%2A> Kullanıcı adı belirtecinin vereni temsil etmek için sistem tarafından belirtilen talep kümesini (özelliği tarafından döndürülen) kullanır.</span><span class="sxs-lookup"><span data-stu-id="3c358-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4. <span data-ttu-id="3c358-129">Yöntemini uygulayın <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> .</span><span class="sxs-lookup"><span data-stu-id="3c358-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="3c358-130">Bu yöntem, bir <xref:System.IdentityModel.Policy.EvaluationContext> sınıfın örneğini (bağımsız değişken olarak geçirilmiş), gelen güvenlik belirteci içeriğine dayalı taleplerle doldurur.</span><span class="sxs-lookup"><span data-stu-id="3c358-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="3c358-131">Yöntemi, `true` değerlendirmede tamamlandığında döndürür.</span><span class="sxs-lookup"><span data-stu-id="3c358-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="3c358-132">Uygulamanın, değerlendirme bağlamına ek bilgi sağlayan diğer yetkilendirme ilkelerinin varlığını temel aldığı durumlarda, bu yöntem, `false` gerekli bilgiler henüz değerlendirme bağlamında mevcut değilse dönebilir.</span><span class="sxs-lookup"><span data-stu-id="3c358-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="3c358-133">Bu durumda, bu yetkilendirme ilkelerinden en az biri değerlendirme bağlamını değiştirmemişse, WCF, gelen ileti için oluşturulan diğer tüm yetkilendirme ilkelerini değerlendirdikten sonra yöntemi yeniden çağırır.</span><span class="sxs-lookup"><span data-stu-id="3c358-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="3c358-134">[Izlenecek yol: özel istemci ve hizmet kimlik bilgileri oluşturma](walkthrough-creating-custom-client-and-service-credentials.md) , özel kimlik bilgileri ve özel bir güvenlik belirteci Yöneticisi oluşturma işlemini açıklar.</span><span class="sxs-lookup"><span data-stu-id="3c358-134">[Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="3c358-135">Burada oluşturulan özel güvenlik belirteci kimlik doğrulamasını kullanmak için, güvenlik belirteci Yöneticisi 'nin bir uygulama, yöntemden özel kimlik doğrulayıcı döndürecek şekilde değiştirilir <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> .</span><span class="sxs-lookup"><span data-stu-id="3c358-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="3c358-136">Yöntemi, uygun bir güvenlik belirteci gereksinimi geçirildiğinde bir Authenticator döndürür.</span><span class="sxs-lookup"><span data-stu-id="3c358-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="3c358-137">Özel bir güvenlik belirteci kimlik doğrulamasını özel bir güvenlik belirteci Yöneticisi ile tümleştirme</span><span class="sxs-lookup"><span data-stu-id="3c358-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1. <span data-ttu-id="3c358-138"><xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>Özel güvenlik belirteci Yöneticisi uygulamanızda yöntemi geçersiz kılın.</span><span class="sxs-lookup"><span data-stu-id="3c358-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2. <span data-ttu-id="3c358-139">Metoda göre özel güvenlik belirteci kimlik doğrulayıcıınızı döndürmesini sağlamak için yöntemine mantık ekleyin <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> .</span><span class="sxs-lookup"><span data-stu-id="3c358-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="3c358-140">Aşağıdaki örnek, belirteç gereksinimleri belirteç türü bir Kullanıcı adı (özelliği tarafından temsil edilir <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> ) ve güvenlik belirteci kimlik doğrulayıcısı istenen ileti yönü (alana göre temsil edilir) ise özel bir güvenlik belirteci kimlik doğrulayıcısı döndürür <xref:System.ServiceModel.Description.MessageDirection.Input> .</span><span class="sxs-lookup"><span data-stu-id="3c358-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  

## <a name="see-also"></a><span data-ttu-id="3c358-141">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="3c358-141">See also</span></span>

- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="3c358-142">İzlenecek yol: Özel İstemci ve Hizmet Kimlik Bilgileri Oluşturma</span><span class="sxs-lookup"><span data-stu-id="3c358-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="3c358-143">Nasıl yapılır: Özel Güvenlik Belirteci Sağlayıcı Oluşturma</span><span class="sxs-lookup"><span data-stu-id="3c358-143">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
