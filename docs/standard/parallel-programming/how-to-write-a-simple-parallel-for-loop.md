---
title: 'Nasıl yapılır: Basit bir Parallel.For Döngüsü Yazma'
description: Döngüyü iptal etmeniz, döngü yinelemelerini kesmeniz veya herhangi bir iş parçacığı yerel durumunu sürdürmeniz gerekmeyen .NET 'teki Parallel. for döngüleri yazmayı öğrenin.
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Parallel.For, How to Write
- for loop, parallel construction in .NET
- parallel for loops, how to use
ms.assetid: 9029ba7f-a9d1-4526-8c84-c88716dba5d4
ms.openlocfilehash: 8307f2205653fbd213d824acffc405ee97580166
ms.sourcegitcommit: 7137e12f54c4e83a94ae43ec320f8cf59c1772ea
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/10/2020
ms.locfileid: "84662699"
---
# <a name="how-to-write-a-simple-parallelfor-loop"></a><span data-ttu-id="06643-103">Nasıl yapılır: Basit bir Parallel.For Döngüsü Yazma</span><span class="sxs-lookup"><span data-stu-id="06643-103">How to: Write a Simple Parallel.For Loop</span></span>

<span data-ttu-id="06643-104">Bu konu, yöntemi gösteren iki örnek içerir <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="06643-104">This topic contains two examples that illustrate the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="06643-105">İlki <xref:System.Threading.Tasks.Parallel.For%28System.Int64%2CSystem.Int64%2CSystem.Action%7BSystem.Int64%7D%29?displayProperty=nameWithType> yöntem aşırı yüklemesini kullanır ve ikincisi, <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Action%7BSystem.Int32%7D%29?displayProperty=nameWithType> yönteminin iki en basit aşırı yüklemesi olan aşırı yüklemeyi kullanır <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="06643-105">The first uses the <xref:System.Threading.Tasks.Parallel.For%28System.Int64%2CSystem.Int64%2CSystem.Action%7BSystem.Int64%7D%29?displayProperty=nameWithType> method overload, and the second uses the <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Action%7BSystem.Int32%7D%29?displayProperty=nameWithType> overload, the two simplest overloads of the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="06643-106"><xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType>Yöntemi iptal etmeniz, döngü yinelemelerini kesmeniz veya herhangi bir iş parçacığı yerel durumunu sürdürmenize gerek olmadığında, bu iki aşırı yüklemeyi kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="06643-106">You can use these two overloads of the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method when you do not need to cancel the loop, break out of the loop iterations, or maintain any thread-local state.</span></span>

> [!NOTE]
> <span data-ttu-id="06643-107">TPL'de temsilciler tanımlamak için bu belgede lambda ifadeleri kullanılır.</span><span class="sxs-lookup"><span data-stu-id="06643-107">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="06643-108">C# veya Visual Basic lambda ifadeleriyle ilgili bilgi sahibi değilseniz bkz. [PLıNQ ve TPL Içindeki lambda ifadeleri](lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="06643-108">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](lambda-expressions-in-plinq-and-tpl.md).</span></span>

<span data-ttu-id="06643-109">İlk örnek, tek bir dizindeki dosyaların boyutunu hesaplar.</span><span class="sxs-lookup"><span data-stu-id="06643-109">The first example calculates the size of files in a single directory.</span></span> <span data-ttu-id="06643-110">İkincisi iki matrisin çarpımını hesaplar.</span><span class="sxs-lookup"><span data-stu-id="06643-110">The second computes the product of two matrices.</span></span>

## <a name="directory-size-example"></a><span data-ttu-id="06643-111">Dizin boyutu örneği</span><span class="sxs-lookup"><span data-stu-id="06643-111">Directory size example</span></span>

<span data-ttu-id="06643-112">Bu örnek, bir dizindeki dosyaların toplam boyutunu hesaplayan basit bir komut satırı yardımcı programıdır.</span><span class="sxs-lookup"><span data-stu-id="06643-112">This example is a simple command-line utility that calculates the total size of files in a directory.</span></span> <span data-ttu-id="06643-113">Bağımsız değişken olarak tek bir dizin yolu bekler ve bu dizindeki dosyaların sayısını ve toplam boyutunu raporlar.</span><span class="sxs-lookup"><span data-stu-id="06643-113">It expects a single directory path as an argument, and reports the number and total size of the files in that directory.</span></span> <span data-ttu-id="06643-114">Dizinin mevcut olduğunu doğruladıktan sonra, <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> dizindeki dosyaları numaralandırma ve dosya boyutlarını belirleme yöntemini kullanır.</span><span class="sxs-lookup"><span data-stu-id="06643-114">After verifying that the directory exists, it uses the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method to enumerate the files in the directory and determine their file sizes.</span></span> <span data-ttu-id="06643-115">Her dosya boyutu, `totalSize` değişkenine eklenir.</span><span class="sxs-lookup"><span data-stu-id="06643-115">Each file size is then added to the `totalSize` variable.</span></span> <span data-ttu-id="06643-116">Ek, <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> ek bir atomik işlem olarak gerçekleştirilmeleri için çağırarak, çağrısı yaparak gerçekleştirilmiş olduğunu unutmayın.</span><span class="sxs-lookup"><span data-stu-id="06643-116">Note that the addition is performed by calling the <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> so that the addition is performed as an atomic operation.</span></span> <span data-ttu-id="06643-117">Aksi takdirde, birden çok görev değişkeni eşzamanlı olarak güncelleştirmeyi deneyebilir `totalSize` .</span><span class="sxs-lookup"><span data-stu-id="06643-117">Otherwise, multiple tasks could try to update the `totalSize` variable simultaneously.</span></span>

[!code-csharp[Conceptual.Parallel.For#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.parallel.for/cs/for1.cs#1)]
[!code-vb[Conceptual.Parallel.For#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.parallel.for/vb/for1.vb#1)]

## <a name="matrix-and-stopwatch-example"></a><span data-ttu-id="06643-118">Matris ve kronometre örneği</span><span class="sxs-lookup"><span data-stu-id="06643-118">Matrix and stopwatch example</span></span>

<span data-ttu-id="06643-119">Bu örnek, <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> iki matrisin çarpımını hesaplamak için yöntemini kullanır.</span><span class="sxs-lookup"><span data-stu-id="06643-119">This example uses the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method to compute the product of two matrices.</span></span> <span data-ttu-id="06643-120">Ayrıca, paralel <xref:System.Diagnostics.Stopwatch?displayProperty=nameWithType> olmayan bir döngüyle paralel bir döngünün performansını karşılaştırmak için sınıfını nasıl kullanacağınızı gösterir.</span><span class="sxs-lookup"><span data-stu-id="06643-120">It also shows how to use the <xref:System.Diagnostics.Stopwatch?displayProperty=nameWithType> class to compare the performance of a parallel loop with a non-parallel loop.</span></span> <span data-ttu-id="06643-121">Büyük bir çıkış hacmi üretebildiğinden, örneğin çıktının bir dosyaya yeniden yönlendirilmesine izin verdiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="06643-121">Note that, because it can generate a large volume of output, the example allows output to be redirected to a file.</span></span>

[!code-csharp[TPL_Parallel#01](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/simpleparallelfor.cs#01)]
[!code-vb[TPL_Parallel#01](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/simpleparallelfor.vb#01)]

<span data-ttu-id="06643-122">Döngüler dahil olmak üzere herhangi bir kodu paralelleştirdiğinde, önemli bir amaç, paralel işleme yükünün herhangi bir performans avantajlarından yararlanmasına neden olacak şekilde, işlemciyi paralelleştirmeden mümkün olduğunca çok daha fazla kullanır.</span><span class="sxs-lookup"><span data-stu-id="06643-122">When parallelizing any code, including loops, one important goal is to utilize the processors as much as possible without over parallelizing to the point where the overhead for parallel processing negates any performance benefits.</span></span> <span data-ttu-id="06643-123">Bu örnekte, iç döngüde çok fazla iş gerçekleştirilmediğinden yalnızca dış döngü paralelleştirildi.</span><span class="sxs-lookup"><span data-stu-id="06643-123">In this particular example, only the outer loop is parallelized because there is not very much work performed in the inner loop.</span></span> <span data-ttu-id="06643-124">Az miktarda iş ve istenmeyen önbellek efektlerinin birleşimi, iç içe paralel Döngülerde performans düşüşüne neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="06643-124">The combination of a small amount of work and undesirable cache effects can result in performance degradation in nested parallel loops.</span></span> <span data-ttu-id="06643-125">Bu nedenle, dış döngüyü paralelleştirme, çoğu sistemde eşzamanlılık avantajlarından en iyi şekilde yararlanmanın en iyi yoludur.</span><span class="sxs-lookup"><span data-stu-id="06643-125">Therefore, parallelizing the outer loop only is the best way to maximize the benefits of concurrency on most systems.</span></span>

## <a name="the-delegate"></a><span data-ttu-id="06643-126">Temsilci</span><span class="sxs-lookup"><span data-stu-id="06643-126">The Delegate</span></span>

<span data-ttu-id="06643-127">Bu aşırı yüklemesinin üçüncü parametresi, <xref:System.Threading.Tasks.Parallel.For%2A> `Action<int>` C# dilinde veya Visual Basic bir temsilcisidir `Action(Of Integer)` .</span><span class="sxs-lookup"><span data-stu-id="06643-127">The third parameter of this overload of <xref:System.Threading.Tasks.Parallel.For%2A> is a delegate of type `Action<int>` in C# or `Action(Of Integer)` in Visual Basic.</span></span> <span data-ttu-id="06643-128">`Action`Sıfır, bir veya on altı tür parametresi olup olmadığı bir temsilci, her zaman void döndürür.</span><span class="sxs-lookup"><span data-stu-id="06643-128">An `Action` delegate, whether it has zero, one or sixteen type parameters, always returns void.</span></span> <span data-ttu-id="06643-129">Visual Basic, öğesinin davranışı `Action` ile tanımlanır `Sub` .</span><span class="sxs-lookup"><span data-stu-id="06643-129">In Visual Basic, the behavior of an `Action` is defined with a `Sub`.</span></span> <span data-ttu-id="06643-130">Örnek, temsilciyi oluşturmak için bir lambda ifadesi kullanır, ancak temsilciyi başka yollarla da oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="06643-130">The example uses a lambda expression to create the delegate, but you can create the delegate in other ways as well.</span></span> <span data-ttu-id="06643-131">Daha fazla bilgi için bkz. [PLıNQ ve TPL 'Deki lambda ifadeleri](lambda-expressions-in-plinq-and-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="06643-131">For more information, see [Lambda Expressions in PLINQ and TPL](lambda-expressions-in-plinq-and-tpl.md).</span></span>

## <a name="the-iteration-value"></a><span data-ttu-id="06643-132">Yineleme değeri</span><span class="sxs-lookup"><span data-stu-id="06643-132">The Iteration Value</span></span>

<span data-ttu-id="06643-133">Temsilci, değeri geçerli yineleme olan tek bir giriş parametresi alır.</span><span class="sxs-lookup"><span data-stu-id="06643-133">The delegate takes a single input parameter whose value is the current iteration.</span></span> <span data-ttu-id="06643-134">Bu yineleme değeri çalışma zamanı tarafından sağlanır ve başlangıç değeri, geçerli iş parçacığında işlenmekte olan kaynağın segmentindeki (bölüm) ilk öğenin dizinidir.</span><span class="sxs-lookup"><span data-stu-id="06643-134">This iteration value is supplied by the runtime and its starting value is the index of the first element on the segment (partition) of the source that is being processed on the current thread.</span></span>

<span data-ttu-id="06643-135">Eşzamanlılık düzeyi üzerinde daha fazla denetime ihtiyacınız varsa, şöyle bir giriş parametresi alan aşırı yüklemelerden birini kullanın <xref:System.Threading.Tasks.ParallelOptions?displayProperty=nameWithType> : <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Threading.Tasks.ParallelOptions%2CSystem.Action%7BSystem.Int32%2CSystem.Threading.Tasks.ParallelLoopState%7D%29?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="06643-135">If you require more control over the concurrency level, use one of the overloads that takes a <xref:System.Threading.Tasks.ParallelOptions?displayProperty=nameWithType> input parameter, such as: <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Threading.Tasks.ParallelOptions%2CSystem.Action%7BSystem.Int32%2CSystem.Threading.Tasks.ParallelLoopState%7D%29?displayProperty=nameWithType>.</span></span>

## <a name="return-value-and-exception-handling"></a><span data-ttu-id="06643-136">Dönüş değeri ve özel durum Işleme</span><span class="sxs-lookup"><span data-stu-id="06643-136">Return Value and Exception Handling</span></span>

<span data-ttu-id="06643-137"><xref:System.Threading.Tasks.Parallel.For%2A><xref:System.Threading.Tasks.ParallelLoopResult?displayProperty=nameWithType>tüm iş parçacıkları tamamlandığında bir nesne döndürür.</span><span class="sxs-lookup"><span data-stu-id="06643-137"><xref:System.Threading.Tasks.Parallel.For%2A> returns a <xref:System.Threading.Tasks.ParallelLoopResult?displayProperty=nameWithType> object when all threads have completed.</span></span> <span data-ttu-id="06643-138">Bu dönüş değeri, Döngü yinelemesini el ile durdururken veya parçaladığında faydalıdır, çünkü <xref:System.Threading.Tasks.ParallelLoopResult> tamamlanmayı çalıştıran son yineleme gibi bilgileri depolar.</span><span class="sxs-lookup"><span data-stu-id="06643-138">This return value is useful when you are stopping or breaking loop iteration manually, because the <xref:System.Threading.Tasks.ParallelLoopResult> stores information such as the last iteration that ran to completion.</span></span> <span data-ttu-id="06643-139">İş parçacıklarından birinde bir veya daha fazla özel durum oluşursa, bir <xref:System.AggregateException?displayProperty=nameWithType> oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="06643-139">If one or more exceptions occur on one of the threads, a <xref:System.AggregateException?displayProperty=nameWithType> will be thrown.</span></span>

<span data-ttu-id="06643-140">Bu örnekteki kodda, öğesinin dönüş değeri <xref:System.Threading.Tasks.Parallel.For%2A> kullanılmaz.</span><span class="sxs-lookup"><span data-stu-id="06643-140">In the code in this example, the return value of <xref:System.Threading.Tasks.Parallel.For%2A> is not used.</span></span>

## <a name="analysis-and-performance"></a><span data-ttu-id="06643-141">Analiz ve performans</span><span class="sxs-lookup"><span data-stu-id="06643-141">Analysis and Performance</span></span>

<span data-ttu-id="06643-142">Bilgisayarınızdaki CPU kullanımını görüntülemek için performans sihirbazını kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="06643-142">You can use the Performance Wizard to view CPU usage on your computer.</span></span> <span data-ttu-id="06643-143">Bir deneme olarak, matrislerde sütun ve satır sayısını artırın.</span><span class="sxs-lookup"><span data-stu-id="06643-143">As an experiment, increase the number of columns and rows in the matrices.</span></span> <span data-ttu-id="06643-144">Matrisler arttıkça, hesaplamanın paralel ve sıralı sürümleri arasındaki performans farkı artar.</span><span class="sxs-lookup"><span data-stu-id="06643-144">The larger the matrices, the greater the performance difference between the parallel and sequential versions of the computation.</span></span> <span data-ttu-id="06643-145">Matris küçük olduğunda, paralel döngü ayarlamadaki ek yük nedeniyle sıralı sürüm daha hızlı çalışır.</span><span class="sxs-lookup"><span data-stu-id="06643-145">When the matrix is small, the sequential version will run faster because of the overhead in setting up the parallel loop.</span></span>

<span data-ttu-id="06643-146">Konsol veya dosya sistemi gibi paylaşılan kaynaklara zaman uyumlu çağrılar, paralel bir döngünün performansını önemli ölçüde azaltır.</span><span class="sxs-lookup"><span data-stu-id="06643-146">Synchronous calls to shared resources, like the Console or the File System, will significantly degrade the performance of a parallel loop.</span></span> <span data-ttu-id="06643-147">Performansı ölçerek, döngü içindeki gibi çağrılardan kaçının <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="06643-147">When measuring performance, try to avoid calls such as <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> within the loop.</span></span>

## <a name="compile-the-code"></a><span data-ttu-id="06643-148">Kodu derle</span><span class="sxs-lookup"><span data-stu-id="06643-148">Compile the Code</span></span>

<span data-ttu-id="06643-149">Bu kodu kopyalayıp bir Visual Studio projesine yapıştırın.</span><span class="sxs-lookup"><span data-stu-id="06643-149">Copy and paste this code into a Visual Studio project.</span></span>

## <a name="see-also"></a><span data-ttu-id="06643-150">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="06643-150">See also</span></span>

- <xref:System.Threading.Tasks.Parallel.For%2A>
- <xref:System.Threading.Tasks.Parallel.ForEach%2A>
- [<span data-ttu-id="06643-151">Veri paralelliği</span><span class="sxs-lookup"><span data-stu-id="06643-151">Data Parallelism</span></span>](data-parallelism-task-parallel-library.md)
- [<span data-ttu-id="06643-152">Paralel programlama</span><span class="sxs-lookup"><span data-stu-id="06643-152">Parallel Programming</span></span>](index.md)
