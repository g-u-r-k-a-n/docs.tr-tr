---
title: SQL Server'da Saklı Yordam İmzalama
ms.date: 01/05/2018
ms.assetid: eeed752c-0084-48e5-9dca-381353007a0d
ms.openlocfilehash: 0131655d06a6ef543ea460d04739401538cac04b
ms.sourcegitcommit: 700ea803fb06c5ce98de017c7f76463ba33ff4a9
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/19/2020
ms.locfileid: "77452363"
---
# <a name="signing-stored-procedures-in-sql-server"></a><span data-ttu-id="16a1b-102">SQL Server'da Saklı Yordam İmzalama</span><span class="sxs-lookup"><span data-stu-id="16a1b-102">Signing Stored Procedures in SQL Server</span></span>

<span data-ttu-id="16a1b-103">Dijital imza, imzalayanın özel anahtarıyla şifrelenmiş bir veri özetine sahiptir.</span><span class="sxs-lookup"><span data-stu-id="16a1b-103">A digital signature is a data digest encrypted with the private key of the signer.</span></span> <span data-ttu-id="16a1b-104">Özel anahtar, dijital imzanın kendi taşıyıcının veya sahibinin benzersiz olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="16a1b-104">The private key ensures that the digital signature is unique to its bearer or owner.</span></span> <span data-ttu-id="16a1b-105">Saklı yordamları, işlevleri (satır içi tablo değerli işlevler hariç), Tetikleyicileri ve derlemeleri imzalayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="16a1b-105">You can sign stored procedures, functions (except for inline table-valued functions), triggers, and assemblies.</span></span>

<span data-ttu-id="16a1b-106">Saklı yordamı sertifikayla veya asimetrik anahtarla imzalayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="16a1b-106">You can sign a stored procedure with a certificate or an asymmetric key.</span></span> <span data-ttu-id="16a1b-107">Bu, izinler sahiplik zincirden devralınamayacağını veya dinamik SQL gibi sahiplik zinciri kopuk olduğunda senaryolar için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="16a1b-107">This is designed for scenarios when permissions cannot be inherited through ownership chaining or when the ownership chain is broken, such as dynamic SQL.</span></span> <span data-ttu-id="16a1b-108">Daha sonra sertifikayla eşlenmiş bir kullanıcı oluşturabilirsiniz, böylece saklı yordamın erişmesi gereken nesneler üzerinde sertifika Kullanıcı izinleri verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="16a1b-108">You can then create a user mapped to the certificate, granting the certificate user permissions on the objects the stored procedure needs to access.</span></span>

<span data-ttu-id="16a1b-109">Aynı sertifikayla eşlenmiş bir oturum açma da oluşturabilir ve ardından bu oturum açma için gerekli sunucu düzeyi izinleri verebilir ya da oturum açma bilgilerini bir veya daha fazla sabit sunucu rolüne ekleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="16a1b-109">You can also create a login mapped to the same certificate, and then grant any necessary server-level permissions to that login, or add the login to one or more of the fixed server roles.</span></span> <span data-ttu-id="16a1b-110">Bu, üst düzey izinlerin gerekli olduğu senaryolar için `TRUSTWORTHY` veritabanı ayarının etkinleştirilmesini önlemek için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="16a1b-110">This is designed to avoid enabling the `TRUSTWORTHY` database setting for scenarios in which higher level permissions are needed.</span></span>

<span data-ttu-id="16a1b-111">Saklı yordam yürütüldüğünde, sertifika kullanıcısının izinlerini ve/veya arayanla birlikte oturum açma bilgilerini birleştirir SQL Server.</span><span class="sxs-lookup"><span data-stu-id="16a1b-111">When the stored procedure is executed, SQL Server combines the permissions of the certificate user and/or login with those of the caller.</span></span> <span data-ttu-id="16a1b-112">`EXECUTE AS` yan tümcesinin aksine, yordamın yürütme bağlamını değiştirmez.</span><span class="sxs-lookup"><span data-stu-id="16a1b-112">Unlike the `EXECUTE AS` clause, it does not change the execution context of the procedure.</span></span> <span data-ttu-id="16a1b-113">Oturum açma ve Kullanıcı adlarını döndüren yerleşik işlevler, sertifika kullanıcı adını değil, çağıranın adını döndürür.</span><span class="sxs-lookup"><span data-stu-id="16a1b-113">Built-in functions that return login and user names return the name of the caller, not the certificate user name.</span></span>

## <a name="creating-certificates"></a><span data-ttu-id="16a1b-114">Sertifika oluşturma</span><span class="sxs-lookup"><span data-stu-id="16a1b-114">Creating Certificates</span></span>

<span data-ttu-id="16a1b-115">Bir saklı yordamı sertifikayla veya asimetrik anahtarla imzaladığınızda, saklı yordam kodunun şifrelenmiş karmasından oluşan bir veri özeti, özel anahtar kullanılarak oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="16a1b-115">When you sign a stored procedure with a certificate or asymmetric key, a data digest consisting of the encrypted hash of the stored procedure code, along with the execute-as user, is created using the private key.</span></span> <span data-ttu-id="16a1b-116">Çalışma zamanında, veri özetinin şifresi ortak anahtarla çözülür ve saklı yordamın karma değeri ile karşılaştırılır.</span><span class="sxs-lookup"><span data-stu-id="16a1b-116">At run time, the data digest is decrypted with the public key and compared with the hash value of the stored procedure.</span></span> <span data-ttu-id="16a1b-117">Farklı Çalıştır kullanıcısının değiştirilmesi, dijital imzanın artık eşleşmemesi için karma değeri geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="16a1b-117">Changing the execute-as user invalidates the hash value so that the digital signature no longer matches.</span></span> <span data-ttu-id="16a1b-118">Saklı yordamı değiştirmek, imzayı tamamen bırakır, bu da özel anahtara erişimi olmayan birinin saklı yordam kodunu değiştirmesini önler.</span><span class="sxs-lookup"><span data-stu-id="16a1b-118">Modifying the stored procedure drops the signature entirely, which prevents someone who does not have access to the private key from changing the stored procedure code.</span></span> <span data-ttu-id="16a1b-119">Her iki durumda da, kodu veya farklı çalıştır kullanıcısını her değiştirişinizde yordamı yeniden imzalamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="16a1b-119">In either case, you must re-sign the procedure each time you change the code or the execute-as user.</span></span>

<span data-ttu-id="16a1b-120">Modülün imzalanmasında iki gerekli adım vardır:</span><span class="sxs-lookup"><span data-stu-id="16a1b-120">There are two required steps involved in signing a module:</span></span>

1. <span data-ttu-id="16a1b-121">Transact-SQL `CREATE CERTIFICATE [certificateName]` ifadesini kullanarak bir sertifika oluşturun.</span><span class="sxs-lookup"><span data-stu-id="16a1b-121">Create a certificate using the Transact-SQL `CREATE CERTIFICATE [certificateName]` statement.</span></span> <span data-ttu-id="16a1b-122">Bu bildirimde bir başlangıç ve bitiş tarihi ve parola ayarlamak için çeşitli seçenekler bulunur.</span><span class="sxs-lookup"><span data-stu-id="16a1b-122">This statement has several options for setting a start and end date and a password.</span></span> <span data-ttu-id="16a1b-123">Varsayılan süre sonu tarihi bir yıldır.</span><span class="sxs-lookup"><span data-stu-id="16a1b-123">The default expiration date is one year.</span></span>

1. <span data-ttu-id="16a1b-124">Yöntemi Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]` ifadesini kullanarak sertifikayla imzalayın.</span><span class="sxs-lookup"><span data-stu-id="16a1b-124">Sign the procedure with the certificate using the Transact-SQL `ADD SIGNATURE TO [procedureName] BY CERTIFICATE [certificateName]` statement.</span></span>

<span data-ttu-id="16a1b-125">Modül imzalandıktan sonra sertifikayla ilişkilendirilmesi gereken ek izinleri tutmak için bir veya daha fazla asıl oluşturulması gerekir.</span><span class="sxs-lookup"><span data-stu-id="16a1b-125">Once the module has been signed, one or more principals needs to be created in order to hold the additional permissions that should be associated with the certificate.</span></span>

<span data-ttu-id="16a1b-126">Modülün ek veritabanı düzeyi izinleri olması gerekiyorsa:</span><span class="sxs-lookup"><span data-stu-id="16a1b-126">If the module needs additional database-level permissions:</span></span>

1. <span data-ttu-id="16a1b-127">Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]` ifadesini kullanarak bu sertifikayla ilişkili bir veritabanı kullanıcısı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="16a1b-127">Create a database user associated with that certificate using the Transact-SQL `CREATE USER [userName] FROM CERTIFICATE [certificateName]` statement.</span></span> <span data-ttu-id="16a1b-128">Bu Kullanıcı yalnızca veritabanında bulunur ve aynı sertifikadan aynı zamanda bir oturum açma işlemi yoksa bir oturum açma işlemiyle ilişkili değildir.</span><span class="sxs-lookup"><span data-stu-id="16a1b-128">This user exists in the database only and is not associated with a login unless a login has also been created from that same certificate.</span></span>

1. <span data-ttu-id="16a1b-129">Sertifika kullanıcısına gerekli veritabanı düzeyi izinlerini verin.</span><span class="sxs-lookup"><span data-stu-id="16a1b-129">Grant the certificate user the required database-level permissions.</span></span>

<span data-ttu-id="16a1b-130">Modülün ek sunucu düzeyi izinleri olması gerekiyorsa:</span><span class="sxs-lookup"><span data-stu-id="16a1b-130">If the module needs additional server-level permissions:</span></span>

1. <span data-ttu-id="16a1b-131">Sertifikayı `master` veritabanına kopyalayın.</span><span class="sxs-lookup"><span data-stu-id="16a1b-131">Copy the certificate to the `master` database.</span></span>

1. <span data-ttu-id="16a1b-132">Transact-SQL `CREATE LOGIN [userName] FROM CERTIFICATE [certificateName]` ifadesini kullanarak bu sertifikayla ilişkili bir oturum açma oluşturun.</span><span class="sxs-lookup"><span data-stu-id="16a1b-132">Create a login associated with that certificate using the Transact-SQL `CREATE LOGIN [userName] FROM CERTIFICATE [certificateName]` statement.</span></span>

1. <span data-ttu-id="16a1b-133">Sertifika oturumuna gereken sunucu düzeyi izinleri verin.</span><span class="sxs-lookup"><span data-stu-id="16a1b-133">Grant the certificate login the required server-level permissions.</span></span>

> [!NOTE]
> <span data-ttu-id="16a1b-134">Bir sertifika, izinleri reddetme ifadesiyle iptal edilen bir kullanıcıya izin veremez.</span><span class="sxs-lookup"><span data-stu-id="16a1b-134">A certificate cannot grant permissions to a user that has had permissions revoked using the DENY statement.</span></span> <span data-ttu-id="16a1b-135">REDDETME her zaman verme işleminden önceliklidir ve çağıranın sertifika kullanıcısına verilen izinleri devralmasını önler.</span><span class="sxs-lookup"><span data-stu-id="16a1b-135">DENY always takes precedence over GRANT, preventing the caller from inheriting permissions granted to the certificate user.</span></span>

## <a name="external-resources"></a><span data-ttu-id="16a1b-136">Dış Kaynaklar</span><span class="sxs-lookup"><span data-stu-id="16a1b-136">External Resources</span></span>

<span data-ttu-id="16a1b-137">Daha fazla bilgi için aşağıdaki kaynaklara bakın.</span><span class="sxs-lookup"><span data-stu-id="16a1b-137">For more information, see the following resources.</span></span>

|<span data-ttu-id="16a1b-138">Kaynak</span><span class="sxs-lookup"><span data-stu-id="16a1b-138">Resource</span></span>|<span data-ttu-id="16a1b-139">Açıklama</span><span class="sxs-lookup"><span data-stu-id="16a1b-139">Description</span></span>|
|--------------|-----------------|
|<span data-ttu-id="16a1b-140">[Modül Imzalama](https://docs.microsoft.com/previous-versions/sql/sql-server-2008/ms345102(v=sql.100))</span><span class="sxs-lookup"><span data-stu-id="16a1b-140">[Module Signing](https://docs.microsoft.com/previous-versions/sql/sql-server-2008/ms345102(v=sql.100))</span></span>|<span data-ttu-id="16a1b-141">Modül imzalamayı açıklar, örnek bir senaryo ve ilgili Transact-SQL makalelerine bağlantılar sağlar.</span><span class="sxs-lookup"><span data-stu-id="16a1b-141">Describes module signing, providing a sample scenario and links to the relevant Transact-SQL articles.</span></span>|
|[<span data-ttu-id="16a1b-142">Saklı yordamları bir sertifikayla imzalama</span><span class="sxs-lookup"><span data-stu-id="16a1b-142">Signing Stored Procedures with a Certificate</span></span>](/sql/relational-databases/tutorial-signing-stored-procedures-with-a-certificate)|<span data-ttu-id="16a1b-143">Bir saklı yordamı sertifikayla imzalamak için bir öğretici sağlar.</span><span class="sxs-lookup"><span data-stu-id="16a1b-143">Provides a tutorial for signing a stored procedure with a certificate.</span></span>|

## <a name="see-also"></a><span data-ttu-id="16a1b-144">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="16a1b-144">See also</span></span>

- [<span data-ttu-id="16a1b-145">ADO.NET Uygulamalarının Güvenliğini Sağlama</span><span class="sxs-lookup"><span data-stu-id="16a1b-145">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="16a1b-146">SQL Server Güvenliğine Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="16a1b-146">Overview of SQL Server Security</span></span>](overview-of-sql-server-security.md)
- [<span data-ttu-id="16a1b-147">SQL Server'da Uygulama Güvenliği Senaryoları</span><span class="sxs-lookup"><span data-stu-id="16a1b-147">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="16a1b-148">SQL Server'da Saklı Yordam İzinlerini Yönetme</span><span class="sxs-lookup"><span data-stu-id="16a1b-148">Managing Permissions with Stored Procedures in SQL Server</span></span>](managing-permissions-with-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="16a1b-149">SQL Server’da Secure Dynamic SQL Yazma</span><span class="sxs-lookup"><span data-stu-id="16a1b-149">Writing Secure Dynamic SQL in SQL Server</span></span>](writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="16a1b-150">SQL Server'da Kimliğe Bürünme İzinlerini Özelleştirme</span><span class="sxs-lookup"><span data-stu-id="16a1b-150">Customizing Permissions with Impersonation in SQL Server</span></span>](customizing-permissions-with-impersonation-in-sql-server.md)
- [<span data-ttu-id="16a1b-151">Saklı Yordamlarla Verileri Değiştirme</span><span class="sxs-lookup"><span data-stu-id="16a1b-151">Modifying Data with Stored Procedures</span></span>](../modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="16a1b-152">ADO.NET’e Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="16a1b-152">ADO.NET Overview</span></span>](../ado-net-overview.md)
