---
title: Kurtarma Gerçekleştirme
description: .NET ' te kurtarma gerçekleştirin. Kaynak Yöneticisi, kaynak hatasından sonra işlem katılımcısını yeniden listeleyerek, dayanıklı işlem dökümüne yardımcı olur.
ms.date: 03/30/2017
ms.assetid: 6dd17bf6-ba42-460a-a44b-8046f52b10d0
ms.openlocfilehash: 23ee6cb194dbafb08ef7acf17aad25a57b57045e
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91186737"
---
# <a name="performing-recovery"></a><span data-ttu-id="0c7bd-104">Kurtarma Gerçekleştirme</span><span class="sxs-lookup"><span data-stu-id="0c7bd-104">Performing Recovery</span></span>

<span data-ttu-id="0c7bd-105">Kaynak Yöneticisi, kaynak hatasından sonra işlem katılımcısını yeniden listeleyerek bir işlemde kalıcı kayıtlar çözümlemesini kolaylaştırır.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-105">A resource manager facilitates resolution of durable enlistments in a transaction by reenlisting the transaction participant after resource failure.</span></span>  
  
## <a name="the-recovery-process"></a><span data-ttu-id="0c7bd-106">Kurtarma işlemi</span><span class="sxs-lookup"><span data-stu-id="0c7bd-106">The Recovery Process</span></span>  

 <span data-ttu-id="0c7bd-107">Bir kaynak durably listeleme (uygulaması tarafından açıklanan <xref:System.Transactions.IEnlistmentNotification> arabirimi), daha sonra olabilir kurtarma için uygun, çağırması gerekir <xref:System.Transactions.Transaction.EnlistDurable%2A> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-107">To durably enlist a resource (described by an implementation of the <xref:System.Transactions.IEnlistmentNotification> interface) that can later be eligible for recovery, you should call the <xref:System.Transactions.Transaction.EnlistDurable%2A> method.</span></span> <span data-ttu-id="0c7bd-108">Buna ek olarak, bir Resource <xref:System.Transactions.Transaction.EnlistDurable%2A> Manager tanımlayıcısı (a) ile bir <xref:System.Guid> kaynak hatası durumunda işlemin katılımcısını tutarlı bir şekilde etiketlemesini sağlamanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-108">In addition, you must provide the <xref:System.Transactions.Transaction.EnlistDurable%2A> method with a resource manager identifier (a <xref:System.Guid>) that is used to consistently label the participant of the transaction in the event of a resource failure.</span></span> <span data-ttu-id="0c7bd-109">Bu nedenle, <xref:System.Guid> Ilk Enlist çağrısı için belirtilen, kurtarma sırasında çağrısındaki *resourceManagerIdentifier* parametresiyle aynı olmalıdır <xref:System.Transactions.TransactionManager.Reenlist%2A> .</span><span class="sxs-lookup"><span data-stu-id="0c7bd-109">For this reason, the <xref:System.Guid> that is provided to the initial Enlist call should be identical to the *resourceManagerIdentifier* parameter in the <xref:System.Transactions.TransactionManager.Reenlist%2A> call during recovery.</span></span> <span data-ttu-id="0c7bd-110">Aksi takdirde <xref:System.Transactions.TransactionException> oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-110">Otherwise, <xref:System.Transactions.TransactionException> is thrown.</span></span> <span data-ttu-id="0c7bd-111">Dayanıklı kayıtlar hakkında daha fazla bilgi için bkz. [kaynakları bir işlem Içinde katılımcılar olarak listeleme](enlisting-resources-as-participants-in-a-transaction.md) .</span><span class="sxs-lookup"><span data-stu-id="0c7bd-111">For more information on durable enlistments, see [Enlisting Resources as Participants in a Transaction](enlisting-resources-as-participants-in-a-transaction.md) .</span></span>  
  
 <span data-ttu-id="0c7bd-112">Uygulamanız kalıcı Kaynak Yöneticisi, aldığında 2PC Protokolü (Aşama 1) hazırla kısımda <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> bildirim, bunu kendi hazırla kaydı bu aşamada oturum açması gerekir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-112">In the prepare phase (phase 1) of the 2PC protocol, when your implementation of a durable resource manager receives the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification, it should log its prepare record during this phase.</span></span> <span data-ttu-id="0c7bd-113">Kayıt, işleme üzerindeki işlemi tamamlamak için gereken tüm bilgileri içermelidir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-113">The record should contain all the information that is necessary to complete the transaction on commit.</span></span> <span data-ttu-id="0c7bd-114">Hazırlık kaydına, hazırlık <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> listesine geri çağırma özelliği eklenerek daha sonra kurtarma sırasında erişilebilir. *preparingEnlistment*</span><span class="sxs-lookup"><span data-stu-id="0c7bd-114">The prepare record can later be accessed during recovery by retrieving the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the *preparingEnlistment* callback.</span></span> <span data-ttu-id="0c7bd-115">Kayıt günlük içinde yapılması gerekmez <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> yöntemi RM olarak bu iş parçacığı üzerinde yapabilir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-115">The record logging does not need to be performed within the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> method as the RM can do this on a worker thread.</span></span>  
  
 <span data-ttu-id="0c7bd-116">Kurtarma işlemi aşağıdaki iki adımlardan oluşur:</span><span class="sxs-lookup"><span data-stu-id="0c7bd-116">The recovery process consists of the following two steps:</span></span>  
  
### <a name="step-1---reenlist"></a><span data-ttu-id="0c7bd-117">Adım 1 - ReEnlist</span><span class="sxs-lookup"><span data-stu-id="0c7bd-117">Step 1 - ReEnlist</span></span>  

 <span data-ttu-id="0c7bd-118">Kaynak Yöneticisi şüpheli her liste için hazırla bilgi kaydını inceler.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-118">The resource manager examines the prepare information record for each enlistment that is in-doubt.</span></span> <span data-ttu-id="0c7bd-119">Bu incelenerek yapılır <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> özelliği <xref:System.Transactions.PreparingEnlistment> Kaynak Yöneticisi'nde için geçirilen geri çağırma <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> bildirim aşamasında 1.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-119">This is done by examining the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> property of the <xref:System.Transactions.PreparingEnlistment> callback, which is passed to the resource manager in the <xref:System.Transactions.IEnlistmentNotification.Prepare%2A> notification during phase 1.</span></span>  
  
 <span data-ttu-id="0c7bd-120">İncelediği her bir kayıt için <xref:System.Transactions.TransactionManager.Reenlist%2A> işlem yöneticisinde çağırır.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-120">For each such enlistment it examines, it invokes <xref:System.Transactions.TransactionManager.Reenlist%2A> on the transaction manager.</span></span> <span data-ttu-id="0c7bd-121">Bu yöntem benzersiz bir üzerinde başarılı <xref:System.Guid> , kaynak yöneticisi yanı sıra bir bayt dizisi liste 's bilgileri tanımlar.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-121">This method passes on a unique <xref:System.Guid> that identifies the resource manager, as well as the enlistment's information in a byte array.</span></span> <span data-ttu-id="0c7bd-122">Yeni bir <xref:System.Transactions.Enlistment> nesne döndürülür.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-122">A new <xref:System.Transactions.Enlistment> object is returned.</span></span> <span data-ttu-id="0c7bd-123">Yeniden kayıt bir özel durumla başarısız olursa, kaynak yöneticisinin daha sonra yeniden denemesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-123">If the reenlistment fails with an exception, the resource manager will need to retry at a later time.</span></span>  
  
 <span data-ttu-id="0c7bd-124">Yalnızca çağırmalıdır <xref:System.Transactions.TransactionManager.Reenlist%2A> hata verdi bir kaynak yöneticisi yeniden başlatıldığında yöntemi.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-124">You should only call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method when a resource manager restarts from failure.</span></span> <span data-ttu-id="0c7bd-125">Ayrıca, bir kaynak yöneticisi tarafından yalnızca, iki aşamalı bir kaydetmenin ilk hazırlanması sırasında günlüğe çözülmemiş işlemleri yeniden listeleme yapmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-125">In addition, you should only reenlist unresolved transactions logged by a resource manager during the initial Prepare phase of a two-phase commit.</span></span> <span data-ttu-id="0c7bd-126">Bu yöntemi geçersiz zamanlarda çağırmak için her türlü girişim hatalı sonuçlara neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-126">Any attempt to call this method at invalid times can produce erroneous results.</span></span>  
  
 <span data-ttu-id="0c7bd-127">Katılımcı bu yöntem kullanılarak yeniden listelense, işlemin sonucuna karşılık gelen aşama 2 yöntemleri <xref:System.Transactions.IEnlistmentNotification> (yani, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> veya <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) uygun şekilde çağırılır.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-127">When a participant is reenlisted using this method, the phase 2 methods of <xref:System.Transactions.IEnlistmentNotification> that correspond to the transaction's outcome (that is, <xref:System.Transactions.IEnlistmentNotification.Commit%2A> , <xref:System.Transactions.IEnlistmentNotification.Rollback%2A> or <xref:System.Transactions.IEnlistmentNotification.InDoubt%2A> ) are called as appropriate.</span></span>  
  
### <a name="step-2---completing-the-recovery"></a><span data-ttu-id="0c7bd-128">Adım 2 - kurtarma Tamamlanıyor</span><span class="sxs-lookup"><span data-stu-id="0c7bd-128">Step 2 - Completing the recovery</span></span>  

 <span data-ttu-id="0c7bd-129">Tüm reenlistments tamamlandığında, kaynak yöneticisi çağırır <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> yöntemi.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-129">When all the reenlistments are finished, the resource manager calls the <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> method.</span></span> <span data-ttu-id="0c7bd-130">Bu yöntem, kurtarmayı tamamlar ve işlem yöneticisine kaynak yöneticisinin daha fazla şüpheli işlem olmadığını bildirir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-130">This method completes the recovery and informs the transaction manager that the resource manager has no more in-doubt transactions.</span></span> <span data-ttu-id="0c7bd-131">Bunu yaptığınızda, kaynak yöneticisi değil çağırır garanti <xref:System.Transactions.TransactionManager.Reenlist%2A> yeniden yöntemi.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-131">By doing so, the resource manager guarantees that it will not invoke the <xref:System.Transactions.TransactionManager.Reenlist%2A> method again.</span></span>  
  
 <span data-ttu-id="0c7bd-132">Yeni işlemlere kaydedilmeden önce tüm şüpheli işlemleri çözümlemek için Kaynak Yöneticisi gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-132">A resource manager is not required to resolve all in-doubt transactions before enlisting in new transactions.</span></span> <span data-ttu-id="0c7bd-133">İlk adım, Resource Manager, işlem yöneticisiyle bir ilişki kurulduktan sonra, ancak çağrıldıktan sonra <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> (2. adım), tekrar gerçekleştirilemediği zaman gerçekleştirilebilir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-133">The first step can be performed at any time after the resource manager establishes a relationship with the transaction manager, but after <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> has been invoked (step 2); step 1 cannot be performed again.</span></span> <span data-ttu-id="0c7bd-134">2. adım işlem sonuçlarının etkilenmeden birden çok kez tekrarlanabilir.</span><span class="sxs-lookup"><span data-stu-id="0c7bd-134">Step 2 can be repeated multiple times without affecting the outcome of transactions.</span></span>
