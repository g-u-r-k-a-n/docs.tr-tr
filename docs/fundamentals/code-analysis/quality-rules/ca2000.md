---
title: 'CA2000: kapsamı kaybetmeden önce nesneleri atma (kod analizi)'
description: 'Kod Analizi kuralıyla ilgili bilgi edinin CA2000: kapsamı kaybetmeden önce nesneleri atma'
ms.date: 05/14/2019
ms.topic: reference
f1_keywords:
- CA2000
- Dispose objects before losing scope
- DisposeObjectsBeforeLosingScope
helpviewer_keywords:
- CA2000
- DisposeObjectsBeforeLosingScope
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 7e90ef1e07160fdd307d95131631f24c8ba371ad
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/04/2021
ms.locfileid: "99545964"
---
# <a name="ca2000-dispose-objects-before-losing-scope"></a><span data-ttu-id="55a8a-103">CA2000: Kapsamı kaybetmeden önce nesneleri bırakın</span><span class="sxs-lookup"><span data-stu-id="55a8a-103">CA2000: Dispose objects before losing scope</span></span>

| | <span data-ttu-id="55a8a-104">Değer</span><span class="sxs-lookup"><span data-stu-id="55a8a-104">Value</span></span> |
|-|-|
| <span data-ttu-id="55a8a-105">**Kural Kimliği**</span><span class="sxs-lookup"><span data-stu-id="55a8a-105">**Rule ID**</span></span> |<span data-ttu-id="55a8a-106">CA2000</span><span class="sxs-lookup"><span data-stu-id="55a8a-106">CA2000</span></span>|
| <span data-ttu-id="55a8a-107">**Kategori**</span><span class="sxs-lookup"><span data-stu-id="55a8a-107">**Category**</span></span> |[<span data-ttu-id="55a8a-108">Microsoft. güvenilirliği</span><span class="sxs-lookup"><span data-stu-id="55a8a-108">Microsoft.Reliability</span></span>](reliability-warnings.md)|
| <span data-ttu-id="55a8a-109">**Düzeltilme veya kırılmamış**</span><span class="sxs-lookup"><span data-stu-id="55a8a-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="55a8a-110">Kırılmamış</span><span class="sxs-lookup"><span data-stu-id="55a8a-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="55a8a-111">Nedeni</span><span class="sxs-lookup"><span data-stu-id="55a8a-111">Cause</span></span>

<span data-ttu-id="55a8a-112">Bir türün yerel nesnesi <xref:System.IDisposable> oluşturulur, ancak nesne tüm başvuruları kapsam dışı olmadan önce nesne atılamaz.</span><span class="sxs-lookup"><span data-stu-id="55a8a-112">A local object of an <xref:System.IDisposable> type is created, but the object is not disposed before all references to the object are out of scope.</span></span>

<span data-ttu-id="55a8a-113">Varsayılan olarak, bu kural codebase 'in tamamını analiz eder, ancak bu [yapılandırılabilir](#configure-code-to-analyze).</span><span class="sxs-lookup"><span data-stu-id="55a8a-113">By default, this rule analyzes the entire codebase, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="55a8a-114">Kural açıklaması</span><span class="sxs-lookup"><span data-stu-id="55a8a-114">Rule description</span></span>

<span data-ttu-id="55a8a-115">Bir atılabilir nesnesi, tüm başvuruları kapsam dışına çıkarılmadan önce açıkça atılmaz, çöp toplayıcı nesnenin sonlandırıcısını çalıştırdığında, nesne belirsiz bir zamanda silinir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-115">If a disposable object is not explicitly disposed before all references to it are out of scope, the object will be disposed at some indeterminate time when the garbage collector runs the finalizer of the object.</span></span> <span data-ttu-id="55a8a-116">Nesnenin sonlandırıcısını çalışmasını engelleyecek olağanüstü bir olay ortaya çıkabilecek için, bunun yerine nesne açıkça atılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="55a8a-116">Because an exceptional event might occur that will prevent the finalizer of the object from running, the object should be explicitly disposed instead.</span></span>

## <a name="special-cases"></a><span data-ttu-id="55a8a-117">Özel durumlar</span><span class="sxs-lookup"><span data-stu-id="55a8a-117">Special cases</span></span>

<span data-ttu-id="55a8a-118">CA2000 kuralı, nesne atılmasa bile aşağıdaki türlerin yerel nesneleri için başlatılmıyor:</span><span class="sxs-lookup"><span data-stu-id="55a8a-118">Rule CA2000 does not fire for local objects of the following types even if the object is not disposed:</span></span>

- <xref:System.IO.Stream?displayProperty=nameWithType>
- <xref:System.IO.StringReader?displayProperty=nameWithType>
- <xref:System.IO.TextReader?displayProperty=nameWithType>
- <xref:System.IO.TextWriter?displayProperty=nameWithType>
- <xref:System.Resources.IResourceReader?displayProperty=nameWithType>

<span data-ttu-id="55a8a-119">Bu türlerden birine ait bir nesnenin bir oluşturucuya geçirilmesi ve sonra bir alana atanması, yeni oluşturulan türe bir *atma sahipliğinin aktarılmasını* gösterir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-119">Passing an object of one of these types to a constructor and then assigning it to a field indicates a *dispose ownership transfer* to the newly constructed type.</span></span> <span data-ttu-id="55a8a-120">Diğer bir deyişle, yeni oluşturulan tür artık nesnenin elden atılırken sorumludur.</span><span class="sxs-lookup"><span data-stu-id="55a8a-120">That is, the newly constructed type is now responsible for disposing of the object.</span></span> <span data-ttu-id="55a8a-121">Kodunuz bu türlerden birinin bir nesnesini bir oluşturucuya geçirirse, nesne tüm başvuruları kapsam dışı olmadan önce atılmasa bile kural CA2000 hiçbir ihlalin gerçekleşmez.</span><span class="sxs-lookup"><span data-stu-id="55a8a-121">If your code passes an object of one of these types to a constructor, no violation of rule CA2000 occurs even if the object is not disposed before all references to it are out of scope.</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="55a8a-122">İhlalleri çözme</span><span class="sxs-lookup"><span data-stu-id="55a8a-122">How to fix violations</span></span>

<span data-ttu-id="55a8a-123">Bu kuralın ihlalini onarmak için, <xref:System.IDisposable.Dispose%2A> tüm başvuruları kapsam dışı olmadan önce nesne üzerinde çağrı yapın.</span><span class="sxs-lookup"><span data-stu-id="55a8a-123">To fix a violation of this rule, call <xref:System.IDisposable.Dispose%2A> on the object before all references to it are out of scope.</span></span>

<span data-ttu-id="55a8a-124">[ `using` ](../../../csharp/language-reference/keywords/using-statement.md) [`Using`](../../../visual-basic/language-reference/statements/using-statement.md) Uygulayan nesneleri kaydırmak için (Visual Basic) ifadesini kullanabilirsiniz <xref:System.IDisposable> .</span><span class="sxs-lookup"><span data-stu-id="55a8a-124">You can use the [`using` statement](../../../csharp/language-reference/keywords/using-statement.md) ([`Using`](../../../visual-basic/language-reference/statements/using-statement.md) in Visual Basic) to wrap objects that implement <xref:System.IDisposable>.</span></span> <span data-ttu-id="55a8a-125">Bu şekilde Sarmalanan nesneler bloğun sonuna otomatik olarak silinir `using` .</span><span class="sxs-lookup"><span data-stu-id="55a8a-125">Objects that are wrapped in this manner are automatically disposed at the end of the `using` block.</span></span> <span data-ttu-id="55a8a-126">Ancak aşağıdaki durumlar, bir ifadesiyle birlikte işlenmemelidir `using` .</span><span class="sxs-lookup"><span data-stu-id="55a8a-126">However, the following situations should not or cannot be handled with a `using` statement:</span></span>

- <span data-ttu-id="55a8a-127">Bir atılabilir nesnesi döndürmek için, nesnesinin bir `try/finally` blok dışında bir blokta oluşturulması gerekir `using` .</span><span class="sxs-lookup"><span data-stu-id="55a8a-127">To return a disposable object, the object must constructed in a `try/finally` block outside of a `using` block.</span></span>

- <span data-ttu-id="55a8a-128">Bir deyimin oluşturucusunda bir atılabilir nesnesinin üyelerini başlatmayın `using` .</span><span class="sxs-lookup"><span data-stu-id="55a8a-128">Do not initialize members of a disposable object in the constructor of a `using` statement.</span></span>

- <span data-ttu-id="55a8a-129">Yalnızca bir özel durum işleyicisi tarafından korunan oluşturucular [bir `using` deyimin alım bölümünde](../../../csharp/language-reference/keywords/using-statement.md)iç içe geçmişse, dış oluşturucudaki bir hata, iç içe Oluşturucu tarafından oluşturulan nesnenin hiçbir zaman kapanmamış olması halinde oluşabilir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-129">When constructors that are protected by only one exception handler are nested in the [acquisition part of a `using` statement](../../../csharp/language-reference/keywords/using-statement.md), a failure in the outer constructor can result in the object created by the nested constructor never being closed.</span></span> <span data-ttu-id="55a8a-130">Aşağıdaki örnekte, <xref:System.IO.StreamReader> oluşturucudaki bir hata <xref:System.IO.FileStream> nesnenin hiçbir şekilde kapanmamış olması olabilir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-130">In the following example, a failure in the <xref:System.IO.StreamReader> constructor can result in the <xref:System.IO.FileStream> object never being closed.</span></span> <span data-ttu-id="55a8a-131">CA2000 bayraklar bu durumda kural ihlaline neden oluyor.</span><span class="sxs-lookup"><span data-stu-id="55a8a-131">CA2000 flags a violation of the rule in this case.</span></span>

   ```csharp
   using (StreamReader sr = new StreamReader(new FileStream("C:\myfile.txt", FileMode.Create)))
   { ... }
   ```

- <span data-ttu-id="55a8a-132">Dinamik nesneler, nesnelerin Dispose modelini uygulamak için bir gölge nesnesi kullanmalıdır <xref:System.IDisposable> .</span><span class="sxs-lookup"><span data-stu-id="55a8a-132">Dynamic objects should use a shadow object to implement the dispose pattern of <xref:System.IDisposable> objects.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="55a8a-133">Uyarıların ne zaman bastırılamıyor</span><span class="sxs-lookup"><span data-stu-id="55a8a-133">When to suppress warnings</span></span>

<span data-ttu-id="55a8a-134">Bu kuraldan bir uyarıyı şu durumlar dışında gösterme:</span><span class="sxs-lookup"><span data-stu-id="55a8a-134">Do not suppress a warning from this rule unless:</span></span>

- <span data-ttu-id="55a8a-135">Nesneniz için Şunu çağıran bir yöntemi (örneğin `Dispose` , <xref:System.IO.Stream.Close%2A></span><span class="sxs-lookup"><span data-stu-id="55a8a-135">You've called a method on your object that calls `Dispose`, such as <xref:System.IO.Stream.Close%2A></span></span>
- <span data-ttu-id="55a8a-136">Uyarıyı tetikleyen Yöntem, <xref:System.IDisposable> nesnenizin sarmaladığı bir nesne döndürüyor</span><span class="sxs-lookup"><span data-stu-id="55a8a-136">The method that raised the warning returns an <xref:System.IDisposable> object that wraps your object</span></span>
- <span data-ttu-id="55a8a-137">Ayırma yöntemi Dispose sahipliğini içermez; diğer bir deyişle, nesneyi atılama sorumluluğu, yönteminde oluşturulan ve çağırana döndürülen başka bir nesne veya sarmalayıcı için aktarılır</span><span class="sxs-lookup"><span data-stu-id="55a8a-137">The allocating method does not have dispose ownership; that is, the responsibility to dispose the object is transferred to another object or wrapper that's created in the method and returned to the caller</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="55a8a-138">Analiz etmek için kodu Yapılandır</span><span class="sxs-lookup"><span data-stu-id="55a8a-138">Configure code to analyze</span></span>

<span data-ttu-id="55a8a-139">Kod tabanınızın hangi bölümlerinin bu kuralı çalıştıracağınızı yapılandırmak için aşağıdaki seçenekleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="55a8a-139">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="55a8a-140">Belirli sembolleri Dışla</span><span class="sxs-lookup"><span data-stu-id="55a8a-140">Exclude specific symbols</span></span>](#exclude-specific-symbols)
- [<span data-ttu-id="55a8a-141">Belirli türleri ve bunların türetilmiş türlerini Dışla</span><span class="sxs-lookup"><span data-stu-id="55a8a-141">Exclude specific types and their derived types</span></span>](#exclude-specific-types-and-their-derived-types)

<span data-ttu-id="55a8a-142">Bu seçenekleri yalnızca bu kural için, tüm kurallar için veya bu kategorideki tüm kurallar ([güvenilirlik](reliability-warnings.md)) için yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="55a8a-142">You can configure these options for just this rule, for all rules, or for all rules in this category ([Reliability](reliability-warnings.md)).</span></span> <span data-ttu-id="55a8a-143">Daha fazla bilgi için bkz. [kod kalitesi kural yapılandırma seçenekleri](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="55a8a-143">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

[!INCLUDE[excluded-symbol-names](~/includes/code-analysis/excluded-symbol-names.md)]

[!INCLUDE[excluded-type-names-with-derived-types](~/includes/code-analysis/excluded-type-names-with-derived-types.md)]

## <a name="related-rules"></a><span data-ttu-id="55a8a-144">İlgili kurallar</span><span class="sxs-lookup"><span data-stu-id="55a8a-144">Related rules</span></span>

- [<span data-ttu-id="55a8a-145">CA2213: Atılabilen alanlar atılmalıdır</span><span class="sxs-lookup"><span data-stu-id="55a8a-145">CA2213: Disposable fields should be disposed</span></span>](ca2213.md)

## <a name="example-1"></a><span data-ttu-id="55a8a-146">Örnek 1</span><span class="sxs-lookup"><span data-stu-id="55a8a-146">Example 1</span></span>

<span data-ttu-id="55a8a-147">Atılabilir nesnesi döndüren bir yöntem uygularsanız, nesnenin atılmış olduğundan emin olmak için catch bloğu olmayan bir try/finally bloğu kullanın.</span><span class="sxs-lookup"><span data-stu-id="55a8a-147">If you're implementing a method that returns a disposable object, use a try/finally block without a catch block to make sure that the object is disposed.</span></span> <span data-ttu-id="55a8a-148">Bir try/finally bloğu kullanarak, özel durumların hata noktasında ortaya çıkmasına ve nesnenin atıldığından emin olmanızı sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="55a8a-148">By using a try/finally block, you allow exceptions to be raised at the fault point and make sure that object is disposed.</span></span>

<span data-ttu-id="55a8a-149">OpenPort1 yönteminde, ISerializable nesne SerialPort 'u açma çağrısı veya SomeMethod çağrısı başarısız olabilir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-149">In the OpenPort1 method, the call to open the ISerializable object SerialPort or the call to SomeMethod can fail.</span></span> <span data-ttu-id="55a8a-150">Bu uygulamada bir CA2000 uyarısı oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="55a8a-150">A CA2000 warning is raised on this implementation.</span></span>

<span data-ttu-id="55a8a-151">OpenPort2 yönteminde, iki SerialPort nesnesi bildirilmiştir ve null olarak ayarlanır:</span><span class="sxs-lookup"><span data-stu-id="55a8a-151">In the OpenPort2 method, two SerialPort objects are declared and set to null:</span></span>

- <span data-ttu-id="55a8a-152">`tempPort`, yöntem işlemlerinin başarılı olduğunu test etmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="55a8a-152">`tempPort`, which is used to test that the method operations succeed.</span></span>

- <span data-ttu-id="55a8a-153">`port`, yönteminin dönüş değeri için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="55a8a-153">`port`, which is used for the return value of the method.</span></span>

<span data-ttu-id="55a8a-154">`tempPort`Oluşturulur ve bir `try` blokta açılır ve diğer tüm gerekli işler aynı `try` blokta gerçekleştirilir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-154">The `tempPort` is constructed and opened in a `try` block, and any other required work is performed in the same `try` block.</span></span> <span data-ttu-id="55a8a-155">`try`Bloğun sonunda, açılan bağlantı noktası `port` döndürülecek nesneye atanır ve `tempPort` nesne olarak ayarlanır `null` .</span><span class="sxs-lookup"><span data-stu-id="55a8a-155">At the end of the `try` block, the opened port is assigned to the `port` object that will be returned and the `tempPort` object is set to `null`.</span></span>

<span data-ttu-id="55a8a-156">`finally`Bloğu değerini denetler `tempPort` .</span><span class="sxs-lookup"><span data-stu-id="55a8a-156">The `finally` block checks the value of `tempPort`.</span></span> <span data-ttu-id="55a8a-157">Null değilse, yöntemindeki bir işlem başarısız olur ve `tempPort` tüm kaynakların serbest bırakılmış olduğundan emin olmak için kapalıdır.</span><span class="sxs-lookup"><span data-stu-id="55a8a-157">If it is not null, an operation in the method has failed, and `tempPort` is closed to make sure that any resources are released.</span></span> <span data-ttu-id="55a8a-158">Döndürülen bağlantı noktası nesnesi, metodun işlemleri başarılı olursa Açık SerialPort nesnesini içerir veya bir işlem başarısız olursa null olur.</span><span class="sxs-lookup"><span data-stu-id="55a8a-158">The returned port object will contain the opened SerialPort object if the operations of the method succeeded, or it will be null if an operation failed.</span></span>

```csharp
public SerialPort OpenPort1(string portName)
{
   SerialPort port = new SerialPort(portName);
   port.Open();  //CA2000 fires because this might throw
   SomeMethod(); //Other method operations can fail
   return port;
}

public SerialPort OpenPort2(string portName)
{
   SerialPort tempPort = null;
   SerialPort port = null;
   try
   {
      tempPort = new SerialPort(portName);
      tempPort.Open();
      SomeMethod();
      //Add any other methods above this line
      port = tempPort;
      tempPort = null;

   }
   finally
   {
      if (tempPort != null)
      {
         tempPort.Close();
      }
   }
   return port;
}
```

```vb
Public Function OpenPort1(ByVal PortName As String) As SerialPort

   Dim port As New SerialPort(PortName)
   port.Open()    'CA2000 fires because this might throw
   SomeMethod()   'Other method operations can fail
   Return port

End Function

Public Function OpenPort2(ByVal PortName As String) As SerialPort

   Dim tempPort As SerialPort = Nothing
   Dim port As SerialPort = Nothing

   Try
      tempPort = New SerialPort(PortName)
      tempPort.Open()
      SomeMethod()
      'Add any other methods above this line
      port = tempPort
      tempPort = Nothing

   Finally
      If Not tempPort Is Nothing Then
         tempPort.Close()
      End If

   End Try

   Return port

End Function
```

## <a name="example-2"></a><span data-ttu-id="55a8a-159">Örnek 2</span><span class="sxs-lookup"><span data-stu-id="55a8a-159">Example 2</span></span>

<span data-ttu-id="55a8a-160">Varsayılan olarak, Visual Basic derleyicisinde tüm aritmetik işleçler taşma için denetlenir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-160">By default, the Visual Basic compiler has all arithmetic operators check for overflow.</span></span> <span data-ttu-id="55a8a-161">Bu nedenle, herhangi bir Visual Basic aritmetik işlemi oluşturabilir <xref:System.OverflowException> .</span><span class="sxs-lookup"><span data-stu-id="55a8a-161">Therefore, any Visual Basic arithmetic operation might throw an <xref:System.OverflowException>.</span></span> <span data-ttu-id="55a8a-162">Bu, CA2000 gibi kurallarda beklenmeyen ihlallere neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="55a8a-162">This could lead to unexpected violations in rules such as CA2000.</span></span> <span data-ttu-id="55a8a-163">Örneğin, Visual Basic derleyici, StreamReader atılmasına neden olacak bir özel durum oluşturabilecek ekleme için bir taşma denetimi yönergesi yaydığı için, aşağıdaki CreateReader1 işlevi bir CA2000 ihlaline neden olur.</span><span class="sxs-lookup"><span data-stu-id="55a8a-163">For example, the following CreateReader1 function will produce a CA2000 violation because the Visual Basic compiler is emitting an overflow checking instruction for the addition that could throw an exception that would cause the StreamReader not to be disposed.</span></span>

<span data-ttu-id="55a8a-164">Bunu yapmak için, projenizdeki Visual Basic derleyicisinden taşma denetimleri yaymayı devre dışı bırakabilir veya kodunuzu aşağıdaki CreateReader2 işlevinde olarak değiştirebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="55a8a-164">To fix this, you can disable the emitting of overflow checks by the Visual Basic compiler in your project or you can modify your code as in the following CreateReader2 function.</span></span>

<span data-ttu-id="55a8a-165">Taşma denetimlerinin yayışını devre dışı bırakmak için Çözüm Gezgini ' de proje adına sağ tıklayın ve ardından **Özellikler**' e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="55a8a-165">To disable the emitting of overflow checks, right-click the project name in Solution Explorer and then click **Properties**.</span></span> <span data-ttu-id="55a8a-166">**Derle**' ye tıklayın, **Gelişmiş derleme seçenekleri**' ne tıklayın ve ardından **tamsayı taşma denetimlerini kaldır**' ı işaretleyin.</span><span class="sxs-lookup"><span data-stu-id="55a8a-166">Click **Compile**, click **Advanced Compile Options**, and then check **Remove integer overflow checks**.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca2000-dispose-objects-before-losing-scope-vboverflow_1.vb":::

## <a name="see-also"></a><span data-ttu-id="55a8a-167">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="55a8a-167">See also</span></span>

- <xref:System.IDisposable>
- [<span data-ttu-id="55a8a-168">Dispose Deseni</span><span class="sxs-lookup"><span data-stu-id="55a8a-168">Dispose Pattern</span></span>](../../../standard/garbage-collection/implementing-dispose.md)
