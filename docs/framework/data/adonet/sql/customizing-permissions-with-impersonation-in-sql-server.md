---
title: SQL Server'da Kimliğe Bürünme İzinlerini Özelleştirme
ms.date: 03/30/2017
ms.assetid: dc733d09-1d6d-4af0-9c4b-8d24504860f1
ms.openlocfilehash: 84c5585912ba259fdcefaae186138c4466b16206
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91180861"
---
# <a name="customizing-permissions-with-impersonation-in-sql-server"></a><span data-ttu-id="80cdd-102">SQL Server'da Kimliğe Bürünme İzinlerini Özelleştirme</span><span class="sxs-lookup"><span data-stu-id="80cdd-102">Customizing Permissions with Impersonation in SQL Server</span></span>

<span data-ttu-id="80cdd-103">Birçok uygulama, temel tablolara erişimi kısıtlamak için sahiplik zincirlemeye bağlı olarak verilere erişmek için saklı yordamlar kullanır.</span><span class="sxs-lookup"><span data-stu-id="80cdd-103">Many applications use stored procedures to access data, relying on ownership chaining to restrict access to base tables.</span></span> <span data-ttu-id="80cdd-104">Saklı yordamlar üzerinde yürütme izinleri verebilir, temel tablolarda izinleri iptal edebilir veya reddetmiş olursunuz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-104">You can grant EXECUTE permissions on stored procedures, revoking or denying permissions on the base tables.</span></span> <span data-ttu-id="80cdd-105">SQL Server, saklı yordam ve tablolar aynı sahibe sahip ise çağıranın izinlerini denetlemez.</span><span class="sxs-lookup"><span data-stu-id="80cdd-105">SQL Server does not check the permissions of the caller if the stored procedure and tables have the same owner.</span></span> <span data-ttu-id="80cdd-106">Ancak, nesnelerin farklı sahipleri varsa veya dinamik SQL söz konusu olduğunda sahiplik zincirleme çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-106">However, ownership chaining doesn't work if objects have different owners or in the case of dynamic SQL.</span></span>  
  
 <span data-ttu-id="80cdd-107">Çağıran tarafından başvurulan veritabanı nesnelerinde izin olmadığında, bir saklı yordamda EXECUTE AS yan tümcesini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-107">You can use the EXECUTE AS clause in a stored procedure when the caller doesn't have permissions on the referenced database objects.</span></span> <span data-ttu-id="80cdd-108">EXECUTE AS yan tümcesinin etkisi, yürütme bağlamının proxy kullanıcısına geçiş yapıdır.</span><span class="sxs-lookup"><span data-stu-id="80cdd-108">The effect of the EXECUTE AS clause is that the execution context is switched to the proxy user.</span></span> <span data-ttu-id="80cdd-109">Tüm kodun yanı sıra iç içe geçmiş saklı yordamlara veya tetikleyicilere yapılan çağrılar, proxy kullanıcısının güvenlik bağlamı altında yürütülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-109">All code, as well as any calls to nested stored procedures or triggers, executes under the security context of the proxy user.</span></span> <span data-ttu-id="80cdd-110">Yürütme bağlamı, yalnızca yordamın yürütülmesinden sonra veya bir GERI alma yöntemi verildiğinde özgün çağırana döndürülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-110">Execution context is reverted to the original caller only after execution of the procedure or when a REVERT statement is issued.</span></span>  
  
## <a name="context-switching-with-the-execute-as-statement"></a><span data-ttu-id="80cdd-111">EXECUTE AS Ifadesiyle bağlam değiştirme</span><span class="sxs-lookup"><span data-stu-id="80cdd-111">Context Switching with the EXECUTE AS Statement</span></span>  

 <span data-ttu-id="80cdd-112">Transact-SQL EXECUTE AS deyimleri, başka bir oturum veya veritabanı kullanıcısını taklit ederek bir deyimin Yürütme bağlamını değiştirmenize olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="80cdd-112">The Transact-SQL EXECUTE AS statement allows you to switch the execution context of a statement by impersonating another login or database user.</span></span> <span data-ttu-id="80cdd-113">Bu, sorguları ve yordamları başka bir kullanıcı olarak test etmek için kullanışlı bir tekniktir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-113">This is a useful technique for testing queries and procedures as another user.</span></span>  
  
```sql  
EXECUTE AS LOGIN = 'loginName';  
EXECUTE AS USER = 'userName';  
```  
  
 <span data-ttu-id="80cdd-114">Kimliğe bürünme izniniz olan oturum açma veya Kullanıcı üzerinde KIMLIĞE bürünme izinlerine sahip olmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-114">You must have IMPERSONATE permissions on the login or user you are impersonating.</span></span> <span data-ttu-id="80cdd-115">Bu izin, `sysadmin` `db_owner` sahip oldukları veritabanlarında tüm veritabanları ve rol üyeleri için kapsanır.</span><span class="sxs-lookup"><span data-stu-id="80cdd-115">This permission is implied for `sysadmin` for all databases, and `db_owner` role members in databases that they own.</span></span>  
  
## <a name="granting-permissions-with-the-execute-as-clause"></a><span data-ttu-id="80cdd-116">EXECUTE AS yan tümcesiyle Izinleri verme</span><span class="sxs-lookup"><span data-stu-id="80cdd-116">Granting Permissions with the EXECUTE AS Clause</span></span>  

 <span data-ttu-id="80cdd-117">Bir saklı yordamın, tetikleyicinin veya Kullanıcı tanımlı işlevin (satır içi tablo değerli işlevler hariç) tanım üstbilgisinde EXECUTE AS yan tümcesini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-117">You can use the EXECUTE AS clause in the definition header of a stored procedure, trigger, or user-defined function (except for inline table-valued functions).</span></span> <span data-ttu-id="80cdd-118">Bu, yordamın EXECUTE AS yan tümcesinde belirtilen Kullanıcı adı veya anahtar sözcüğü bağlamında yürütülmesine neden olur.</span><span class="sxs-lookup"><span data-stu-id="80cdd-118">This causes the procedure to execute in the context of the user name or keyword specified in the EXECUTE AS clause.</span></span> <span data-ttu-id="80cdd-119">Veritabanında bir oturum açmayla eşlenmemiş bir ara sunucu oluşturabilir ve yalnızca yordam tarafından erişilen nesneler üzerinde gerekli izinleri verebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-119">You can create a proxy user in the database that is not mapped to a login, granting it only the necessary permissions on the objects accessed by the procedure.</span></span> <span data-ttu-id="80cdd-120">Yalnızca EXECUTE AS yan tümcesinde belirtilen ara sunucu kullanıcısının, modülün eriştiği tüm nesneler üzerinde izinleri olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="80cdd-120">Only the proxy user specified in the EXECUTE AS clause must have permissions on all objects accessed by the module.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="80cdd-121">TRUNCATE TABLE gibi bazı eylemlerin tablo izinleri yoktur.</span><span class="sxs-lookup"><span data-stu-id="80cdd-121">Some actions, such as TRUNCATE TABLE, do not have grantable permissions.</span></span> <span data-ttu-id="80cdd-122">Deyimini bir yordam içine ekleyerek ve ALTER TABLE izinlerine sahip bir proxy Kullanıcı belirterek, yordamı yalnızca yordamda yürütme izinleri olan çağıranlar için kesme izinlerini genişletebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-122">By incorporating the statement within a procedure and specifying a proxy user who has ALTER TABLE permissions, you can extend the permissions to truncate the table to callers who have only EXECUTE permissions on the procedure.</span></span>  
  
 <span data-ttu-id="80cdd-123">EXECUTE AS yan tümcesinde belirtilen bağlam, iç içe geçmiş yordamlar ve Tetikleyiciler dahil olmak üzere yordamın süresi için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-123">The context specified in the EXECUTE AS clause is valid for the duration of the procedure, including nested procedures and triggers.</span></span> <span data-ttu-id="80cdd-124">Yürütme tamamlandığında veya GERI alma açıklaması verildiğinde bağlam çağırana döner.</span><span class="sxs-lookup"><span data-stu-id="80cdd-124">Context reverts to the caller when execution is complete or the REVERT statement is issued.</span></span>  
  
 <span data-ttu-id="80cdd-125">Bir yordamda EXECUTE AS yan tümcesini kullanmanın üç adımı vardır.</span><span class="sxs-lookup"><span data-stu-id="80cdd-125">There are three steps involved in using the EXECUTE AS clause in a procedure.</span></span>  
  
1. <span data-ttu-id="80cdd-126">Veritabanında bir oturum açma ile eşlenmeyen bir proxy kullanıcı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="80cdd-126">Create a proxy user in the database that is not mapped to a login.</span></span> <span data-ttu-id="80cdd-127">Bu gerekli değildir, ancak izinleri yönetirken yardımcı olur.</span><span class="sxs-lookup"><span data-stu-id="80cdd-127">This is not required, but it helps when managing permissions.</span></span>  
  
```sql
CREATE USER proxyUser WITHOUT LOGIN  
```  
  
1. <span data-ttu-id="80cdd-128">Proxy kullanıcısına gerekli izinleri verin.</span><span class="sxs-lookup"><span data-stu-id="80cdd-128">Grant the proxy user the necessary permissions.</span></span>  
  
2. <span data-ttu-id="80cdd-129">EXECUTE AS yan tümcesini saklı yordama veya Kullanıcı tanımlı işleve ekleyin.</span><span class="sxs-lookup"><span data-stu-id="80cdd-129">Add the EXECUTE AS clause to the stored procedure or user-defined function.</span></span>  
  
```sql
CREATE PROCEDURE [procName] WITH EXECUTE AS 'proxyUser' AS ...  
```  
  
> [!NOTE]
> <span data-ttu-id="80cdd-130">Çağıranın orijinal güvenlik bağlamı korunmadığı için denetim gerektiren uygulamalar kesilebilir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-130">Applications that require auditing can break because the original security context of the caller is not retained.</span></span> <span data-ttu-id="80cdd-131">SESSION_USER, Kullanıcı veya USER_NAME gibi geçerli kullanıcının kimliğini döndüren yerleşik işlevler, özgün çağıranı değil, EXECUTE AS yan tümcesiyle ilişkili kullanıcıyı döndürür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-131">Built-in functions that return the identity of the current user, such as SESSION_USER, USER, or USER_NAME, return the user associated with the EXECUTE AS clause, not the original caller.</span></span>  
  
### <a name="using-execute-as-with-revert"></a><span data-ttu-id="80cdd-132">KAPANıRKEN farklı ÇALıŞTıR kullanma</span><span class="sxs-lookup"><span data-stu-id="80cdd-132">Using EXECUTE AS with REVERT</span></span>  

 <span data-ttu-id="80cdd-133">Özgün yürütme bağlamına dönmek için Transact-SQL DÖNDÜRÜLÜYOR ifadesini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-133">You can use the Transact-SQL REVERT statement to revert to the original execution context.</span></span>  
  
 <span data-ttu-id="80cdd-134">GERI dönüş tanımlama bilgisi olmadan isteğe bağlı yan tümce, @variableName @variableName değişken doğru değeri içeriyorsa, yürütme bağlamını çağırana GERI anahtarla değiştirmenize izin verir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-134">The optional clause, WITH NO REVERT COOKIE = @variableName, allows you switch the execution context back to the caller if the @variableName variable contains the correct value.</span></span> <span data-ttu-id="80cdd-135">Bu, yürütme bağlamını, bağlantı havuzunun kullanıldığı ortamlarda arayan tarafa geri yüklemenize olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="80cdd-135">This allows you to switch the execution context back to the caller in environments where connection pooling is used.</span></span> <span data-ttu-id="80cdd-136">Değeri @variableName yalnızca execute as deyimlerinin çağıranı olarak bilindiğinden, çağıran, yürütme bağlamının uygulamayı çağıran Son Kullanıcı tarafından değiştirilemeyeceğini garanti edebilir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-136">Because the value of @variableName is known only to the caller of the EXECUTE AS statement, the caller can guarantee that the execution context cannot be changed by the end user that invokes the application.</span></span> <span data-ttu-id="80cdd-137">Bağlantı kapatıldığında, havuza döndürülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-137">When the connection is closed, it is returned to the pool.</span></span> <span data-ttu-id="80cdd-138">ADO.NET içinde bağlantı havuzu oluşturma hakkında daha fazla bilgi için bkz. [SQL Server bağlantı havuzu (ADO.net)](../sql-server-connection-pooling.md).</span><span class="sxs-lookup"><span data-stu-id="80cdd-138">For more information on connection pooling in ADO.NET, see [SQL Server Connection Pooling (ADO.NET)](../sql-server-connection-pooling.md).</span></span>  
  
### <a name="specifying-the-execution-context"></a><span data-ttu-id="80cdd-139">Yürütme bağlamını belirtme</span><span class="sxs-lookup"><span data-stu-id="80cdd-139">Specifying the Execution Context</span></span>  

 <span data-ttu-id="80cdd-140">Bir Kullanıcı belirtmenin yanı sıra, aşağıdaki anahtar kelimelerle de ÇALıŞTıR ' ı da kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-140">In addition to specifying a user, you can also use EXECUTE AS with any of the following keywords.</span></span>  
  
- <span data-ttu-id="80cdd-141">Yapana.</span><span class="sxs-lookup"><span data-stu-id="80cdd-141">CALLER.</span></span> <span data-ttu-id="80cdd-142">ÇAĞıRAN olarak yürütme varsayılandır; başka bir seçenek belirtilmemişse, yordam çağıranın güvenlik bağlamında yürütülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-142">Executing as CALLER is the default; if no other option is specified, then the procedure executes in the security context of the caller.</span></span>  
  
- <span data-ttu-id="80cdd-143">İnde.</span><span class="sxs-lookup"><span data-stu-id="80cdd-143">OWNER.</span></span> <span data-ttu-id="80cdd-144">SAHIP olarak yürütülerek işlem, yordam sahibi bağlamında yürütülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-144">Executing as OWNER executes the procedure in the context of the procedure owner.</span></span> <span data-ttu-id="80cdd-145">Yordam veya veritabanı sahibine ait bir şemada oluşturulduysa `dbo` , yordam Kısıtlanmamış izinlerle yürütülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-145">If the procedure is created in a schema owned by `dbo` or the database owner, the procedure will execute with unrestricted permissions.</span></span>  
  
- <span data-ttu-id="80cdd-146">Self.</span><span class="sxs-lookup"><span data-stu-id="80cdd-146">SELF.</span></span> <span data-ttu-id="80cdd-147">, Saklı yordamın oluşturanın güvenlik bağlamında kendi kendine yürütme olarak yürütülür.</span><span class="sxs-lookup"><span data-stu-id="80cdd-147">Executing as SELF executes in the security context of the creator of the stored procedure.</span></span> <span data-ttu-id="80cdd-148">Bu, belirli bir kullanıcı olarak yürütülene eşdeğerdir; burada belirtilen kullanıcı, yordamı oluşturan veya değiştiren bir kişidir.</span><span class="sxs-lookup"><span data-stu-id="80cdd-148">This is equivalent to executing as a specified user, where the specified user is the person creating or altering the procedure.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="80cdd-149">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="80cdd-149">See also</span></span>

- [<span data-ttu-id="80cdd-150">ADO.NET Uygulamalarının Güvenliğini Sağlama</span><span class="sxs-lookup"><span data-stu-id="80cdd-150">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="80cdd-151">SQL Server Güvenliğine Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="80cdd-151">Overview of SQL Server Security</span></span>](overview-of-sql-server-security.md)
- [<span data-ttu-id="80cdd-152">SQL Server'da Uygulama Güvenliği Senaryoları</span><span class="sxs-lookup"><span data-stu-id="80cdd-152">Application Security Scenarios in SQL Server</span></span>](application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="80cdd-153">SQL Server'da Saklı Yordam İzinlerini Yönetme</span><span class="sxs-lookup"><span data-stu-id="80cdd-153">Managing Permissions with Stored Procedures in SQL Server</span></span>](managing-permissions-with-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="80cdd-154">SQL Server’da Secure Dynamic SQL Yazma</span><span class="sxs-lookup"><span data-stu-id="80cdd-154">Writing Secure Dynamic SQL in SQL Server</span></span>](writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="80cdd-155">SQL Server'da Saklı Yordam İmzalama</span><span class="sxs-lookup"><span data-stu-id="80cdd-155">Signing Stored Procedures in SQL Server</span></span>](signing-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="80cdd-156">Saklı Yordamlarla Verileri Değiştirme</span><span class="sxs-lookup"><span data-stu-id="80cdd-156">Modifying Data with Stored Procedures</span></span>](../modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="80cdd-157">ADO.NET’e Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="80cdd-157">ADO.NET Overview</span></span>](../ado-net-overview.md)
