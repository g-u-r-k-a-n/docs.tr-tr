---
description: "Hakkında daha fazla bilgi edinin: sürüm 3,5 SP1 'de HttpWebRequest için NTLM kimlik doğrulamasında yapılan değişiklikler"
title: Sürüm 3.5 SP1’de HttpWebRequest için NTLM kimlik doğrulamasındaki değişiklikler
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: cdb17317dbafc167cce7a9b2785be68a35d3bd5b
ms.sourcegitcommit: ddf7edb67715a5b9a45e3dd44536dabc153c1de0
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/06/2021
ms.locfileid: "99791640"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="5e1cf-103">Sürüm 3.5 SP1’de HttpWebRequest için NTLM kimlik doğrulamasındaki değişiklikler</span><span class="sxs-lookup"><span data-stu-id="5e1cf-103">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>

<span data-ttu-id="5e1cf-104">.NET Framework sürüm 3,5 SP1 ve üzeri sürümlerde, tümleşik Windows kimlik doğrulamasının,,, <xref:System.Net.HttpWebRequest> <xref:System.Net.HttpListener> <xref:System.Net.Security.NegotiateStream> ve System.net ad alanındaki ilgili sınıfların işlenme biçimini etkileyen güvenlik değişiklikleri yapılmıştır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-104">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="5e1cf-105">Bu değişiklikler, Web istekleri yapmak ve NTLM tabanlı tümleşik Windows kimlik doğrulaması kullanıldığında yanıtları almak için bu sınıfları kullanan uygulamaları etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-105">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="5e1cf-106">Bu değişiklik, tümleşik Windows kimlik doğrulaması kullanmak üzere yapılandırılmış Web sunucularını ve istemci uygulamalarını etkileyebilir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-106">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>

## <a name="overview"></a><span data-ttu-id="5e1cf-107">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="5e1cf-107">Overview</span></span>

<span data-ttu-id="5e1cf-108">Tümleşik Windows kimlik doğrulamasının tasarımı, bazı kimlik bilgileri yanıtlarının evrensel olmasına olanak sağlar, yani yeniden kullanılabilir veya iletilebilirler.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-108">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="5e1cf-109">Bu belirli tasarım özelliği gerekmiyorsa, kimlik doğrulama protokollerinin hedefe özgü bilgilerin yanı sıra kanala özgü bilgileri de taşıması gerekir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-109">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="5e1cf-110">Hizmetler, kimlik bilgileri yanıtlarının hizmet sorumlusu adı (SPN) gibi hizmet özel bilgilerini içermesini sağlamak için genişletilmiş koruma sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-110">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="5e1cf-111">Kimlik bilgisi alışverişlerinde bu bilgiler sayesinde hizmetler, yanlış şekilde alınmış olabilecek kimlik bilgileri yanıtlarının kötü amaçlı kullanımına karşı daha iyi koruma sağlayabiliyor.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-111">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>

<span data-ttu-id="5e1cf-112">Ve ad alanlarında birden çok bileşen, <xref:System.Net> <xref:System.Net.Security> çağıran bir uygulama adına tümleşik Windows kimlik doğrulaması gerçekleştirir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-112">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="5e1cf-113">Bu bölümde, tümleşik Windows kimlik doğrulaması kullanımıyla genişletilmiş koruma eklemek için System.Net bileşenlerinde yapılan değişiklikler açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-113">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>

## <a name="changes"></a><span data-ttu-id="5e1cf-114">Değişiklikler</span><span class="sxs-lookup"><span data-stu-id="5e1cf-114">Changes</span></span>

<span data-ttu-id="5e1cf-115">Tümleşik Windows kimlik doğrulaması ile kullanılan NTLM kimlik doğrulama işlemi, hedef bilgisayar tarafından verilen bir sınama içerir ve istemci bilgisayara geri gönderilir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-115">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="5e1cf-116">Bir bilgisayar kendi kendine oluşturduğu bir zorluk aldığında, bağlantı bir geri döngü bağlantısı (örneğin, IPv4 adresi 127.0.0.1) olmadığı takdirde kimlik doğrulaması başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-116">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>

<span data-ttu-id="5e1cf-117">İç Web sunucusunda çalışan bir hizmete erişirken, veya gibi bir URL kullanarak hizmete erişmek yaygındır `http://contoso/service` `https://contoso/service` .</span><span class="sxs-lookup"><span data-stu-id="5e1cf-117">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="5e1cf-118">"Contoso" adı, genellikle hizmetin dağıtıldığı bilgisayarın bilgisayar adıdır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-118">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="5e1cf-119"><xref:System.Net>Ve ile ilgili ad alanları, adları adreslere çözümlemek için Active Directory, DNS, NetBIOS, yerel bilgisayarın Hosts dosyasını (genellikle WINDOWS\system32\drivers\etc\hosts) veya yerel bilgisayarın LMHOSTS dosyasını (genellikle WINDOWS\system32\drivers\etc\lmhosts) kullanmayı destekler.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-119">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="5e1cf-120">"Contoso" adı, "contoso" adresine gönderilen isteklerin uygun sunucu bilgisayarına gönderilmesini sağlayacak şekilde çözümlenir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-120">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>

<span data-ttu-id="5e1cf-121">Büyük dağıtımlar için yapılandırıldığında, tek bir sanal sunucu adının, istemci uygulamaları ve son kullanıcılar tarafından hiçbir zaman kullanılmayan temel makine adlarıyla dağıtıma verilmesi de yaygındır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-121">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="5e1cf-122">Örneğin, sunucuyu çağırabilirsiniz `www.contoso.com` , ancak iç ağda "contoso" kullanmanız yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-122">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="5e1cf-123">Bu ad, istemci Web isteğindeki ana bilgisayar üst bilgisi olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-123">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="5e1cf-124">HTTP protokolü tarafından belirtildiği gibi, konak isteği-üstbilgisi alanı, istenen kaynağın Internet ana bilgisayar ve bağlantı noktası numarasını belirtir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-124">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="5e1cf-125">Bu bilgiler, Kullanıcı veya başvurulan kaynak (genellikle bir HTTP URL 'SI) tarafından verilen özgün URI 'den elde edilir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-125">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="5e1cf-126">.NET Framework sürüm 4 ' te bu bilgiler, yeni özelliği kullanılarak istemci tarafından da ayarlanabilir <xref:System.Net.HttpWebRequest.Host%2A> .</span><span class="sxs-lookup"><span data-stu-id="5e1cf-126">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>

<span data-ttu-id="5e1cf-127"><xref:System.Net.AuthenticationManager>Sınıfı, <xref:System.Net.WebRequest> türetilmiş sınıflar ve sınıf tarafından kullanılan yönetilen kimlik doğrulama bileşenlerini ("modüller") denetler <xref:System.Net.WebClient> .</span><span class="sxs-lookup"><span data-stu-id="5e1cf-127">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="5e1cf-128"><xref:System.Net.AuthenticationManager>Sınıfı, <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> uygulamanın kimlik doğrulaması sırasında kullanılmak üzere özel bir SPN dizesi SAĞLAMASı için URI dizesi tarafından dizine alınmış bir nesne sunan bir özellik sağlar.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-128">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>

<span data-ttu-id="5e1cf-129">Sürüm 3,5 SP1 artık varsayılan olarak, özellik ayarlanmamışsa NTLM (NT LAN Manager) kimlik doğrulaması alışverişi içindeki SPN 'deki istek URL 'sinde kullanılan ana bilgisayar adını <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> belirtmektir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-129">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="5e1cf-130">İstek URL 'sinde kullanılan ana bilgisayar adı, istemci isteğinde ' de belirtilen konak üstbilgisinden farklı olabilir <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="5e1cf-130">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="5e1cf-131">İstek URL 'sinde kullanılan ana bilgisayar adı, sunucunun gerçek ana bilgisayar adından, sunucunun makine adına, bilgisayarın IP adresine veya geri döngü adresine göre farklılık gösterebilir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-131">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="5e1cf-132">Bu durumlarda, Windows kimlik doğrulama isteği başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-132">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="5e1cf-133">Sorunu gidermek için, Windows 'u istemci isteğindeki istek URL 'sinde kullanılan ana bilgisayar adının (örneğin, "contoso") yerel bilgisayar için alternatif bir ad olduğunu bildirmemiz gerekir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-133">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>

<span data-ttu-id="5e1cf-134">Sunucu uygulamasının bu değişikliği geçici olarak çözmek için birkaç olası yöntem vardır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-134">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="5e1cf-135">Önerilen yaklaşım, istek URL 'sinde kullanılan ana bilgisayar adının `BackConnectionHostNames` sunucudaki kayıt defterindeki anahtarla eşlenmeidir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-135">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="5e1cf-136">`BackConnectionHostNames`Kayıt defteri anahtarı normalde bir ana bilgisayar adını bir geri döngü adresiyle eşlemek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-136">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="5e1cf-137">Adımlar aşağıda listelenmiştir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-137">The steps are listed below.</span></span>

<span data-ttu-id="5e1cf-138">Geri döngü adresiyle eşlenen ana bilgisayar adlarını belirtmek ve yerel bir bilgisayardaki Web sitelerine bağlanmak için şu adımları izleyin:</span><span class="sxs-lookup"><span data-stu-id="5e1cf-138">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>

1. <span data-ttu-id="5e1cf-139">Başlat ' a, Çalıştır ' a tıklayın, regedit yazın ve ardından Tamam ' a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-139">Click Start, click Run, type regedit, and then click OK.</span></span>

2. <span data-ttu-id="5e1cf-140">Kayıt Defteri Düzenleyicisi 'nde, aşağıdaki kayıt defteri anahtarını bulun ve tıklayın:</span><span class="sxs-lookup"><span data-stu-id="5e1cf-140">In Registry Editor, locate and then click the following registry key:</span></span>

    `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`

3. <span data-ttu-id="5e1cf-141">MSV1_0 öğesine sağ tıklayın, yeni ' nin üzerine gelin ve ardından çok dizeli değer ' e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-141">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>

4. <span data-ttu-id="5e1cf-142">`BackConnectionHostNames` yazın ve sonra ENTER tuşuna basın.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-142">Type `BackConnectionHostNames`, and then press ENTER.</span></span>

5. <span data-ttu-id="5e1cf-143">Sağ tıklayın `BackConnectionHostNames` ve ardından Değiştir ' e tıklayın.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-143">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>

6. <span data-ttu-id="5e1cf-144">Değer verileri kutusuna, yerel bilgisayardaki siteler (istek URL 'sinde kullanılan ana bilgisayar adı) için ana bilgisayar adını veya ana bilgisayar adlarını yazın ve ardından Tamam ' a tıklayın.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-144">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>

7. <span data-ttu-id="5e1cf-145">Kayıt defteri düzenleyicisinden çıkın ve sonra IISADMIN hizmetini yeniden başlatın ve IISRESET komutunu çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-145">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>

<span data-ttu-id="5e1cf-146">Daha az güvenli bir iş, bölümünde açıklandığı gibi geri döngü denetimini devre dışı bırakmamaktadır <https://support.microsoft.com/kb/896861> .</span><span class="sxs-lookup"><span data-stu-id="5e1cf-146">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="5e1cf-147">Bu, yansıma saldırılarına karşı korumayı devre dışı bırakır.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-147">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="5e1cf-148">Bu nedenle, alternatif adlar kümesini yalnızca makinenin gerçekten kullanmasını beklediğinizi kısıtlamak daha iyidir.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-148">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>

## <a name="see-also"></a><span data-ttu-id="5e1cf-149">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="5e1cf-149">See also</span></span>

- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
