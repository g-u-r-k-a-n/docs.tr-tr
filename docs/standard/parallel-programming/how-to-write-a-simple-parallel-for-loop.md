---
title: 'Nasıl yapılır: Basit bir Parallel.For Döngüsü Yazma'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Parallel.For, How to Write
- for loop, parallel construction in .NET
- parallel for loops, how to use
ms.assetid: 9029ba7f-a9d1-4526-8c84-c88716dba5d4
ms.openlocfilehash: 78f07a4f0118c6bce7a043f111988281ddd6add0
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/15/2020
ms.locfileid: "73139663"
---
# <a name="how-to-write-a-simple-parallelfor-loop"></a><span data-ttu-id="0eb0f-102">Nasıl yapılır: Basit bir Parallel.For Döngüsü Yazma</span><span class="sxs-lookup"><span data-stu-id="0eb0f-102">How to: Write a Simple Parallel.For Loop</span></span>

<span data-ttu-id="0eb0f-103">Bu konu <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> yöntemi gösteren iki örnek içerir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-103">This topic contains two examples that illustrate the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="0eb0f-104">İlk <xref:System.Threading.Tasks.Parallel.For%28System.Int64%2CSystem.Int64%2CSystem.Action%7BSystem.Int64%7D%29?displayProperty=nameWithType> yöntem aşırı yükleme kullanır ve ikinci <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Action%7BSystem.Int32%7D%29?displayProperty=nameWithType> aşırı yükleme kullanır, <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> yöntemin en basit iki aşırı yükleri.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-104">The first uses the <xref:System.Threading.Tasks.Parallel.For%28System.Int64%2CSystem.Int64%2CSystem.Action%7BSystem.Int64%7D%29?displayProperty=nameWithType> method overload, and the second uses the <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Action%7BSystem.Int32%7D%29?displayProperty=nameWithType> overload, the two simplest overloads of the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="0eb0f-105">Döngüyü iptal etme, döngü <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> yinelemelerini koparmanız veya iş parçacığı yerel durumunu korumanız gerekmediğinde bu iki yöntemin aşırı yükünü kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-105">You can use these two overloads of the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method when you do not need to cancel the loop, break out of the loop iterations, or maintain any thread-local state.</span></span>

> [!NOTE]
> <span data-ttu-id="0eb0f-106">TPL'de temsilciler tanımlamak için bu belgede lambda ifadeleri kullanılır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-106">This documentation uses lambda expressions to define delegates in TPL.</span></span> <span data-ttu-id="0eb0f-107">C# veya Visual Basic'teki lambda ifadelerine aşina değilseniz, [PLINQ ve TPL'deki Lambda İfadeleri'ne](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-107">If you are not familiar with lambda expressions in C# or Visual Basic, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>

<span data-ttu-id="0eb0f-108">İlk örnek, tek bir dizindeki dosyaların boyutunu hesaplar.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-108">The first example calculates the size of files in a single directory.</span></span> <span data-ttu-id="0eb0f-109">İkinci iki matrisin ürünlerini hesaplar.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-109">The second computes the product of two matrices.</span></span>

## <a name="directory-size-example"></a><span data-ttu-id="0eb0f-110">Dizin boyutu örneği</span><span class="sxs-lookup"><span data-stu-id="0eb0f-110">Directory size example</span></span>

<span data-ttu-id="0eb0f-111">Bu örnek, bir dizindeki dosyaların toplam boyutunu hesaplayan basit bir komut satırı yardımcı programıdır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-111">This example is a simple command-line utility that calculates the total size of files in a directory.</span></span> <span data-ttu-id="0eb0f-112">Bağımsız değişken olarak tek bir dizin yolu bekler ve bu dizindeki dosyaların sayısını ve toplam boyutunu bildirir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-112">It expects a single directory path as an argument, and reports the number and total size of the files in that directory.</span></span> <span data-ttu-id="0eb0f-113">Dizinin var olduğunu doğruladıktan sonra, <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> dizindeki dosyaları numaralandırmak ve dosya boyutlarını belirlemek için yöntemi kullanır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-113">After verifying that the directory exists, it uses the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method to enumerate the files in the directory and determine their file sizes.</span></span> <span data-ttu-id="0eb0f-114">Her dosya boyutu daha `totalSize` sonra değişkene eklenir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-114">Each file size is then added to the `totalSize` variable.</span></span> <span data-ttu-id="0eb0f-115">Ekleme nin atomik bir işlem <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> olarak gerçekleştirilebilmeleri için çağrılar ekleyerek gerçekleştirildiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-115">Note that the addition is performed by calling the <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> so that the addition is performed as an atomic operation.</span></span> <span data-ttu-id="0eb0f-116">Aksi takdirde, birden çok `totalSize` görev değişkeni aynı anda güncelleştirmeyi deneyebilir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-116">Otherwise, multiple tasks could try to update the `totalSize` variable simultaneously.</span></span>

[!code-csharp[Conceptual.Parallel.For#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.parallel.for/cs/for1.cs#1)]
[!code-vb[Conceptual.Parallel.For#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.parallel.for/vb/for1.vb#1)]

## <a name="matrix-and-stopwatch-example"></a><span data-ttu-id="0eb0f-117">Matris ve kronometre örneği</span><span class="sxs-lookup"><span data-stu-id="0eb0f-117">Matrix and stopwatch example</span></span>

<span data-ttu-id="0eb0f-118">Bu örnek, <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> iki matrisin ürünlerini hesaplamak için yöntemi kullanır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-118">This example uses the <xref:System.Threading.Tasks.Parallel.For%2A?displayProperty=nameWithType> method to compute the product of two matrices.</span></span> <span data-ttu-id="0eb0f-119">Ayrıca, paralel döngünün <xref:System.Diagnostics.Stopwatch?displayProperty=nameWithType> performansını paralel olmayan bir döngüyle karşılaştırmak için sınıfın nasıl kullanılacağını da gösterir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-119">It also shows how to use the <xref:System.Diagnostics.Stopwatch?displayProperty=nameWithType> class to compare the performance of a parallel loop with a non-parallel loop.</span></span> <span data-ttu-id="0eb0f-120">Büyük miktarda çıktı oluşturabildiği için, örneğin çıktının bir dosyaya yönlendirilmesine izin verdiğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-120">Note that, because it can generate a large volume of output, the example allows output to be redirected to a file.</span></span>

[!code-csharp[TPL_Parallel#01](../../../samples/snippets/csharp/VS_Snippets_Misc/tpl_parallel/cs/simpleparallelfor.cs#01)]
[!code-vb[TPL_Parallel#01](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpl_parallel/vb/simpleparallelfor.vb#01)]

<span data-ttu-id="0eb0f-121">Döngüler de dahil olmak üzere herhangi bir kodu paralelleştirirken, önemli bir amaç, paralel işleme için ek yükün herhangi bir performans avantajını yok ettiği noktaya paralelleme yapmadan işlemcileri mümkün olduğunca kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-121">When parallelizing any code, including loops, one important goal is to utilize the processors as much as possible without over parallelizing to the point where the overhead for parallel processing negates any performance benefits.</span></span> <span data-ttu-id="0eb0f-122">Bu özel örnekte, iç döngüde çok fazla çalışma yapılmadığından, yalnızca dış döngü paralelleştirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-122">In this particular example, only the outer loop is parallelized because there is not very much work performed in the inner loop.</span></span> <span data-ttu-id="0eb0f-123">Az miktarda çalışma ve istenmeyen önbellek efektlerinin birleşimi iç içe paralel döngülerde performans düşüşüne neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-123">The combination of a small amount of work and undesirable cache effects can result in performance degradation in nested parallel loops.</span></span> <span data-ttu-id="0eb0f-124">Bu nedenle, dış döngüyü yalnızca paralelleştirmek, çoğu sistemde eşzamanlılık faydalarını en üst düzeye çıkarmanın en iyi yoludur.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-124">Therefore, parallelizing the outer loop only is the best way to maximize the benefits of concurrency on most systems.</span></span>

## <a name="the-delegate"></a><span data-ttu-id="0eb0f-125">Temsilci</span><span class="sxs-lookup"><span data-stu-id="0eb0f-125">The Delegate</span></span>

<span data-ttu-id="0eb0f-126">Bu aşırı yükün <xref:System.Threading.Tasks.Parallel.For%2A> üçüncü parametresi C# veya `Action<int>` `Action(Of Integer)` Visual Basic'te bir tür temsilcisidir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-126">The third parameter of this overload of <xref:System.Threading.Tasks.Parallel.For%2A> is a delegate of type `Action<int>` in C# or `Action(Of Integer)` in Visual Basic.</span></span> <span data-ttu-id="0eb0f-127">Bir `Action` temsilci, ister sıfır, ister bir veya on altı tür parametreye sahip olsun, her zaman geçersiz olarak döndürür.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-127">An `Action` delegate, whether it has zero, one or sixteen type parameters, always returns void.</span></span> <span data-ttu-id="0eb0f-128">Visual Basic'te, bir `Action` davranışı bir `Sub`. ile tanımlanır</span><span class="sxs-lookup"><span data-stu-id="0eb0f-128">In Visual Basic, the behavior of an `Action` is defined with a `Sub`.</span></span> <span data-ttu-id="0eb0f-129">Örnek, temsilciyi oluşturmak için bir lambda ifadesi kullanır, ancak temsilciyi başka şekillerde de oluşturabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-129">The example uses a lambda expression to create the delegate, but you can create the delegate in other ways as well.</span></span> <span data-ttu-id="0eb0f-130">Daha fazla bilgi için [PLINQ ve TPL'deki Lambda İfadeleri'ne](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-130">For more information, see [Lambda Expressions in PLINQ and TPL](../../../docs/standard/parallel-programming/lambda-expressions-in-plinq-and-tpl.md).</span></span>

## <a name="the-iteration-value"></a><span data-ttu-id="0eb0f-131">Yineleme Değeri</span><span class="sxs-lookup"><span data-stu-id="0eb0f-131">The Iteration Value</span></span>

<span data-ttu-id="0eb0f-132">Temsilci, değeri geçerli yineleme olan tek bir giriş parametresini alır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-132">The delegate takes a single input parameter whose value is the current iteration.</span></span> <span data-ttu-id="0eb0f-133">Bu yineleme değeri çalışma zamanı tarafından sağlanır ve başlangıç değeri, geçerli iş parçacığı üzerinde işlenen kaynağın segmentindeki (bölüm) ilk öğenin dizinidir.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-133">This iteration value is supplied by the runtime and its starting value is the index of the first element on the segment (partition) of the source that is being processed on the current thread.</span></span>

<span data-ttu-id="0eb0f-134">Eşzamanlılık düzeyi üzerinde daha fazla denetime ihtiyaç duyuyorsanız, <xref:System.Threading.Tasks.ParallelOptions?displayProperty=nameWithType> aşağıdakiler gibi bir giriş <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Threading.Tasks.ParallelOptions%2CSystem.Action%7BSystem.Int32%2CSystem.Threading.Tasks.ParallelLoopState%7D%29?displayProperty=nameWithType>parametresi alan aşırı yüklerden birini kullanın: .</span><span class="sxs-lookup"><span data-stu-id="0eb0f-134">If you require more control over the concurrency level, use one of the overloads that takes a <xref:System.Threading.Tasks.ParallelOptions?displayProperty=nameWithType> input parameter, such as: <xref:System.Threading.Tasks.Parallel.For%28System.Int32%2CSystem.Int32%2CSystem.Threading.Tasks.ParallelOptions%2CSystem.Action%7BSystem.Int32%2CSystem.Threading.Tasks.ParallelLoopState%7D%29?displayProperty=nameWithType>.</span></span>

## <a name="return-value-and-exception-handling"></a><span data-ttu-id="0eb0f-135">İade Değeri ve Özel Durum Taşıma</span><span class="sxs-lookup"><span data-stu-id="0eb0f-135">Return Value and Exception Handling</span></span>

<span data-ttu-id="0eb0f-136"><xref:System.Threading.Tasks.Parallel.For%2A>tüm <xref:System.Threading.Tasks.ParallelLoopResult?displayProperty=nameWithType> iş parçacıkları tamamlandığında bir nesne döndürür.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-136"><xref:System.Threading.Tasks.Parallel.For%2A> returns a <xref:System.Threading.Tasks.ParallelLoopResult?displayProperty=nameWithType> object when all threads have completed.</span></span> <span data-ttu-id="0eb0f-137">Bu iade değeri, döngü yinelemesini el ile durdururken veya <xref:System.Threading.Tasks.ParallelLoopResult> kırarken yararlıdır, çünkü tamamlanmak üzere olan son yineleme gibi bilgileri depolar.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-137">This return value is useful when you are stopping or breaking loop iteration manually, because the <xref:System.Threading.Tasks.ParallelLoopResult> stores information such as the last iteration that ran to completion.</span></span> <span data-ttu-id="0eb0f-138">İş iş parçacığı birinde bir veya daha fazla <xref:System.AggregateException?displayProperty=nameWithType> özel durum oluşursa, bir tane atılır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-138">If one or more exceptions occur on one of the threads, a <xref:System.AggregateException?displayProperty=nameWithType> will be thrown.</span></span>

<span data-ttu-id="0eb0f-139">Bu örnekteki kodda, iade <xref:System.Threading.Tasks.Parallel.For%2A> değeri kullanılmaz.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-139">In the code in this example, the return value of <xref:System.Threading.Tasks.Parallel.For%2A> is not used.</span></span>

## <a name="analysis-and-performance"></a><span data-ttu-id="0eb0f-140">Analiz ve Performans</span><span class="sxs-lookup"><span data-stu-id="0eb0f-140">Analysis and Performance</span></span>

<span data-ttu-id="0eb0f-141">BilgisayarınızdaCPU kullanımını görüntülemek için Performans Sihirbazı'nı kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-141">You can use the Performance Wizard to view CPU usage on your computer.</span></span> <span data-ttu-id="0eb0f-142">Deneme olarak, matrislerde sütun ve satır sayısını artırın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-142">As an experiment, increase the number of columns and rows in the matrices.</span></span> <span data-ttu-id="0eb0f-143">Matrisler ne kadar büyükse, hesaplamanın paralel ve sıralı sürümleri arasındaki performans farkı da o kadar büyük türler.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-143">The larger the matrices, the greater the performance difference between the parallel and sequential versions of the computation.</span></span> <span data-ttu-id="0eb0f-144">Matris küçük olduğunda, paralel döngüyü ayarlamadaki ek yükü nedeniyle sıralı sürüm daha hızlı çalışır.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-144">When the matrix is small, the sequential version will run faster because of the overhead in setting up the parallel loop.</span></span>

<span data-ttu-id="0eb0f-145">Konsol veya Dosya Sistemi gibi paylaşılan kaynaklara yapılan eşzamanlı çağrılar, paralel bir döngünün performansını önemli ölçüde düşürür.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-145">Synchronous calls to shared resources, like the Console or the File System, will significantly degrade the performance of a parallel loop.</span></span> <span data-ttu-id="0eb0f-146">Performansı ölçerken, döngü içindeki <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> gibi çağrılardan kaçınmaya çalışın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-146">When measuring performance, try to avoid calls such as <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> within the loop.</span></span>

## <a name="compile-the-code"></a><span data-ttu-id="0eb0f-147">Kodu Derleme</span><span class="sxs-lookup"><span data-stu-id="0eb0f-147">Compile the Code</span></span>

<span data-ttu-id="0eb0f-148">Bu kodu Visual Studio projesine kopyalayıp yapıştırın.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-148">Copy and paste this code into a Visual Studio project.</span></span>

## <a name="see-also"></a><span data-ttu-id="0eb0f-149">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="0eb0f-149">See also</span></span>

- <xref:System.Threading.Tasks.Parallel.For%2A>
- <xref:System.Threading.Tasks.Parallel.ForEach%2A>
- [<span data-ttu-id="0eb0f-150">Veri Paralelliği</span><span class="sxs-lookup"><span data-stu-id="0eb0f-150">Data Parallelism</span></span>](../../../docs/standard/parallel-programming/data-parallelism-task-parallel-library.md)
- [<span data-ttu-id="0eb0f-151">Paralel Programlama</span><span class="sxs-lookup"><span data-stu-id="0eb0f-151">Parallel Programming</span></span>](../../../docs/standard/parallel-programming/index.md)
