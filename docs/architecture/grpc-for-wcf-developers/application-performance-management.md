---
title: Uygulama performansı yönetimi-WCF geliştiricileri için gRPC
description: ASP.NET Core gRPC uygulamaları için günlüğe kaydetme, ölçümler ve izleme.
ms.date: 12/15/2020
ms.openlocfilehash: 8a2a89e268e3b2dffdcc945ac71b2de85b4d4964
ms.sourcegitcommit: 655f8a16c488567dfa696fc0b293b34d3c81e3df
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 01/06/2021
ms.locfileid: "97938461"
---
# <a name="application-performance-management"></a><span data-ttu-id="9fa44-103">Uygulama Performansı Yönetimi</span><span class="sxs-lookup"><span data-stu-id="9fa44-103">Application Performance Management</span></span>

<span data-ttu-id="9fa44-104">Kubernetes gibi üretim ortamlarında, en iyi şekilde çalıştığından emin olmak için uygulamaları izlemeniz önemlidir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-104">In production environments like Kubernetes, it's important to monitor applications to ensure they're running optimally.</span></span> <span data-ttu-id="9fa44-105">Günlüğe kaydetme ve ölçümler özellikle önemlidir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-105">Logging and metrics are important in particular.</span></span> <span data-ttu-id="9fa44-106">GRPC dahil ASP.NET Core, günlük iletilerinin ve ölçüm verilerinin oluşturulması ve yönetilmesi için yerleşik destek ve verilerin *izlenmesini* sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-106">ASP.NET Core, including gRPC, provides built-in support for producing and managing log messages and metrics data, as well as *tracing* data.</span></span>

## <a name="the-difference-between-logging-and-metrics"></a><span data-ttu-id="9fa44-107">Günlüğe kaydetme ve ölçümler arasındaki fark</span><span class="sxs-lookup"><span data-stu-id="9fa44-107">The difference between logging and metrics</span></span>

<span data-ttu-id="9fa44-108">*Günlüğe kaydetme* , sistemde gerçekleşen şeyler hakkında ayrıntılı bilgileri kaydeden metin iletileriyle ilgilidir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-108">*Logging* is concerned with text messages that record detailed information about things that have happened in the system.</span></span> <span data-ttu-id="9fa44-109">Günlük iletileri, yığın izlemeleri gibi özel durum verilerini veya ileti hakkında bağlam sağlayan yapılandırılmış verileri içerebilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-109">Log messages might include exception data, like stack traces, or structured data that provide context about the message.</span></span> <span data-ttu-id="9fa44-110">Günlüğe kaydetme çıkışı genellikle aranabilir bir metin deposuna yazılır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-110">Logging output is commonly written to a searchable text store.</span></span>

<span data-ttu-id="9fa44-111">*Ölçümler* , kümelenebilir ve bir panodaki grafikler ve grafikler kullanılarak sunulacak şekilde tasarlanan sayısal verileri ifade eder.</span><span class="sxs-lookup"><span data-stu-id="9fa44-111">*Metrics* refers to numeric data designed to be aggregated and presented by using charts and graphs in a dashboard.</span></span> <span data-ttu-id="9fa44-112">Pano, bir uygulamanın genel sistem durumunun ve performansının görünümünü sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-112">The dashboard provides a view of the overall health and performance of an application.</span></span> <span data-ttu-id="9fa44-113">Ölçüm verileri, bir eşik aşıldığında otomatik uyarıları tetiklemek için de kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-113">Metrics data can also be used to trigger automated alerts when a threshold is exceeded.</span></span> <span data-ttu-id="9fa44-114">Ölçüm verilerine ilişkin bazı örnekler aşağıda verilmiştir:</span><span class="sxs-lookup"><span data-stu-id="9fa44-114">Here are some examples of metrics data:</span></span>

- <span data-ttu-id="9fa44-115">İstekleri işlemek için geçen süre.</span><span class="sxs-lookup"><span data-stu-id="9fa44-115">Time taken to process requests.</span></span>
- <span data-ttu-id="9fa44-116">Bir hizmet örneği tarafından işlenen saniye başına istek sayısı.</span><span class="sxs-lookup"><span data-stu-id="9fa44-116">The number of requests per second being handled by an instance of a service.</span></span>
- <span data-ttu-id="9fa44-117">Bir örnekteki başarısız istek sayısı.</span><span class="sxs-lookup"><span data-stu-id="9fa44-117">The number of failed requests on an instance.</span></span>

## <a name="logging-in-aspnet-core-grpc"></a><span data-ttu-id="9fa44-118">ASP.NET Core gRPC 'de oturum açma</span><span class="sxs-lookup"><span data-stu-id="9fa44-118">Logging in ASP.NET Core gRPC</span></span>

<span data-ttu-id="9fa44-119">ASP.NET Core, [Microsoft. Extensions. Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet paketi biçiminde günlük için yerleşik destek sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-119">ASP.NET Core provides built-in support for logging, in the form of [Microsoft.Extensions.Logging](https://www.nuget.org/packages/Microsoft.Extensions.Logging) NuGet package.</span></span> <span data-ttu-id="9fa44-120">Bu kitaplığın temel kısımları Web SDK 'sına dahildir, bu yüzden el ile yüklemeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="9fa44-120">The core parts of this library are included with the Web SDK, so there's no need to install it manually.</span></span> <span data-ttu-id="9fa44-121">Varsayılan olarak, günlük iletileri standart çıktıya ("konsol") ve herhangi bir ekli hata ayıklayıcıya yazılır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-121">By default, log messages are written to the standard output (the "console") and to any attached debugger.</span></span> <span data-ttu-id="9fa44-122">Kalıcı dış veri depolarına Günlükler yazmak için [isteğe bağlı günlük havuzu paketlerini](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers)içeri aktarmanız gerekebilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-122">To write logs to persistent external data stores, you might need to import [optional logging sink packages](/aspnet/core/fundamentals/logging/?view=aspnetcore-3.0#third-party-logging-providers).</span></span>

<span data-ttu-id="9fa44-123">ASP.NET Core gRPC çerçevesi, bu günlüğe kaydetme çerçevesine ayrıntılı tanılama günlüğü iletileri yazar ve bu sayede uygulamanızın kendi iletileriyle birlikte işlenebilirler ve depolanabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-123">The ASP.NET Core gRPC framework writes detailed diagnostic logging messages to this logging framework, so they can be processed and stored along with your application's own messages.</span></span>

### <a name="produce-log-messages"></a><span data-ttu-id="9fa44-124">Günlük iletileri üretme</span><span class="sxs-lookup"><span data-stu-id="9fa44-124">Produce log messages</span></span>

<span data-ttu-id="9fa44-125">Günlüğe kaydetme uzantısı, ASP.NET Core bağımlılık ekleme sistemine otomatik olarak kaydedilir, bu sayede Günlükçüleri gRPC hizmet türlerinde bir oluşturucu parametresi olarak belirtebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9fa44-125">The logging extension is automatically registered with ASP.NET Core's dependency injection system, so you can specify loggers as a constructor parameter on gRPC service types.</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private readonly ILogger<StockData> _logger;

    public StockData(ILogger<StockData> logger)
    {
        _logger = logger;
    }
}
```

<span data-ttu-id="9fa44-126">İstekler ve özel durumlar gibi birçok günlük iletisi ASP.NET Core ve gRPC çerçevesi bileşenleri tarafından sağlanır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-126">Many log messages, such as requests and exceptions, are provided by the ASP.NET Core and gRPC framework components.</span></span> <span data-ttu-id="9fa44-127">Alt düzey sorunlar yerine uygulama mantığı hakkında ayrıntı ve bağlam sağlamak için kendi günlük iletilerinizi ekleyin.</span><span class="sxs-lookup"><span data-stu-id="9fa44-127">Add your own log messages to provide detail and context about application logic, rather than lower-level concerns.</span></span>

<span data-ttu-id="9fa44-128">Günlük iletilerini ve kullanılabilir günlük havuzları ve hedefleri yazma hakkında daha fazla bilgi için bkz.  [.NET Core ve ASP.NET Core oturum açma](/aspnet/core/fundamentals/logging/).</span><span class="sxs-lookup"><span data-stu-id="9fa44-128">For more information about writing log messages and available logging sinks and targets, see  [Logging in .NET Core and ASP.NET Core](/aspnet/core/fundamentals/logging/).</span></span>

## <a name="metrics-in-aspnet-core-grpc"></a><span data-ttu-id="9fa44-129">ASP.NET Core gRPC 'de ölçümler</span><span class="sxs-lookup"><span data-stu-id="9fa44-129">Metrics in ASP.NET Core gRPC</span></span>

<span data-ttu-id="9fa44-130">.NET Core çalışma zamanı, ölçümleri yayma ve gözlemlemek için bir bileşen kümesi sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-130">The .NET Core runtime provides a set of components for emitting and observing metrics.</span></span> <span data-ttu-id="9fa44-131">Bunlar ve sınıfları gibi API 'Leri <xref:System.Diagnostics.Tracing.EventSource> içerir <xref:System.Diagnostics.Tracing.EventCounter> .</span><span class="sxs-lookup"><span data-stu-id="9fa44-131">These include APIs such as the <xref:System.Diagnostics.Tracing.EventSource> and <xref:System.Diagnostics.Tracing.EventCounter> classes.</span></span> <span data-ttu-id="9fa44-132">Bu API 'Ler, dış süreçler tarafından tüketilen, [DotNet sayaçları genel aracı](../../core/diagnostics/dotnet-counters.md)veya Windows Için olay izleme gibi temel sayısal verileri yayabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-132">These APIs can emit basic numeric data that can be consumed by external processes, like the [dotnet-counters global tool](../../core/diagnostics/dotnet-counters.md), or Event Tracing for Windows.</span></span> <span data-ttu-id="9fa44-133">Kendi kodunuzda kullanma hakkında daha fazla bilgi için `EventCounter` bkz. [EventCounter tanıtımı](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span><span class="sxs-lookup"><span data-stu-id="9fa44-133">For more information about using `EventCounter` in your own code, see [EventCounter introduction](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.Tracing/documentation/EventCounterTutorial.md).</span></span>

<span data-ttu-id="9fa44-134">Daha gelişmiş ölçümler ve ölçüm verilerini daha geniş veri depolarına yazmak için, [uygulama ölçümleri](https://www.app-metrics.io)adlı açık kaynaklı bir projeyi deneyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="9fa44-134">For more advanced metrics and for writing metric data to a wider range of data stores, you might try an open-source project called [App Metrics](https://www.app-metrics.io).</span></span> <span data-ttu-id="9fa44-135">Bu kitaplıklar paketi kodunuzu işaretlemek için kapsamlı bir tür kümesi sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-135">This suite of libraries provides an extensive set of types to instrument your code.</span></span> <span data-ttu-id="9fa44-136">Ayrıca, Prometheus ve ımexdb gibi zaman serisi veritabanlarını içeren farklı türlerdeki hedeflere yönelik ölçümleri yazmak için paketler sağlar ve [Application Insights](/azure/azure-monitor/app/app-insights-overview).</span><span class="sxs-lookup"><span data-stu-id="9fa44-136">It also offers packages to write metrics to different kinds of targets that include time-series databases, such as Prometheus and InfluxDB, and [Application Insights](/azure/azure-monitor/app/app-insights-overview).</span></span> <span data-ttu-id="9fa44-137">[App. ölçümler. AspNetCore. Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet paketi, ASP.NET Core çerçevesi ile tümleştirme aracılığıyla otomatik olarak oluşturulan kapsamlı bir temel ölçümler kümesi ekler.</span><span class="sxs-lookup"><span data-stu-id="9fa44-137">The [App.Metrics.AspNetCore.Mvc](https://www.nuget.org/packages/App.Metrics.AspNetCore.Mvc/) NuGet package even adds a comprehensive set of basic metrics that are automatically generated via integration with the ASP.NET Core framework.</span></span> <span data-ttu-id="9fa44-138">Proje Web sitesi, [Grafana](https://grafana.com/) görselleştirme platformu ile bu ölçümleri görüntülemeye yönelik [Şablonlar](https://www.app-metrics.io/samples/grafana/) sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-138">The project website provides [templates](https://www.app-metrics.io/samples/grafana/) for displaying those metrics with the [Grafana](https://grafana.com/) visualization platform.</span></span>

### <a name="produce-metrics"></a><span data-ttu-id="9fa44-139">Ölçüm üretin</span><span class="sxs-lookup"><span data-stu-id="9fa44-139">Produce metrics</span></span>

<span data-ttu-id="9fa44-140">Çoğu ölçüm platformu aşağıdaki türleri destekler:</span><span class="sxs-lookup"><span data-stu-id="9fa44-140">Most metrics platforms support the following types:</span></span>

| <span data-ttu-id="9fa44-141">Ölçüm türü</span><span class="sxs-lookup"><span data-stu-id="9fa44-141">Metric type</span></span> | <span data-ttu-id="9fa44-142">Açıklama</span><span class="sxs-lookup"><span data-stu-id="9fa44-142">Description</span></span> |
| ----------- | ----------- |
| <span data-ttu-id="9fa44-143">Sayaç</span><span class="sxs-lookup"><span data-stu-id="9fa44-143">Counter</span></span>     | <span data-ttu-id="9fa44-144">İstekler ve hatalar gibi ne sıklıkla bir şeyin gerçekleştiğini izler.</span><span class="sxs-lookup"><span data-stu-id="9fa44-144">Tracks how often something happens, such as requests and errors.</span></span> |
| <span data-ttu-id="9fa44-145">Ölçer</span><span class="sxs-lookup"><span data-stu-id="9fa44-145">Gauge</span></span>       | <span data-ttu-id="9fa44-146">Etkin bağlantılar gibi zaman içinde değişen tek bir değer kaydeder.</span><span class="sxs-lookup"><span data-stu-id="9fa44-146">Records a single value that changes over time, such as active connections.</span></span> |
| <span data-ttu-id="9fa44-147">Histogram</span><span class="sxs-lookup"><span data-stu-id="9fa44-147">Histogram</span></span>   | <span data-ttu-id="9fa44-148">Değerlerin bir dağılımını rastgele sınırlar arasında ölçer.</span><span class="sxs-lookup"><span data-stu-id="9fa44-148">Measures a distribution of values across arbitrary limits.</span></span> <span data-ttu-id="9fa44-149">Örneğin, bir histogram veri kümesi boyutunu izleyebilir, kaç tane <bir kayıt olduğunu, kaç tane 11-100 kaydı olduğunu, kaç adet 101-1000 kaydı olduğunu ve kaç tane >1000 kayıt olduğunu sayalabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-149">For example, a histogram can track dataset size, counting how many contained <10 records, how many contained 11-100 records, how many contained 101-1000 records, and how many contained >1000 records.</span></span> |
| <span data-ttu-id="9fa44-150">Ölçüm</span><span class="sxs-lookup"><span data-stu-id="9fa44-150">Meter</span></span>       | <span data-ttu-id="9fa44-151">Bir olayın çeşitli zaman yayıldığında oluşma oranını ölçer.</span><span class="sxs-lookup"><span data-stu-id="9fa44-151">Measures the rate at which an event occurs in various time spans.</span></span> |
| <span data-ttu-id="9fa44-152">Zamanlayıcı</span><span class="sxs-lookup"><span data-stu-id="9fa44-152">Timer</span></span>       | <span data-ttu-id="9fa44-153">Etkinlik süresini ve oluşma hızını izler, histogram olarak depolanır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-153">Tracks the duration of events and the rate at which it occurs, stored as a histogram.</span></span> |

<span data-ttu-id="9fa44-154">*Uygulama ölçümlerini* kullanarak bir arabirim, `IMetrics` bağımlılık ekleme yoluyla elde edilebilir ve bir GRPC hizmeti için bu ölçülerden herhangi birini kaydetmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-154">By using *App Metrics*, an `IMetrics` interface can be obtained via dependency injection, and used to record any of these metrics for a gRPC service.</span></span> <span data-ttu-id="9fa44-155">Aşağıdaki örnek, `Get` zaman içinde yapılan isteklerin sayısını nasıl saymayı gösterir:</span><span class="sxs-lookup"><span data-stu-id="9fa44-155">The following example shows how to count the number of `Get` requests made over time:</span></span>

```csharp
public class StockData : Stocks.StocksBase
{
    private static readonly CounterOptions GetRequestCounter = new CounterOptions
    {
        Name = "StockData_Get_Requests",
        MeasurementUnit = Unit.Calls
    };

    private readonly IStockRepository _repository;
    private readonly IMetrics _metrics;

    public StockData(IStockRepository repository, IMetrics metrics)
    {
        _repository = repository;
        _metrics = metrics;
    }

    public override async Task<GetResponse> Get(GetRequest request, ServerCallContext context)
    {
        _metrics.Measure.Counter.Increment(GetRequestCounter);

        // Serve request...
    }
}
```

### <a name="store-and-visualize-metrics-data"></a><span data-ttu-id="9fa44-156">Ölçüm verilerini depolayın ve görselleştirin</span><span class="sxs-lookup"><span data-stu-id="9fa44-156">Store and visualize metrics data</span></span>

<span data-ttu-id="9fa44-157">Ölçüm verilerini depolamanın en iyi yolu, zaman damgalarla işaretlenmiş sayısal veri serisini kaydetmek üzere tasarlanan özel bir veri deposu olan *zaman serisi bir veritabanıdır*.</span><span class="sxs-lookup"><span data-stu-id="9fa44-157">The best way to store metrics data is in a *time-series database*, a specialized data store designed to record numerical data series marked with timestamps.</span></span> <span data-ttu-id="9fa44-158">Bu veritabanlarının en popüler değeri, [Prometheus](https://prometheus.io/) ve [etkileyen](https://www.influxdata.com/products/influxdb-overview/).</span><span class="sxs-lookup"><span data-stu-id="9fa44-158">The most popular of these databases are [Prometheus](https://prometheus.io/) and [InfluxDB](https://www.influxdata.com/products/influxdb-overview/).</span></span> <span data-ttu-id="9fa44-159">Microsoft Azure Ayrıca, [Azure izleyici](/azure/azure-monitor/overview) hizmeti aracılığıyla adanmış ölçüm depolama alanı sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-159">Microsoft Azure also provides dedicated metrics storage through the [Azure Monitor](/azure/azure-monitor/overview) service.</span></span>

<span data-ttu-id="9fa44-160">Ölçüm verilerini görselleştirmeye yönelik geçerli go çözümü, çok çeşitli depolama sağlayıcılarıyla birlikte [Grafana](https://grafana.com).</span><span class="sxs-lookup"><span data-stu-id="9fa44-160">The current go-to solution for visualizing metrics data is [Grafana](https://grafana.com), which works with a wide range of storage providers.</span></span> <span data-ttu-id="9fa44-161">Aşağıdaki görüntüde, StockData örneğini çalıştıran Linkerd hizmet kafeslerinden alınan ölçümleri görüntüleyen örnek bir Grafana panosu gösterilmektedir:</span><span class="sxs-lookup"><span data-stu-id="9fa44-161">The following image shows an example Grafana dashboard that displays metrics from the Linkerd service mesh running the StockData sample:</span></span>

![Grafana panonun ekran görüntüsü](media/application-performance-management/grafana-screenshot.png)

### <a name="metrics-based-alerting"></a><span data-ttu-id="9fa44-163">Ölçüm tabanlı uyarı</span><span class="sxs-lookup"><span data-stu-id="9fa44-163">Metrics-based alerting</span></span>

<span data-ttu-id="9fa44-164">Ölçüm verilerinin sayısal doğası, uyarı sistemlerini, geliştiricilerin veya Destek mühendislerinin bir değer tanımlı tolerans dışında kaldığında geliştiricilere bildirmek için uygun olduğu anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-164">The numerical nature of metrics data means that it's ideally suited to drive alerting systems, notifying developers or support engineers when a value falls outside of some defined tolerance.</span></span> <span data-ttu-id="9fa44-165">Zaten bahsedilen platformlar, e-postalar, metin iletileri veya Pano içi görselleştirmeler dahil olmak üzere çeşitli seçenekler aracılığıyla uyarı desteği sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-165">The platforms already mentioned all provide support for alerting via a range of options, including emails, text messages, or in-dashboard visualizations.</span></span>

## <a name="distributed-tracing"></a><span data-ttu-id="9fa44-166">Dağıtılmış izleme</span><span class="sxs-lookup"><span data-stu-id="9fa44-166">Distributed tracing</span></span>

<span data-ttu-id="9fa44-167">Dağıtılmış izleme, mikro hizmetler ve dağıtılmış mimarilerin artan kullanımını gösteren, izleme sırasında görece son bir geliştirmede oluşur.</span><span class="sxs-lookup"><span data-stu-id="9fa44-167">Distributed tracing is a relatively recent development in monitoring, which has arisen from the increasing use of microservices and distributed architectures.</span></span> <span data-ttu-id="9fa44-168">İstemci tarayıcısından, uygulamadan veya cihazdan gelen tek bir istek birçok adım ve alt isteklere ayrılabilir ve bir ağ genelinde birçok hizmetin kullanımını içerir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-168">A single request from a client browser, application, or device can be broken down into many steps and sub-requests, and involve the use of many services across a network.</span></span> <span data-ttu-id="9fa44-169">Bu etkinlik, günlük iletilerinin ve ölçümlerinin tetiklediği belirli bir istekle ilişkilendirilmesi güç sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-169">This activity makes it difficult to correlate log messages and metrics with the specific request that triggered them.</span></span> <span data-ttu-id="9fa44-170">Dağıtılmış izleme, isteklere tanımlayıcılar uygular ve günlüklerin ve ölçümlerin belirli bir işlemle bağıntılı olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-170">Distributed tracing applies identifiers to requests, and allows logs and metrics to be correlated with a particular operation.</span></span> <span data-ttu-id="9fa44-171">Bu izleme, [WCF 'nin uçtan uca izlemeye](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md)benzer, ancak birden çok platformda uygulanır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-171">This tracing is similar to [WCF's end-to-end tracing](../../framework/wcf/diagnostics/tracing/end-to-end-tracing.md), but it's applied across multiple platforms.</span></span>

<span data-ttu-id="9fa44-172">Dağıtılmış izleme popülerliği arttı ve standartlaştırmaya başlıyor.</span><span class="sxs-lookup"><span data-stu-id="9fa44-172">Distributed tracing has grown quickly in popularity and is beginning to standardize.</span></span> <span data-ttu-id="9fa44-173">Bulut Yerel Bilgi Işlem altyapısı, [Açık izleme standardı](https://opentracing.io)oluşturdu ve [deleger](https://www.jaegertracing.io/) ve [elastik APM](https://www.elastic.co/products/apm)gibi arka uçlar ile çalışmaya yönelik satıcıya ait kitaplıkları sağlamaya çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="9fa44-173">The Cloud Native Computing Foundation created the [Open Tracing standard](https://opentracing.io), attempting to provide vendor-neutral libraries for working with back ends like [Jaeger](https://www.jaegertracing.io/) and [Elastic APM](https://www.elastic.co/products/apm).</span></span> <span data-ttu-id="9fa44-174">Aynı zamanda, Google aynı sorun kümesini karşılamak için [Opencensus projesini](https://opencensus.io/) oluşturmuştur.</span><span class="sxs-lookup"><span data-stu-id="9fa44-174">At the same time, Google created the [OpenCensus project](https://opencensus.io/) to address the same set of problems.</span></span> <span data-ttu-id="9fa44-175">Bu iki proje, gelecekteki sektörün sektör standardı olacak şekilde yeni bir proje olan [Opentelemetriyi](https://opentelemetry.io)birleştiriyor.</span><span class="sxs-lookup"><span data-stu-id="9fa44-175">These two projects are merging into a new project, [OpenTelemetry](https://opentelemetry.io), which aims to be the industry standard of the future.</span></span>

### <a name="how-distributed-tracing-works"></a><span data-ttu-id="9fa44-176">Dağıtılmış izlemenin nasıl çalıştığı</span><span class="sxs-lookup"><span data-stu-id="9fa44-176">How distributed tracing works</span></span>

<span data-ttu-id="9fa44-177">Dağıtılmış izleme, tek bir *izlemenin* parçası olan adlandırılmış, zaman aşımına uğramış işlemler, bir sistemin birden çok düğümünde işlemeyi içerebilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-177">Distributed tracing is based on the concept of *spans*: named, timed operations that are part of a single *trace*, which can involve processing on multiple nodes of a system.</span></span> <span data-ttu-id="9fa44-178">Yeni bir işlem başlatıldığında, benzersiz tanımlayıcı ile bir izleme oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="9fa44-178">When a new operation is initiated, a trace is created with a unique identifier.</span></span> <span data-ttu-id="9fa44-179">Her alt işlem için, kendi tanımlayıcısı ve izleme tanımlayıcısı ile bir span oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="9fa44-179">For each sub-operation, a span is created with its own identifier and trace identifier.</span></span> <span data-ttu-id="9fa44-180">İstek sistem etrafında geçerken, çeşitli bileşenler *üst* ilişkilerini içeren *alt* yayılma oluşturabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-180">As the request passes around the system, various components can create *child* spans that include the identifier of their *parent*.</span></span> <span data-ttu-id="9fa44-181">Bir yayılma, izleme ve yayma tanımlayıcılarını ve ayrıca anahtar ve değer çiftleri ( *Bagaj* adı verilir) biçimindeki yararlı verileri içeren bir *içeriğe* sahiptir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-181">A span has a *context*, which contains the trace and span identifiers, as well as useful data in the form of key and value pairs (called *baggage*).</span></span>

### <a name="distributed-tracing-with-diagnosticsource"></a><span data-ttu-id="9fa44-182">İle dağıtılmış izleme `DiagnosticSource`</span><span class="sxs-lookup"><span data-stu-id="9fa44-182">Distributed tracing with `DiagnosticSource`</span></span>

<span data-ttu-id="9fa44-183">.NET, dağıtılmış izlemeler ve yayılmalar için iyi eşleşen bir iç modüle sahiptir: [Diagnosticsource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span><span class="sxs-lookup"><span data-stu-id="9fa44-183">.NET has an internal module that maps well to distributed traces and spans: [DiagnosticSource](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#diagnosticsource-users-guide).</span></span> <span data-ttu-id="9fa44-184">Ayrıca, bir işlem içinde tanılamayı oluşturmak ve kullanmak için basit bir yol sağlamak için, `DiagnosticSource` modül bir *etkinlik* kavramıdır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-184">As well as providing a simple way to produce and consume diagnostics within a process, the `DiagnosticSource` module has the concept of an *activity*.</span></span> <span data-ttu-id="9fa44-185">Etkinlik etkin bir şekilde dağıtılmış izlemenin veya bir izleme içindeki yayılımın bir uygulamasıdır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-185">An activity is effectively an implementation of a distributed trace, or a span within a trace.</span></span> <span data-ttu-id="9fa44-186">Modülün iç işlevleri, tanımlayıcıları ayırmak da dahil olmak üzere üst/alt etkinliklerden yararlanın.</span><span class="sxs-lookup"><span data-stu-id="9fa44-186">The internals of the module take care of parent/child activities, including allocating identifiers.</span></span> <span data-ttu-id="9fa44-187">Türünü kullanma hakkında daha fazla bilgi için `Activity` bkz. [GitHub 'Da etkinlik Kullanıcı Kılavuzu](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span><span class="sxs-lookup"><span data-stu-id="9fa44-187">For more information about using the `Activity` type, see the [Activity User Guide on GitHub](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-user-guide).</span></span>

<span data-ttu-id="9fa44-188">, `DiagnosticSource` Çekirdek çerçevesinin bir parçası olduğundan ve daha sonra, birden çok çekirdek bileşeni tarafından desteklenir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-188">Because `DiagnosticSource` is a part of the core framework and later, it's supported by several core components.</span></span> <span data-ttu-id="9fa44-189">Bunlar, <xref:System.Net.Http.HttpClient> gRPC çerçevesinde açık destek de dahil olmak üzere, Entity Framework Core ve ASP.NET Core içerir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-189">These include <xref:System.Net.Http.HttpClient>, Entity Framework Core, and ASP.NET Core, including explicit support in the gRPC framework.</span></span> <span data-ttu-id="9fa44-190">ASP.NET Core bir istek aldığında, [W3C Trace bağlam](https://www.w3.org/TR/trace-context) standardı ile eşleşen BIR çift http üst bilgisi olup olmadığını denetler.</span><span class="sxs-lookup"><span data-stu-id="9fa44-190">When ASP.NET Core receives a request, it checks for a pair of HTTP headers matching the [W3C Trace Context](https://www.w3.org/TR/trace-context) standard.</span></span> <span data-ttu-id="9fa44-191">Üstbilgiler bulunursa bir etkinlik, üst bilgilerden kimlik değerleri ve bağlamı kullanılarak başlatılır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-191">If the headers are found, an activity is started by using the identity values and context from the headers.</span></span> <span data-ttu-id="9fa44-192">Üst bilgi bulunmazsa, standart biçimle eşleşen üretilen kimlik değerleriyle bir etkinlik başlatılır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-192">If no headers are found, an activity is started with generated identity values that match the standard format.</span></span> <span data-ttu-id="9fa44-193">Bu etkinliğin ömrü boyunca Framework veya uygulama kodu tarafından oluşturulan tüm Tanılamalar, izleme ve span tanımlayıcılarıyla etiketlenebilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-193">Any diagnostics generated by the framework or by application code during the lifetime of this activity can be tagged with the trace and span identifiers.</span></span> <span data-ttu-id="9fa44-194">`HttpClient`Destek, her istekte geçerli bir etkinlik olup olmadığını denetleyerek ve izleme üstbilgilerini giden isteğe otomatik olarak ekleyerek bu işlevselliği daha fazla genişletir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-194">The `HttpClient` support extends this functionality further by checking for a current activity on every request, and automatically adding the trace headers to the outgoing request.</span></span>

<span data-ttu-id="9fa44-195">ASP.NET Core gRPC istemcisi ve sunucu kitaplıkları, ve için açık destek içerir ve `DiagnosticSource` `Activity` Etkinlikler oluşturup üstbilgi bilgilerini otomatik olarak kullanabilir ve kullanır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-195">The ASP.NET Core gRPC client and server libraries include explicit support for `DiagnosticSource` and `Activity`, and create activities and apply and use header information automatically.</span></span>

> [!NOTE]
> <span data-ttu-id="9fa44-196">Tüm bu yalnızca bir dinleyicinin tanılama bilgilerini tükettiği durumlarda gerçekleşir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-196">All of this happens only if a listener is consuming the diagnostic information.</span></span> <span data-ttu-id="9fa44-197">Dinleyici yoksa, hiçbir Tanılama yazılmaz ve hiçbir etkinlik oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="9fa44-197">If there's no listener, no diagnostics are written and no activities are created.</span></span>

### <a name="add-your-own-diagnosticsource-and-activity"></a><span data-ttu-id="9fa44-198">Kendinizinkini ekleyin `DiagnosticSource` ve `Activity`</span><span class="sxs-lookup"><span data-stu-id="9fa44-198">Add your own `DiagnosticSource` and `Activity`</span></span>

<span data-ttu-id="9fa44-199">Kendi tanılamayı eklemek veya uygulama kodunuzda açık yayılma oluşturmak için, bkz. [Diagnosticsource Kullanıcı Kılavuzu](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) ve [etkinlik Kullanıcı Kılavuzu](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span><span class="sxs-lookup"><span data-stu-id="9fa44-199">To add your own diagnostics or create explicit spans within your application code, see the [DiagnosticSource User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md#instrumenting-with-diagnosticsourcediagnosticlistener) and [Activity User Guide](https://github.com/dotnet/runtime/blob/master/src/libraries/System.Diagnostics.DiagnosticSource/src/ActivityUserGuide.md#activity-usage).</span></span>

### <a name="store-distributed-trace-data"></a><span data-ttu-id="9fa44-200">Dağıtılmış izleme verilerini depola</span><span class="sxs-lookup"><span data-stu-id="9fa44-200">Store distributed trace data</span></span>

<span data-ttu-id="9fa44-201">Yazma sırasında, Opentelemetri projesi hala erken aşamalarındayken ve yalnızca alfa kalite paketleri .NET uygulamaları için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-201">At the time of writing, the OpenTelemetry project is still in the early stages, and only alpha-quality packages are available for .NET applications.</span></span> <span data-ttu-id="9fa44-202">OpenTracing projesi şu anda daha fazla yetişkin kitaplığı sunmaktadır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-202">The OpenTracing project currently offers more mature libraries.</span></span>

<span data-ttu-id="9fa44-203">OpenTracing API 'SI aşağıdaki bölümde açıklanmıştır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-203">The OpenTracing API is described in the following section.</span></span> <span data-ttu-id="9fa44-204">Bunun yerine uygulamanızda Opentelemetri API 'sini kullanmak istiyorsanız GitHub 'da [opentelemetri .NET SDK deposuna](https://github.com/open-telemetry/opentelemetry-dotnet) bakın.</span><span class="sxs-lookup"><span data-stu-id="9fa44-204">If you want to use the OpenTelemetry API in your application instead, refer to the [OpenTelemetry .NET SDK repository](https://github.com/open-telemetry/opentelemetry-dotnet) on GitHub.</span></span>

#### <a name="use-the-opentracing-package-to-store-distributed-trace-data"></a><span data-ttu-id="9fa44-205">Dağıtılmış izleme verilerini depolamak için OpenTracing paketini kullanın</span><span class="sxs-lookup"><span data-stu-id="9fa44-205">Use the OpenTracing package to store distributed trace data</span></span>

<span data-ttu-id="9fa44-206">[Opentracing NuGet paketi](https://www.nuget.org/packages/OpenTracing/) , tüm opentracing uyumlu arka uçları destekler (' den bağımsız olarak kullanılabilir `DiagnosticSource` ).</span><span class="sxs-lookup"><span data-stu-id="9fa44-206">The [OpenTracing NuGet package](https://www.nuget.org/packages/OpenTracing/) supports all OpenTracing-compliant back ends (which can be used independently of `DiagnosticSource`).</span></span> <span data-ttu-id="9fa44-207">Opentracing API katkıları projesinden [opentracing. contrib. NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/)'a ek bir paket vardır.</span><span class="sxs-lookup"><span data-stu-id="9fa44-207">There's an additional package from the OpenTracing API Contributions project, [OpenTracing.Contrib.NetCore](https://www.nuget.org/packages/OpenTracing.Contrib.NetCore/).</span></span> <span data-ttu-id="9fa44-208">Bu paket bir `DiagnosticSource` dinleyici ekler ve olayları ve etkinlikleri otomatik olarak arka uca yazar.</span><span class="sxs-lookup"><span data-stu-id="9fa44-208">This package adds a `DiagnosticSource` listener, and writes events and activities to a back end automatically.</span></span> <span data-ttu-id="9fa44-209">Bu paketin etkinleştirilmesi, NuGet 'den yüklemek ve sınıfınıza bir hizmet olarak eklemek kadar basittir `Startup` .</span><span class="sxs-lookup"><span data-stu-id="9fa44-209">Enabling this package is as simple as installing it from NuGet and adding it as a service in your `Startup` class.</span></span>

```csharp
public class Startup
{
    public void ConfigureServices(IServiceCollection services)
    {
        services.AddOpenTracing();
    }
}
```

<span data-ttu-id="9fa44-210">OpenTracing paketi bir Özet katmanıdır ve bu nedenle arka uca özel uygulama gerektirir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-210">The OpenTracing package is an abstraction layer, and as such it requires implementation specific to the back end.</span></span> <span data-ttu-id="9fa44-211">OpenTracing API uygulamaları aşağıdaki açık kaynak arka uçları için kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="9fa44-211">OpenTracing API implementations are available for the following open source back ends.</span></span>

| <span data-ttu-id="9fa44-212">Ad</span><span class="sxs-lookup"><span data-stu-id="9fa44-212">Name</span></span> | <span data-ttu-id="9fa44-213">Paket</span><span class="sxs-lookup"><span data-stu-id="9fa44-213">Package</span></span> | <span data-ttu-id="9fa44-214">Web Sitesi</span><span class="sxs-lookup"><span data-stu-id="9fa44-214">Website</span></span> |
| ---- | ------- | -------- |
| <span data-ttu-id="9fa44-215">Jaeger</span><span class="sxs-lookup"><span data-stu-id="9fa44-215">Jaeger</span></span> | [<span data-ttu-id="9fa44-216">Jaeger</span><span class="sxs-lookup"><span data-stu-id="9fa44-216">Jaeger</span></span>](https://www.nuget.org/packages/Jaeger/) | [<span data-ttu-id="9fa44-217">jaegertracing.io</span><span class="sxs-lookup"><span data-stu-id="9fa44-217">jaegertracing.io</span></span>](https://jaegertracing.io) |
| <span data-ttu-id="9fa44-218">Elastik APM</span><span class="sxs-lookup"><span data-stu-id="9fa44-218">Elastic APM</span></span> | [<span data-ttu-id="9fa44-219">Elastik. APM. NetCoreAll</span><span class="sxs-lookup"><span data-stu-id="9fa44-219">Elastic.Apm.NetCoreAll</span></span>](https://www.nuget.org/packages/Elastic.Apm.NetCoreAll/) | [<span data-ttu-id="9fa44-220">elastic.co/products/apm</span><span class="sxs-lookup"><span data-stu-id="9fa44-220">elastic.co/products/apm</span></span>](https://www.elastic.co/products/apm) |

<span data-ttu-id="9fa44-221">.NET için OpenTracing API 'SI hakkında daha fazla bilgi için bkz. GitHub 'da [c# için opentracing](https://github.com/opentracing/opentracing-csharp) ve [opentracing contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) depoları.</span><span class="sxs-lookup"><span data-stu-id="9fa44-221">For more information on the OpenTracing API for .NET, see the [OpenTracing for C#](https://github.com/opentracing/opentracing-csharp) and the [OpenTracing Contrib C#/.NET Core](https://github.com/opentracing-contrib/csharp-netcore) repositories on GitHub.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="9fa44-222">[Önceki](load-balancing.md) 
> [Sonraki](appendix.md)</span><span class="sxs-lookup"><span data-stu-id="9fa44-222">[Previous](load-balancing.md)
[Next](appendix.md)</span></span>
