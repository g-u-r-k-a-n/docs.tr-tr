---
title: 'CA1060: P-Invoke öğesini NativeMethods sınıfına taşı (kod analizi)'
description: 'Kod Analizi kuralı CA1060 hakkında bilgi edinin: NativeMethods sınıfına taşıma P-Invoke'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- MovePInvokesToNativeMethodsClass
- CA1060
helpviewer_keywords:
- MovePInvokesToNativeMethodsClass
- CA1060
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: d1b47bac2bfe33bd926b77c4f59efab7574e4851
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 02/04/2021
ms.locfileid: "99546718"
---
# <a name="ca1060-move-pinvokes-to-nativemethods-class"></a><span data-ttu-id="7bd13-103">CA1060: P/Invokes öğesini NativeMethods sınıfına taşıyın</span><span class="sxs-lookup"><span data-stu-id="7bd13-103">CA1060: Move P/Invokes to NativeMethods class</span></span>

| | <span data-ttu-id="7bd13-104">Değer</span><span class="sxs-lookup"><span data-stu-id="7bd13-104">Value</span></span> |
|-|-|
| <span data-ttu-id="7bd13-105">**Kural Kimliği**</span><span class="sxs-lookup"><span data-stu-id="7bd13-105">**Rule ID**</span></span> |<span data-ttu-id="7bd13-106">CA1060</span><span class="sxs-lookup"><span data-stu-id="7bd13-106">CA1060</span></span>|
| <span data-ttu-id="7bd13-107">**Kategori**</span><span class="sxs-lookup"><span data-stu-id="7bd13-107">**Category**</span></span> |[<span data-ttu-id="7bd13-108">Microsoft. Design</span><span class="sxs-lookup"><span data-stu-id="7bd13-108">Microsoft.Design</span></span>](design-warnings.md)|
| <span data-ttu-id="7bd13-109">**Düzeltilme veya kırılmamış**</span><span class="sxs-lookup"><span data-stu-id="7bd13-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="7bd13-110">Yeni</span><span class="sxs-lookup"><span data-stu-id="7bd13-110">Breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="7bd13-111">Nedeni</span><span class="sxs-lookup"><span data-stu-id="7bd13-111">Cause</span></span>

<span data-ttu-id="7bd13-112">Bir yöntem, yönetilmeyen koda erişmek için platform çağırma hizmetleri 'ni kullanır ve **Nativemethod** sınıflarından birinin üyesi değildir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-112">A method uses Platform Invocation Services to access unmanaged code and is not a member of one of the **NativeMethods** classes.</span></span>

## <a name="rule-description"></a><span data-ttu-id="7bd13-113">Kural açıklaması</span><span class="sxs-lookup"><span data-stu-id="7bd13-113">Rule description</span></span>

<span data-ttu-id="7bd13-114">Özniteliği kullanılarak işaretlenenler <xref:System.Runtime.InteropServices.DllImportAttribute?displayProperty=fullName> veya Visual Basic içindeki anahtar sözcüğü kullanılarak tanımlanan Yöntemler gibi platform çağırma yöntemleri, `Declare` yönetilmeyen koda erişin.</span><span class="sxs-lookup"><span data-stu-id="7bd13-114">Platform Invocation methods, such as those that are marked by using the <xref:System.Runtime.InteropServices.DllImportAttribute?displayProperty=fullName> attribute, or methods that are defined by using the `Declare` keyword in Visual Basic, access unmanaged code.</span></span> <span data-ttu-id="7bd13-115">Bu yöntemler aşağıdaki sınıflardan birinde olmalıdır:</span><span class="sxs-lookup"><span data-stu-id="7bd13-115">These methods should be in one of the following classes:</span></span>

- <span data-ttu-id="7bd13-116">**NativeMethods** -Bu sınıf, yönetilmeyen kod izni için yığın izlenecek yol göster ' i göstermez.</span><span class="sxs-lookup"><span data-stu-id="7bd13-116">**NativeMethods** - This class does not suppress stack walks for unmanaged code permission.</span></span> <span data-ttu-id="7bd13-117">( <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> Bu sınıfa uygulanmamalıdır.) Bu sınıf, bir yığın yürüme gerçekleştirileceği için her yerde kullanılabilecek yöntemler içindir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-117">(<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> must not be applied to this class.) This class is for methods that can be used anywhere because a stack walk will be performed.</span></span>

- <span data-ttu-id="7bd13-118">**SafeNativeMethods** -Bu sınıf, yönetilmeyen kod izni için yığın izlenecek yol gösterir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-118">**SafeNativeMethods** - This class suppresses stack walks for unmanaged code permission.</span></span> <span data-ttu-id="7bd13-119">( <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> Bu sınıfa uygulanır.) Bu sınıf, herkes tarafından çağrı yapmak için güvenli olan yöntemlere yöneliktir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-119">(<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> is applied to this class.) This class is for methods that are safe for anyone to call.</span></span> <span data-ttu-id="7bd13-120">Yöntemler herhangi bir arayan için zararsız olduğundan, kullanımın güvenli olduğundan emin olmak için bu yöntemlerin çağıranları tam güvenlik incelemesi gerçekleştirmek için gerekli değildir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-120">Callers of these methods are not required to perform a full security review to make sure that the usage is secure because the methods are harmless for any caller.</span></span>

- <span data-ttu-id="7bd13-121">**UnsafeNativeMethods** -Bu sınıf, yönetilmeyen kod izni için yığın izlenecek yol gösterir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-121">**UnsafeNativeMethods** - This class suppresses stack walks for unmanaged code permission.</span></span> <span data-ttu-id="7bd13-122">( <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> Bu sınıfa uygulanır.) Bu sınıf potansiyel olarak tehlikeli Yöntemler içindir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-122">(<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> is applied to this class.) This class is for methods that are potentially dangerous.</span></span> <span data-ttu-id="7bd13-123">Bu yöntemlerin herhangi bir çağırıcısı, kullanımın güvenli olduğundan emin olmak için, yığın ilerlemesinin gerçekleştirilmediğinden emin olmak için tam bir güvenlik incelemesi gerçekleştirmelidir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-123">Any caller of these methods must perform a full security review to make sure that the usage is secure because no stack walk will be performed.</span></span>

<span data-ttu-id="7bd13-124">Bu sınıflar `internal` ( `Friend` Visual Basic) olarak tanımlanır ve yeni örneklerin oluşturulmasını engellemek için özel bir Oluşturucu bildirir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-124">These classes are declared as `internal` (`Friend` in Visual Basic) and declare a private constructor to prevent new instances from being created.</span></span> <span data-ttu-id="7bd13-125">Bu sınıflardaki Yöntemler `static` ve `internal` ( `Shared` ve `Friend` Visual Basic) olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7bd13-125">The methods in these classes should be `static` and `internal` (`Shared` and `Friend` in Visual Basic).</span></span>

## <a name="how-to-fix-violations"></a><span data-ttu-id="7bd13-126">İhlalleri çözme</span><span class="sxs-lookup"><span data-stu-id="7bd13-126">How to fix violations</span></span>

<span data-ttu-id="7bd13-127">Bu kural ihlalini onarmak için yöntemini uygun **NativeMethods** sınıfına taşıyın.</span><span class="sxs-lookup"><span data-stu-id="7bd13-127">To fix a violation of this rule, move the method to the appropriate **NativeMethods** class.</span></span> <span data-ttu-id="7bd13-128">Çoğu uygulama için, P/Invoke 'u **NativeMethods** adlı yeni bir sınıfa taşımak yeterlidir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-128">For most applications, moving P/Invokes to a new class that is named **NativeMethods** is enough.</span></span>

<span data-ttu-id="7bd13-129">Ancak, diğer uygulamalarda kullanmak üzere kitaplıklar geliştiriyorsanız, **SafeNativeMethods** ve **UnsafeNativeMethods** adlı iki diğer sınıfı tanımlamayı göz önünde bulundurmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-129">However, if you are developing libraries for use in other applications, you should consider defining two other classes that are called **SafeNativeMethods** and **UnsafeNativeMethods**.</span></span> <span data-ttu-id="7bd13-130">Bu sınıflar, **NativeMethods** sınıfına benzer; Ancak, **SuppressUnmanagedCodeSecurityAttribute** adlı özel bir öznitelik kullanılarak işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-130">These classes resemble the **NativeMethods** class; however, they are marked by using a special attribute called **SuppressUnmanagedCodeSecurityAttribute**.</span></span> <span data-ttu-id="7bd13-131">Bu öznitelik uygulandığında, çalışma zamanı tam bir yığın gerçekleştirmez ve tüm çağıranların **UnmanagedCode** iznine sahip olduğundan emin olun.</span><span class="sxs-lookup"><span data-stu-id="7bd13-131">When this attribute is applied, the runtime does not perform a full stack walk to make sure that all callers have the **UnmanagedCode** permission.</span></span> <span data-ttu-id="7bd13-132">Çalışma zamanı normalde bu izni başlangıçta denetler.</span><span class="sxs-lookup"><span data-stu-id="7bd13-132">The runtime ordinarily checks for this permission at startup.</span></span> <span data-ttu-id="7bd13-133">Denetim gerçekleştirilmediğinden, bu yönetilmeyen yöntemlere yapılan çağrıların performansını önemli ölçüde iyileştirebilir. Ayrıca, bu yöntemleri çağırmak için sınırlı izinleri olan kodun de kullanılmasına olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="7bd13-133">Because the check is not performed, it can greatly improve performance for calls to these unmanaged methods, It also enables code that has limited permissions to call these methods.</span></span>

<span data-ttu-id="7bd13-134">Ancak, bu özniteliği harika bir şekilde kullanmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-134">However, you should use this attribute with great care.</span></span> <span data-ttu-id="7bd13-135">Yanlış uygulanırsa, ciddi güvenlik etkilerine neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-135">It can have serious security implications if it is implemented incorrectly..</span></span>

<span data-ttu-id="7bd13-136">Yöntemleri uygulama hakkında daha fazla bilgi için bkz. **NativeMethods** örneği, **SafeNativeMethods** example ve **UnsafeNativeMethods** örneği.</span><span class="sxs-lookup"><span data-stu-id="7bd13-136">For information about how to implement the methods, see the **NativeMethods** example, **SafeNativeMethods** example, and **UnsafeNativeMethods** example.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="7bd13-137">Uyarıların ne zaman bastırılamıyor</span><span class="sxs-lookup"><span data-stu-id="7bd13-137">When to suppress warnings</span></span>

<span data-ttu-id="7bd13-138">Bu kuraldan uyarıyı bastırmayın.</span><span class="sxs-lookup"><span data-stu-id="7bd13-138">Do not suppress a warning from this rule.</span></span>

## <a name="example"></a><span data-ttu-id="7bd13-139">Örnek</span><span class="sxs-lookup"><span data-stu-id="7bd13-139">Example</span></span>

<span data-ttu-id="7bd13-140">Aşağıdaki örnek, bu kuralı ihlal eden bir yöntemi bildirir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-140">The following example declares a method that violates this rule.</span></span> <span data-ttu-id="7bd13-141">İhlalin düzeltilmesi için, **RemoveDirectory** p/Invoke yalnızca P/Invoke tutmak üzere tasarlanan uygun bir sınıfa taşınmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7bd13-141">To correct the violation, the **RemoveDirectory** P/Invoke should be moved to an appropriate class that is designed to hold only P/Invokes.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet1":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet1":::

## <a name="nativemethods-example"></a><span data-ttu-id="7bd13-142">NativeMethods örneği</span><span class="sxs-lookup"><span data-stu-id="7bd13-142">NativeMethods example</span></span>

<span data-ttu-id="7bd13-143">**NativeMethods** sınıfı **SuppressUnmanagedCodeSecurityAttribute** kullanılarak işaretlenmemelidir, çünkü içine yerleştirilen P/Invoke, **UnmanagedCode** izni gerektirir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-143">Because the **NativeMethods** class should not be marked by using **SuppressUnmanagedCodeSecurityAttribute**, P/Invokes that are put in it will require **UnmanagedCode** permission.</span></span> <span data-ttu-id="7bd13-144">Çoğu uygulama yerel bilgisayardan çalıştığından ve tam güvenle birlikte çalıştığı için, bu genellikle bir sorun değildir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-144">Because most applications run from the local computer and run together with full trust, this is usually not a problem.</span></span> <span data-ttu-id="7bd13-145">Ancak, yeniden kullanılabilir kitaplıklar geliştiriyorsanız, bir **SafeNativeMethods** veya **UnsafeNativeMethods** sınıfı tanımlamayı göz önünde bulundurmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-145">However, if you are developing reusable libraries, you should consider defining a **SafeNativeMethods** or **UnsafeNativeMethods** class.</span></span>

<span data-ttu-id="7bd13-146">Aşağıdaki örnek, user32.dll **Messagebip** işlevini sarmalayan bir **Interaction. bip** yöntemi gösterir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-146">The following example shows an **Interaction.Beep** method that wraps the **MessageBeep** function from user32.dll.</span></span> <span data-ttu-id="7bd13-147">**Messagebip** P/Invoke, **NativeMethods** sınıfına konur.</span><span class="sxs-lookup"><span data-stu-id="7bd13-147">The **MessageBeep** P/Invoke is put in the **NativeMethods** class.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet2":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet2":::

## <a name="safenativemethods-example"></a><span data-ttu-id="7bd13-148">SafeNativeMethods örneği</span><span class="sxs-lookup"><span data-stu-id="7bd13-148">SafeNativeMethods example</span></span>

<span data-ttu-id="7bd13-149">Herhangi bir uygulamaya güvenle açık olabilecek ve herhangi bir yan etkisi olmayan P/Invoke metotları **SafeNativeMethods** adlı bir sınıfa yerleştirilmelidir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-149">P/Invoke methods that can be safely exposed to any application and that do not have any side effects should be put in a class that is named **SafeNativeMethods**.</span></span> <span data-ttu-id="7bd13-150">İzinleriniz için gereken izinlere sahip değilsiniz ve nereden çağrıldığının üzerine çok dikkat etmeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="7bd13-150">You do not have to demand permissions and you do not have to pay much attention to where they are called from.</span></span>

<span data-ttu-id="7bd13-151">Aşağıdaki örnek, kernel32.dll **GetTickCount** işlevini sarmalayan bir **Environment. TickCount** özelliğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-151">The following example shows an **Environment.TickCount** property that wraps the **GetTickCount** function from kernel32.dll.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet3":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet3":::

## <a name="unsafenativemethods-example"></a><span data-ttu-id="7bd13-152">UnsafeNativeMethods örneği</span><span class="sxs-lookup"><span data-stu-id="7bd13-152">UnsafeNativeMethods example</span></span>

<span data-ttu-id="7bd13-153">Güvenli bir şekilde çağrılamayan ve yan etkileri **UnsafeNativeMethods** adlı bir sınıfa yerleştirilecek olan P/Invoke yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="7bd13-153">P/Invoke methods that cannot be safely called and that could cause side effects should be put in a class that is named **UnsafeNativeMethods**.</span></span> <span data-ttu-id="7bd13-154">Bu yöntemlerin kullanıcıya istem dışı olarak gösterilmediğinden emin olmak için dikkatli bir şekilde denetlenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-154">These methods should be rigorously checked to make sure that they are not exposed to the user unintentionally.</span></span> <span data-ttu-id="7bd13-155">Alternatif olarak, yöntemler onları kullandıklarında **UnmanagedCode** yerine talep edilen başka bir izne sahip olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="7bd13-155">Alternatively, the methods should have another permission that is demanded instead of **UnmanagedCode** when they use them.</span></span>

<span data-ttu-id="7bd13-156">Aşağıdaki örnek, user32.dll **ShowCursor** işlevini sarmalayan bir **Cursor. Hide** metodunu gösterir.</span><span class="sxs-lookup"><span data-stu-id="7bd13-156">The following example shows a **Cursor.Hide** method that wraps the **ShowCursor** function from user32.dll.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca1060-move-p-invokes-to-nativemethods-class_1.vb" id="snippet4":::

:::code language="csharp" source="snippets/csharp/all-rules/ca1060.cs" id="snippet4":::

## <a name="see-also"></a><span data-ttu-id="7bd13-157">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="7bd13-157">See also</span></span>

- [<span data-ttu-id="7bd13-158">Tasarım kuralları</span><span class="sxs-lookup"><span data-stu-id="7bd13-158">Design rules</span></span>](design-warnings.md)
