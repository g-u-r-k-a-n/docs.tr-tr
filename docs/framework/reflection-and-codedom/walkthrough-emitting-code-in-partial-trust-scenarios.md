---
title: 'İzlenecek yol: Kısmi Güven Senaryolarında Kod Yayma'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- reflection emit, anonymously hosted dynamic methods
- partial trust, reflection
- partial trust, emitting dynamic methods
- reflection emit, partial trust scenarios
- anonymously hosted dynamic methods [.NET Framework]
- emitting dynamic assemblies,partial trust scenarios
- reflection emit, dynamic methods
- dynamic methods
ms.assetid: c45be261-2a9d-4c4e-9bd6-27f0931b7d25
ms.openlocfilehash: fd420c9754494b95c55df403edec87743572db03
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/30/2019
ms.locfileid: "73129988"
---
# <a name="walkthrough-emitting-code-in-partial-trust-scenarios"></a><span data-ttu-id="42dfb-102">İzlenecek yol: Kısmi Güven Senaryolarında Kod Yayma</span><span class="sxs-lookup"><span data-stu-id="42dfb-102">Walkthrough: Emitting Code in Partial Trust Scenarios</span></span>

<span data-ttu-id="42dfb-103">Yansıma yayma, tam veya kısmi güvende aynı API kümesini kullanır, ancak bazı özellikler kısmen güvenilen kodda özel izinler gerektirir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-103">Reflection emit uses the same API set in full or partial trust, but some features require special permissions in partially trusted code.</span></span> <span data-ttu-id="42dfb-104">Ayrıca, yansıma yayma özelliği, kısmi güvenle ve güvenlik açısından saydam derlemelerde kullanılmak üzere tasarlanan, anonim olarak barındırılan bir dinamik yöntem özelliğine sahiptir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-104">In addition, reflection emit has a feature, anonymously hosted dynamic methods, that is designed to be used with partial trust and by security-transparent assemblies.</span></span>

> [!NOTE]
> <span data-ttu-id="42dfb-105">3,5 .NET Framework önce, kodu <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> bayrağıyla <xref:System.Security.Permissions.ReflectionPermission> olarak yayma gerekir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-105">Before .NET Framework 3.5, emitting code required <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="42dfb-106">Bu izin, `FullTrust` varsayılan olarak dahil edilir ve `Internet` izin kümelerinde adlandırılmış izin kümeleri `Intranet`.</span><span class="sxs-lookup"><span data-stu-id="42dfb-106">This permission is included by default in the `FullTrust` and `Intranet` named permission sets, but not in the `Internet` permission set.</span></span> <span data-ttu-id="42dfb-107">Bu nedenle, bir kitaplık yalnızca <xref:System.Security.SecurityCriticalAttribute> özniteliği varsa ve ayrıca <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>için bir <xref:System.Security.PermissionSet.Assert%2A> yöntemi yürütülürse, kısmi güvenle kullanılabilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-107">Therefore, a library could be used from partial trust only if it had the <xref:System.Security.SecurityCriticalAttribute> attribute and also executed an <xref:System.Security.PermissionSet.Assert%2A> method for <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>.</span></span> <span data-ttu-id="42dfb-108">Bu tür Kitaplıklar, kodlama hataları güvenlik delikleri ile sonuçlanabileceğinden dikkatli bir güvenlik incelemesi gerektirir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-108">Such libraries require careful security review because coding errors could result in security holes.</span></span> <span data-ttu-id="42dfb-109">.NET Framework 3,5, kod oluşturma doğal olarak ayrıcalıklı bir işlem olmadığından kodun herhangi bir güvenlik talebi vermeden kısmi güven senaryolarında oluşturulmasına olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="42dfb-109">The .NET Framework 3.5 allows code to be emitted in partial trust scenarios without issuing any security demands, because generating code is not inherently a privileged operation.</span></span> <span data-ttu-id="42dfb-110">Diğer bir deyişle, oluşturulan kodun onu yayan derlemeden daha fazla izni yoktur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-110">That is, the generated code has no more permissions than the assembly that emits it.</span></span> <span data-ttu-id="42dfb-111">Bu, kodu oluşturan kitaplıkların güvenlik açısından saydam olmasını sağlar ve <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>onay gereksinimini ortadan kaldırır, böylece güvenli bir kitaplık yazmak bu tür kapsamlı bir güvenlik incelemesi gerektirmez.</span><span class="sxs-lookup"><span data-stu-id="42dfb-111">This enables libraries that emit code to be security-transparent and removes the need to assert <xref:System.Security.Permissions.ReflectionPermissionFlag.ReflectionEmit>, so that writing a secure library does not require such a thorough security review.</span></span>

<span data-ttu-id="42dfb-112">Bu izlenecek yol aşağıdaki görevleri gösterir:</span><span class="sxs-lookup"><span data-stu-id="42dfb-112">This walkthrough illustrates the following tasks:</span></span>

- <span data-ttu-id="42dfb-113">[Kısmen güvenilen kodu test etmek için basit bir korumalı alan ayarlama](#Setting_up).</span><span class="sxs-lookup"><span data-stu-id="42dfb-113">[Setting up a simple sandbox for testing partially trusted code](#Setting_up).</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="42dfb-114">Bu, kısmi güvende kodla denemeler yapmanın basit bir yoludur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-114">This is a simple way to experiment with code in partial trust.</span></span> <span data-ttu-id="42dfb-115">Gerçekten güvenilmeyen konumlardan gelen kodu çalıştırmak için bkz. [nasıl yapılır: bir korumalı alana kısmen güvenilen kod çalıştırma](../misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span><span class="sxs-lookup"><span data-stu-id="42dfb-115">To run code that actually comes from untrusted locations, see [How to: Run Partially Trusted Code in a Sandbox](../misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>

- <span data-ttu-id="42dfb-116">[Kısmen güvenilen uygulama etki alanlarında kod çalıştırma](#Running_code).</span><span class="sxs-lookup"><span data-stu-id="42dfb-116">[Running code in partially trusted application domains](#Running_code).</span></span>

- <span data-ttu-id="42dfb-117">[Kısmi güvende kodu yaymak ve yürütmek için anonim olarak barındırılan dinamik yöntemler kullanma](#Using_methods).</span><span class="sxs-lookup"><span data-stu-id="42dfb-117">[Using anonymously hosted dynamic methods to emit and execute code in partial trust](#Using_methods).</span></span>

<span data-ttu-id="42dfb-118">Kısmi güven senaryolarında kod yayma hakkında daha fazla bilgi için, bkz. [yansıma yayma Içindeki güvenlik sorunları](security-issues-in-reflection-emit.md).</span><span class="sxs-lookup"><span data-stu-id="42dfb-118">For more information about emitting code in partial trust scenarios, see [Security Issues in Reflection Emit](security-issues-in-reflection-emit.md).</span></span>

<span data-ttu-id="42dfb-119">Bu yordamlarda gösterilen kodun tüm listesi için bu izlenecek yolun sonundaki [örnek bölümüne](#Example) bakın.</span><span class="sxs-lookup"><span data-stu-id="42dfb-119">For a complete listing of the code shown in these procedures, see the [Example section](#Example) at the end of this walkthrough.</span></span>

<a name="Setting_up"></a>

## <a name="setting-up-partially-trusted-locations"></a><span data-ttu-id="42dfb-120">Kısmen güvenilen konumlar ayarlama</span><span class="sxs-lookup"><span data-stu-id="42dfb-120">Setting up Partially Trusted Locations</span></span>

<span data-ttu-id="42dfb-121">Aşağıdaki iki yordamda, kodu kısmi güvenle test etmek için kullanabileceğiniz konumların nasıl ayarlanacağı gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-121">The following two procedures show how to set up locations from which you can test code with partial trust.</span></span>

- <span data-ttu-id="42dfb-122">İlk yordam, koda Internet izinleri verilen bir korumalı uygulama etki alanı oluşturmayı gösterir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-122">The first procedure shows how to create a sandboxed application domain in which code is granted Internet permissions.</span></span>

- <span data-ttu-id="42dfb-123">İkinci yordam, eşit veya daha az güvenin derlemelerindeki özel verilere erişimi etkinleştirmek için kısmen güvenilen bir uygulama etki alanına <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> bayrağıyla <xref:System.Security.Permissions.ReflectionPermission> nasıl ekleneceğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-123">The second procedure shows how to add <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag to a partially trusted application domain, to enable access to private data in assemblies of equal or lesser trust.</span></span>

### <a name="creating-sandboxed-application-domains"></a><span data-ttu-id="42dfb-124">Korumalı uygulama etki alanları oluşturma</span><span class="sxs-lookup"><span data-stu-id="42dfb-124">Creating Sandboxed Application Domains</span></span>

<span data-ttu-id="42dfb-125">Derlemelerinizin kısmi güvenle çalıştırıldığı bir uygulama etki alanı oluşturmak için, uygulama etki alanını oluşturmak üzere <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> yöntemi aşırı yüklemesini kullanarak derlemelere verilecek izin kümesini belirtmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-125">To create an application domain in which your assemblies run with partial trust, you must specify the set of permissions to be granted to the assemblies by using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to create the application domain.</span></span> <span data-ttu-id="42dfb-126">İzin kümesini belirtmenin en kolay yolu, güvenlik ilkesinden adlandırılmış bir izin kümesi alma yöntemidir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-126">The easiest way to specify the grant set is to retrieve a named permission set from security policy.</span></span>

<span data-ttu-id="42dfb-127">Aşağıdaki yordam, yayımlanmış kodun yalnızca ortak türlerin ortak üyelerine erişebileceği test senaryoları için, kodunuzu kısmi güvenle çalıştıran bir korumalı uygulama etki alanı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-127">The following procedure creates a sandboxed application domain that runs your code with partial trust, to test scenarios in which emitted code can access only public members of public types.</span></span> <span data-ttu-id="42dfb-128">Sonraki yordamda, verilen kodun, eşit veya daha az izinlere sahip derlemelerdeki ortak türlere ve üyelere erişebileceği test senaryolarına <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>nasıl ekleneceği gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-128">A subsequent procedure shows how to add <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess>, to test scenarios in which emitted code can access nonpublic types and members in assemblies that are granted equal or lesser permissions.</span></span>

#### <a name="to-create-an-application-domain-with-partial-trust"></a><span data-ttu-id="42dfb-129">Kısmi güvenle bir uygulama etki alanı oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="42dfb-129">To create an application domain with partial trust</span></span>

1. <span data-ttu-id="42dfb-130">Korumalı uygulama etki alanındaki derlemelere verilecek bir izin kümesi oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-130">Create a permission set to grant to the assemblies in the sandboxed application domain.</span></span> <span data-ttu-id="42dfb-131">Bu durumda, Internet bölgesinin izin kümesi kullanılır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-131">In this case, the permission set of the Internet zone is used.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#2)]
    [!code-vb[HowToEmitCodeInPartialTrust#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#2)]

2. <span data-ttu-id="42dfb-132">Uygulama etki alanını bir uygulama yolu ile başlatmak için bir <xref:System.AppDomainSetup> nesnesi oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-132">Create an <xref:System.AppDomainSetup> object to initialize the application domain with an application path.</span></span>

    > [!IMPORTANT]
    > <span data-ttu-id="42dfb-133">Kolaylık olması için, bu kod örneği geçerli klasörü kullanır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-133">For simplicity, this code example uses the current folder.</span></span> <span data-ttu-id="42dfb-134">Aslında Internet 'ten gelen kodu çalıştırmak için, güvenli olmayan kod için ayrı bir klasör kullanın. [nasıl yapılır: bir korumalı alana kısmen güvenilen kod çalıştırma](../misc/how-to-run-partially-trusted-code-in-a-sandbox.md)bölümünde açıklandığı gibi.</span><span class="sxs-lookup"><span data-stu-id="42dfb-134">To run code that actually comes from the Internet, use a separate folder for the untrusted code, as described in [How to: Run Partially Trusted Code in a Sandbox](../misc/how-to-run-partially-trusted-code-in-a-sandbox.md).</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#3)]
    [!code-vb[HowToEmitCodeInPartialTrust#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#3)]

3. <span data-ttu-id="42dfb-135">Uygulama etki alanı kurulum bilgilerini ve uygulama etki alanında yürütülen tüm derlemeler için izin kümesini belirterek uygulama etki alanını oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-135">Create the application domain, specifying the application domain setup information and the grant set for all assemblies that execute in the application domain.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#5)]
    [!code-vb[HowToEmitCodeInPartialTrust#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#5)]

    <span data-ttu-id="42dfb-136"><xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> yöntemi aşırı yüklemesinin son parametresi, uygulama etki alanının izin kümesi yerine, tam güven verilecek bir derleme kümesi belirtmenizi sağlar.</span><span class="sxs-lookup"><span data-stu-id="42dfb-136">The last parameter of the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload enables you to specify a set of assemblies that are to be granted full trust, instead of the grant set of the application domain.</span></span> <span data-ttu-id="42dfb-137">Bu derlemeler genel derleme önbelleğinde olduğundan, uygulamanızın kullandığı .NET Framework derlemelerini belirtmeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="42dfb-137">You do not have to specify the .NET Framework assemblies that your application uses, because those assemblies are in the global assembly cache.</span></span> <span data-ttu-id="42dfb-138">Genel derleme önbelleğindeki derlemeler her zaman tam olarak güvenilirdir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-138">Assemblies in the global assembly cache are always fully trusted.</span></span> <span data-ttu-id="42dfb-139">Bu parametreyi, genel derleme önbelleğinde olmayan tanımlayıcı adlandırılmış derlemeler belirtmek için kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="42dfb-139">You can use this parameter to specify strong-named assemblies that are not in the global assembly cache.</span></span>

### <a name="adding-restrictedmemberaccess-to-sandboxed-domains"></a><span data-ttu-id="42dfb-140">Korumalı etki alanlarına Kısıttedmemberaccess ekleniyor</span><span class="sxs-lookup"><span data-stu-id="42dfb-140">Adding RestrictedMemberAccess to Sandboxed Domains</span></span>

<span data-ttu-id="42dfb-141">Konak uygulamalar, anonim olarak barındırılan dinamik yöntemlerin, kodu yayan derlemenin güven düzeyine eşit veya daha küçük olan derlemelerde bulunan özel verilere erişmelerine izin verebilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-141">Host applications can allow anonymously hosted dynamic methods to have access to private data in assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span> <span data-ttu-id="42dfb-142">Bu kısıtlı özelliği, tam zamanında (JıT) görünürlük denetimlerini atlamaya olanak tanımak için, ana bilgisayar uygulaması, izin kümesine <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> (RMA) bayrağıyla bir <xref:System.Security.Permissions.ReflectionPermission> nesnesi ekler.</span><span class="sxs-lookup"><span data-stu-id="42dfb-142">To enable this restricted ability to skip just-in-time (JIT) visibility checks, the host application adds a <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> (RMA) flag to the grant set.</span></span>

<span data-ttu-id="42dfb-143">Örneğin, bir ana bilgisayar Internet uygulamalarına Internet izinleri artı RMA verebilir, böylece bir Internet uygulaması kendi derlemelerindeki özel verilere erişen kodu yayabilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-143">For example, a host might grant Internet applications Internet permissions plus RMA, so that an Internet application can emit code that accesses private data in its own assemblies.</span></span> <span data-ttu-id="42dfb-144">Erişim, eşit veya daha az güven Derlemeleriyle sınırlı olduğundan, bir Internet uygulaması .NET Framework derlemeleri gibi tamamen güvenilen derlemelerin üyelerine erişemez.</span><span class="sxs-lookup"><span data-stu-id="42dfb-144">Because the access is limited to assemblies of equal or lesser trust, an Internet application cannot access members of fully trusted assemblies such as .NET Framework assemblies.</span></span>

> [!NOTE]
> <span data-ttu-id="42dfb-145">Ayrıcalık yükseltmesini engellemek için, anonim olarak barındırılan dinamik yöntemler oluşturulduğunda, yayma derlemesi için yığın bilgileri dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-145">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="42dfb-146">Yöntemi çağrıldığında, yığın bilgileri denetlenir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-146">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="42dfb-147">Bu nedenle, tam güvenilir koddan çağrılan, anonim olarak barındırılan bir dinamik yöntem hala yayma derlemesinin güven düzeyiyle sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-147">Thus, an anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the emitting assembly.</span></span>

#### <a name="to-create-an-application-domain-with-partial-trust-plus-rma"></a><span data-ttu-id="42dfb-148">Kısmi güven artı RMA ile bir uygulama etki alanı oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="42dfb-148">To create an application domain with partial trust plus RMA</span></span>

1. <span data-ttu-id="42dfb-149"><xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (RMA) bayrağıyla yeni bir <xref:System.Security.Permissions.ReflectionPermission> nesnesi oluşturun ve izin kümesine izin eklemek için <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> metodunu kullanın.</span><span class="sxs-lookup"><span data-stu-id="42dfb-149">Create a new <xref:System.Security.Permissions.ReflectionPermission> object with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> (RMA) flag, and use the <xref:System.Security.PermissionSet.SetPermission%2A?displayProperty=nameWithType> method to add the permission to the grant set.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#7)]
    [!code-vb[HowToEmitCodeInPartialTrust#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#7)]

    <span data-ttu-id="42dfb-150"><xref:System.Security.PermissionSet.AddPermission%2A> yöntemi, zaten dahil değilse izin kümesine izin ekler.</span><span class="sxs-lookup"><span data-stu-id="42dfb-150">The <xref:System.Security.PermissionSet.AddPermission%2A> method adds the permission to the grant set if it is not already included.</span></span> <span data-ttu-id="42dfb-151">İzin verme kümesine zaten eklenirse, belirtilen bayraklar var olan izne eklenir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-151">If the permission is already included in the grant set, the specified flags are added to the existing permission.</span></span>

    > [!NOTE]
    > <span data-ttu-id="42dfb-152">RMA, anonim olarak barındırılan dinamik yöntemlerin bir özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-152">RMA is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="42dfb-153">Sıradan dinamik yöntemler JıT görünürlük denetimlerini atlediğinde, oluşturulan kod tam güven gerektirir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-153">When ordinary dynamic methods skip JIT visibility checks, the emitted code requires full trust.</span></span>

2. <span data-ttu-id="42dfb-154">Uygulama etki alanı kurulum bilgilerini ve izin kümesini belirterek uygulama etki alanını oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-154">Create the application domain, specifying the application domain setup information and the grant set.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#8)]
    [!code-vb[HowToEmitCodeInPartialTrust#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#8)]

<a name="Running_code"></a>

## <a name="running-code-in-sandboxed-application-domains"></a><span data-ttu-id="42dfb-155">Korumalı uygulama etki alanlarında kod çalıştırma</span><span class="sxs-lookup"><span data-stu-id="42dfb-155">Running Code in Sandboxed Application Domains</span></span>

<span data-ttu-id="42dfb-156">Aşağıdaki yordamda bir uygulama etki alanında yürütülebilecek Yöntemler, etki alanında sınıfın bir örneği oluşturma ve yöntemlerini yürütme yöntemleri kullanılarak bir sınıfın nasıl tanımlanacağı açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-156">The following procedure explains how to define a class by using methods that can be executed in an application domain, how to create an instance of the class in the domain, and how to execute its methods.</span></span>

#### <a name="to-define-and-execute-a-method-in-an-application-domain"></a><span data-ttu-id="42dfb-157">Uygulama etki alanında bir yöntemi tanımlamak ve yürütmek için</span><span class="sxs-lookup"><span data-stu-id="42dfb-157">To define and execute a method in an application domain</span></span>

1. <span data-ttu-id="42dfb-158"><xref:System.MarshalByRefObject>türeten bir sınıf tanımlayın.</span><span class="sxs-lookup"><span data-stu-id="42dfb-158">Define a class that derives from <xref:System.MarshalByRefObject>.</span></span> <span data-ttu-id="42dfb-159">Bu, diğer uygulama etki alanlarında sınıfının örneklerini oluşturmanızı ve uygulama etki alanı sınırları arasında Yöntem çağrıları yapmanızı sağlar.</span><span class="sxs-lookup"><span data-stu-id="42dfb-159">This enables you to create instances of the class in other application domains and to make method calls across application domain boundaries.</span></span> <span data-ttu-id="42dfb-160">Bu örnekteki sınıf `Worker`olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-160">The class in this example is named `Worker`.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#10)]
    [!code-vb[HowToEmitCodeInPartialTrust#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#10)]

2. <span data-ttu-id="42dfb-161">Yürütmek istediğiniz kodu içeren bir genel yöntem tanımlayın.</span><span class="sxs-lookup"><span data-stu-id="42dfb-161">Define a public method that contains the code you want to execute.</span></span> <span data-ttu-id="42dfb-162">Bu örnekte, kod basit bir dinamik yöntem yayar, yöntemi yürütmek için bir temsilci oluşturur ve temsilciyi çağırır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-162">In this example, the code emits a simple dynamic method, creates a delegate to execute the method, and invokes the delegate.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#11)]
    [!code-vb[HowToEmitCodeInPartialTrust#11](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#11)]

3. <span data-ttu-id="42dfb-163">Ana programınızda, derlemelerinizin görünen adını alın.</span><span class="sxs-lookup"><span data-stu-id="42dfb-163">In your main program, get the display name of your assembly.</span></span> <span data-ttu-id="42dfb-164">Bu ad, korumalı uygulama etki alanında `Worker` sınıfının örneklerini oluşturduğunuzda kullanılır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-164">This name is used when you create instances of the `Worker` class in the sandboxed application domain.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#14)]
    [!code-vb[HowToEmitCodeInPartialTrust#14](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#14)]

4. <span data-ttu-id="42dfb-165">Ana programınızda, Bu izlenecek yolda [ilk yordamda](#Setting_up) açıklandığı gibi bir korumalı uygulama etki alanı oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-165">In your main program, create a sandboxed application domain, as described in [the first procedure](#Setting_up) in this walkthrough.</span></span> <span data-ttu-id="42dfb-166">`SimpleEmitDemo` yöntemi yalnızca ortak Yöntemler kullandığından `Internet` izin kümesine herhangi bir izin eklemeniz gerekmez.</span><span class="sxs-lookup"><span data-stu-id="42dfb-166">You do not have to add any permissions to the `Internet` permission set, because the `SimpleEmitDemo` method uses only public methods.</span></span>

5. <span data-ttu-id="42dfb-167">Ana programınızda, korumalı uygulama etki alanında `Worker` sınıfının bir örneğini oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-167">In your main program, create an instance of the `Worker` class in the sandboxed application domain.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#12)]
    [!code-vb[HowToEmitCodeInPartialTrust#12](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#12)]

    <span data-ttu-id="42dfb-168"><xref:System.AppDomain.CreateInstanceAndUnwrap%2A> yöntemi, hedef uygulama etki alanında nesnesini oluşturur ve nesnenin özelliklerini ve yöntemlerini çağırmak için kullanılabilecek bir ara sunucu döndürür.</span><span class="sxs-lookup"><span data-stu-id="42dfb-168">The <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method creates the object in the target application domain and returns a proxy that can be used to call the properties and methods of the object.</span></span>

    > [!NOTE]
    > <span data-ttu-id="42dfb-169">Bu kodu Visual Studio 'da kullanırsanız, sınıfının adını ad alanını içerecek şekilde değiştirmelisiniz.</span><span class="sxs-lookup"><span data-stu-id="42dfb-169">If you use this code in Visual Studio, you must change the name of the class to include the namespace.</span></span> <span data-ttu-id="42dfb-170">Varsayılan olarak, ad alanı projenin adıdır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-170">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="42dfb-171">Örneğin, proje "PartialTrust" ise, sınıf adının "PartialTrust. Worker" olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-171">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>

6. <span data-ttu-id="42dfb-172">`SimpleEmitDemo` yöntemini çağırmak için kod ekleyin.</span><span class="sxs-lookup"><span data-stu-id="42dfb-172">Add code to call the `SimpleEmitDemo` method.</span></span> <span data-ttu-id="42dfb-173">Çağrı, uygulama etki alanı sınırı üzerinden sıralanır ve kod, korumalı uygulama etki alanında yürütülür.</span><span class="sxs-lookup"><span data-stu-id="42dfb-173">The call is marshaled across the application domain boundary, and the code is executed in the sandboxed application domain.</span></span>

    [!code-csharp[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#13)]
    [!code-vb[HowToEmitCodeInPartialTrust#13](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#13)]

<a name="Using_methods"></a>

## <a name="using-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="42dfb-174">Anonim olarak barındırılan dinamik yöntemler kullanma</span><span class="sxs-lookup"><span data-stu-id="42dfb-174">Using Anonymously Hosted Dynamic Methods</span></span>

<span data-ttu-id="42dfb-175">Anonim olarak barındırılan dinamik yöntemler, sistem tarafından sağlanmış bir saydam derleme ile ilişkilendirilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-175">Anonymously hosted dynamic methods are associated with a transparent assembly that is provided by the system.</span></span> <span data-ttu-id="42dfb-176">Bu nedenle, içerdikleri kod saydamdır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-176">Therefore, the code they contain is transparent.</span></span> <span data-ttu-id="42dfb-177">Diğer yandan sıradan dinamik yöntemlerin, mevcut bir modülle ilişkilendirilmesi gerekir (doğrudan belirtilen veya bir ilişkili türden çıkarılan) ve güvenlik düzeyini bu modülden taşıyın.</span><span class="sxs-lookup"><span data-stu-id="42dfb-177">Ordinary dynamic methods, on the other hand, must be associated with an existing module (whether directly specified or inferred from an associated type), and take their security level from that module.</span></span>

> [!NOTE]
> <span data-ttu-id="42dfb-178">Anonim barındırma sağlayan derleme ile dinamik bir yöntemi ilişkilendirmenin tek yolu, aşağıdaki yordamda açıklanan oluşturucuları kullanmaktır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-178">The only way to associate a dynamic method with the assembly that provides anonymous hosting is to use the constructors that are described in the following procedure.</span></span> <span data-ttu-id="42dfb-179">Anonim barındırma derlemesinde açıkça bir modül belirtemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="42dfb-179">You cannot explicitly specify a module in the anonymous hosting assembly.</span></span>

<span data-ttu-id="42dfb-180">Sıradan dinamik yöntemler, ilişkili oldukları modülün iç üyelerine veya ilişkilendirildikleri türün özel üyelerine erişimi vardır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-180">Ordinary dynamic methods have access to the internal members of the module they are associated with, or to the private members of the type they are associated with.</span></span> <span data-ttu-id="42dfb-181">Anonim olarak barındırılan dinamik yöntemler diğer koddan yalıtılmış olduğundan, özel verilere erişimi yoktur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-181">Because anonymously hosted dynamic methods are isolated from other code, they do not have access to private data.</span></span> <span data-ttu-id="42dfb-182">Ancak, özel verilere erişim kazanmak için JıT görünürlük denetimlerini atlayabilecekleri sınırlı bir özelliği vardır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-182">However, they do have a restricted ability to skip JIT visibility checks to gain access to private data.</span></span> <span data-ttu-id="42dfb-183">Bu özellik, güven düzeylerine sahip olan ve kodu gösteren derlemenin güven düzeyinden daha küçük olan Derlemelerle sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-183">This ability is limited to assemblies that have trust levels equal to or less than the trust level of the assembly that emits the code.</span></span>

<span data-ttu-id="42dfb-184">Ayrıcalık yükseltmesini engellemek için, anonim olarak barındırılan dinamik yöntemler oluşturulduğunda, yayma derlemesi için yığın bilgileri dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-184">To prevent elevation of privilege, stack information for the emitting assembly is included when anonymously hosted dynamic methods are constructed.</span></span> <span data-ttu-id="42dfb-185">Yöntemi çağrıldığında, yığın bilgileri denetlenir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-185">When the method is invoked, the stack information is checked.</span></span> <span data-ttu-id="42dfb-186">Tam olarak güvenilen koddan çağrılan, anonim olarak barındırılan dinamik bir yöntem yine de onu yayılan derlemenin güven düzeyiyle sınırlıdır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-186">An anonymously hosted dynamic method that is invoked from fully trusted code is still limited to the trust level of the assembly that emitted it.</span></span>

#### <a name="to-use-anonymously-hosted-dynamic-methods"></a><span data-ttu-id="42dfb-187">Anonim olarak barındırılan dinamik yöntemler kullanmak için</span><span class="sxs-lookup"><span data-stu-id="42dfb-187">To use anonymously hosted dynamic methods</span></span>

- <span data-ttu-id="42dfb-188">İlişkili bir modül veya tür belirtmeyen bir Oluşturucu kullanarak anonim olarak barındırılan bir dinamik yöntem oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-188">Create an anonymously hosted dynamic method by using a constructor that does not specify an associated module or type.</span></span>

  [!code-csharp[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#15)]
  [!code-vb[HowToEmitCodeInPartialTrust#15](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#15)]

  <span data-ttu-id="42dfb-189">Anonim olarak barındırılan dinamik bir yöntem yalnızca ortak türleri ve yöntemleri kullanıyorsa, kısıtlı üye erişimi gerektirmez ve JıT görünürlük denetimlerini atlamak zorunda kalmaz.</span><span class="sxs-lookup"><span data-stu-id="42dfb-189">If an anonymously hosted dynamic method uses only public types and methods, it does not require restricted member access and does not have to skip JIT visibility checks.</span></span>

  <span data-ttu-id="42dfb-190">Dinamik bir yöntemi yaymak için özel izin gerekmez, ancak bu kod, kullandığı türler ve yöntemler tarafından talep edilen izinleri gerektirir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-190">No special permissions are required to emit a dynamic method, but the emitted code requires the permissions that are demanded by the types and methods it uses.</span></span> <span data-ttu-id="42dfb-191">Örneğin, oluşturulan kod bir dosyaya erişen bir yöntemi çağırırsa, <xref:System.Security.Permissions.FileIOPermission>gerekir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-191">For example, if the emitted code calls a method that accesses a file, it requires <xref:System.Security.Permissions.FileIOPermission>.</span></span> <span data-ttu-id="42dfb-192">Güven düzeyi bu izni içermiyorsa, oluşturulan kod yürütüldüğünde bir güvenlik özel durumu oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-192">If the trust level does not include that permission, a security exception is thrown when the emitted code is executed.</span></span> <span data-ttu-id="42dfb-193">Burada gösterilen kod yalnızca <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> yöntemini kullanan dinamik bir yöntemi yayar.</span><span class="sxs-lookup"><span data-stu-id="42dfb-193">The code shown here emits a dynamic method that uses only the <xref:System.Console.WriteLine%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="42dfb-194">Bu nedenle, kod kısmen güvenilen konumlardan yürütülebilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-194">Therefore, the code can be executed from partially trusted locations.</span></span>

- <span data-ttu-id="42dfb-195">Alternatif olarak, <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> oluşturucusunu kullanarak ve `restrictedSkipVisibility` parametresi için `true` belirterek JıT görünürlük denetimlerini atlayıp kısıtlanmış, anonim olarak barındırılan bir dinamik yöntem oluşturun.</span><span class="sxs-lookup"><span data-stu-id="42dfb-195">Alternatively, create an anonymously hosted dynamic method with restricted ability to skip JIT visibility checks, by using the <xref:System.Reflection.Emit.DynamicMethod.%23ctor%28System.String%2CSystem.Type%2CSystem.Type%5B%5D%2CSystem.Boolean%29> constructor and specifying `true` for the `restrictedSkipVisibility` parameter.</span></span>

  [!code-csharp[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#16)]
  [!code-vb[HowToEmitCodeInPartialTrust#16](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#16)]

  <span data-ttu-id="42dfb-196">Kısıtlama, anonim olarak barındırılan dinamik yöntemin yalnızca güven düzeylerine sahip derlemelerdeki özel verilere, yayma derlemesinin güven düzeyine eşit veya ondan daha küçük bir erişim sağlayabilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-196">The restriction is that the anonymously hosted dynamic method can access private data only in assemblies with trust levels equal to or less than the trust level of the emitting assembly.</span></span> <span data-ttu-id="42dfb-197">Örneğin, dinamik yöntem Internet güveni ile yürütülerek Internet güveni ile de yürütülen diğer derlemelerdeki özel verilere erişebilir, ancak .NET Framework derlemelerinin özel verilerine erişemez.</span><span class="sxs-lookup"><span data-stu-id="42dfb-197">For example, if the dynamic method is executing with Internet trust, it can access private data in other assemblies that are also executing with Internet trust, but it cannot access private data of .NET Framework assemblies.</span></span> <span data-ttu-id="42dfb-198">.NET Framework derlemeleri genel bütünleştirilmiş kod önbelleğine yüklenir ve her zaman tam olarak güvenilirdir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-198">.NET Framework assemblies are installed in the global assembly cache and are always fully trusted.</span></span>

  <span data-ttu-id="42dfb-199">Anonim olarak barındırılan dinamik yöntemler, yalnızca konak uygulama <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> bayrağıyla <xref:System.Security.Permissions.ReflectionPermission> veriyorsa JıT görünürlük denetimlerini atlamak için bu kısıtlı özelliği kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-199">Anonymously hosted dynamic methods can use this restricted ability to skip JIT visibility checks only if the host application grants <xref:System.Security.Permissions.ReflectionPermission> with the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> flag.</span></span> <span data-ttu-id="42dfb-200">Bu izin talebi, yöntemi çağrıldığında yapılır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-200">The demand for this permission is made when the method is invoked.</span></span>

  > [!NOTE]
  > <span data-ttu-id="42dfb-201">Yayma derlemesi için çağrı yığını bilgileri, dinamik yöntem oluşturulduğunda dahil edilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-201">Call stack information for the emitting assembly is included when the dynamic method is constructed.</span></span> <span data-ttu-id="42dfb-202">Bu nedenle talep, yöntemi çağıran derleme yerine yayma derlemesinin izinlerine göre yapılır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-202">Therefore, the demand is made against the permissions of the emitting assembly instead of the assembly that invokes the method.</span></span> <span data-ttu-id="42dfb-203">Bu, verilmiş kodun yükseltilmiş izinlerle yürütülmesini önler.</span><span class="sxs-lookup"><span data-stu-id="42dfb-203">This prevents the emitted code from being executed with elevated permissions.</span></span>

  <span data-ttu-id="42dfb-204">Bu izlenecek yolun sonundaki [kod örneği](#Example) , kısıtlı üye erişiminin kullanımını ve sınırlamalarını gösterir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-204">The [complete code example](#Example) at the end of this walkthrough demonstrates the use and limitations of restricted member access.</span></span> <span data-ttu-id="42dfb-205">`Worker` sınıfı, görünürlük denetimlerini atlayıp kısıtlı yeteneği olmadan anonim olarak barındırılan dinamik yöntemler oluşturabileceğiniz bir yöntemi içerir ve örnek, bu yöntemi farklı güvene sahip uygulama etki alanlarında yürütmenin sonucunu gösterir düzeyleri.</span><span class="sxs-lookup"><span data-stu-id="42dfb-205">Its `Worker` class includes a method that can create anonymously hosted dynamic methods with or without the restricted ability to skip visibility checks, and the example shows the result of executing this method in application domains that have different trust levels.</span></span>

  > [!NOTE]
  > <span data-ttu-id="42dfb-206">Görünürlük denetimlerini atlama yeteneği, anonim olarak barındırılan dinamik yöntemlerin bir özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-206">The restricted ability to skip visibility checks is a feature of anonymously hosted dynamic methods.</span></span> <span data-ttu-id="42dfb-207">Sıradan dinamik yöntemler JıT görünürlük denetimlerini atlar, bunlara tam güven verilmelidir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-207">When ordinary dynamic methods skip JIT visibility checks, they must be granted full trust.</span></span>

<a name="Example"></a>

## <a name="example"></a><span data-ttu-id="42dfb-208">Örnek</span><span class="sxs-lookup"><span data-stu-id="42dfb-208">Example</span></span>

### <a name="description"></a><span data-ttu-id="42dfb-209">Açıklama</span><span class="sxs-lookup"><span data-stu-id="42dfb-209">Description</span></span>

<span data-ttu-id="42dfb-210">Aşağıdaki kod örneği, anonim olarak barındırılan dinamik yöntemlerin JıT görünürlük denetimlerini atlamasını sağlamak için <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> bayrağının kullanımını gösterir, ancak yalnızca hedef üye kodu yayan derlemeden daha eşit veya daha düşük bir güven düzeyindedir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-210">The following code example demonstrates the use of the <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> flag to allow anonymously hosted dynamic methods to skip JIT visibility checks, but only when the target member is at an equal or lower level of trust than the assembly that emits the code.</span></span>

<span data-ttu-id="42dfb-211">Örnek, uygulama etki alanı sınırları genelinde sıralanabilen bir `Worker` sınıfını tanımlar.</span><span class="sxs-lookup"><span data-stu-id="42dfb-211">The example defines a `Worker` class that can be marshaled across application domain boundaries.</span></span> <span data-ttu-id="42dfb-212">Sınıfta, dinamik yöntemleri yayan ve yürütecek iki `AccessPrivateMethod` yöntemi aşırı yüklemesi vardır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-212">The class has two `AccessPrivateMethod` method overloads that emit and execute dynamic methods.</span></span> <span data-ttu-id="42dfb-213">İlk aşırı yükleme, `Worker` sınıfının özel `PrivateMethod` yöntemini çağıran dinamik bir yöntem yayar ve bu, JıT görünürlük denetimleri olan veya olmayan dinamik yöntemi yayabilir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-213">The first overload emits a dynamic method that calls the private `PrivateMethod` method of the `Worker` class, and it can emit the dynamic method with or without JIT visibility checks.</span></span> <span data-ttu-id="42dfb-214">İkinci aşırı yükleme, <xref:System.String> sınıfının bir `internal` özelliğine (Visual Basic`Friend` özelliğine) erişen dinamik bir yöntem yayar.</span><span class="sxs-lookup"><span data-stu-id="42dfb-214">The second overload emits a dynamic method that accesses an `internal` property (`Friend` property in Visual Basic) of the <xref:System.String> class.</span></span>

<span data-ttu-id="42dfb-215">Örnek, `Internet` izinlerle sınırlı bir izin kümesi oluşturmak için bir yardımcı yöntem kullanır ve ardından, etki alanında çalıştırılan tüm kodun bu izin kümesini kullandığını belirtmek için <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> yöntemi aşırı yüklemesini kullanarak bir uygulama etki alanı oluşturur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-215">The example uses a helper method to create a grant set limited to `Internet` permissions, and then creates an application domain, using the <xref:System.AppDomain.CreateDomain%28System.String%2CSystem.Security.Policy.Evidence%2CSystem.AppDomainSetup%2CSystem.Security.PermissionSet%2CSystem.Security.Policy.StrongName%5B%5D%29?displayProperty=nameWithType> method overload to specify that all code that executes in the domain uses this grant set.</span></span> <span data-ttu-id="42dfb-216">Örnek, uygulama etki alanında `Worker` sınıfının bir örneğini oluşturur ve `AccessPrivateMethod` yöntemini iki kez yürütür.</span><span class="sxs-lookup"><span data-stu-id="42dfb-216">The example creates an instance of the `Worker` class in the application domain, and executes the `AccessPrivateMethod` method two times.</span></span>

- <span data-ttu-id="42dfb-217">`AccessPrivateMethod` yöntemi ilk yürütüldüğünde JıT görünürlük denetimleri zorlanır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-217">The first time the `AccessPrivateMethod` method is executed, JIT visibility checks are enforced.</span></span> <span data-ttu-id="42dfb-218">JıT görünürlük denetimleri özel yönteme erişmesini önleyebildiğinden, dinamik yöntem çağrıldığında başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-218">The dynamic method fails when it is invoked, because JIT visibility checks prevent it from accessing the private method.</span></span>

- <span data-ttu-id="42dfb-219">`AccessPrivateMethod` yöntemi ikinci kez yürütüldüğünde JıT görünürlük denetimleri atlanır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-219">The second time the `AccessPrivateMethod` method is executed, JIT visibility checks are skipped.</span></span> <span data-ttu-id="42dfb-220">Dinamik yöntem derlendiğinde başarısız olur, çünkü `Internet` izin kümesi görünürlük denetimlerini atlamak için yeterli izinleri vermez.</span><span class="sxs-lookup"><span data-stu-id="42dfb-220">The dynamic method fails when it is compiled, because the `Internet` grant set does not grant sufficient permissions to skip visibility checks.</span></span>

<span data-ttu-id="42dfb-221">Örnek, izin kümesine <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> <xref:System.Security.Permissions.ReflectionPermission> ekler.</span><span class="sxs-lookup"><span data-stu-id="42dfb-221">The example adds <xref:System.Security.Permissions.ReflectionPermission> with <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> to the grant set.</span></span> <span data-ttu-id="42dfb-222">Örnek daha sonra ikinci bir etki alanı oluşturur ve etki alanında çalıştırılan tüm kodların yeni izin kümesindeki izinleri verildiğini belirtmek için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-222">The example then creates a second domain, specifying that all code that executes in the domain is granted the permissions in the new grant set.</span></span> <span data-ttu-id="42dfb-223">Örnek, yeni uygulama etki alanında `Worker` sınıfının bir örneğini oluşturur ve `AccessPrivateMethod` yönteminin her iki yüklerini de yürütür.</span><span class="sxs-lookup"><span data-stu-id="42dfb-223">The example creates an instance of the `Worker` class in the new application domain, and executes both overloads of the `AccessPrivateMethod` method.</span></span>

- <span data-ttu-id="42dfb-224">`AccessPrivateMethod` yönteminin ilk aşırı yüklemesi yürütülür ve JıT görünürlük denetimleri atlanır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-224">The first overload of the `AccessPrivateMethod` method is executed, and JIT visibility checks are skipped.</span></span> <span data-ttu-id="42dfb-225">Kodu veren derleme özel yöntemi içeren derlemeyle aynı olduğundan, dinamik yöntem başarıyla derlenir ve yürütülür.</span><span class="sxs-lookup"><span data-stu-id="42dfb-225">The dynamic method compiles and executes successfully, because the assembly that emits the code is the same as the assembly that contains the private method.</span></span> <span data-ttu-id="42dfb-226">Bu nedenle, güven düzeyleri eşittir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-226">Therefore, the trust levels are equal.</span></span> <span data-ttu-id="42dfb-227">`Worker` sınıfını içeren uygulama birden fazla derlemeye sahipse, aynı işlem bu derlemelerin herhangi biri için başarılı olur, çünkü hepsi aynı güven düzeyinde olacaktır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-227">If the application that contains the `Worker` class had several assemblies, the same process would succeed for any one of those assemblies, because they would all be at the same trust level.</span></span>

- <span data-ttu-id="42dfb-228">`AccessPrivateMethod` yönteminin ikinci aşırı yüklemesi yürütülür ve daha sonra JıT görünürlük denetimleri atlanır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-228">The second overload of the `AccessPrivateMethod` method is executed, and again JIT visibility checks are skipped.</span></span> <span data-ttu-id="42dfb-229">Bu kez, <xref:System.String> sınıfının `internal` `FirstChar` özelliğine erişmeye çalıştığı için derleme sırasında dinamik yöntem başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="42dfb-229">This time the dynamic method fails when it is compiled, because it tries to access the `internal` `FirstChar` property of the <xref:System.String> class.</span></span> <span data-ttu-id="42dfb-230"><xref:System.String> sınıfını içeren derleme tamamen güvenilirdir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-230">The assembly that contains the <xref:System.String> class is fully trusted.</span></span> <span data-ttu-id="42dfb-231">Bu nedenle, kodu yayan derlemeden daha yüksek bir güven düzeyindedir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-231">Therefore, it is at a higher level of trust than the assembly that emits the code.</span></span>

<span data-ttu-id="42dfb-232">Bu karşılaştırma, <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> kısmen güvenilen kodun, güvenilen kodun güvenliği tehlikeye atmadan diğer kısmen güvenilen kodun görünürlük denetimlerini atlamasını nasıl etkinleştirdiğini gösterir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-232">This comparison shows how <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess?displayProperty=nameWithType> enables partially trusted code to skip visibility checks for other partially trusted code without compromising the security of trusted code.</span></span>

### <a name="code"></a><span data-ttu-id="42dfb-233">Kod</span><span class="sxs-lookup"><span data-stu-id="42dfb-233">Code</span></span>

[!code-csharp[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/csharp/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/cs/source.cs#1)]
[!code-vb[HowToEmitCodeInPartialTrust#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/HowToEmitCodeInPartialTrust/vb/source.vb#1)]

## <a name="compiling-the-code"></a><span data-ttu-id="42dfb-234">Kod Derleniyor</span><span class="sxs-lookup"><span data-stu-id="42dfb-234">Compiling the Code</span></span>

- <span data-ttu-id="42dfb-235">Visual Studio 'da Bu kod örneğini oluşturursanız, <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> yöntemine geçirdiğinizde sınıfın adını ad alanını içerecek şekilde değiştirmelisiniz.</span><span class="sxs-lookup"><span data-stu-id="42dfb-235">If you build this code example in Visual Studio, you must change the name of the class to include the namespace when you pass it to the <xref:System.AppDomain.CreateInstanceAndUnwrap%2A> method.</span></span> <span data-ttu-id="42dfb-236">Varsayılan olarak, ad alanı projenin adıdır.</span><span class="sxs-lookup"><span data-stu-id="42dfb-236">By default, the namespace is the name of the project.</span></span> <span data-ttu-id="42dfb-237">Örneğin, proje "PartialTrust" ise, sınıf adının "PartialTrust. Worker" olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="42dfb-237">For example, if the project is "PartialTrust", the class name must be "PartialTrust.Worker".</span></span>

## <a name="see-also"></a><span data-ttu-id="42dfb-238">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="42dfb-238">See also</span></span>

- [<span data-ttu-id="42dfb-239">Yansıma Yaymadaki Güvenlik Sorunları</span><span class="sxs-lookup"><span data-stu-id="42dfb-239">Security Issues in Reflection Emit</span></span>](security-issues-in-reflection-emit.md)
- [<span data-ttu-id="42dfb-240">Nasıl yapılır: bir korumalı alanda kısmen güvenilen kod çalıştırma</span><span class="sxs-lookup"><span data-stu-id="42dfb-240">How to: Run Partially Trusted Code in a Sandbox</span></span>](../misc/how-to-run-partially-trusted-code-in-a-sandbox.md)
