---
title: Bir mikro hizmete CQRS ve DDD desenlerini uygulama
description: .NET Microservices Mimari Containerized .NET Uygulamaları için | CQRS ve DDD desenleri arasındaki genel ilişkiyi anlayın.
ms.date: 10/08/2018
ms.openlocfilehash: e4e36bafff39f5f30d6371ed7c113322a85c3362
ms.sourcegitcommit: f87ad41b8e62622da126aa928f7640108c4eff98
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 04/07/2020
ms.locfileid: "80805585"
---
# <a name="apply-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="13bbd-103">Basitleştirilmiş CQRS ve DDD desenlerini microservice'e uygulayın</span><span class="sxs-lookup"><span data-stu-id="13bbd-103">Apply simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="13bbd-104">CQRS, veri okuma ve yazma modellerini birbirinden ayıran mimari bir desendir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-104">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="13bbd-105">İlgili terim [Komut Sorgusu Ayırma (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) aslında Bertrand Meyer tarafından kitabında Nesne *Yönelimli Yazılım İnşaat*tanımlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="13bbd-105">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="13bbd-106">Temel fikir, bir sistemin işlemlerini keskin bir şekilde ayrılmış iki kategoriye bölebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="13bbd-106">The basic idea is that you can divide a system's operations into two sharply separated categories:</span></span>

- <span data-ttu-id="13bbd-107">Sorgu.</span><span class="sxs-lookup"><span data-stu-id="13bbd-107">Queries.</span></span> <span data-ttu-id="13bbd-108">Bu bir sonuç dönmek ve sistemin durumunu değiştirmez, ve yan etkileri ücretsizdir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-108">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

- <span data-ttu-id="13bbd-109">Komut.</span><span class="sxs-lookup"><span data-stu-id="13bbd-109">Commands.</span></span> <span data-ttu-id="13bbd-110">Bunlar sistemin durumunu değiştirir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-110">These change the state of a system.</span></span>

<span data-ttu-id="13bbd-111">CQS basit bir kavramdır: aynı nesne içinde sorgular veya komutlar olan yöntemler hakkında.</span><span class="sxs-lookup"><span data-stu-id="13bbd-111">CQS is a simple concept: it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="13bbd-112">Her yöntem durumu döndürür veya durumu mutasyona uğratsa da her ikisini birden döndürmez.</span><span class="sxs-lookup"><span data-stu-id="13bbd-112">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="13bbd-113">Tek bir depo deseni nesnesi bile CQS ile uyumlu olabilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-113">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="13bbd-114">CQS, CQRS için temel bir ilke olarak kabul edilebilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-114">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="13bbd-115">[Komut ve Sorgu Sorumluluk Ayrımı (CQRS)](https://martinfowler.com/bliki/CQRS.html) Greg Young tarafından tanıtıldı ve kuvvetle Udi Dahan ve diğerleri tarafından teşvik.</span><span class="sxs-lookup"><span data-stu-id="13bbd-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="13bbd-116">Daha ayrıntılı olmasına rağmen, CQS ilkesine dayanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="13bbd-116">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="13bbd-117">Komutlara ve olaylara ve isteğe bağlı olarak eşzamanlı iletilere dayalı bir desen olarak kabul edilebilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-117">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="13bbd-118">Çoğu durumda, CQRS daha gelişmiş senaryolar ile ilgilidir, okumalar için farklı bir fiziksel veritabanı olması gibi (sorgular) yazma (güncelleştirmeler).</span><span class="sxs-lookup"><span data-stu-id="13bbd-118">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="13bbd-119">Ayrıca, daha gelişmiş bir CQRS sistemi güncelleştirme veritabanınız için [Olay Kaynağı (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) uygulayabilir, böylece olayları geçerli durum verilerini depolamak yerine yalnızca etki alanı modelinde depolarsınız.</span><span class="sxs-lookup"><span data-stu-id="13bbd-119">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](https://martinfowler.com/eaaDev/EventSourcing.html) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="13bbd-120">Ancak, bu yaklaşım bu kılavuzda kullanılmaz.</span><span class="sxs-lookup"><span data-stu-id="13bbd-120">However, this approach is not used in this guide.</span></span> <span data-ttu-id="13bbd-121">Bu kılavuz, sorguları komutlardan ayırmaktan oluşan en basit CQRS yaklaşımını kullanır.</span><span class="sxs-lookup"><span data-stu-id="13bbd-121">This guide uses the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="13bbd-122">CQRS ayırma yönü bir katmanda sorgu işlemleri gruplandırma ve başka bir katmanda komutları elde edilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-122">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="13bbd-123">Her katmanın kendi veri modeli vardır (model dediğimize dikkat edin, farklı bir veritabanı değil) ve kendi desen ve teknoloji kombinasyonu kullanılarak oluşturulmuştur.</span><span class="sxs-lookup"><span data-stu-id="13bbd-123">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="13bbd-124">Daha da önemlisi, iki katman, bu kılavuz için kullanılan örnekte (sipariş mikroservice) olduğu gibi, aynı katman veya microservice içinde olabilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-124">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="13bbd-125">Ya da farklı mikro hizmetler de veya süreçlerde uygulanabilir, böylece birbirlerini etkilemeden ayrı ayrı optimize edilebilir ve ölçeklendirilebilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-125">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="13bbd-126">CQRS, diğer bağlamlarda bir tane nin bulunduğu bir okuma/yazma işlemi için iki nesneye sahip olmak anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-126">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="13bbd-127">Daha gelişmiş CQRS literatüründe öğrenebileceğiniz normalleştirilmiş okuma veritabanına sahip olmak için nedenler vardır.</span><span class="sxs-lookup"><span data-stu-id="13bbd-127">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="13bbd-128">Ancak burada, amacın sorgularda daha fazla esnekliğe sahip olmak yerine, sorguları agrega gibi DDD desenleri kısıtlamalarıyla sınırlamak olduğu bu yaklaşımı kullanmıyoruz.</span><span class="sxs-lookup"><span data-stu-id="13bbd-128">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="13bbd-129">Bu tür bir hizmet örneği eShopOnContainers referans uygulamasından sipariş microservice olduğunu.</span><span class="sxs-lookup"><span data-stu-id="13bbd-129">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="13bbd-130">Bu hizmet basitleştirilmiş bir CQRS yaklaşımına dayalı bir microservice uygular.</span><span class="sxs-lookup"><span data-stu-id="13bbd-130">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="13bbd-131">Tek bir veri kaynağı veya veritabanı kullanır, ancak şekil 7-2'de gösterildiği gibi, işlem etki alanı için iki mantıksal model ve DDD desenleri kullanır.</span><span class="sxs-lookup"><span data-stu-id="13bbd-131">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 7-2.</span></span>

![Yüksek düzeyde Basitleştirilmiş CQRS ve DDD microservice gösteren diyagram.](./media/apply-simplified-microservice-cqrs-ddd-patterns/simplified-cqrs-ddd-microservice.png)

<span data-ttu-id="13bbd-133">**Şekil 7-2**.</span><span class="sxs-lookup"><span data-stu-id="13bbd-133">**Figure 7-2**.</span></span> <span data-ttu-id="13bbd-134">Basitleştirilmiş CQRS ve DDD tabanlı mikrohizmet</span><span class="sxs-lookup"><span data-stu-id="13bbd-134">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="13bbd-135">Mantıksal "Sipariş" Microservice olabilir, ancak aynı Docker ana bilgisayar olmak zorunda değildir Sipariş veritabanı içerir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-135">The Logical "Ordering" Microservice includes its Ordering database, which can be, but doesn't have to be, the same Docker host.</span></span> <span data-ttu-id="13bbd-136">Veritabanının aynı Docker ana bilgisayarda olması geliştirme için iyidir, ancak üretim için değildir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-136">Having the database in the same Docker host is good for development, but not for production.</span></span>

<span data-ttu-id="13bbd-137">Uygulama katmanı Web API'nin kendisi olabilir.</span><span class="sxs-lookup"><span data-stu-id="13bbd-137">The application layer can be the Web API itself.</span></span> <span data-ttu-id="13bbd-138">Burada önemli tasarım yönü microservice komutları, etki alanı modeli ve CQRS desen aşağıdaki işlemlerden sorguları ve ViewModels (özellikle istemci uygulamaları için oluşturulan veri modelleri) bölünmüş olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="13bbd-138">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="13bbd-139">Bu yaklaşım, sorguları, sonraki bölümlerde açıklandığı gibi yalnızca hareketler ve güncelleştirmeler için anlamlı olan DDD desenlerinden gelen kısıtlamalardan ve kısıtlamalardan bağımsız tutar.</span><span class="sxs-lookup"><span data-stu-id="13bbd-139">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="13bbd-140">Ek kaynaklar</span><span class="sxs-lookup"><span data-stu-id="13bbd-140">Additional resources</span></span>

- <span data-ttu-id="13bbd-141">**Greg Young' ı. Bir Olay Kaynaklı Sistemde Sürüm** (Online e-kitap okumak için ücretsiz) </span><span class="sxs-lookup"><span data-stu-id="13bbd-141">**Greg Young. Versioning in an Event Sourced System** (Free to read online e-book) </span></span>\
   <https://leanpub.com/esversioning/read>

>[!div class="step-by-step"]
><span data-ttu-id="13bbd-142">[Önceki](index.md)
>[Sonraki](eshoponcontainers-cqrs-ddd-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="13bbd-142">[Previous](index.md)
[Next](eshoponcontainers-cqrs-ddd-microservice.md)</span></span>
