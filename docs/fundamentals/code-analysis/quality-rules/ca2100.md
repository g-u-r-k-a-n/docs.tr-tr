---
title: 'CA2100: güvenlik açıkları için SQL sorgularını gözden geçirme (kod analizi)'
description: 'Kod Analizi kuralı CA2100 hakkında bilgi edinin: güvenlik açıkları için SQL sorgularını gözden geçirin'
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- Review SQL queries for security vulnerabilities
- ReviewSqlQueriesForSecurityVulnerabilities
- CA2100
helpviewer_keywords:
- CA2100
- ReviewSqlQueriesForSecurityVulnerabilities
author: gewarren
ms.author: gewarren
dev_langs:
- CSharp
- VB
ms.openlocfilehash: 5e2b509096a988ea67a44c60636c66c70c37f45c
ms.sourcegitcommit: e301979e3049ce412d19b094c60ed95b316a8f8c
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 12/16/2020
ms.locfileid: "97595170"
---
# <a name="ca2100-review-sql-queries-for-security-vulnerabilities"></a><span data-ttu-id="2e9ea-103">CA2100: SQL sorgularını güvenlik açıkları için inceleyin</span><span class="sxs-lookup"><span data-stu-id="2e9ea-103">CA2100: Review SQL queries for security vulnerabilities</span></span>

| | <span data-ttu-id="2e9ea-104">Değer</span><span class="sxs-lookup"><span data-stu-id="2e9ea-104">Value</span></span> |
|-|-|
| <span data-ttu-id="2e9ea-105">**Kural Kimliği**</span><span class="sxs-lookup"><span data-stu-id="2e9ea-105">**Rule ID**</span></span> |<span data-ttu-id="2e9ea-106">CA2100</span><span class="sxs-lookup"><span data-stu-id="2e9ea-106">CA2100</span></span>|
| <span data-ttu-id="2e9ea-107">**Kategori**</span><span class="sxs-lookup"><span data-stu-id="2e9ea-107">**Category**</span></span> |<span data-ttu-id="2e9ea-108">Microsoft.Security</span><span class="sxs-lookup"><span data-stu-id="2e9ea-108">Microsoft.Security</span></span>|
| <span data-ttu-id="2e9ea-109">**Düzeltilme veya kırılmamış**</span><span class="sxs-lookup"><span data-stu-id="2e9ea-109">**Fix is breaking or non-breaking**</span></span> |<span data-ttu-id="2e9ea-110">Kırılmamış</span><span class="sxs-lookup"><span data-stu-id="2e9ea-110">Non-breaking</span></span>|

## <a name="cause"></a><span data-ttu-id="2e9ea-111">Nedeni</span><span class="sxs-lookup"><span data-stu-id="2e9ea-111">Cause</span></span>

<span data-ttu-id="2e9ea-112">Yöntemi, <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> yöntemine dize bağımsız değişkeninden oluşturulan bir dize kullanarak özelliği ayarlar.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-112">A method sets the <xref:System.Data.IDbCommand.CommandText%2A?displayProperty=fullName> property by using a string that is built from a string argument to the method.</span></span>

<span data-ttu-id="2e9ea-113">Varsayılan olarak, bu kural codebase 'in tamamını analiz eder, ancak bu [yapılandırılabilir](#configure-code-to-analyze).</span><span class="sxs-lookup"><span data-stu-id="2e9ea-113">By default, this rule analyzes the entire codebase, but this is [configurable](#configure-code-to-analyze).</span></span>

## <a name="rule-description"></a><span data-ttu-id="2e9ea-114">Kural açıklaması</span><span class="sxs-lookup"><span data-stu-id="2e9ea-114">Rule description</span></span>

<span data-ttu-id="2e9ea-115">Bu kural, değeri derleme zamanında belirlenemeyen herhangi bir dizenin Kullanıcı girişi içerebileceğini varsayar.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-115">This rule assumes that any string, whose value can't be determined at compile time, may contain user input.</span></span> <span data-ttu-id="2e9ea-116">Kullanıcı girişi ile oluşturulan SQL komut dizesi, SQL enjeksiyon saldırılarına karşı savunmasız durumdadır.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-116">A SQL command string that is built from user input is vulnerable to SQL injection attacks.</span></span> <span data-ttu-id="2e9ea-117">Bir SQL ekleme saldırısında, kötü niyetli bir Kullanıcı, bir sorgunun tasarımını değiştiren ve temel alınan veritabanına yetkisiz erişim elde eden bir giriş sağlar.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-117">In a SQL injection attack, a malicious user supplies input that alters the design of a query in an attempt to damage or gain unauthorized access to the underlying database.</span></span> <span data-ttu-id="2e9ea-118">Tipik teknikler, SQL sabit dize sınırlayıcısı olan tek tırnak işareti veya kesme işareti ekleme işlemini içerir; bir SQL yorumunu belirten iki tire; ve yeni bir komutun izlediği noktalı virgül.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-118">Typical techniques include injection of a single quotation mark or apostrophe, which is the SQL literal string delimiter; two dashes, which signifies a SQL comment; and a semicolon, which indicates that a new command follows.</span></span> <span data-ttu-id="2e9ea-119">Kullanıcı girişi sorgunun bir parçası olmalıdır, saldırı riskini azaltmak için, verimlilik sırasıyla listelenen aşağıdakilerden birini kullanın.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-119">If user input must be part of the query, use one of the following, listed in order of effectiveness, to reduce the risk of attack.</span></span>

- <span data-ttu-id="2e9ea-120">Saklı yordam kullanın.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-120">Use a stored procedure.</span></span>

- <span data-ttu-id="2e9ea-121">Parametreli bir komut dizesi kullanın.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-121">Use a parameterized command string.</span></span>

- <span data-ttu-id="2e9ea-122">Komut dizesini oluşturmadan önce hem tür hem de içerik için Kullanıcı girişini doğrulayın.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-122">Validate the user input for both type and content before you build the command string.</span></span>

<span data-ttu-id="2e9ea-123">Aşağıdaki .NET türleri <xref:System.Data.IDbCommand.CommandText%2A> özelliği uygular veya bir dize bağımsız değişkeni kullanarak özelliği ayarlamış olan oluşturucular sağlar.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-123">The following .NET types implement the <xref:System.Data.IDbCommand.CommandText%2A> property or provide constructors that set the property by using a string argument.</span></span>

- <span data-ttu-id="2e9ea-124"><xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> ve <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="2e9ea-124"><xref:System.Data.Odbc.OdbcCommand?displayProperty=fullName> and <xref:System.Data.Odbc.OdbcDataAdapter?displayProperty=fullName></span></span>

- <span data-ttu-id="2e9ea-125"><xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> ve <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="2e9ea-125"><xref:System.Data.OleDb.OleDbCommand?displayProperty=fullName> and <xref:System.Data.OleDb.OleDbDataAdapter?displayProperty=fullName></span></span>

- <span data-ttu-id="2e9ea-126"><xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> ve <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="2e9ea-126"><xref:System.Data.OracleClient.OracleCommand?displayProperty=fullName> and <xref:System.Data.OracleClient.OracleDataAdapter?displayProperty=fullName></span></span>

- <span data-ttu-id="2e9ea-127"><xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> ve <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName></span><span class="sxs-lookup"><span data-stu-id="2e9ea-127"><xref:System.Data.SqlClient.SqlCommand?displayProperty=fullName> and <xref:System.Data.SqlClient.SqlDataAdapter?displayProperty=fullName></span></span>

<span data-ttu-id="2e9ea-128">Bazı durumlarda, bu kural bir dizenin bir değerini derleme zamanında belirleyemeyebilir, ancak bunu da yapabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-128">In some cases, this rule might not determine a string's value at compile time, even though you can.</span></span> <span data-ttu-id="2e9ea-129">Bu durumlarda bu kural, bu dizeleri SQL komutları olarak kullanırken yanlış pozitif sonuçlar üretir.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-129">In those cases, this rule produces false positives when using those strings as SQL commands.</span></span> <span data-ttu-id="2e9ea-130">Aşağıda bu tür bir dizeye örnek verilmiştir.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-130">The following is an example of such a string.</span></span>

```csharp
int x = 10;
string query = "SELECT TOP " + x.ToString() + " FROM Table";
```

<span data-ttu-id="2e9ea-131">Bu, `ToString()` örtük olarak kullanılırken geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-131">The same applies when using `ToString()` implicitly.</span></span>

```csharp
int x = 10;
string query = String.Format("SELECT TOP {0} FROM Table", x);
```

## <a name="how-to-fix-violations"></a><span data-ttu-id="2e9ea-132">İhlalleri çözme</span><span class="sxs-lookup"><span data-stu-id="2e9ea-132">How to fix violations</span></span>

<span data-ttu-id="2e9ea-133">Bu kuralın ihlalini onarmak için parametreli bir sorgu kullanın.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-133">To fix a violation of this rule, use a parameterized query.</span></span>

## <a name="when-to-suppress-warnings"></a><span data-ttu-id="2e9ea-134">Uyarıların ne zaman bastırılamıyor</span><span class="sxs-lookup"><span data-stu-id="2e9ea-134">When to suppress warnings</span></span>

<span data-ttu-id="2e9ea-135">Komut metni herhangi bir kullanıcı girişi içermiyorsa, bu kuraldan bir uyarıyı gizlemek güvenlidir.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-135">It is safe to suppress a warning from this rule if the command text does not contain any user input.</span></span>

## <a name="configure-code-to-analyze"></a><span data-ttu-id="2e9ea-136">Analiz etmek için kodu Yapılandır</span><span class="sxs-lookup"><span data-stu-id="2e9ea-136">Configure code to analyze</span></span>

<span data-ttu-id="2e9ea-137">Kod tabanınızın hangi bölümlerinin bu kuralı çalıştıracağınızı yapılandırmak için aşağıdaki seçenekleri kullanın.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-137">Use the following options to configure which parts of your codebase to run this rule on.</span></span>

- [<span data-ttu-id="2e9ea-138">Belirli sembolleri Dışla</span><span class="sxs-lookup"><span data-stu-id="2e9ea-138">Exclude specific symbols</span></span>](#exclude-specific-symbols)
- [<span data-ttu-id="2e9ea-139">Belirli türleri ve bunların türetilmiş türlerini Dışla</span><span class="sxs-lookup"><span data-stu-id="2e9ea-139">Exclude specific types and their derived types</span></span>](#exclude-specific-types-and-their-derived-types)

<span data-ttu-id="2e9ea-140">Bu seçenekleri yalnızca bu kural için, tüm kurallar için veya bu kategorideki tüm kurallar (güvenlik) için yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-140">You can configure these options for just this rule, for all rules, or for all rules in this category (Security).</span></span> <span data-ttu-id="2e9ea-141">Daha fazla bilgi için bkz. [kod kalitesi kural yapılandırma seçenekleri](../code-quality-rule-options.md).</span><span class="sxs-lookup"><span data-stu-id="2e9ea-141">For more information, see [Code quality rule configuration options](../code-quality-rule-options.md).</span></span>

[!INCLUDE[excluded-symbol-names](~/includes/code-analysis/excluded-symbol-names.md)]

[!INCLUDE[excluded-type-names-with-derived-types](~/includes/code-analysis/excluded-type-names-with-derived-types.md)]

## <a name="example"></a><span data-ttu-id="2e9ea-142">Örnek</span><span class="sxs-lookup"><span data-stu-id="2e9ea-142">Example</span></span>

<span data-ttu-id="2e9ea-143">Aşağıdaki örnek, kuralı `UnsafeQuery` ve `SaferQuery` parametreli bir komut dizesi kullanarak kuralı karşılayan yöntemini ihlal eden bir yöntemi gösterir.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-143">The following example shows a method, `UnsafeQuery`, that violates the rule and a method, `SaferQuery`, that satisfies the rule by using a parameterized command string.</span></span>

:::code language="vb" source="snippets/vb/all-rules/ca2100-review-sql-queries-for-security-vulnerabilities_1.vb":::

:::code language="csharp" source="snippets/csharp/all-rules/ca2100.cs" id="snippet1":::

## <a name="see-also"></a><span data-ttu-id="2e9ea-144">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="2e9ea-144">See also</span></span>

- [<span data-ttu-id="2e9ea-145">Güvenliğe genel bakış</span><span class="sxs-lookup"><span data-stu-id="2e9ea-145">Security Overview</span></span>](../../../framework/data/adonet/security-overview.md)
