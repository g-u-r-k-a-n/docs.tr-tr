---
title: WCF ile Temsilcilik ve Kimliğe Bürünme
description: Bir hizmet etki alanının kaynaklarına istemci erişimini kısıtlamak için WCF tarafından kullanılan kimliğe bürünme ve temsil etme yöntemleri hakkında bilgi edinin.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- impersonation [WCF]
- delegation [WCF]
ms.assetid: 110e60f7-5b03-4b69-b667-31721b8e3152
ms.openlocfilehash: 7f8d3695a36a43ca6bf796b141c07f6d2d088354
ms.sourcegitcommit: 358a28048f36a8dca39a9fe6e6ac1f1913acadd5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85245082"
---
# <a name="delegation-and-impersonation-with-wcf"></a><span data-ttu-id="6b1ff-103">WCF ile Temsilcilik ve Kimliğe Bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-103">Delegation and Impersonation with WCF</span></span>
<span data-ttu-id="6b1ff-104">*Kimliğe bürünme* , hizmetlerin, istemci erişimini bir hizmet etki alanı kaynaklarına kısıtlamak için kullandığı yaygın bir tekniktir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-104">*Impersonation* is a common technique that services use to restrict client access to a service domain's resources.</span></span> <span data-ttu-id="6b1ff-105">Hizmet etki alanı kaynakları, yerel dosyalar (kimliğe bürünme) gibi makine kaynakları ya da başka bir makinedeki bir dosya paylaşma (temsili) gibi bir kaynak olabilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-105">Service domain resources can either be machine resources, such as local files (impersonation), or a resource on another machine, such as a file share (delegation).</span></span> <span data-ttu-id="6b1ff-106">Örnek bir uygulama için bkz. [Istemcinin kimliğine bürünme](../samples/impersonating-the-client.md).</span><span class="sxs-lookup"><span data-stu-id="6b1ff-106">For a sample application, see [Impersonating the Client](../samples/impersonating-the-client.md).</span></span> <span data-ttu-id="6b1ff-107">Kimliğe bürünme özelliğinin nasıl kullanılacağına ilişkin bir örnek için bkz. [nasıl yapılır: bir hizmette Istemcinin kimliğine bürünme](../how-to-impersonate-a-client-on-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="6b1ff-107">For an example of how to use impersonation, see [How to: Impersonate a Client on a Service](../how-to-impersonate-a-client-on-a-service.md).</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="6b1ff-108">Bir hizmetin bir hizmette kimliğe bürünerek hizmetin, sunucu işleminden daha yüksek ayrıcalıklara sahip olabilecek istemci kimlik bilgileriyle çalıştığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-108">Be aware that when impersonating a client on a service, the service runs with the client's credentials, which may have higher privileges than the server process.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="6b1ff-109">Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="6b1ff-109">Overview</span></span>  
 <span data-ttu-id="6b1ff-110">Genellikle istemciler, hizmetin istemci adına bazı işlemleri gerçekleştirmesini sağlamak için bir hizmet çağırır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-110">Typically, clients call a service to have the service perform some action on the client’s behalf.</span></span> <span data-ttu-id="6b1ff-111">Kimliğe bürünme hizmeti, eylemi gerçekleştirirken hizmetin istemci olarak davranmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-111">Impersonation allows the service to act as the client while performing the action.</span></span> <span data-ttu-id="6b1ff-112">Temsili, bir ön uç hizmetinin istemcinin isteğini arka uç hizmetinin da istemcinin kimliğine bürünebileceği şekilde bir arka uç hizmetine iletmesini sağlar.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-112">Delegation allows a front-end service to forward the client’s request to a back-end service in such a way that the back-end service can also impersonate the client.</span></span> <span data-ttu-id="6b1ff-113">Kimliğe bürünme en yaygın olarak, istemcinin belirli bir eylemi gerçekleştirme yetkisine sahip olup olmadığını kontrol etmenin bir yolu olarak kullanılır, ancak temsil, kimliğe bürünme yeteneklerini, istemcinin kimliğiyle birlikte bir arka uç hizmetine akar.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-113">Impersonation is most commonly used as a way of checking whether a client is authorized to perform a particular action, while delegation is a way of flowing impersonation capabilities, along with the client’s identity, to a back-end service.</span></span> <span data-ttu-id="6b1ff-114">Temsili, Kerberos tabanlı kimlik doğrulaması gerçekleştirildiğinde kullanılabilecek bir Windows etki alanı özelliğidir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-114">Delegation is a Windows domain feature that can be used when Kerberos-based authentication is performed.</span></span> <span data-ttu-id="6b1ff-115">Yetkilendirme, kimlik akışından farklıdır ve yetkilendirme, istemcinin parolasını elinde bulunmadan istemci kimliğine bürünme özelliğini aktardığından, kimlik akışından çok daha yüksek ayrıcalıklı bir işlemdir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-115">Delegation is distinct from identity flow and, because delegation transfers the ability to impersonate the client without possession of the client’s password, it is a much higher privileged operation than identity flow.</span></span>  
  
 <span data-ttu-id="6b1ff-116">Hem kimliğe bürünme hem de temsil, istemcinin bir Windows kimliğine sahip olmasını gerektirir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-116">Both impersonation and delegation require that the client have a Windows identity.</span></span> <span data-ttu-id="6b1ff-117">Bir istemci bir Windows kimliğine sahip değilse, kullanılabilir tek seçenek, istemcinin kimliğini ikinci hizmete Flow ' dır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-117">If a client does not possess a Windows identity, then the only option available is to flow the client’s identity to the second service.</span></span>  
  
## <a name="impersonation-basics"></a><span data-ttu-id="6b1ff-118">Kimliğe bürünme temelleri</span><span class="sxs-lookup"><span data-stu-id="6b1ff-118">Impersonation Basics</span></span>  
 <span data-ttu-id="6b1ff-119">Windows Communication Foundation (WCF), çeşitli istemci kimlik bilgileri için kimliğe bürünmeyi destekler.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-119">Windows Communication Foundation (WCF) supports impersonation for a variety of client credentials.</span></span> <span data-ttu-id="6b1ff-120">Bu konuda, bir hizmet yönteminin uygulanması sırasında çağıranın kimliğe bürünmesi için hizmet modeli desteği açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-120">This topic describes service model support for impersonating the caller during the implementation of a service method.</span></span> <span data-ttu-id="6b1ff-121">Ayrıca, bu senaryolarda kimliğe bürünme ve SOAP Güvenliği ve WCF seçeneklerini içeren yaygın dağıtım senaryolarından de bahsedildi.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-121">Also discussed are common deployment scenarios involving impersonation and SOAP security and WCF options in these scenarios.</span></span>  
  
 <span data-ttu-id="6b1ff-122">Bu konu, SOAP güvenliği kullanılırken WCF 'de kimliğe bürünme ve temsili ile odaklanır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-122">This topic focuses on impersonation and delegation in WCF when using SOAP security.</span></span> <span data-ttu-id="6b1ff-123">Aktarım güvenliği [Ile kimliğe bürünme kullanma](using-impersonation-with-transport-security.md)bölümünde açıklandığı gibi, aktarım GÜVENLIĞI kullanılırken WCF ile kimliğe bürünme ve temsil özelliğini de kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-123">You can also use impersonation and delegation with WCF when using transport security, as described in [Using Impersonation with Transport Security](using-impersonation-with-transport-security.md).</span></span>  
  
## <a name="two-methods"></a><span data-ttu-id="6b1ff-124">İki yöntem</span><span class="sxs-lookup"><span data-stu-id="6b1ff-124">Two Methods</span></span>  
 <span data-ttu-id="6b1ff-125">WCF SOAP güvenliğinin, kimliğe bürünme işlemini gerçekleştirmek için iki ayrı yöntemi vardır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-125">WCF SOAP security has two distinct methods for performing impersonation.</span></span> <span data-ttu-id="6b1ff-126">Kullanılan yöntem bağlamaya bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-126">The method used depends on the binding.</span></span> <span data-ttu-id="6b1ff-127">Bunlardan biri, güvenlik desteği sağlayıcısı arabirimi (SSPI) veya Kerberos kimlik doğrulamasından alınan bir Windows belirtecinden kimliğe bürünme yoluyla, daha sonra hizmette önbelleğe alınır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-127">One is impersonation from a Windows token obtained from the Security Support Provider Interface (SSPI) or Kerberos authentication, which is then cached on the service.</span></span> <span data-ttu-id="6b1ff-128">İkincisi, toplu olarak *Service-for-User* (S4U) olarak adlandırılan Kerberos uzantılarından alınan bir Windows belirtecinden kimliğe bürünme özelliğine sahiptir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-128">The second is impersonation from a Windows token obtained from the Kerberos extensions, collectively called *Service-for-User* (S4U).</span></span>  
  
### <a name="cached-token-impersonation"></a><span data-ttu-id="6b1ff-129">Önbelleğe alınmış belirteç kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-129">Cached Token Impersonation</span></span>  
 <span data-ttu-id="6b1ff-130">Önbelleğe alınmış belirteç kimliğe bürünme işlemini aşağıda bulabilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="6b1ff-130">You can perform cached-token impersonation with the following:</span></span>  
  
- <span data-ttu-id="6b1ff-131"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding> , ve <xref:System.ServiceModel.NetTcpBinding> bir Windows istemci kimlik bilgileri ile.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-131"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a Windows client credential.</span></span>  
  
- <span data-ttu-id="6b1ff-132"><xref:System.ServiceModel.BasicHttpBinding><xref:System.ServiceModel.BasicHttpSecurityMode> <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> kimlik bilgisi veya istemcinin, hizmetin geçerli bir Windows hesabıyla eşlenebilmesi için bir Kullanıcı adı kimlik bilgisi sunan herhangi bir standart bağlama ile bir kümesi vardır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-132"><xref:System.ServiceModel.BasicHttpBinding> with a <xref:System.ServiceModel.BasicHttpSecurityMode> set to the <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> credential, or any other standard binding where the client presents a user name credential that the service can map to a valid Windows account.</span></span>  
  
- <span data-ttu-id="6b1ff-133">Herhangi biri <xref:System.ServiceModel.Channels.CustomBinding> , olarak ayarlanmış bir Windows istemci kimlik bilgisi kullanır `requireCancellation` `true` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-133">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` set to `true`.</span></span> <span data-ttu-id="6b1ff-134">(Özelliği şu sınıflarda kullanılabilir: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters> , <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters> , ve <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters> .) Bağlamada güvenli bir konuşma kullanılıyorsa, `requireCancellation` özelliği de olarak ayarlanmalıdır `true` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-134">(The property is available on the following classes: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, and <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) If a secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
- <span data-ttu-id="6b1ff-135"><xref:System.ServiceModel.Channels.CustomBinding>İstemci, Kullanıcı adı kimlik bilgisini sunan her yerde.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-135">Any <xref:System.ServiceModel.Channels.CustomBinding> where the client presents a user name credential.</span></span> <span data-ttu-id="6b1ff-136">Bağlamada güvenli konuşma kullanılıyorsa, `requireCancellation` özelliği de olarak ayarlanmalıdır `true` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-136">If secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
### <a name="s4u-based-impersonation"></a><span data-ttu-id="6b1ff-137">S4U tabanlı kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-137">S4U-Based Impersonation</span></span>  
 <span data-ttu-id="6b1ff-138">Aşağıdaki ile S4U tabanlı kimliğe bürünme gerçekleştirebilirsiniz:</span><span class="sxs-lookup"><span data-stu-id="6b1ff-138">You can perform S4U-based impersonation with the following:</span></span>  
  
- <span data-ttu-id="6b1ff-139"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding> , ve <xref:System.ServiceModel.NetTcpBinding> hizmetin geçerli bir Windows hesabıyla eşlenebilmesi için sertifika istemci kimlik bilgileri ile.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-139"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a certificate client credential that the service can map to a valid Windows account.</span></span>  
  
- <span data-ttu-id="6b1ff-140">Herhangi biri <xref:System.ServiceModel.Channels.CustomBinding> , `requireCancellation` özelliği olarak ayarlanmış bir Windows istemci kimlik bilgisi kullanır `false` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-140">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` property set to `false`.</span></span>  
  
- <span data-ttu-id="6b1ff-141">Herhangi biri <xref:System.ServiceModel.Channels.CustomBinding> , `requireCancellation` özelliği olarak ayarlanmış bir Kullanıcı adı veya Windows istemci kimlik bilgisi ve güvenli konuşma kullanır `false` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-141">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a user name or Windows client credential and secure conversation with the `requireCancellation` property set to `false`.</span></span>  
  
 <span data-ttu-id="6b1ff-142">Hizmetin, istemcinin kimliğine bürünebileceği kapsam, hizmet hesabının kimliğe bürünme girişiminde bulunduğu ayrıcalıklara, kullanılan kimliğe bürünme türüne ve istemcinin izin verdiği kimliğe bürünme kapsamına bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-142">The extent to which the service can impersonate the client depends on the privileges the service account holds when it attempts impersonation, the type of impersonation used, and possibly the extent of impersonation the client permits.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6b1ff-143">İstemci ve hizmet aynı bilgisayar üzerinde çalışırken ve istemci bir sistem hesabı (örneğin, `Local System` veya) altında çalışıyorsa `Network Service` , durum bilgisi olan güvenlik bağlamı belirteçleri ile güvenli bir oturum oluşturulduğunda istemciye kimliğe bürünme yapılamaz.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-143">When the client and service are running on the same computer and the client is running under a system account (for example, `Local System` or `Network Service`), the client cannot be impersonated when a secure session is established with stateful Security Context tokens.</span></span> <span data-ttu-id="6b1ff-144">Bir Windows form veya konsol uygulaması genellikle şu anda oturum açmış olan hesap altında çalışır, bu sayede hesaba varsayılan olarak kimliğe bürünme yapılabilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-144">A Windows Form or console application typically runs under the currently logged-in account, so that account can be impersonated by default.</span></span> <span data-ttu-id="6b1ff-145">Ancak, istemci bir ASP.NET sayfası olduğunda ve Bu sayfa IIS 6,0 veya IIS 7,0 ' de barındırılıyorsa, istemci `Network Service` Varsayılan olarak hesap altında çalışır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-145">However, when the client is an ASP.NET page and that page is hosted in IIS 6.0 or IIS 7.0, then the client does run under the `Network Service` account by default.</span></span> <span data-ttu-id="6b1ff-146">Güvenli oturumları destekleyen sistem tarafından sağlanmış tüm bağlamalar, varsayılan olarak durum bilgisi olmayan bir güvenlik bağlamı belirteci (SCT) kullanır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-146">All of the system-provided bindings that support secure sessions use a stateless security context token (SCT) by default.</span></span> <span data-ttu-id="6b1ff-147">Ancak, istemci bir ASP.NET sayfalararsa ve durum bilgisi olan güvenlik oturumları kullanılıyorsa, istemciye kimliğe bürünme yapılamaz.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-147">However, if the client is an ASP.NET page, and secure sessions with stateful SCTs are used, the client cannot be impersonated.</span></span> <span data-ttu-id="6b1ff-148">Güvenli bir oturumda durum bilgisi olan SCN 'leri kullanma hakkında daha fazla bilgi için bkz. [nasıl yapılır: güvenli bir oturum Için güvenlik bağlamı belirteci oluşturma](how-to-create-a-security-context-token-for-a-secure-session.md).</span><span class="sxs-lookup"><span data-stu-id="6b1ff-148">For more information about using stateful SCTs in a secure session, see [How to: Create a Security Context Token for a Secure Session](how-to-create-a-security-context-token-for-a-secure-session.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-declarative-model"></a><span data-ttu-id="6b1ff-149">Hizmet yönteminde kimliğe bürünme: bildirime dayalı model</span><span class="sxs-lookup"><span data-stu-id="6b1ff-149">Impersonation in a Service Method: Declarative Model</span></span>  
 <span data-ttu-id="6b1ff-150">Çoğu kimliğe bürünme senaryosunda, çağıran bağlamda hizmet yönteminin yürütülmesi yer alabilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-150">Most impersonation scenarios involve executing the service method in the caller context.</span></span> <span data-ttu-id="6b1ff-151">WCF, kullanıcının özniteliğinde kimliğe bürünme gereksinimini belirtmesini sağlayarak bunu kolay hale getiren bir kimliğe bürünme özelliği sağlar <xref:System.ServiceModel.OperationBehaviorAttribute> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-151">WCF provides an impersonation feature that makes this easy to do by allowing the user to specify the impersonation requirement in the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute.</span></span> <span data-ttu-id="6b1ff-152">Örneğin, aşağıdaki kodda, WCF altyapısı yöntemini yürütmeden önce çağıranı taklit eder `Hello` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-152">For example, in the following code, the WCF infrastructure impersonates the caller before executing the `Hello` method.</span></span> <span data-ttu-id="6b1ff-153">Yöntemi içindeki yerel kaynaklara erişme girişimleri, `Hello` yalnızca kaynağın erişim denetim listesi (ACL) arayan erişim ayrıcalıklarına izin veriyorsa başarılı olur.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-153">Any attempt to access native resources inside the `Hello` method succeed only if the access control list (ACL) of the resource allows the caller access privileges.</span></span> <span data-ttu-id="6b1ff-154">Kimliğe bürünme özelliğini etkinleştirmek için, <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> özelliği, <xref:System.ServiceModel.ImpersonationOption> <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType> Aşağıdaki örnekte gösterildiği gibi, ya da bir numaralandırma değerlerinden birine ayarlayın.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-154">To enable impersonation, set the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property to one of the <xref:System.ServiceModel.ImpersonationOption> enumeration values, either <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> or <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, as shown in the following example.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6b1ff-155">Bir hizmet, uzak istemciden daha yüksek kimlik bilgilerine sahip olduğunda, özelliği olarak ayarlandıysa hizmetin kimlik bilgileri kullanılır <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> <xref:System.ServiceModel.ImpersonationOption.Allowed> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-155">When a service has higher credentials than the remote client, the credentials of the service are used if the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span></span> <span data-ttu-id="6b1ff-156">Diğer bir deyişle, düşük ayrıcalıklı bir kullanıcı kimlik bilgilerini sağlıyorsa, daha yüksek ayrıcalıklı bir hizmet yöntemi hizmetin kimlik bilgileriyle yürütür ve düşük ayrıcalıklı kullanıcının başka bir şekilde kullanamayacak kaynakları kullanabilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-156">That is, if a low-privileged user provides its credentials, a higher-privileged service executes the method with the credentials of the service, and can use resources that the low-privileged user would otherwise not be able to use.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#1)]
 [!code-vb[c_ImpersonationAndDelegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#1)]  
  
 <span data-ttu-id="6b1ff-157">WCF altyapısı, yalnızca çağıran tarafından bir Windows kullanıcı hesabıyla eşleştirilecek kimlik bilgileriyle doğrulandıysa çağıranın kimliğine bürünebilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-157">The WCF infrastructure can impersonate the caller only if the caller is authenticated with credentials that can be mapped to a Windows user account.</span></span> <span data-ttu-id="6b1ff-158">Hizmet, bir Windows hesabına eşlenemeyen bir kimlik bilgisi kullanarak kimlik doğrulaması yapacak şekilde yapılandırıldıysa, hizmet yöntemi yürütülmez.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-158">If the service is configured to authenticate using a credential that cannot be mapped to a Windows account, the service method is not executed.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6b1ff-159">Windows XP 'de, bir durum bilgisi olan bir SCT oluşturulduysa kimliğe bürünme başarısız olur ve buna yol açar <xref:System.InvalidOperationException> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-159">On Windows XP, impersonation fails if a stateful SCT is created, resulting in an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="6b1ff-160">Daha fazla bilgi için bkz. [desteklenmeyen senaryolar](unsupported-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="6b1ff-160">For more information, see [Unsupported Scenarios](unsupported-scenarios.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-imperative-model"></a><span data-ttu-id="6b1ff-161">Bir hizmet yönteminde kimliğe bürünme: kesinlik temelli model</span><span class="sxs-lookup"><span data-stu-id="6b1ff-161">Impersonation in a Service Method: Imperative Model</span></span>  
 <span data-ttu-id="6b1ff-162">Bazen bir çağıranın, işlev için tüm hizmet yöntemini taklit etmesine gerek yoktur, ancak yalnızca bir bölümü için.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-162">Sometimes a caller does not need to impersonate the entire service method to function, but for only a portion of it.</span></span> <span data-ttu-id="6b1ff-163">Bu durumda, çağıranın Windows kimliğini hizmet yöntemi içinde edinin ve imperatively kimliğe bürünme işlemini gerçekleştirin.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-163">In this case, obtain the Windows identity of the caller inside the service method and imperatively perform the impersonation.</span></span> <span data-ttu-id="6b1ff-164">Bunu <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> , <xref:System.ServiceModel.ServiceSecurityContext> sınıfının bir örneğini döndürmek <xref:System.Security.Principal.WindowsIdentity> ve <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> örneği kullanmadan önce metodunu çağırmak için özelliğini kullanarak yapın.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-164">Do this by using the <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> property of the <xref:System.ServiceModel.ServiceSecurityContext> to return an instance of the <xref:System.Security.Principal.WindowsIdentity> class and calling the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method before using the instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6b1ff-165">`Using` `using` Kimliğe bürünme eylemini otomatik olarak dönüştürmek için Visual Basic ifadesini veya C# ifadesini kullandığınızdan emin olun.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-165">Be sure to use the Visual Basic`Using` statement or the C# `using` statement to automatically revert the impersonation action.</span></span> <span data-ttu-id="6b1ff-166">İfadesini kullanmazsanız veya Visual Basic veya C# dışında bir programlama dili kullanıyorsanız, kimliğe bürünme düzeyini döndürtığınızdan emin olun.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-166">If you do not use the statement, or if you use a programming language other than Visual Basic or C#, be sure to revert the impersonation level.</span></span> <span data-ttu-id="6b1ff-167">Bunun yapılmaması, hizmet reddi ve ayrıcalık yükselmesi saldırıları için temel oluşturur.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-167">Failure to do this can form the basis for denial of service and elevation of privilege attacks.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#2)]
 [!code-vb[c_ImpersonationAndDelegation#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#2)]  
  
## <a name="impersonation-for-all-service-methods"></a><span data-ttu-id="6b1ff-168">Tüm hizmet yöntemleri için kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-168">Impersonation for All Service Methods</span></span>  
 <span data-ttu-id="6b1ff-169">Bazı durumlarda, arayanın bağlamında bir hizmetin tüm yöntemlerini gerçekleştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-169">In some cases, you must perform all the methods of a service in the caller’s context.</span></span> <span data-ttu-id="6b1ff-170">Bu özelliği Yöntem temelinde açıkça etkinleştirmek yerine öğesini kullanın <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-170">Instead of explicitly enabling this feature on a per-method basis, use the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span></span> <span data-ttu-id="6b1ff-171">Aşağıdaki kodda gösterildiği gibi, <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> özelliğini olarak ayarlayın `true` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-171">As shown in the following code, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> property to `true`.</span></span> <span data-ttu-id="6b1ff-172">, <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> Sınıfının davranış koleksiyonlarından alınır <xref:System.ServiceModel.ServiceHost> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-172">The <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> is retrieved from the collections of behaviors of the <xref:System.ServiceModel.ServiceHost> class.</span></span> <span data-ttu-id="6b1ff-173">Ayrıca `Impersonation` , <xref:System.ServiceModel.OperationBehaviorAttribute> her metoda uygulanan özelliğinin ya da olarak ayarlanması gerektiğini unutmayın <xref:System.ServiceModel.ImpersonationOption.Allowed> <xref:System.ServiceModel.ImpersonationOption.Required> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-173">Also note that the `Impersonation` property of the <xref:System.ServiceModel.OperationBehaviorAttribute> applied to each method must also be set to either <xref:System.ServiceModel.ImpersonationOption.Allowed> or <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#3)]
 [!code-vb[c_ImpersonationAndDelegation#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#3)]  
  
 <span data-ttu-id="6b1ff-174">Aşağıdaki tabloda, ve ' nin tüm olası birleşimleri için WCF davranışı açıklanmaktadır `ImpersonationOption` `ImpersonateCallerForAllServiceOperations` .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-174">The following table describes WCF behavior for all possible combinations of `ImpersonationOption` and `ImpersonateCallerForAllServiceOperations`.</span></span>  
  
|`ImpersonationOption`|`ImpersonateCallerForAllServiceOperations`|<span data-ttu-id="6b1ff-175">Davranış</span><span class="sxs-lookup"><span data-stu-id="6b1ff-175">Behavior</span></span>|  
|---------------------------|------------------------------------------------|--------------|  
|<span data-ttu-id="6b1ff-176">Gerekli</span><span class="sxs-lookup"><span data-stu-id="6b1ff-176">Required</span></span>|<span data-ttu-id="6b1ff-177">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-177">n/a</span></span>|<span data-ttu-id="6b1ff-178">WCF Çağrıyı taklit eder</span><span class="sxs-lookup"><span data-stu-id="6b1ff-178">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="6b1ff-179">İzin Verildi</span><span class="sxs-lookup"><span data-stu-id="6b1ff-179">Allowed</span></span>|<span data-ttu-id="6b1ff-180">yanlış</span><span class="sxs-lookup"><span data-stu-id="6b1ff-180">false</span></span>|<span data-ttu-id="6b1ff-181">WCF, çağıranın kimliğine bürünemez</span><span class="sxs-lookup"><span data-stu-id="6b1ff-181">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="6b1ff-182">İzin Verildi</span><span class="sxs-lookup"><span data-stu-id="6b1ff-182">Allowed</span></span>|<span data-ttu-id="6b1ff-183">true</span><span class="sxs-lookup"><span data-stu-id="6b1ff-183">true</span></span>|<span data-ttu-id="6b1ff-184">WCF Çağrıyı taklit eder</span><span class="sxs-lookup"><span data-stu-id="6b1ff-184">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="6b1ff-185">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="6b1ff-185">NotAllowed</span></span>|<span data-ttu-id="6b1ff-186">yanlış</span><span class="sxs-lookup"><span data-stu-id="6b1ff-186">false</span></span>|<span data-ttu-id="6b1ff-187">WCF, çağıranın kimliğine bürünemez</span><span class="sxs-lookup"><span data-stu-id="6b1ff-187">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="6b1ff-188">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="6b1ff-188">NotAllowed</span></span>|<span data-ttu-id="6b1ff-189">true</span><span class="sxs-lookup"><span data-stu-id="6b1ff-189">true</span></span>|<span data-ttu-id="6b1ff-190">Veril.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-190">Disallowed.</span></span> <span data-ttu-id="6b1ff-191">(Bir oluşturulur <xref:System.InvalidOperationException> .)</span><span class="sxs-lookup"><span data-stu-id="6b1ff-191">(An <xref:System.InvalidOperationException> is thrown.)</span></span>|  
  
## <a name="impersonation-level-obtained-from-windows-credentials-and-cached-token-impersonation"></a><span data-ttu-id="6b1ff-192">Windows kimlik bilgileri ve önbelleğe alınmış belirteç kimliğe bürünme ile edinilen kimliğe bürünme düzeyi</span><span class="sxs-lookup"><span data-stu-id="6b1ff-192">Impersonation Level Obtained from Windows Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="6b1ff-193">Bazı senaryolarda, istemci bir Windows istemci kimlik bilgisi kullanıldığında hizmetin gerçekleştirdiği kimliğe bürünme düzeyi üzerinde kısmi denetime sahiptir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-193">In some scenarios the client has partial control over the level of impersonation the service performs when a Windows client credential is used.</span></span> <span data-ttu-id="6b1ff-194">İstemci anonim kimliğe bürünme düzeyi belirttiğinde bir senaryo meydana gelir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-194">One scenario occurs when the client specifies an Anonymous impersonation level.</span></span> <span data-ttu-id="6b1ff-195">Diğer bir deyişle, önbelleğe alınmış bir belirteçle kimliğe bürünme işlemi gerçekleştirilirken meydana gelir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-195">The other occurs when performing impersonation with a cached token.</span></span> <span data-ttu-id="6b1ff-196">Bu, <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> <xref:System.ServiceModel.Security.WindowsClientCredential> genel sınıfın bir özelliği olarak erişilen sınıfının özelliği ayarlanarak yapılır <xref:System.ServiceModel.ChannelFactory%601> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-196">This is done by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6b1ff-197">Kimliğe bürünme düzeyi belirtilmesi, istemcinin hizmette anonim olarak oturum açmasına neden olur.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-197">Specifying an impersonation level of Anonymous causes the client to log on to the service anonymously.</span></span> <span data-ttu-id="6b1ff-198">Bu nedenle, kimliğe bürünme işleminin gerçekleştirilip gerçekleştirilmediğine bakılmaksızın hizmetin anonim oturum açmalarına izin vermelidir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-198">The service must therefore allow anonymous logons, regardless of whether impersonation is performed.</span></span>  
  
 <span data-ttu-id="6b1ff-199">İstemci kimliğe bürünme düzeyini,, veya olarak <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous> belirtebilir <xref:System.Security.Principal.TokenImpersonationLevel.Identification> <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation> <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-199">The client can specify the impersonation level as <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, or <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="6b1ff-200">Aşağıdaki kodda gösterildiği gibi, yalnızca belirtilen düzeydeki bir belirteç oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-200">Only a token at the specified level is produced, as shown in the following code.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#4)]
 [!code-vb[c_ImpersonationAndDelegation#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#4)]  
  
 <span data-ttu-id="6b1ff-201">Aşağıdaki tablo, önbelleğe alınmış bir belirteçle kimliğe bürünme sırasında hizmetin aldığı kimliğe bürünme düzeyini belirtir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-201">The following table specifies the impersonation level the service obtains when impersonating from a cached token.</span></span>  
  
|<span data-ttu-id="6b1ff-202">`AllowedImpersonationLevel`deeri</span><span class="sxs-lookup"><span data-stu-id="6b1ff-202">`AllowedImpersonationLevel` value</span></span>|<span data-ttu-id="6b1ff-203">Hizmet,`SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-203">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="6b1ff-204">Hizmet ve istemci, temsilciliğini alabilir</span><span class="sxs-lookup"><span data-stu-id="6b1ff-204">Service and client are capable of delegation</span></span>|<span data-ttu-id="6b1ff-205">Önbelleğe alınmış belirteç`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-205">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="6b1ff-206">Anonim</span><span class="sxs-lookup"><span data-stu-id="6b1ff-206">Anonymous</span></span>|<span data-ttu-id="6b1ff-207">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-207">Yes</span></span>|<span data-ttu-id="6b1ff-208">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-208">n/a</span></span>|<span data-ttu-id="6b1ff-209">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-209">Impersonation</span></span>|  
|<span data-ttu-id="6b1ff-210">Anonim</span><span class="sxs-lookup"><span data-stu-id="6b1ff-210">Anonymous</span></span>|<span data-ttu-id="6b1ff-211">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-211">No</span></span>|<span data-ttu-id="6b1ff-212">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-212">n/a</span></span>|<span data-ttu-id="6b1ff-213">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-213">Identification</span></span>|  
|<span data-ttu-id="6b1ff-214">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-214">Identification</span></span>|<span data-ttu-id="6b1ff-215">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-215">n/a</span></span>|<span data-ttu-id="6b1ff-216">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-216">n/a</span></span>|<span data-ttu-id="6b1ff-217">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-217">Identification</span></span>|  
|<span data-ttu-id="6b1ff-218">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-218">Impersonation</span></span>|<span data-ttu-id="6b1ff-219">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-219">Yes</span></span>|<span data-ttu-id="6b1ff-220">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-220">n/a</span></span>|<span data-ttu-id="6b1ff-221">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-221">Impersonation</span></span>|  
|<span data-ttu-id="6b1ff-222">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-222">Impersonation</span></span>|<span data-ttu-id="6b1ff-223">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-223">No</span></span>|<span data-ttu-id="6b1ff-224">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-224">n/a</span></span>|<span data-ttu-id="6b1ff-225">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-225">Identification</span></span>|  
|<span data-ttu-id="6b1ff-226">Temsilci</span><span class="sxs-lookup"><span data-stu-id="6b1ff-226">Delegation</span></span>|<span data-ttu-id="6b1ff-227">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-227">Yes</span></span>|<span data-ttu-id="6b1ff-228">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-228">Yes</span></span>|<span data-ttu-id="6b1ff-229">Temsilci</span><span class="sxs-lookup"><span data-stu-id="6b1ff-229">Delegation</span></span>|  
|<span data-ttu-id="6b1ff-230">Temsilci</span><span class="sxs-lookup"><span data-stu-id="6b1ff-230">Delegation</span></span>|<span data-ttu-id="6b1ff-231">Evet</span><span class="sxs-lookup"><span data-stu-id="6b1ff-231">Yes</span></span>|<span data-ttu-id="6b1ff-232">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-232">No</span></span>|<span data-ttu-id="6b1ff-233">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-233">Impersonation</span></span>|  
|<span data-ttu-id="6b1ff-234">Temsilci</span><span class="sxs-lookup"><span data-stu-id="6b1ff-234">Delegation</span></span>|<span data-ttu-id="6b1ff-235">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-235">No</span></span>|<span data-ttu-id="6b1ff-236">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-236">n/a</span></span>|<span data-ttu-id="6b1ff-237">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-237">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-user-name-credentials-and-cached-token-impersonation"></a><span data-ttu-id="6b1ff-238">Kullanıcı adı kimlik bilgilerinden alınan kimliğe bürünme düzeyi ve önbelleğe alınmış belirteç kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-238">Impersonation Level Obtained from User Name Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="6b1ff-239">Bir istemci, hizmetin Kullanıcı adı ve parolasını geçirerek, özelliğin özelliği olarak ayarlanmasına eşdeğer olan kullanıcının bu kullanıcı olarak oturum açmasına olanak sağlar `AllowedImpersonationLevel` <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> .</span><span class="sxs-lookup"><span data-stu-id="6b1ff-239">By passing the service its user name and password, a client enables WCF to log on as that user, which is equivalent to setting the `AllowedImpersonationLevel` property to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="6b1ff-240">( `AllowedImpersonationLevel` <xref:System.ServiceModel.Security.WindowsClientCredential> Ve <xref:System.ServiceModel.Security.HttpDigestClientCredential> sınıflarında kullanılabilir.) Aşağıdaki tablo, hizmet Kullanıcı adı kimlik bilgilerini aldığında elde edilen kimliğe bürünme düzeyini sağlar.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-240">(The `AllowedImpersonationLevel` is available on the <xref:System.ServiceModel.Security.WindowsClientCredential> and <xref:System.ServiceModel.Security.HttpDigestClientCredential> classes.) The following table provides the impersonation level obtained when the service receives user name credentials.</span></span>  
  
|`AllowedImpersonationLevel`|<span data-ttu-id="6b1ff-241">Hizmet,`SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-241">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="6b1ff-242">Hizmet ve istemci, temsilciliğini alabilir</span><span class="sxs-lookup"><span data-stu-id="6b1ff-242">Service and client are capable of delegation</span></span>|<span data-ttu-id="6b1ff-243">Önbelleğe alınmış belirteç`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-243">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="6b1ff-244">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-244">n/a</span></span>|<span data-ttu-id="6b1ff-245">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-245">Yes</span></span>|<span data-ttu-id="6b1ff-246">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-246">Yes</span></span>|<span data-ttu-id="6b1ff-247">Temsilci</span><span class="sxs-lookup"><span data-stu-id="6b1ff-247">Delegation</span></span>|  
|<span data-ttu-id="6b1ff-248">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-248">n/a</span></span>|<span data-ttu-id="6b1ff-249">Evet</span><span class="sxs-lookup"><span data-stu-id="6b1ff-249">Yes</span></span>|<span data-ttu-id="6b1ff-250">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-250">No</span></span>|<span data-ttu-id="6b1ff-251">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-251">Impersonation</span></span>|  
|<span data-ttu-id="6b1ff-252">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-252">n/a</span></span>|<span data-ttu-id="6b1ff-253">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-253">No</span></span>|<span data-ttu-id="6b1ff-254">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-254">n/a</span></span>|<span data-ttu-id="6b1ff-255">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-255">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-s4u-based-impersonation"></a><span data-ttu-id="6b1ff-256">S4U tabanlı kimliğe bürünme 'den edinilen kimliğe bürünme düzeyi</span><span class="sxs-lookup"><span data-stu-id="6b1ff-256">Impersonation Level Obtained from S4U-Based Impersonation</span></span>  
  
|<span data-ttu-id="6b1ff-257">Hizmet,`SeTcbPrivilege`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-257">Service has `SeTcbPrivilege`</span></span>|<span data-ttu-id="6b1ff-258">Hizmet,`SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-258">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="6b1ff-259">Hizmet ve istemci, temsilciliğini alabilir</span><span class="sxs-lookup"><span data-stu-id="6b1ff-259">Service and client are capable of delegation</span></span>|<span data-ttu-id="6b1ff-260">Önbelleğe alınmış belirteç`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="6b1ff-260">Cached token `ImpersonationLevel`</span></span>|  
|----------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="6b1ff-261">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-261">Yes</span></span>|<span data-ttu-id="6b1ff-262">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-262">Yes</span></span>|<span data-ttu-id="6b1ff-263">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-263">n/a</span></span>|<span data-ttu-id="6b1ff-264">Kimliğe bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-264">Impersonation</span></span>|  
|<span data-ttu-id="6b1ff-265">Evet</span><span class="sxs-lookup"><span data-stu-id="6b1ff-265">Yes</span></span>|<span data-ttu-id="6b1ff-266">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-266">No</span></span>|<span data-ttu-id="6b1ff-267">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-267">n/a</span></span>|<span data-ttu-id="6b1ff-268">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-268">Identification</span></span>|  
|<span data-ttu-id="6b1ff-269">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-269">No</span></span>|<span data-ttu-id="6b1ff-270">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-270">n/a</span></span>|<span data-ttu-id="6b1ff-271">yok</span><span class="sxs-lookup"><span data-stu-id="6b1ff-271">n/a</span></span>|<span data-ttu-id="6b1ff-272">Kimlik</span><span class="sxs-lookup"><span data-stu-id="6b1ff-272">Identification</span></span>|  
  
## <a name="mapping-a-client-certificate-to-a-windows-account"></a><span data-ttu-id="6b1ff-273">Bir Istemci sertifikasını bir Windows hesabıyla eşleme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-273">Mapping a Client Certificate to a Windows Account</span></span>  
 <span data-ttu-id="6b1ff-274">Bir istemcinin sertifikayı kullanarak bir hizmette kimliğini doğrulaması ve hizmetin istemciyi Active Directory aracılığıyla mevcut bir hesapla eşlemesini sağlamak mümkündür.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-274">It is possible for a client to authenticate itself to a service using a certificate, and to have the service map the client to an existing account through Active Directory.</span></span> <span data-ttu-id="6b1ff-275">Aşağıdaki XML, sertifikayı eşlemek için hizmetin nasıl yapılandırılacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-275">The following XML shows how to configure the service to map the certificate.</span></span>  
  
```xml  
<behaviors>  
  <serviceBehaviors>  
    <behavior name="MapToWindowsAccount">  
      <serviceCredentials>  
        <clientCertificate>  
          <authentication mapClientCertificateToWindowsAccount="true" />  
        </clientCertificate>  
      </serviceCredentials>  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
```  
  
 <span data-ttu-id="6b1ff-276">Aşağıdaki kod, hizmetin nasıl yapılandırılacağını gösterir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-276">The following code shows how to configure the service.</span></span>  
  
```csharp
// Create a binding that sets a certificate as the client credential type.  
WSHttpBinding b = new WSHttpBinding();  
b.Security.Message.ClientCredentialType = MessageCredentialType.Certificate;  
  
// Create a service host that maps the certificate to a Windows account.  
Uri httpUri = new Uri("http://localhost/Calculator");  
ServiceHost sh = new ServiceHost(typeof(HelloService), httpUri);  
sh.Credentials.ClientCertificate.Authentication.MapClientCertificateToWindowsAccount = true;  
```  
  
## <a name="delegation"></a><span data-ttu-id="6b1ff-277">Temsilci</span><span class="sxs-lookup"><span data-stu-id="6b1ff-277">Delegation</span></span>  
 <span data-ttu-id="6b1ff-278">Bir arka uç hizmetine temsilci seçmek için, bir hizmet, istemcinin Windows kimliğini kullanarak Kerberos Multi-BAI (NTLM geri dönüşü olmadan SSPI) veya arka uç hizmetine Kerberos doğrudan kimlik doğrulaması gerçekleştirmelidir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-278">To delegate to a back-end service, a service must perform Kerberos multi-leg (SSPI without NTLM fallback) or Kerberos direct authentication to the back-end service using the client’s Windows identity.</span></span> <span data-ttu-id="6b1ff-279">Bir arka uç hizmetine temsilci seçmek için bir <xref:System.ServiceModel.ChannelFactory%601> ve bir kanal oluşturun ve sonra istemciyi taklit ederken kanal üzerinden iletişim kurun.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-279">To delegate to a back-end service, create a <xref:System.ServiceModel.ChannelFactory%601> and a channel, and then communicate through the channel while impersonating the client.</span></span> <span data-ttu-id="6b1ff-280">Bu tür bir temsilciyle, arka uç hizmetinin ön uç hizmetinden konumlandırıldığı mesafe ön uç hizmeti tarafından elde edilen kimliğe bürünme düzeyine bağlıdır.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-280">With this form of delegation, the distance at which the back-end service can be located from the front-end service depends on the impersonation level achieved by the front-end service.</span></span> <span data-ttu-id="6b1ff-281">Kimliğe bürünme düzeyi olduğunda <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation> , ön uç ve arka uç hizmetlerinin aynı makinede çalışıyor olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-281">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, the front-end and back-end services must be running on the same machine.</span></span> <span data-ttu-id="6b1ff-282">Kimliğe bürünme düzeyi olduğunda <xref:System.Security.Principal.TokenImpersonationLevel.Delegation> , ön uç ve arka uç hizmetleri ayrı makinelerde veya aynı makinede olabilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-282">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, the front-end and back-end services can be on separate machines or on the same machine.</span></span> <span data-ttu-id="6b1ff-283">Temsili düzeyi kimliğe bürünme özelliğinin etkinleştirilmesi için Windows etki alanı ilkesinin temsilciliğe izin verecek şekilde yapılandırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-283">Enabling delegation-level impersonation requires that Windows domain policy be configured to permit delegation.</span></span> <span data-ttu-id="6b1ff-284">Temsilci desteği için Active Directory yapılandırma hakkında daha fazla bilgi için bkz. [temsilci kimlik doğrulamasını etkinleştirme](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc780217(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="6b1ff-284">For more information about configuring Active Directory for delegation support, see [Enabling Delegated Authentication](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc780217(v=ws.10)).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="6b1ff-285">İstemci, arka uç hizmetindeki bir Windows hesabına karşılık gelen bir Kullanıcı adı ve parola kullanarak ön uç hizmetinde kimlik doğrulaması gerçekleştiriyorsa, ön uç hizmeti istemcinin kullanıcı adını ve parolasını yeniden kullanarak arka uç hizmetinde kimlik doğrulaması yapabilir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-285">When a client authenticates to the front-end service using a user name and password that correspond to a Windows account on the back-end service, the front-end service can authenticate to the back-end service by reusing the client’s user name and password.</span></span> <span data-ttu-id="6b1ff-286">Bu özellikle güçlü bir kimlik akışı biçimidir, çünkü arka uç hizmetine Kullanıcı adı ve parola geçirme, arka uç hizmetinin kimliğe bürünme işlemini gerçekleştirmesini sağlar ancak Kerberos kullanılmadığından, temsilciyi oluşturmaz.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-286">This is a particularly powerful form of identity flow, because passing user name and password to the back-end service enables the back-end service to perform impersonation, but it does not constitute delegation because Kerberos is not used.</span></span> <span data-ttu-id="6b1ff-287">Active Directory denetimleri, Kullanıcı adı ve parola kimlik doğrulaması için geçerlidir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-287">Active Directory controls on delegation do not apply to user name and password authentication.</span></span>  
  
### <a name="delegation-ability-as-a-function-of-impersonation-level"></a><span data-ttu-id="6b1ff-288">Kimliğe bürünme düzeyi Işlevi olarak temsil yeteneği</span><span class="sxs-lookup"><span data-stu-id="6b1ff-288">Delegation Ability as a Function of Impersonation Level</span></span>  
  
|<span data-ttu-id="6b1ff-289">Kimliğe bürünme düzeyi</span><span class="sxs-lookup"><span data-stu-id="6b1ff-289">Impersonation level</span></span>|<span data-ttu-id="6b1ff-290">Hizmet, işlemler arası temsili gerçekleştirebilir</span><span class="sxs-lookup"><span data-stu-id="6b1ff-290">Service can perform cross-process delegation</span></span>|<span data-ttu-id="6b1ff-291">Hizmet, makineler arası temsili gerçekleştirebilir</span><span class="sxs-lookup"><span data-stu-id="6b1ff-291">Service can perform cross-machine delegation</span></span>|  
|-------------------------|---------------------------------------------------|---------------------------------------------------|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Identification>|<span data-ttu-id="6b1ff-292">Hayır</span><span class="sxs-lookup"><span data-stu-id="6b1ff-292">No</span></span>|<span data-ttu-id="6b1ff-293">Hayır</span><span class="sxs-lookup"><span data-stu-id="6b1ff-293">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>|<span data-ttu-id="6b1ff-294">Evet</span><span class="sxs-lookup"><span data-stu-id="6b1ff-294">Yes</span></span>|<span data-ttu-id="6b1ff-295">No</span><span class="sxs-lookup"><span data-stu-id="6b1ff-295">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Delegation>|<span data-ttu-id="6b1ff-296">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-296">Yes</span></span>|<span data-ttu-id="6b1ff-297">Yes</span><span class="sxs-lookup"><span data-stu-id="6b1ff-297">Yes</span></span>|  
  
 <span data-ttu-id="6b1ff-298">Aşağıdaki kod örneği, temsilciyi nasıl kullanacağınızı gösterir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-298">The following code example demonstrates how to use delegation.</span></span>  
  
 [!code-csharp[c_delegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_delegation/cs/source.cs#1)]
 [!code-vb[c_delegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_delegation/vb/source.vb#1)]  
  
### <a name="how-to-configure-an-application-to-use-constrained-delegation"></a><span data-ttu-id="6b1ff-299">Bir uygulamayı kısıtlanmış temsilciyi kullanacak şekilde yapılandırma</span><span class="sxs-lookup"><span data-stu-id="6b1ff-299">How to Configure an Application to Use Constrained Delegation</span></span>  
 <span data-ttu-id="6b1ff-300">Kısıtlanmış temsilciyi kullanabilmeniz için, gönderenin, alıcının ve etki alanı denetleyicisinin bu şekilde yapılandırılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-300">Before you can use constrained delegation, the sender, receiver, and the domain controller must be configured to do so.</span></span> <span data-ttu-id="6b1ff-301">Aşağıdaki yordamda, kısıtlanmış temsilciyi etkinleştiren adımlar listelenmektedir.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-301">The following procedure lists the steps that enable constrained delegation.</span></span> <span data-ttu-id="6b1ff-302">Yetkilendirme ve kısıtlanmış yetkilendirme arasındaki farklılıklar hakkında daha fazla bilgi için, kısıtlanmış tartışmayı ele alan [Windows Server 2003 Kerberos uzantılarının](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc738207(v=ws.10)) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-302">For details about the differences between delegation and constrained delegation, see the portion of [Windows Server 2003 Kerberos Extensions](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc738207(v=ws.10)) that discusses constrained discussion.</span></span>  
  
1. <span data-ttu-id="6b1ff-303">Etki alanı denetleyicisinde, **Hesap duyarlıdır ve** istemci uygulamasının çalıştığı hesap için temsilci seçilemez onay kutusunu temizleyin.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-303">On the domain controller, clear the **Account is sensitive and cannot be delegated** check box for the account under which the client application is running.</span></span>  
  
2. <span data-ttu-id="6b1ff-304">Etki alanı denetleyicisinde, istemci uygulamasının çalıştığı hesap için **hesap için güvenilir** onay kutusunu seçin.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-304">On the domain controller, select the **Account is trusted for delegation** check box for the account under which the client application is running.</span></span>  
  
3. <span data-ttu-id="6b1ff-305">Etki alanı denetleyicisinde, orta katman bilgisayarı, yetkilendirme **Için güven bilgisayar** seçeneğine tıklayarak, yetkilendirme için güvenilecek şekilde yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-305">On the domain controller, configure the middle tier computer so that it is trusted for delegation, by clicking the **Trust computer for delegation** option.</span></span>  
  
4. <span data-ttu-id="6b1ff-306">Etki alanı denetleyicisinde, **Bu bilgisayara yalnızca belirtilen hizmetlere yetkilendirme Için güven** seçeneğini tıklayarak orta katman bilgisayarı Kısıtlı temsilciyi kullanacak şekilde yapılandırın.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-306">On the domain controller, configure the middle tier computer to use constrained delegation, by clicking the **Trust this computer for delegation to specified services only** option.</span></span>  
  
 <span data-ttu-id="6b1ff-307">Kısıtlanmış temsilciyi yapılandırma hakkında daha ayrıntılı yönergeler için bkz. [Kerberos protokol geçişi ve kısıtlanmış temsili](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc739587(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="6b1ff-307">For more detailed instructions about configuring constrained delegation, see [Kerberos Protocol Transition and Constrained Delegation](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc739587(v=ws.10)).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="6b1ff-308">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="6b1ff-308">See also</span></span>

- <xref:System.ServiceModel.OperationBehaviorAttribute>
- <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>
- <xref:System.ServiceModel.ImpersonationOption>
- <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A>
- <xref:System.ServiceModel.ServiceSecurityContext>
- <xref:System.Security.Principal.WindowsIdentity>
- <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>
- <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A>
- <xref:System.ServiceModel.ServiceHost>
- <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ChannelFactory%601>
- <xref:System.Security.Principal.TokenImpersonationLevel.Identification>
- [<span data-ttu-id="6b1ff-309">Taşıma Güvenliği ile Kimliğe Bürünme Kullanma</span><span class="sxs-lookup"><span data-stu-id="6b1ff-309">Using Impersonation with Transport Security</span></span>](using-impersonation-with-transport-security.md)
- [<span data-ttu-id="6b1ff-310">İstemci Kimliğine Bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-310">Impersonating the Client</span></span>](../samples/impersonating-the-client.md)
- [<span data-ttu-id="6b1ff-311">Nasıl yapılır: Bir Hizmette İstemci Kimliğine Bürünme</span><span class="sxs-lookup"><span data-stu-id="6b1ff-311">How to: Impersonate a Client on a Service</span></span>](../how-to-impersonate-a-client-on-a-service.md)
- [<span data-ttu-id="6b1ff-312">ServiceModel Meta Veri Yardımcı Programracı (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="6b1ff-312">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../servicemodel-metadata-utility-tool-svcutil-exe.md)
