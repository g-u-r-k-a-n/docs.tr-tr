---
title: SQL Server Bağlantı Havuzu
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 7e51d44e-7c4e-4040-9332-f0190fe36f07
ms.openlocfilehash: 149511bd4e84baabf11eca014257127b587830df
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/12/2020
ms.locfileid: "79149004"
---
# <a name="sql-server-connection-pooling-adonet"></a><span data-ttu-id="7a1ae-102">SQL Server Bağlantı Havuzu (ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="7a1ae-102">SQL Server Connection Pooling (ADO.NET)</span></span>
<span data-ttu-id="7a1ae-103">Bir veritabanı sunucusuna bağlanmak genellikle birkaç zaman alıcı adımdan oluşur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-103">Connecting to a database server typically consists of several time-consuming steps.</span></span> <span data-ttu-id="7a1ae-104">Soket veya adlandırılmış bir boru gibi fiziksel bir kanal kurulmalı, sunucuile ilk el sıkışma yapılmalı, bağlantı dize bilgileri ayrıştırılmalı, bağlantı sunucu tarafından doğrulanmalıdır, denetimler geçerli işlem ve benzeri.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-104">A physical channel such as a socket or a named pipe must be established, the initial handshake with the server must occur, the connection string information must be parsed, the connection must be authenticated by the server, checks must be run for enlisting in the current transaction, and so on.</span></span>  
  
 <span data-ttu-id="7a1ae-105">Uygulamada, çoğu uygulama bağlantılar için yalnızca bir veya birkaç farklı yapılandırma kullanır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-105">In practice, most applications use only one or a few different configurations for connections.</span></span> <span data-ttu-id="7a1ae-106">Bu, uygulama yürütme sırasında birçok aynı bağlantının art arda açılıp kapatılacağı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-106">This means that during application execution, many identical connections will be repeatedly opened and closed.</span></span> <span data-ttu-id="7a1ae-107">Bağlantıları açma maliyetini en aza indirmek için, ADO.NET *bağlantı havuzu*adı verilen bir optimizasyon tekniği kullanır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-107">To minimize the cost of opening connections, ADO.NET uses an optimization technique called *connection pooling*.</span></span>  
  
 <span data-ttu-id="7a1ae-108">Bağlantı havuzu, yeni bağlantıların kaç kez açılması gerektiğini azaltır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-108">Connection pooling reduces the number of times that new connections must be opened.</span></span> <span data-ttu-id="7a1ae-109">*Havuzcu* fiziksel bağlantının sahipliğini korur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-109">The *pooler* maintains ownership of the physical connection.</span></span> <span data-ttu-id="7a1ae-110">Verilen her bağlantı yapılandırması için bir dizi etkin bağlantıyı canlı tutarak bağlantıları yönetir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-110">It manages connections by keeping alive a set of active connections for each given connection configuration.</span></span> <span data-ttu-id="7a1ae-111">Bir kullanıcı bir `Open` bağlantıyı aradığında, havuzcu havuzda kullanılabilir bir bağlantı arar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-111">Whenever a user calls `Open` on a connection, the pooler looks for an available connection in the pool.</span></span> <span data-ttu-id="7a1ae-112">Birleştirilmiş bir bağlantı varsa, yeni bir bağlantı açmak yerine arayanın döndürür.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-112">If a pooled connection is available, it returns it to the caller instead of opening a new connection.</span></span> <span data-ttu-id="7a1ae-113">Uygulama bağlantıyı `Close` aradığında, havuzlayıcı bağlantıyı kapatmak yerine havuzlu etkin bağlantı kümesine döndürür.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-113">When the application calls `Close` on the connection, the pooler returns it to the pooled set of active connections instead of closing it.</span></span> <span data-ttu-id="7a1ae-114">Bağlantı havuza döndürüldükten sonra, bir sonraki `Open` çağrıda yeniden kullanılmaya hazırdır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-114">Once the connection is returned to the pool, it is ready to be reused on the next `Open` call.</span></span>  
  
 <span data-ttu-id="7a1ae-115">Yalnızca aynı yapılandırmaya sahip bağlantılar bir araya alınabilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-115">Only connections with the same configuration can be pooled.</span></span> <span data-ttu-id="7a1ae-116">ADO.NET aynı anda, her yapılandırma için bir tane olmak üzere birden fazla havuz tutar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-116">ADO.NET keeps several pools at the same time, one for each configuration.</span></span> <span data-ttu-id="7a1ae-117">Bağlantılar bağlantı dizesi ve tümleşik güvenlik kullanıldığında Windows kimliği tarafından havuzlara ayrılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-117">Connections are separated into pools by connection string, and by Windows identity when integrated security is used.</span></span> <span data-ttu-id="7a1ae-118">Bağlantılar, bir işlemde kaydolup olmadıklarına bağlı olarak da biraraya alınır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-118">Connections are also pooled based on whether they are enlisted in a transaction.</span></span> <span data-ttu-id="7a1ae-119">Kullanırken, <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A> <xref:System.Data.SqlClient.SqlCredential> örnek bağlantı havuzunu etkiler.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-119">When using <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, the <xref:System.Data.SqlClient.SqlCredential> instance affects the connection pool.</span></span> <span data-ttu-id="7a1ae-120"><xref:System.Data.SqlClient.SqlCredential> Kullanıcı kimliği ve parola aynı olsa bile, farklı bağlantı havuzları kullanır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-120">Different instances of <xref:System.Data.SqlClient.SqlCredential> will use different connection pools, even if the user ID and password are the same.</span></span>  
  
 <span data-ttu-id="7a1ae-121">Bağlantıları birleştirme, uygulamanızın performansını ve ölçeklenebilirliğini önemli ölçüde artırabilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-121">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="7a1ae-122">Varsayılan olarak, bağlantı havuzu ADO.NET etkinleştirilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-122">By default, connection pooling is enabled in ADO.NET.</span></span> <span data-ttu-id="7a1ae-123">Açıkça devre dışı kaldığınız sürece, havuzsahibi uygulamalarınızda açılıp kapandıkları için bağlantıları optimize eder.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-123">Unless you explicitly disable it, the pooler optimizes the connections as they are opened and closed in your application.</span></span> <span data-ttu-id="7a1ae-124">Bağlantı birleştirme davranışını denetlemek için birkaç bağlantı dizesi değiştirici de sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-124">You can also supply several connection string modifiers to control connection pooling behavior.</span></span> <span data-ttu-id="7a1ae-125">Daha fazla bilgi için daha sonra bu konuyla "Bağlantı Dizeanahtarlarıyla Bağlantı Havuzu'nun Denetleilmesi" konusuna bakın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-125">For more information, see "Controlling Connection Pooling with Connection String Keywords" later in this topic.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7a1ae-126">Bağlantı havuzu etkinleştirildiğinde ve bir zaman arası hatası veya başka bir oturum açma hatası oluşursa, bir özel durum atılır ve sonraki bağlantı denemeleri sonraki beş saniye boyunca "engelleme süresi" başarısız olur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-126">When connection pooling is enabled, and if a timeout error or other login error occurs, an exception will be thrown and subsequent connection attempts will fail for the next five seconds, the "blocking period".</span></span> <span data-ttu-id="7a1ae-127">Uygulama engelleme süresi içinde bağlanmaya çalışırsa, ilk özel durum yeniden atılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-127">If the application attempts to connect within the blocking period, the first exception will be thrown again.</span></span> <span data-ttu-id="7a1ae-128">Engelleme dönemi sona erdikten sonraki hatalar, bir önceki engelleme dönemine göre iki kat daha uzun olan yeni bir engelleme dönemine ve en fazla bir dakikaya kadar sonuçlanacaktır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-128">Subsequent failures after a blocking period ends will result in a new blocking periods that is twice as long as the previous blocking period, up to a maximum of one minute.</span></span>  
  
## <a name="pool-creation-and-assignment"></a><span data-ttu-id="7a1ae-129">Havuz Oluşturma ve Atama</span><span class="sxs-lookup"><span data-stu-id="7a1ae-129">Pool Creation and Assignment</span></span>  
 <span data-ttu-id="7a1ae-130">Bir bağlantı ilk açıldığında, bağlantı havuzubağlantıdaki bağlantı dizesiyle ilişkilendiren tam eşleşen algoritmayı temel alan bir bağlantı havuzu oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-130">When a connection is first opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="7a1ae-131">Her bağlantı havuzu farklı bir bağlantı dizesi ile ilişkilidir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-131">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="7a1ae-132">Yeni bir bağlantı açıldığında, bağlantı dizesi varolan bir havuzla tam eşleşme değilse, yeni bir havuz oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-132">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span> <span data-ttu-id="7a1ae-133">Bağlantılar, işlem başına, uygulama etki alanı başına, bağlantı dizesi başına ve tümleşik güvenlik kullanıldığında, Windows kimliği başına birleştirilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-133">Connections are pooled per process, per application domain, per connection string and when integrated security is used, per Windows identity.</span></span> <span data-ttu-id="7a1ae-134">Bağlantı dizeleri de tam bir eşleşme olmalıdır; aynı bağlantı için farklı bir sırada sağlanan anahtar kelimeler ayrı ayrı biraraya gelecektir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-134">Connection strings must also be an exact match; keywords supplied in a different order for the same connection will be pooled separately.</span></span>  
  
 <span data-ttu-id="7a1ae-135">Aşağıdaki C# örneğinde, <xref:System.Data.SqlClient.SqlConnection> üç yeni nesne oluşturulur, ancak bunları yönetmek için yalnızca iki bağlantı havuzu gerekir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-135">In the following C# example, three new <xref:System.Data.SqlClient.SqlConnection> objects are created, but only two connection pools are required to manage them.</span></span> <span data-ttu-id="7a1ae-136">Birinci ve ikinci bağlantı dizeleri için `Initial Catalog`atanan değere göre farklılık gösterir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-136">Note that the first and second connection strings differ by the value assigned for `Initial Catalog`.</span></span>  
  
```csharp
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();
        // Pool A is created.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=pubs"))  
    {  
        connection.Open();
        // Pool B is created because the connection strings differ.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();
        // The connection string matches pool A.  
    }  
```  
  
 <span data-ttu-id="7a1ae-137">`MinPoolSize` Bağlantı dizesinde belirtilmemişse veya sıfır olarak belirtilmişse, havuzdaki bağlantılar bir hareketsizlik döneminden sonra kapatılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-137">If `MinPoolSize` is either not specified in the connection string or is specified as zero, the connections in the pool will be closed after a period of inactivity.</span></span> <span data-ttu-id="7a1ae-138">Ancak, belirtilen `MinPoolSize` sıfırdan büyükse, bağlantı havuzu boşaltılına `AppDomain` ve işlem sona erene kadar yok edilmez.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-138">However, if the specified `MinPoolSize` is greater than zero, the connection pool is not destroyed until the `AppDomain` is unloaded and the process ends.</span></span> <span data-ttu-id="7a1ae-139">Etkin olmayan veya boş havuzların bakımı, en az sistem ek yükü içerir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-139">Maintenance of inactive or empty pools involves minimal system overhead.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7a1ae-140">Önemli bir hata olduğunda havuz otomatik olarak temizlenir( örneğin, bir hata.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-140">The pool is automatically cleared when a fatal error occurs, such as a failover.</span></span>  
  
## <a name="adding-connections"></a><span data-ttu-id="7a1ae-141">Bağlantı Ekleme</span><span class="sxs-lookup"><span data-stu-id="7a1ae-141">Adding Connections</span></span>  
 <span data-ttu-id="7a1ae-142">Her benzersiz bağlantı dizesi için bir bağlantı havuzu oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-142">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="7a1ae-143">Bir havuz oluşturulduğunda, en az havuz boyutu gereksiniminin karşılanması için birden çok bağlantı nesnesi oluşturulur ve havuza eklenir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-143">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="7a1ae-144">Bağlantılar gerektiğinde havuza, belirtilen maksimum havuz boyutuna kadar eklenir (100 varsayılandır).</span><span class="sxs-lookup"><span data-stu-id="7a1ae-144">Connections are added to the pool as needed, up to the maximum pool size specified (100 is the default).</span></span> <span data-ttu-id="7a1ae-145">Bağlantılar kapatıldıklarında veya imha edildiklerinde havuza geri salınır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-145">Connections are released back into the pool when they are closed or disposed.</span></span>  
  
 <span data-ttu-id="7a1ae-146">Bir <xref:System.Data.SqlClient.SqlConnection> nesne istendiğinde, kullanılabilir bir bağlantı varsa havuzdan elde edilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-146">When a <xref:System.Data.SqlClient.SqlConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="7a1ae-147">Kullanılabilir olması için bağlantının kullanılmaması, eşleşen bir işlem bağlamı olması veya herhangi bir işlem bağlamıyla ilişkisinin kullanılmaması ve sunucuya geçerli bir bağlantısı olması gerekir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-147">To be usable, a connection must be unused, have a matching transaction context or be unassociated with any transaction context, and have a valid link to the server.</span></span>  
  
 <span data-ttu-id="7a1ae-148">Bağlantı havuzu, bağlantıları havuza geri salınan bağlantıları yeniden tahsis ederek bağlantı isteklerini karşılar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-148">The connection pooler satisfies requests for connections by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="7a1ae-149">En büyük havuz boyutuna ulaşıldıysa ve kullanılabilir bağlantı yoksa, istek sıraya alınır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-149">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="7a1ae-150">Havuzcu daha sonra zaman ayarı ulaşılana kadar (varsayılan 15 saniyedir) bağlantıları geri almaya çalışır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-150">The pooler then tries to reclaim any connections until the time-out is reached (the default is 15 seconds).</span></span> <span data-ttu-id="7a1ae-151">Havuzcu bağlantı süreleri dolmadan önce isteği karşılayamıyorsa, bir özel durum atılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-151">If the pooler cannot satisfy the request before the connection times out, an exception is thrown.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="7a1ae-152">Bağlantının havuza döndürülebilmeleri için bağlantıyı kullanmayı bitirdiğinizde bağlantıyı her zaman kapatmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-152">We strongly recommend that you always close the connection when you are finished using it so that the connection will be returned to the pool.</span></span> <span data-ttu-id="7a1ae-153">Bunu `Close` nesnenin `Dispose` yöntemlerini `Connection` kullanarak veya C#'daki bir `using` deyimin içindeki tüm bağlantıları `Using` açarak veya Visual Basic'teki bir ifadeyi kullanarak yapabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-153">You can do this using either the `Close` or `Dispose` methods of the `Connection` object, or by opening all connections inside a `using` statement in C#, or a `Using` statement in Visual Basic.</span></span> <span data-ttu-id="7a1ae-154">Açıkça kapatılmayan bağlantılar eklenmeyebilir veya havuza döndürülebilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-154">Connections that are not explicitly closed might not be added or returned to the pool.</span></span> <span data-ttu-id="7a1ae-155">Daha fazla bilgi [için, Bildirim'i veya](../../../csharp/language-reference/keywords/using-statement.md) Nasıl Olur: Visual Basic için [Bir Sistem Kaynağından Nasıl Atınır'a](../../../visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) bakın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-155">For more information, see [using Statement](../../../csharp/language-reference/keywords/using-statement.md) or [How to: Dispose of a System Resource](../../../visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) for Visual Basic.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="7a1ae-156">Sınıfınızın `Close` yönteminde `Finalize` `Connection`bir `DataReader`, a veya başka bir yönetilen nesneyi aramayın. `Dispose`</span><span class="sxs-lookup"><span data-stu-id="7a1ae-156">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="7a1ae-157">Sonlandırıcıda, yalnızca sınıfınızın doğrudan sahip olduğu yönetilmeyen kaynakları serbest bırakın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-157">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="7a1ae-158">Sınıfınız yönetilmeyen kaynaklara sahip değilse, sınıf `Finalize` tanımınıza bir yöntem eklemeyin.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-158">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="7a1ae-159">Daha fazla bilgi için [Çöp Toplama'ya](../../../standard/garbage-collection/index.md)bakın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-159">For more information, see [Garbage Collection](../../../standard/garbage-collection/index.md).</span></span>  
  
<span data-ttu-id="7a1ae-160">Bağlantıları açma ve kapatmayla ilgili olaylar hakkında daha fazla bilgi için SQL Server belgelerinde [Denetim Giriş Etkinlik Sınıfı](/sql/relational-databases/event-classes/audit-login-event-class) ve Denetim Giriş Etkinlik [Sınıfı'na](/sql/relational-databases/event-classes/audit-logout-event-class) bakın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-160">For more info about the events associated with opening and closing connections, see [Audit Login Event Class](/sql/relational-databases/event-classes/audit-login-event-class) and [Audit Logout Event Class](/sql/relational-databases/event-classes/audit-logout-event-class) in the SQL Server documentation.</span></span>  
  
## <a name="removing-connections"></a><span data-ttu-id="7a1ae-161">Bağlantıları Kaldırma</span><span class="sxs-lookup"><span data-stu-id="7a1ae-161">Removing Connections</span></span>  
 <span data-ttu-id="7a1ae-162">Bağlantı havuzu, yaklaşık 4-8 dakika boşta kaldıktan sonra veya havuzlayıcı sunucuyla bağlantının kesildiğini algılarsa havuzdan bir bağlantı kaldırır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-162">The connection pooler removes a connection from the pool after it has been idle for approximately 4-8 minutes, or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="7a1ae-163">Kopmuş bir bağlantının ancak sunucuyla iletişim kurmaya çalıştıktan sonra algılanabileceğini unutmayın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-163">Note that a severed connection can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="7a1ae-164">Artık sunucuya bağlı olmayan bir bağlantı bulunursa, geçersiz olarak işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-164">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="7a1ae-165">Geçersiz bağlantılar yalnızca kapatıldığında veya geri alındıklarında bağlantı havuzundan kaldırılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-165">Invalid connections are removed from the connection pool only when they are closed or reclaimed.</span></span>  
  
 <span data-ttu-id="7a1ae-166">Kaybolan bir sunucuya bağlantı varsa, bağlantı havuzcu kopan bağlantıyı algılayıp geçersiz olarak işaretlemiş olsa bile bu bağlantı havuzdan çekilebilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-166">If a connection exists to a server that has disappeared, this connection can be drawn from the pool even if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="7a1ae-167">Bu durum, bağlantının hala geçerli olup olmadığını denetleme nin ek yükü, sunucuya başka bir gidiş-dönüş yolculuğun oluşmasına neden olarak bir havuz sahibine sahip olmanın avantajlarını ortadan kaldıracağı için durum böyledir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-167">This is the case because the overhead of checking that the connection is still valid would eliminate the benefits of having a pooler by causing another round trip to the server to occur.</span></span> <span data-ttu-id="7a1ae-168">Bu durumda, bağlantıyı kullanmak için ilk girişimi bağlantı kesilmiş olduğunu algılar ve bir özel durum atılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-168">When this occurs, the first attempt to use the connection will detect that the connection has been severed, and an exception is thrown.</span></span>  
  
## <a name="clearing-the-pool"></a><span data-ttu-id="7a1ae-169">Havuzu Temizleme</span><span class="sxs-lookup"><span data-stu-id="7a1ae-169">Clearing the Pool</span></span>  
 <span data-ttu-id="7a1ae-170">ADO.NET 2.0 havuzu temizlemek için iki <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> yeni <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>yöntem tanıttı: ve .</span><span class="sxs-lookup"><span data-stu-id="7a1ae-170">ADO.NET 2.0 introduced two new methods to clear the pool: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> and <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span></span> <span data-ttu-id="7a1ae-171">`ClearAllPools`Belirli bir sağlayıcının bağlantı havuzlarını `ClearPool` temizler ve belirli bir bağlantıyla ilişkili bağlantı havuzunu temizler.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-171">`ClearAllPools` clears the connection pools for a given provider, and `ClearPool` clears the connection pool that is associated with a specific connection.</span></span> <span data-ttu-id="7a1ae-172">Arama sırasında kullanılan bağlantılar varsa, bunlar uygun şekilde işaretlenir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-172">If there are connections being used at the time of the call, they are marked appropriately.</span></span> <span data-ttu-id="7a1ae-173">Kapatıldıklarında, havuza döndürülmek yerine atılırlar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-173">When they are closed, they are discarded instead of being returned to the pool.</span></span>  
  
## <a name="transaction-support"></a><span data-ttu-id="7a1ae-174">İşlem Desteği</span><span class="sxs-lookup"><span data-stu-id="7a1ae-174">Transaction Support</span></span>  
 <span data-ttu-id="7a1ae-175">Bağlantılar havuzdan çizilir ve hareket bağlamına göre atanır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-175">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="7a1ae-176">Bağlantı `Enlist=false` dizesinde belirtilmediği sürece, bağlantı havuzu bağlantının <xref:System.Transactions.Transaction.Current%2A> bağlam içinde kaydolduğundan emin olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-176">Unless `Enlist=false` is specified in the connection string, the connection pool makes sure that the connection is enlisted in the <xref:System.Transactions.Transaction.Current%2A> context.</span></span> <span data-ttu-id="7a1ae-177">Bir bağlantı kapatıldığında ve kayıtlı `System.Transactions` bir işlemle havuza döndürüldüğünde, aynı `System.Transactions` işlemle bu bağlantı havuzu için bir sonraki istek varsa aynı bağlantıyı döndürecek şekilde bir kenara bırakılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-177">When a connection is closed and returned to the pool with an enlisted `System.Transactions` transaction, it is set aside in such a way that the next request for that connection pool with the same `System.Transactions` transaction will return the same connection if it is available.</span></span> <span data-ttu-id="7a1ae-178">Böyle bir istek verilirse ve havuzlu bağlantı yoksa, havuzun işlenmemiş kısmından bir bağlantı çizilir ve kaydolur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-178">If such a request is issued, and there are no pooled connections available, a connection is drawn from the non-transacted part of the pool and enlisted.</span></span> <span data-ttu-id="7a1ae-179">Havuzun her iki alanında da bağlantı yoksa, yeni bir bağlantı oluşturulur ve kaydolur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-179">If no connections are available in either area of the pool, a new connection is created and enlisted.</span></span>  
  
 <span data-ttu-id="7a1ae-180">Bir bağlantı kapatıldığında, işlem bağlamına göre havuza ve uygun alt bölüme geri bırakılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-180">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="7a1ae-181">Bu nedenle, dağıtılmış bir hareket beklemede olsa bile, hata oluşturmadan bağlantıyı kapatabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-181">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="7a1ae-182">Bu, dağıtılmış hareketi daha sonra gerçekleştirmenize veya iptal etmenizi sağlar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-182">This allows you to commit or abort the distributed transaction later.</span></span>  
  
## <a name="controlling-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="7a1ae-183">Bağlantı Dize anahtar kelimeleri ile Bağlantı Havuzu denetleme</span><span class="sxs-lookup"><span data-stu-id="7a1ae-183">Controlling Connection Pooling with Connection String Keywords</span></span>  
 <span data-ttu-id="7a1ae-184">Nesnenin `ConnectionString` <xref:System.Data.SqlClient.SqlConnection> özelliği, bağlantı birleştirme mantığının davranışını ayarlamak için kullanılabilecek bağlantı dize anahtarlarını/değer çiftlerini destekler.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-184">The `ConnectionString` property of the <xref:System.Data.SqlClient.SqlConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span> <span data-ttu-id="7a1ae-185">Daha fazla bilgi için bkz. <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-185">For more information, see <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
## <a name="pool-fragmentation"></a><span data-ttu-id="7a1ae-186">Havuz Parçalanması</span><span class="sxs-lookup"><span data-stu-id="7a1ae-186">Pool Fragmentation</span></span>  
 <span data-ttu-id="7a1ae-187">Havuz parçalanması, uygulamanın işlem çıkana kadar serbest bırakılmayan çok sayıda havuz oluşturabileceği birçok Web uygulamasında yaygın bir sorundur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-187">Pool fragmentation is a common problem in many Web applications where the application can create a large number of pools that are not freed until the process exits.</span></span> <span data-ttu-id="7a1ae-188">Bu, çok sayıda bağlantıyı açık ve bellek tüketen bırakır ve bu da düşük performansa neden olabilir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-188">This leaves a large number of connections open and consuming memory, which results in poor performance.</span></span>  
  
### <a name="pool-fragmentation-due-to-integrated-security"></a><span data-ttu-id="7a1ae-189">Entegre Güvenlik Nedeniyle Havuz Parçalanma</span><span class="sxs-lookup"><span data-stu-id="7a1ae-189">Pool Fragmentation Due to Integrated Security</span></span>  
 <span data-ttu-id="7a1ae-190">Bağlantılar, bağlantı dizesine ve kullanıcı kimliğine göre biraraya getirilmiştir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-190">Connections are pooled according to the connection string plus the user identity.</span></span> <span data-ttu-id="7a1ae-191">Bu nedenle, Web sitesinde Temel kimlik doğrulama veya Windows Kimlik Doğrulama ve tümleşik bir güvenlik girişi kullanırsanız, kullanıcı başına bir havuz elde elabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-191">Therefore, if you use Basic authentication or Windows Authentication on the Web site and an integrated security login, you get one pool per user.</span></span> <span data-ttu-id="7a1ae-192">Bu, tek bir kullanıcı için sonraki veritabanı isteklerinin performansını artırsa da, bu kullanıcı diğer kullanıcılar tarafından yapılan bağlantılardan yararlanamaz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-192">Although this improves the performance of subsequent database requests for a single user, that user cannot take advantage of connections made by other users.</span></span> <span data-ttu-id="7a1ae-193">Ayrıca, kullanıcı başına veritabanı sunucusuna en az bir bağlantı sağlar.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-193">It also results in at least one connection per user to the database server.</span></span> <span data-ttu-id="7a1ae-194">Bu, geliştiricilerin güvenlik ve denetim gereksinimlerine karşı tartmak gerekir belirli bir Web uygulaması mimarisinin bir yan etkisidir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-194">This is a side effect of a particular Web application architecture that developers must weigh against security and auditing requirements.</span></span>  
  
### <a name="pool-fragmentation-due-to-many-databases"></a><span data-ttu-id="7a1ae-195">Birçok Veritabanına Bağlı Havuz Parçalanma</span><span class="sxs-lookup"><span data-stu-id="7a1ae-195">Pool Fragmentation Due to Many Databases</span></span>  
 <span data-ttu-id="7a1ae-196">Birçok Internet servis sağlayıcısı, tek bir sunucuda birden fazla Web sitesi barındırz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-196">Many Internet service providers host several Web sites on a single server.</span></span> <span data-ttu-id="7a1ae-197">Formlar kimlik doğrulama oturumunu onaylamak ve ardından söz konusu kullanıcı veya kullanıcı grubu için belirli bir veritabanına bağlantı açmak için tek bir veritabanı kullanabilirler.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-197">They may use a single database to confirm a Forms authentication login and then open a connection to a specific database for that user or group of users.</span></span> <span data-ttu-id="7a1ae-198">Kimlik doğrulama veritabanına bağlantı bir araya ve herkes tarafından kullanılır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-198">The connection to the authentication database is pooled and used by everyone.</span></span> <span data-ttu-id="7a1ae-199">Ancak, her veritabanına sunucuya bağlantı sayısını artıran ayrı bir bağlantı havuzu vardır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-199">However, there is a separate pool of connections to each database, which increase the number of connections to the server.</span></span>  
  
 <span data-ttu-id="7a1ae-200">Bu aynı zamanda uygulama tasarımının bir yan etkisidir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-200">This is also a side-effect of the application design.</span></span> <span data-ttu-id="7a1ae-201">SQL Server'a bağlandığınızda güvenlikten ödün vermeden bu yan etkiyi önlemenin nispeten basit bir yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-201">There is a relatively simple way to avoid this side effect without compromising security when you connect to SQL Server.</span></span> <span data-ttu-id="7a1ae-202">Her kullanıcı veya grup için ayrı bir veritabanına bağlanmak yerine, sunucudaki aynı veritabanına bağlanın ve ardından istenen veritabanına değişmek için Transact-SQL USE deyimini çalıştırın.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-202">Instead of connecting to a separate database for each user or group, connect to the same database on the server and then execute the Transact-SQL USE statement to change to the desired database.</span></span> <span data-ttu-id="7a1ae-203">Aşağıdaki kod parçası `master` veritabanına bir ilk bağlantı oluşturma ve daha sonra `databaseName` dize değişkeninde belirtilen istenen veritabanına geçiş gösterir.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-203">The following code fragment demonstrates creating an initial connection to the `master` database and then switching to the desired database specified in the `databaseName` string variable.</span></span>  
  
```vb  
' Assumes that command is a valid SqlCommand object and that  
' connectionString connects to master.  
    command.Text = "USE DatabaseName"  
Using connection As New SqlConnection(connectionString)  
    connection.Open()  
    command.ExecuteNonQuery()  
End Using  
```  
  
```csharp  
// Assumes that command is a SqlCommand object and that  
// connectionString connects to master.  
command.Text = "USE DatabaseName";  
using (SqlConnection connection = new SqlConnection(  
  connectionString))  
  {  
    connection.Open();  
    command.ExecuteNonQuery();  
  }  
```  
  
## <a name="application-roles-and-connection-pooling"></a><span data-ttu-id="7a1ae-204">Uygulama Rolleri ve Bağlantı Havuzu</span><span class="sxs-lookup"><span data-stu-id="7a1ae-204">Application Roles and Connection Pooling</span></span>  
 <span data-ttu-id="7a1ae-205">Bir SQL Server uygulama rolü `sp_setapprole` sistem depolanan yordamı çağırarak etkinleştirildikten sonra, bu bağlantının güvenlik bağlamı sıfırlanamaz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-205">After a SQL Server application role has been activated by calling the `sp_setapprole` system stored procedure, the security context of that connection cannot be reset.</span></span> <span data-ttu-id="7a1ae-206">Ancak, havuzlama etkinse, bağlantı havuza döndürülür ve havuzdaki bağlantı yeniden kullanıldığında bir hata oluşur.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-206">However, if pooling is enabled, the connection is returned to the pool, and an error occurs when the pooled connection is reused.</span></span> <span data-ttu-id="7a1ae-207">Daha fazla bilgi için Bilgi Bankası makalesine bakın, "[OLE DB kaynak havuzu ile SQL uygulama rol hataları."](https://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)</span><span class="sxs-lookup"><span data-stu-id="7a1ae-207">For more information, see the Knowledge Base article, "[SQL application role errors with OLE DB resource pooling](https://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span></span>  
  
### <a name="application-role-alternatives"></a><span data-ttu-id="7a1ae-208">Uygulama Rolü Alternatifleri</span><span class="sxs-lookup"><span data-stu-id="7a1ae-208">Application Role Alternatives</span></span>  
 <span data-ttu-id="7a1ae-209">Uygulama rolleri yerine kullanabileceğiniz güvenlik mekanizmalarından yararlanmanızı öneririz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-209">We recommend that you take advantage of security mechanisms that you can use instead of application roles.</span></span> <span data-ttu-id="7a1ae-210">Daha fazla bilgi için [bkz.](./sql/creating-application-roles-in-sql-server.md)</span><span class="sxs-lookup"><span data-stu-id="7a1ae-210">For more information, see [Creating Application Roles in SQL Server](./sql/creating-application-roles-in-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7a1ae-211">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="7a1ae-211">See also</span></span>

- [<span data-ttu-id="7a1ae-212">Bağlantı Havuzu</span><span class="sxs-lookup"><span data-stu-id="7a1ae-212">Connection Pooling</span></span>](connection-pooling.md)
- [<span data-ttu-id="7a1ae-213">SQL Server ve ADO.NET</span><span class="sxs-lookup"><span data-stu-id="7a1ae-213">SQL Server and ADO.NET</span></span>](./sql/index.md)
- [<span data-ttu-id="7a1ae-214">Performans Sayaçları</span><span class="sxs-lookup"><span data-stu-id="7a1ae-214">Performance Counters</span></span>](performance-counters.md)
- [<span data-ttu-id="7a1ae-215">ADO.NET’e Genel Bakış</span><span class="sxs-lookup"><span data-stu-id="7a1ae-215">ADO.NET Overview</span></span>](ado-net-overview.md)
