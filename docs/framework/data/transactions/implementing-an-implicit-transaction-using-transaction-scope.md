---
title: İşlem Kapsamı Kullanarak Örtük İşlem Uygulama
description: .NET 'teki TransactionScope sınıfını kullanarak örtük bir işlem uygulayın. Bu sınıf, bir kod bloğunu bir işleme katılan olarak işaretlemek için bir yol sağlar.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 49d1706a-1e0c-4c85-9704-75c908372eb9
ms.openlocfilehash: ff2fe64156d5d72773549d78b2e29631905cbb10
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 09/24/2020
ms.locfileid: "91186867"
---
# <a name="implementing-an-implicit-transaction-using-transaction-scope"></a><span data-ttu-id="388cd-104">İşlem Kapsamı Kullanarak Örtük İşlem Uygulama</span><span class="sxs-lookup"><span data-stu-id="388cd-104">Implementing an Implicit Transaction using Transaction Scope</span></span>

<span data-ttu-id="388cd-105">Sınıfı, bir <xref:System.Transactions.TransactionScope> kod bloğunu bir işlem içine katılımınıza, işlem kendisiyle etkileşime girmeden işaretlemek için basit bir yol sağlar.</span><span class="sxs-lookup"><span data-stu-id="388cd-105">The <xref:System.Transactions.TransactionScope> class provides a simple way to mark a block of code as participating in a transaction, without requiring you to interact with the transaction itself.</span></span> <span data-ttu-id="388cd-106">İşlem kapsamı, ortam işlemini otomatik olarak seçebilir ve yönetebilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-106">A transaction scope can select and manage the ambient transaction automatically.</span></span> <span data-ttu-id="388cd-107">Kullanım kolaylığı ve verimlilik nedeniyle, <xref:System.Transactions.TransactionScope> bir işlem uygulaması geliştirirken sınıfını kullanmanız önerilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-107">Due to its ease of use and efficiency, it is recommended that you use the <xref:System.Transactions.TransactionScope> class when developing a transaction application.</span></span>  
  
 <span data-ttu-id="388cd-108">Ayrıca, işlemle birlikte listeleme kaynaklarına gerek kalmaz.</span><span class="sxs-lookup"><span data-stu-id="388cd-108">In addition, you do not need to enlist resources explicitly with the transaction.</span></span> <span data-ttu-id="388cd-109">Herhangi bir <xref:System.Transactions> Kaynak Yöneticisi (SQL Server 2005 gibi), kapsam tarafından oluşturulan bir ortam işleminin varlığını algılayabilir ve otomatik olarak listeleme yapabilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-109">Any <xref:System.Transactions> resource manager (such as SQL Server 2005) can detect the existence of an ambient transaction created by the scope and automatically enlist.</span></span>  
  
## <a name="creating-a-transaction-scope"></a><span data-ttu-id="388cd-110">İşlem kapsamı oluşturma</span><span class="sxs-lookup"><span data-stu-id="388cd-110">Creating a transaction scope</span></span>  

 <span data-ttu-id="388cd-111">Aşağıdaki örnek, bir basit kullanımını gösterir <xref:System.Transactions.TransactionScope> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="388cd-111">The following sample shows a simple usage of the <xref:System.Transactions.TransactionScope> class.</span></span>  
  
 [!code-csharp[TransactionScope#1](../../../../samples/snippets/csharp/VS_Snippets_Remoting/TransactionScope/cs/ScopeWithSQL.cs#1)]
 [!code-vb[TransactionScope#1](../../../../samples/snippets/visualbasic/VS_Snippets_Remoting/TransactionScope/vb/ScopeWithSQL.vb#1)]  
  
 <span data-ttu-id="388cd-112">Yeni bir nesne oluşturduktan sonra işlem kapsamı başlatılır <xref:System.Transactions.TransactionScope> .</span><span class="sxs-lookup"><span data-stu-id="388cd-112">The transaction scope is started once you create a new <xref:System.Transactions.TransactionScope> object.</span></span>  <span data-ttu-id="388cd-113">Kod örneğinde gösterildiği gibi, bir ifadesiyle kapsam oluşturmanız önerilir `using` .</span><span class="sxs-lookup"><span data-stu-id="388cd-113">As illustrated in the code sample, it is recommended that you create scopes with a `using` statement.</span></span> <span data-ttu-id="388cd-114">`using`İfade hem C# ' de hem de Visual Basic kullanılabilir ve `try` `finally` kapsamın doğru bir şekilde atıldığından emin olmak için... bloğu gibi çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="388cd-114">The `using` statement is available both in C# and in Visual Basic, and works like a `try`...`finally` block to ensure that the scope is disposed of properly.</span></span>  
  
 <span data-ttu-id="388cd-115">Örneğini oluşturduğunuzda <xref:System.Transactions.TransactionScope> , işlem Yöneticisi hangi hareketin katılacağı belirler.</span><span class="sxs-lookup"><span data-stu-id="388cd-115">When you instantiate <xref:System.Transactions.TransactionScope>, the transaction manager determines which transaction to participate in.</span></span> <span data-ttu-id="388cd-116">Belirlendikten sonra, kapsam her zaman bu işleme katılır.</span><span class="sxs-lookup"><span data-stu-id="388cd-116">Once determined, the scope always participates in that transaction.</span></span> <span data-ttu-id="388cd-117">Karar iki etkene dayanır: bir ortam işleminin mevcut olup olmadığı ve `TransactionScopeOption` oluşturucudaki parametre değeri.</span><span class="sxs-lookup"><span data-stu-id="388cd-117">The decision is based on two factors: whether an ambient transaction is present and the value of the `TransactionScopeOption` parameter in the constructor.</span></span> <span data-ttu-id="388cd-118">Çevresel işlem, kodunuzun çalıştırıldığı işlemdir.</span><span class="sxs-lookup"><span data-stu-id="388cd-118">The ambient transaction is the transaction within which your code executes.</span></span> <span data-ttu-id="388cd-119">Sınıfının statik özelliğini çağırarak çevresel işleme bir başvuru elde edebilirsiniz <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> <xref:System.Transactions.Transaction> .</span><span class="sxs-lookup"><span data-stu-id="388cd-119">You can obtain a reference to the ambient transaction by calling the static <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> property of the <xref:System.Transactions.Transaction> class.</span></span> <span data-ttu-id="388cd-120">Bu parametrenin nasıl kullanıldığı hakkında daha fazla bilgi için, bu konunun [TransactionScopeOption kullanılarak işlem akışını yönetme](#ManageTxFlow) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="388cd-120">For more information on how this parameter is used, see the [Managing transaction flow using TransactionScopeOption](#ManageTxFlow) section of this topic.</span></span>  
  
## <a name="completing-a-transaction-scope"></a><span data-ttu-id="388cd-121">İşlem kapsamını tamamlama</span><span class="sxs-lookup"><span data-stu-id="388cd-121">Completing a transaction scope</span></span>  

 <span data-ttu-id="388cd-122">Uygulamanız bir işlemde gerçekleştirmek istediği tüm işleri tamamladığında, işlem <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWithType> yöneticisini işlem yürütmek için kabul edilebilir olduğunu bildirmek üzere yöntemi yalnızca bir kez çağırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="388cd-122">When your application completes all the work it wants to perform in a transaction, you should call the <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWithType> method only once to inform the transaction manager that it is acceptable to commit the transaction.</span></span> <span data-ttu-id="388cd-123">Çağrısını bloktaki son ifadeye koymak çok iyi bir uygulamadır <xref:System.Transactions.TransactionScope.Complete%2A> `using` .</span><span class="sxs-lookup"><span data-stu-id="388cd-123">It is very good practice to put the call to <xref:System.Transactions.TransactionScope.Complete%2A> as the last statement in the `using` block.</span></span>  
  
 <span data-ttu-id="388cd-124">İşlem yöneticisi bunu bir sistem hatası olarak yorumladığı ya da işlemin kapsamında oluşturulan bir özel durumla eşdeğer olduğundan, bu yöntemi çağıramaması işlemi iptal eder.</span><span class="sxs-lookup"><span data-stu-id="388cd-124">Failing to call this method aborts the transaction, because the transaction manager interprets this as a system failure, or equivalent to an exception thrown within the scope of the transaction.</span></span> <span data-ttu-id="388cd-125">Ancak, bu yöntemin çağrılması, işlem WIL 'nin uygulanabileceğini garanti etmez.</span><span class="sxs-lookup"><span data-stu-id="388cd-125">However, calling this method does not guarantee that the transaction wil be committed.</span></span> <span data-ttu-id="388cd-126">Yalnızca durumlarınızın işlem yöneticisini bilgilendiren bir yoldur.</span><span class="sxs-lookup"><span data-stu-id="388cd-126">It is merely a way of informing the transaction manager of your status.</span></span> <span data-ttu-id="388cd-127">Yöntemini çağırdıktan sonra, <xref:System.Transactions.TransactionScope.Complete%2A> özelliği kullanarak çevresel işleme <xref:System.Transactions.Transaction.Current%2A> erişemeyecektir ve bunu yapmaya çalıştığınızda bir özel durum oluşturulması neden olur.</span><span class="sxs-lookup"><span data-stu-id="388cd-127">After calling the <xref:System.Transactions.TransactionScope.Complete%2A> method, you can no longer access the ambient transaction by using the <xref:System.Transactions.Transaction.Current%2A> property, and attempting to do so will result in an exception being thrown.</span></span>  
  
 <span data-ttu-id="388cd-128"><xref:System.Transactions.TransactionScope>Nesneyi başlangıçta oluşturmadıysa, işlemi işlem yöneticisi tarafından yürütmek için gerçek iş, bloktaki kodun son satırından sonra oluşur `using` .</span><span class="sxs-lookup"><span data-stu-id="388cd-128">If the <xref:System.Transactions.TransactionScope> object created the transaction initially, the actual work of committing the transaction by the transaction manager occurs after the last line of code in the `using` block.</span></span> <span data-ttu-id="388cd-129">İşlem oluşturamadığında, işleme <xref:System.Transactions.CommittableTransaction.Commit%2A> nesnenin sahibi tarafından her çağrıldığında gerçekleşir <xref:System.Transactions.CommittableTransaction> .</span><span class="sxs-lookup"><span data-stu-id="388cd-129">If it did not create the transaction, the commit occurs whenever <xref:System.Transactions.CommittableTransaction.Commit%2A> is called by the owner of the <xref:System.Transactions.CommittableTransaction> object.</span></span> <span data-ttu-id="388cd-130">Bu noktada, işlem yöneticisi kaynak yöneticilerini çağırır ve <xref:System.Transactions.TransactionScope.Complete%2A> yöntemin nesne üzerinde çağrılıp çağrılmayacağı temelinde bunları COMMIT veya Rollback olarak bilgilendirir <xref:System.Transactions.TransactionScope> .</span><span class="sxs-lookup"><span data-stu-id="388cd-130">At that point the transaction manager calls the resource managers and informs them to either commit or rollback, based on whether the <xref:System.Transactions.TransactionScope.Complete%2A> method was called on the <xref:System.Transactions.TransactionScope> object.</span></span>  
  
 <span data-ttu-id="388cd-131">`using`İfade, <xref:System.Transactions.TransactionScope.Dispose%2A> <xref:System.Transactions.TransactionScope> bir özel durum gerçekleşse bile nesne yönteminin çağrılması sağlar.</span><span class="sxs-lookup"><span data-stu-id="388cd-131">The `using` statement ensures that the <xref:System.Transactions.TransactionScope.Dispose%2A> method of the <xref:System.Transactions.TransactionScope> object is called even if an exception occurs.</span></span> <span data-ttu-id="388cd-132"><xref:System.Transactions.TransactionScope.Dispose%2A>Yöntemi, işlem kapsamının sonunu işaretler.</span><span class="sxs-lookup"><span data-stu-id="388cd-132">The <xref:System.Transactions.TransactionScope.Dispose%2A> method marks the end of the transaction scope.</span></span> <span data-ttu-id="388cd-133">Bu yöntemi çağırdıktan sonra oluşan özel durumlar işlemi etkilemeyebilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-133">Exceptions that occur after calling this method may not affect the transaction.</span></span> <span data-ttu-id="388cd-134">Bu yöntem aynı zamanda çevresel işlemi önceki durumuna geri yükler.</span><span class="sxs-lookup"><span data-stu-id="388cd-134">This method also restores the ambient transaction to it previous state.</span></span>  
  
 <span data-ttu-id="388cd-135">, <xref:System.Transactions.TransactionAbortedException> Kapsam işlemi oluşturduğunda oluşturulur ve işlem iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-135">A <xref:System.Transactions.TransactionAbortedException> is thrown if the scope creates the transaction, and the transaction is aborted.</span></span> <span data-ttu-id="388cd-136"><xref:System.Transactions.TransactionInDoubtException>İşlem yöneticisi bir işleme kararına ulaşamadıysanız, oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="388cd-136">A <xref:System.Transactions.TransactionInDoubtException> is thrown if the transaction manager cannot reach a Commit decision.</span></span> <span data-ttu-id="388cd-137">İşlem yürütüldüğünden hiçbir özel durum oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="388cd-137">No exception is thrown if the transaction is committed.</span></span>  
  
## <a name="rolling-back-a-transaction"></a><span data-ttu-id="388cd-138">Bir işlem geri alınıyor</span><span class="sxs-lookup"><span data-stu-id="388cd-138">Rolling back a transaction</span></span>  

 <span data-ttu-id="388cd-139">Bir işlemi geri almak istiyorsanız, <xref:System.Transactions.TransactionScope.Complete%2A> yöntemi işlem kapsamı içinde çağırmamalıdır.</span><span class="sxs-lookup"><span data-stu-id="388cd-139">If you want to rollback a transaction, you should not call the <xref:System.Transactions.TransactionScope.Complete%2A> method within the transaction scope.</span></span> <span data-ttu-id="388cd-140">Örneğin, kapsam içinde bir özel durum.</span><span class="sxs-lookup"><span data-stu-id="388cd-140">For example, you can throw an exception within the scope.</span></span> <span data-ttu-id="388cd-141">İçindeki katıldığı işlem geri alınacaktır.</span><span class="sxs-lookup"><span data-stu-id="388cd-141">The transaction in which it participates in will be rolled back.</span></span>  
  
## <a name="managing-transaction-flow-using-transactionscopeoption"></a><a name="ManageTxFlow"></a> <span data-ttu-id="388cd-142">TransactionScopeOption kullanarak işlem akışını yönetme</span><span class="sxs-lookup"><span data-stu-id="388cd-142">Managing transaction flow using TransactionScopeOption</span></span>  

 <span data-ttu-id="388cd-143">İşlem kapsamı, <xref:System.Transactions.TransactionScope> `RootMethod` yöntemi aşağıdaki örnekte olduğu gibi, kendi kapsamını kullanan bir yöntemin içinden öğesini kullanan bir yöntemi çağırarak iç içe olabilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-143">Transaction scope can be nested by calling a method that uses a <xref:System.Transactions.TransactionScope> from within a method that uses its own scope, as is the case with the `RootMethod` method in the following example,</span></span>  
  
```csharp  
void RootMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        SomeMethod();
        scope.Complete();
    }
}

void SomeMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        scope.Complete();
    }
}
```  
  
 <span data-ttu-id="388cd-144">En üst işlem kapsamı kök kapsamı olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="388cd-144">The top-most transaction scope is referred to as the root scope.</span></span>  
  
 <span data-ttu-id="388cd-145"><xref:System.Transactions.TransactionScope>Sınıfı, <xref:System.Transactions.TransactionScopeOption> kapsamın işlem davranışını tanımlayan, türün bir listesini kabul eden birkaç aşırı yüklenmiş Oluşturucu sağlar.</span><span class="sxs-lookup"><span data-stu-id="388cd-145">The <xref:System.Transactions.TransactionScope> class provides several overloaded constructors that accept an enumeration of the type <xref:System.Transactions.TransactionScopeOption>, which defines the transactional behavior of the scope.</span></span>  
  
 <span data-ttu-id="388cd-146">Bir <xref:System.Transactions.TransactionScope> nesnenin üç seçenek vardır:</span><span class="sxs-lookup"><span data-stu-id="388cd-146">A <xref:System.Transactions.TransactionScope> object has three options:</span></span>  
  
- <span data-ttu-id="388cd-147">Ortam işlemine katılır veya bir tane yoksa yeni bir tane oluşturun.</span><span class="sxs-lookup"><span data-stu-id="388cd-147">Join the ambient transaction, or create a new one if one does not exist.</span></span>  
  
- <span data-ttu-id="388cd-148">Yeni bir kök kapsamı olun, yani yeni bir işlem başlatın ve bu işlemin kendi kapsamı içinde yeni çevresel işlem olmasını sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="388cd-148">Be a new root scope, that is, start a new transaction and have that transaction be the new ambient transaction inside its own scope.</span></span>  
  
- <span data-ttu-id="388cd-149">Bir işlemde bir işlem olmaz.</span><span class="sxs-lookup"><span data-stu-id="388cd-149">Not take part in a transaction at all.</span></span> <span data-ttu-id="388cd-150">Sonuç olarak ortam işlemi yoktur.</span><span class="sxs-lookup"><span data-stu-id="388cd-150">There is no ambient transaction as a result.</span></span>  
  
 <span data-ttu-id="388cd-151">Kapsamı ile örneği varsa <xref:System.Transactions.TransactionScopeOption.Required> ve bir ortam işlemi mevcutsa, kapsam bu işlemi birleştirir.</span><span class="sxs-lookup"><span data-stu-id="388cd-151">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Required>, and an ambient transaction is present, the scope joins that transaction.</span></span> <span data-ttu-id="388cd-152">Diğer taraftan, ortam işlemi yoksa, kapsam yeni bir işlem oluşturur ve kök kapsamı olur.</span><span class="sxs-lookup"><span data-stu-id="388cd-152">If, on the other hand, there is no ambient transaction, then the scope creates a new transaction, and become the root scope.</span></span> <span data-ttu-id="388cd-153">Varsayılan değer budur.</span><span class="sxs-lookup"><span data-stu-id="388cd-153">This is the default value.</span></span> <span data-ttu-id="388cd-154">Kullanıldığında <xref:System.Transactions.TransactionScopeOption.Required> , kapsamın içindeki kodun kök olup olmadığı veya yalnızca ortam hareketine katılması gibi farklı davranması gerekmez.</span><span class="sxs-lookup"><span data-stu-id="388cd-154">When <xref:System.Transactions.TransactionScopeOption.Required> is used, the code inside the scope does not need to behave differently whether it is the root or just joining the ambient transaction.</span></span> <span data-ttu-id="388cd-155">Her iki durumda da aynı şekilde çalışması.</span><span class="sxs-lookup"><span data-stu-id="388cd-155">It should operate identically in both cases.</span></span>  
  
 <span data-ttu-id="388cd-156">Kapsamı ile örneği varsa <xref:System.Transactions.TransactionScopeOption.RequiresNew>, her zaman bir kök kapsam olur.</span><span class="sxs-lookup"><span data-stu-id="388cd-156">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.RequiresNew>, it is always the root scope.</span></span> <span data-ttu-id="388cd-157">Yeni bir işlem başlatır ve işlem, kapsam içindeki yeni çevresel işlem haline gelir.</span><span class="sxs-lookup"><span data-stu-id="388cd-157">It starts a new transaction, and its transaction becomes the new ambient transaction inside the scope.</span></span>  
  
 <span data-ttu-id="388cd-158">Kapsamı ile örneği varsa, bir <xref:System.Transactions.TransactionScopeOption.Suppress> ortam işleminin mevcut olup olmamasına bakılmaksızın hiçbir zaman bir işlemde yer almıyor.</span><span class="sxs-lookup"><span data-stu-id="388cd-158">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Suppress>, it never takes part in a transaction, regardless of whether an ambient transaction is present.</span></span> <span data-ttu-id="388cd-159">Bu değerle örneklenmiş bir kapsam, her zaman `null` çevresel işlem olarak sahip olmalıdır.</span><span class="sxs-lookup"><span data-stu-id="388cd-159">A scope instantiated with this value always have `null` as its ambient transaction.</span></span>  
  
 <span data-ttu-id="388cd-160">Yukarıdaki seçenekleri aşağıdaki tabloda özetlenmiştir.</span><span class="sxs-lookup"><span data-stu-id="388cd-160">The above options are summarized in the following table.</span></span>  
  
|<span data-ttu-id="388cd-161">TransactionScopeOption</span><span class="sxs-lookup"><span data-stu-id="388cd-161">TransactionScopeOption</span></span>|<span data-ttu-id="388cd-162">Çevresel Işlem</span><span class="sxs-lookup"><span data-stu-id="388cd-162">Ambient Transaction</span></span>|<span data-ttu-id="388cd-163">Kapsam bölümü alır</span><span class="sxs-lookup"><span data-stu-id="388cd-163">The scope takes part in</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="388cd-164">Gerekli</span><span class="sxs-lookup"><span data-stu-id="388cd-164">Required</span></span>|<span data-ttu-id="388cd-165">Hayır</span><span class="sxs-lookup"><span data-stu-id="388cd-165">No</span></span>|<span data-ttu-id="388cd-166">Yeni Işlem (kök olacaktır)</span><span class="sxs-lookup"><span data-stu-id="388cd-166">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="388cd-167">Yeni gerektirir</span><span class="sxs-lookup"><span data-stu-id="388cd-167">Requires New</span></span>|<span data-ttu-id="388cd-168">Hayır</span><span class="sxs-lookup"><span data-stu-id="388cd-168">No</span></span>|<span data-ttu-id="388cd-169">Yeni Işlem (kök olacaktır)</span><span class="sxs-lookup"><span data-stu-id="388cd-169">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="388cd-170">Önle</span><span class="sxs-lookup"><span data-stu-id="388cd-170">Suppress</span></span>|<span data-ttu-id="388cd-171">Hayır</span><span class="sxs-lookup"><span data-stu-id="388cd-171">No</span></span>|<span data-ttu-id="388cd-172">Işlem yok</span><span class="sxs-lookup"><span data-stu-id="388cd-172">No Transaction</span></span>|  
|<span data-ttu-id="388cd-173">Gerekli</span><span class="sxs-lookup"><span data-stu-id="388cd-173">Required</span></span>|<span data-ttu-id="388cd-174">Yes</span><span class="sxs-lookup"><span data-stu-id="388cd-174">Yes</span></span>|<span data-ttu-id="388cd-175">Çevresel Işlem</span><span class="sxs-lookup"><span data-stu-id="388cd-175">Ambient  Transaction</span></span>|  
|<span data-ttu-id="388cd-176">Yeni gerektirir</span><span class="sxs-lookup"><span data-stu-id="388cd-176">Requires New</span></span>|<span data-ttu-id="388cd-177">Yes</span><span class="sxs-lookup"><span data-stu-id="388cd-177">Yes</span></span>|<span data-ttu-id="388cd-178">Yeni Işlem (kök olacaktır)</span><span class="sxs-lookup"><span data-stu-id="388cd-178">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="388cd-179">Önle</span><span class="sxs-lookup"><span data-stu-id="388cd-179">Suppress</span></span>|<span data-ttu-id="388cd-180">Yes</span><span class="sxs-lookup"><span data-stu-id="388cd-180">Yes</span></span>|<span data-ttu-id="388cd-181">Işlem yok</span><span class="sxs-lookup"><span data-stu-id="388cd-181">No Transaction</span></span>|  
  
 <span data-ttu-id="388cd-182">Bir <xref:System.Transactions.TransactionScope> nesne var olan bir ortam işlemine katıldığında kapsam nesnesini elden atma işlemi, kapsam işlemi iptal etmediği takdirde işlemi sonlandırmayabilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-182">When a <xref:System.Transactions.TransactionScope> object joins an existing ambient transaction, disposing of the scope object may not end the transaction, unless the scope aborts the transaction.</span></span> <span data-ttu-id="388cd-183">Ortam işlemi bir kök kapsam tarafından oluşturulduysa, yalnızca kök kapsamı bırakıldığında, <xref:System.Transactions.CommittableTransaction.Commit%2A> işlem üzerinde çağırılır.</span><span class="sxs-lookup"><span data-stu-id="388cd-183">If the ambient transaction was created by a root scope, only when the root scope is disposed of, does <xref:System.Transactions.CommittableTransaction.Commit%2A> get called on the transaction.</span></span> <span data-ttu-id="388cd-184">İşlem el ile oluşturulduysa, işlem iptal edildiğinde ya da Oluşturucusu tarafından işlendiği zaman sona erer.</span><span class="sxs-lookup"><span data-stu-id="388cd-184">If the transaction was created manually, the transaction ends when it is either aborted, or committed by its creator.</span></span>  
  
 <span data-ttu-id="388cd-185">Aşağıdaki örnekte gösterildiği bir <xref:System.Transactions.TransactionScope> üç iç içe kapsamlı nesneler, farklı bir her örneklenen oluşturan nesne <xref:System.Transactions.TransactionScopeOption> değeri.</span><span class="sxs-lookup"><span data-stu-id="388cd-185">The following example shows a <xref:System.Transactions.TransactionScope> object that creates three nested scope objects, each instantiated with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
//Default is Required
{
    using(TransactionScope scope2 = new TransactionScope(TransactionScopeOption.Required))
    {
        //...
    }

    using(TransactionScope scope3 = new TransactionScope(TransactionScopeOption.RequiresNew))
    {
        //...  
    }
  
    using(TransactionScope scope4 = new TransactionScope(TransactionScopeOption.Suppress))
    {
        //...  
    }
}
```  
  
 <span data-ttu-id="388cd-186">Örnek, ile yeni bir kapsam () oluşturan herhangi bir ortam işlemini içermeyen bir kod bloğunu gösterir `scope1` <xref:System.Transactions.TransactionScopeOption.Required> .</span><span class="sxs-lookup"><span data-stu-id="388cd-186">The example shows a code block without any ambient transaction creating a new scope (`scope1`) with <xref:System.Transactions.TransactionScopeOption.Required>.</span></span> <span data-ttu-id="388cd-187">Kapsam, `scope1` Yeni bir işlem (Işlem a) oluşturduğu ve işlemi çevresel işlem yapan bir kök kapsamdır.</span><span class="sxs-lookup"><span data-stu-id="388cd-187">The scope `scope1` is a root scope as it creates a new transaction (Transaction A) and makes Transaction A the ambient transaction.</span></span> <span data-ttu-id="388cd-188">`Scope1`Daha sonra her farklı bir ile üç daha fazla nesne oluşturur <xref:System.Transactions.TransactionScopeOption> değeri.</span><span class="sxs-lookup"><span data-stu-id="388cd-188">`Scope1` then creates three more objects, each with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span> <span data-ttu-id="388cd-189">Örneğin, `scope2` ile oluşturulur <xref:System.Transactions.TransactionScopeOption.Required> ve bir ortam işlemi olduğundan, tarafından oluşturulan ilk işlemi birleştirir `scope1` .</span><span class="sxs-lookup"><span data-stu-id="388cd-189">For example, `scope2` is created with <xref:System.Transactions.TransactionScopeOption.Required>, and since there is an ambient transaction, it joins the first transaction created by `scope1`.</span></span> <span data-ttu-id="388cd-190">Bu `scope3` , yeni bir işlemin kök kapsamı ve `scope4` ortam işlemi olmadığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="388cd-190">Note that `scope3` is the root scope of a new transaction, and that `scope4` has no ambient transaction.</span></span>  
  
 <span data-ttu-id="388cd-191">Değerini varsayılan ve en sık kullanılan olsa da <xref:System.Transactions.TransactionScopeOption> olan <xref:System.Transactions.TransactionScopeOption.Required>, her diğer değerlerinin benzersiz amacı vardır.</span><span class="sxs-lookup"><span data-stu-id="388cd-191">Although the default and most commonly used value of <xref:System.Transactions.TransactionScopeOption> is <xref:System.Transactions.TransactionScopeOption.Required>, each of the other values has its unique purpose.</span></span>  

### <a name="non-transactional-code-inside-a-transaction-scope"></a><span data-ttu-id="388cd-192">İşlem kapsamı içinde işlem olmayan kod</span><span class="sxs-lookup"><span data-stu-id="388cd-192">Non-transactional code inside a transaction scope</span></span>

 <span data-ttu-id="388cd-193"><xref:System.Transactions.TransactionScopeOption.Suppress> kod bölümü tarafından gerçekleştirilen işlemleri korumak istediğinizde ve işlemler başarısız olursa ortam işlemini durdurmak istemediğinizde yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="388cd-193"><xref:System.Transactions.TransactionScopeOption.Suppress> is useful when you want to preserve the operations performed by the code section, and do not want to abort the ambient transaction if the operations fail.</span></span> <span data-ttu-id="388cd-194">Örneğin, günlüğe kaydetme veya denetim işlemleri gerçekleştirmek istediğinizde ya da çevresel işleminizi yürütmelerden veya iptal etmeksizin bağımsız olarak abonelere yayımlamak istediğinizde.</span><span class="sxs-lookup"><span data-stu-id="388cd-194">For example, when you want to perform logging or audit operations, or when you want to publish events to subscribers regardless of whether your ambient transaction commits or aborts.</span></span> <span data-ttu-id="388cd-195">Bu değer, aşağıdaki örnekte gösterildiği gibi işlem kapsamı içinde işlem olmayan bir kod bölümüne sahip etmenize olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="388cd-195">This value allows you to have a non-transactional code section inside a transaction scope, as shown in the following example.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
{
    try
    {
        //Start of non-transactional section
        using(TransactionScope scope2 = new
            TransactionScope(TransactionScopeOption.Suppress))  
        {  
            //Do non-transactional work here  
        }  
        //Restores ambient transaction here
   }
   catch {}  
   //Rest of scope1
}
```  
  
### <a name="voting-inside-a-nested-scope"></a><span data-ttu-id="388cd-196">İç içe bir kapsam içinde oylama</span><span class="sxs-lookup"><span data-stu-id="388cd-196">Voting inside a nested scope</span></span>  

 <span data-ttu-id="388cd-197">İç içe bir kapsam kök kapsamın çevresel hareketine katılabilse de, <xref:System.Transactions.TransactionScope.Complete%2A> iç içe kapsamda çağırma, kök kapsamı üzerinde hiçbir etkisi olmaz.</span><span class="sxs-lookup"><span data-stu-id="388cd-197">Although a nested scope can join the ambient transaction of the root scope, calling <xref:System.Transactions.TransactionScope.Complete%2A> in the nested scope has no affect on the root scope.</span></span> <span data-ttu-id="388cd-198">Yalnızca kök kapsamdaki en son iç içe kapsama kadar olan tüm kapsamlar işlemi yürütmek için oy alırsanız işlem kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-198">Only if all the scopes from the root scope down to the last nested scope vote to commit the transaction, will the transaction be committed.</span></span> <span data-ttu-id="388cd-199"><xref:System.Transactions.TransactionScope.Complete%2A>İç içe bir kapsamda çağrılmayan ortam işlemi hemen iptal edilecek şekilde kök kapsamı etkiler.</span><span class="sxs-lookup"><span data-stu-id="388cd-199">Not calling <xref:System.Transactions.TransactionScope.Complete%2A> in a nested scope will affect the root scope as the ambient transaction will immediately be aborted.</span></span>  
  
## <a name="setting-the-transactionscope-timeout"></a><span data-ttu-id="388cd-200">TransactionScope zaman aşımını ayarlama</span><span class="sxs-lookup"><span data-stu-id="388cd-200">Setting the TransactionScope timeout</span></span>  

 <span data-ttu-id="388cd-201">Öğesinin <xref:System.Transactions.TransactionScope> <xref:System.TimeSpan> zaman aşımını denetlemek için kullanılan, türünde bir değer kabul etmenin bazı aşırı yüklenmiş oluşturucularından bazıları.</span><span class="sxs-lookup"><span data-stu-id="388cd-201">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a value of type <xref:System.TimeSpan>, which is used to control the timeout of the transaction.</span></span> <span data-ttu-id="388cd-202">Sıfır olarak ayarlanmış bir zaman aşımı sonsuz bir zaman aşımı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="388cd-202">A timeout set to zero means an infinite timeout.</span></span> <span data-ttu-id="388cd-203">Sonsuz zaman aşımı genellikle hata ayıklama için yararlıdır, kodunuzda adım adım ilerleyerek iş mantığınızdaki bir sorunu yalıtmak istediğinizde ve sorunu bulmaya çalışırken hata ayıklama işlemini zaman aşımına uğratın.</span><span class="sxs-lookup"><span data-stu-id="388cd-203">Infinite timeout is useful mostly for debugging, when you want to isolate a problem in your business logic by stepping through your code, and you do not want the transaction you debug to time out while you attempt to locate the problem.</span></span> <span data-ttu-id="388cd-204">Tüm diğer durumlarda sonsuz zaman aşımı değerini kullanırken son derece dikkatli olun, çünkü işlem kilitlenmeleri için korumaları geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="388cd-204">Be extremely careful using the infinite timeout value in all other cases, because it overrides the safeguards against transaction deadlocks.</span></span>  
  
 <span data-ttu-id="388cd-205">Genellikle ayarlanabilir <xref:System.Transactions.TransactionScope> zaman aşımına uğramak üzere iki durumda da varsayılan dışındaki değerler.</span><span class="sxs-lookup"><span data-stu-id="388cd-205">You typically set the <xref:System.Transactions.TransactionScope> timeout to values other than default in two cases.</span></span> <span data-ttu-id="388cd-206">Birincisi geliştirme sırasında, uygulamanızın durdurulan işlemleri işleme biçimini test etmek istediğinizde olur.</span><span class="sxs-lookup"><span data-stu-id="388cd-206">The first is during development, when you want to test the way your application handles aborted transactions.</span></span> <span data-ttu-id="388cd-207">Zaman aşımını küçük bir değere (örneğin bir milisaniyelik) ayarlayarak, işlem başarısız olur ve bu nedenle hata işleme kodunuzu gözlemleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="388cd-207">By setting the timeout to a small value (such as one millisecond), you cause your transaction to fail and can thus observe your error handling code.</span></span> <span data-ttu-id="388cd-208">Kapsam içinde kaynak talebi, söz konusu kilitlenmeleri kaynaklanan düşünüyorsanız, varsayılan zaman aşımı değerinden bir değere ayarlamanız ikinci durumdur.</span><span class="sxs-lookup"><span data-stu-id="388cd-208">The second case in which you set the value to be less than the default timeout is when you believe that the scope is involved in resource contention, resulting in deadlocks.</span></span> <span data-ttu-id="388cd-209">Bu durumda, işlemi en kısa sürede iptal etmek ve varsayılan zaman aşımı süresinin dolmasını beklemek istemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="388cd-209">In that case, you want to abort the transaction as soon as possible and not wait for the default timeout to expire.</span></span>  
  
 <span data-ttu-id="388cd-210">Bir kapsam bir ortam işlemini birleşdiğinde, ancak ortam işleminin ayarlandığı değerden daha küçük bir zaman aşımı belirttiğinde, yeni, daha kısa zaman aşımı nesne üzerinde zorlanır <xref:System.Transactions.TransactionScope> ve kapsamın iç içe geçen süre içinde bitmesi gerekir, aksi halde işlem otomatik olarak iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-210">When a scope joins an ambient transaction but specifies a smaller timeout than the one the ambient transaction is set to, the new, shorter timeout is enforced on the <xref:System.Transactions.TransactionScope> object, and the scope must end within the nested time specified, or the transaction is automatically aborted.</span></span> <span data-ttu-id="388cd-211">İç içe geçmiş kapsamın zaman aşımı çevresel işlemden daha büyükse, hiçbir etkisi olmaz.</span><span class="sxs-lookup"><span data-stu-id="388cd-211">If the nested scope's timeout is more than that of the ambient transaction, it has no effect.</span></span>  
  
## <a name="setting-the-transactionscope-isolation-level"></a><span data-ttu-id="388cd-212">TransactionScope yalıtım düzeyini ayarlama</span><span class="sxs-lookup"><span data-stu-id="388cd-212">Setting the TransactionScope isolation level</span></span>  

 <span data-ttu-id="388cd-213">Bir <xref:System.Transactions.TransactionScope> <xref:System.Transactions.TransactionOptions> zaman aşımı değerine ek olarak bir yalıtım düzeyi belirtmek için türünde bir yapıyı kabul etmenin bazı aşırı yüklenmiş oluşturucularından bazıları.</span><span class="sxs-lookup"><span data-stu-id="388cd-213">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a structure of type <xref:System.Transactions.TransactionOptions> to specify an isolation level, in addition to a timeout value.</span></span> <span data-ttu-id="388cd-214">Varsayılan olarak, işlem yalıtım düzeyi olarak ayarlanmış şekilde yürütülür <xref:System.Transactions.IsolationLevel.Serializable> .</span><span class="sxs-lookup"><span data-stu-id="388cd-214">By default, the transaction executes with isolation level set to <xref:System.Transactions.IsolationLevel.Serializable>.</span></span> <span data-ttu-id="388cd-215">Başka bir yalıtım düzeyi seçme <xref:System.Transactions.IsolationLevel.Serializable> yaygın olarak okuma yoğun sistemleri için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="388cd-215">Selecting an isolation level other than <xref:System.Transactions.IsolationLevel.Serializable> is commonly used for read-intensive systems.</span></span> <span data-ttu-id="388cd-216">Bunun için işlem işleme teorisi ve işlem semantiğinin, ilgili eşzamanlılık sorunlarının ve sistem tutarlılığı sonuçlarının bir katı şekilde anlaşılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="388cd-216">This requires a solid understanding of transaction processing theory and the semantics of the transaction itself, the concurrency issues involved, and the consequences for system consistency.</span></span>  
  
 <span data-ttu-id="388cd-217">Ayrıca, tüm kaynak yöneticileri tüm yalıtım düzeylerini desteklemez ve bu işlem, bir şekilde, yapılandırılmış olandan daha yüksek bir düzeyde bir parça almak isteyebilir.</span><span class="sxs-lookup"><span data-stu-id="388cd-217">In addition, not all resource managers support all levels of isolation, and they may elect to take part in the transaction at a higher level than the one configured.</span></span>  
  
 <span data-ttu-id="388cd-218">Her yalıtım düzeyi, <xref:System.Transactions.IsolationLevel.Serializable> aynı bilgilere erişen diğer işlemlerden kaynaklanan tutarsızlığa açıktır.</span><span class="sxs-lookup"><span data-stu-id="388cd-218">Every isolation level besides <xref:System.Transactions.IsolationLevel.Serializable> is susceptible to inconsistency resulting from other transactions accessing the same information.</span></span> <span data-ttu-id="388cd-219">Farklı yalıtım düzeyleri arasındaki farkı biçiminde okunur ve yazma kilitler kullanılır.</span><span class="sxs-lookup"><span data-stu-id="388cd-219">The difference between the different isolation levels is in the way read and write locks are used.</span></span> <span data-ttu-id="388cd-220">Bir kilit, yalnızca işlem Resource Manager 'daki verilere eriştiğinde tutulabilir veya işlem tamamlanana ya da durduruluncaya kadar tutulabilirler.</span><span class="sxs-lookup"><span data-stu-id="388cd-220">A lock can be held only when the transaction accesses the data in the resource manager, or it can be held until the transaction is committed or aborted.</span></span> <span data-ttu-id="388cd-221">Eski verimlilik, tutarlılık ikincisi için iyidir.</span><span class="sxs-lookup"><span data-stu-id="388cd-221">The former is better for throughput, the latter for consistency.</span></span> <span data-ttu-id="388cd-222">Kilit iki tür ve işlemleri (okuma/yazma) iki tür dört temel yalıtım düzeyi verin.</span><span class="sxs-lookup"><span data-stu-id="388cd-222">The two kinds of locks and the two kinds of operations (read/write) give four basic isolation levels.</span></span> <span data-ttu-id="388cd-223">Daha fazla bilgi edinmek için bkz. <xref:System.Transactions.IsolationLevel>.</span><span class="sxs-lookup"><span data-stu-id="388cd-223">See <xref:System.Transactions.IsolationLevel> for more information.</span></span>  
  
 <span data-ttu-id="388cd-224">İç içe <xref:System.Transactions.TransactionScope> nesneler kullanılırken, tüm iç içe kapsamlar çevresel işleme katmak istediklerinde tam olarak aynı yalıtım düzeyini kullanacak şekilde yapılandırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="388cd-224">When using nested <xref:System.Transactions.TransactionScope> objects, all nested scopes must be configured to use exactly the same isolation level if they want to join the ambient transaction.</span></span> <span data-ttu-id="388cd-225">Yuvalanmış bir <xref:System.Transactions.TransactionScope> nesne, ortam işlemine katılmayı denediğinde farklı bir yalıtım düzeyi belirtir, bir oluşturulur <xref:System.ArgumentException> .</span><span class="sxs-lookup"><span data-stu-id="388cd-225">If a nested <xref:System.Transactions.TransactionScope> object tries to join the ambient transaction yet it specifies a different isolation level, an <xref:System.ArgumentException> is thrown.</span></span>  
  
## <a name="interop-with-com"></a><span data-ttu-id="388cd-226">COM + ile birlikte çalışma</span><span class="sxs-lookup"><span data-stu-id="388cd-226">Interop with COM+</span></span>  

 <span data-ttu-id="388cd-227">Yeni bir <xref:System.Transactions.TransactionScope> örnek oluşturduğunuzda, <xref:System.Transactions.EnterpriseServicesInteropOption> com+ ile nasıl etkileşim kuracağınızı belirtmek için oluşturuculardan birindeki sabit listesini kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="388cd-227">When you create a new <xref:System.Transactions.TransactionScope> instance, you can use the <xref:System.Transactions.EnterpriseServicesInteropOption> enumeration in one of the constructors to specify how to interact with COM+.</span></span> <span data-ttu-id="388cd-228">Bu konuda daha fazla bilgi için bkz. [Enterprise Services ve com+ işlemleri Ile birlikte çalışabilirlik](interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="388cd-228">For more information on this, see [Interoperability with Enterprise Services and COM+ Transactions](interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="388cd-229">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="388cd-229">See also</span></span>

- <xref:System.Transactions.Transaction.Clone%2A>
- <xref:System.Transactions.TransactionScope>
