---
title: Bir İşlemde Kaynakları Katılımcı Olarak Kaydetme
description: Bir .NET işleminde katılımcı olarak listeleme kaynakları. Bir işlemdeki her kaynak bir işlem yöneticisi tarafından koordine edilen bir kaynak yöneticisi tarafından yönetilir.
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 786a12c2-d530-49f4-9c59-5c973e15a11d
ms.openlocfilehash: c3c777593750b3a4f05ae97ed6e26e19f58e4d72
ms.sourcegitcommit: 6219b1e1feccb16d88656444210fed3297f5611e
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/22/2020
ms.locfileid: "85141881"
---
# <a name="enlisting-resources-as-participants-in-a-transaction"></a><span data-ttu-id="31526-104">Bir İşlemde Kaynakları Katılımcı Olarak Kaydetme</span><span class="sxs-lookup"><span data-stu-id="31526-104">Enlisting Resources as Participants in a Transaction</span></span>

<span data-ttu-id="31526-105">Bir işleme katılan her kaynak, eylemleri bir işlem yöneticisi tarafından koordine edilen bir kaynak yöneticisi tarafından yönetilir.</span><span class="sxs-lookup"><span data-stu-id="31526-105">Each resource participating in a transaction is managed by a resource manager, whose actions are coordinated by a transaction manager.</span></span> <span data-ttu-id="31526-106">Koordinasyon, işlem Yöneticisi aracılığıyla bir işlemde kayıtlı olan abonelere verilen bildirimler aracılığıyla yapılır.</span><span class="sxs-lookup"><span data-stu-id="31526-106">The coordination is done through notifications given to subscribers who have enlisted in a transaction through the transaction manager.</span></span>

<span data-ttu-id="31526-107">Bu konu, bir kaynağın (veya birden fazla kaynağın) bir işlemde nasıl ve farklı kayıt türlerine nasıl kayyüklenebileceğini ele alır.</span><span class="sxs-lookup"><span data-stu-id="31526-107">This topic covers how a resource (or multiple resources) can be enlisted in a transaction, as well as the different types of enlistment.</span></span> <span data-ttu-id="31526-108">[Tek aşamalı ve çok aşamalı bir Işlem yürütmek](committing-a-transaction-in-single-phase-and-multi-phase.md) , işlem taahhüdünün kayıtlı kaynaklar arasında nasıl koordine edilebilir olduğunu içerir.</span><span class="sxs-lookup"><span data-stu-id="31526-108">The [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md) topic covers how transaction commitment can be coordinated among enlisted resources.</span></span>

## <a name="enlisting-resources-in-a-transaction"></a><span data-ttu-id="31526-109">Bir Işlemdeki kaynakları kaydetme</span><span class="sxs-lookup"><span data-stu-id="31526-109">Enlisting Resources in a Transaction</span></span>

<span data-ttu-id="31526-110">Bir kaynağın bir işleme katılmasını sağlamak için, işlem içinde listelenmesi gerekir.</span><span class="sxs-lookup"><span data-stu-id="31526-110">In order for a resource to participate in a transaction, it must enlist in the transaction.</span></span> <span data-ttu-id="31526-111"><xref:System.Transactions.Transaction>Sınıfı, bu işlevselliği sağlayan, adları **Listeleme** ile başlayan bir yöntemler kümesini tanımlar.</span><span class="sxs-lookup"><span data-stu-id="31526-111">The <xref:System.Transactions.Transaction> class defines a set of methods whose names begin with **Enlist** that provide this functionality.</span></span> <span data-ttu-id="31526-112">Farklı **Listeleme** yöntemleri, bir kaynak yöneticisi 'nin sahip olabileceği farklı kayıt türlerine karşılık gelir.</span><span class="sxs-lookup"><span data-stu-id="31526-112">The different **Enlist** methods correspond to the different types of enlistment that a resource manager may have.</span></span> <span data-ttu-id="31526-113">Özellikle, kullandığınız <xref:System.Transactions.Transaction.EnlistVolatile%2A> geçici kaynaklar için yöntemleri ve <xref:System.Transactions.Transaction.EnlistDurable%2A> kalıcı kaynaklar için yöntem.</span><span class="sxs-lookup"><span data-stu-id="31526-113">Specifically, you use the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods for volatile resources, and the <xref:System.Transactions.Transaction.EnlistDurable%2A> method for durable resources.</span></span> <span data-ttu-id="31526-114">Süreklilik (veya tersine volatility) kaynak yöneticisi kaynak yöneticisi hatası kurtarma destekleyip başvuruyor.</span><span class="sxs-lookup"><span data-stu-id="31526-114">The durability (or conversely the volatility) of a resource manager refers to whether the resource manager supports failure recovery.</span></span> <span data-ttu-id="31526-115">Bir Kaynak Yöneticisi hata kurtarmayı destekliyorsa, Aşama 1 sırasında verileri dayanıklı depolamaya (hazırla) devam ettirir. Bu, Resource Manager kapalıysa, kurtarma sonrasında işlemi yeniden listeleme ve TM 'den alınan bildirimlere göre uygun eylemleri gerçekleştirmenize olanak sağlar.</span><span class="sxs-lookup"><span data-stu-id="31526-115">If a resource manager supports failure recovery, it persists data to durable storage during Phase1 (prepare) such that if the resource manager goes down, it can re-enlist in the transaction upon recovery and perform the proper actions based on the notifications received from the TM.</span></span> <span data-ttu-id="31526-116">Genel olarak, geçici kaynak yöneticileri bellek içi veri yapısı (örneğin, bellek içi bir işlem Hashtable) gibi geçici kaynakları yönetir ve dayanıklı kaynak yöneticileri, daha kalıcı bir yedekleme deposuna sahip kaynakları (örneğin, yedekleme deposu disk olan bir veritabanı) yönetir.</span><span class="sxs-lookup"><span data-stu-id="31526-116">In general, volatile resource managers manage volatile resources such as an in-memory data structure (for example, an in-memory transacted-hashtable), and durable resource managers manage resources that have a more persistent backing store (for example, a database whose backing store is disk).</span></span>

<span data-ttu-id="31526-117">Kullanılacak karar sonra kolaylık <xref:System.Transactions.Transaction.EnlistDurable%2A> veya <xref:System.Transactions.Transaction.EnlistVolatile%2A> , kaynağın süreklilik desteğini tabanlı yöntemi, iki aşaması yürütme içinde (2PC) uygulayarak katılmak için kaynak listeleme <xref:System.Transactions.IEnlistmentNotification> , kaynak yöneticisi için arabirim.</span><span class="sxs-lookup"><span data-stu-id="31526-117">For simplicity, after deciding whether to use the <xref:System.Transactions.Transaction.EnlistDurable%2A> or <xref:System.Transactions.Transaction.EnlistVolatile%2A> method based on your resource's durability support, you should enlist your resource to participate in Two Phase Commit (2PC) by implementing the <xref:System.Transactions.IEnlistmentNotification> interface for your resource manager.</span></span> <span data-ttu-id="31526-118">2PC hakkında daha fazla bilgi için bkz. [tek aşamalı ve çok aşamalı bir işlem](committing-a-transaction-in-single-phase-and-multi-phase.md)yürütme.</span><span class="sxs-lookup"><span data-stu-id="31526-118">For more information on 2PC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md).</span></span>

<span data-ttu-id="31526-119">Tek bir katılımcı çağırarak birden fazla bu iletişim kuralları için listeleme <xref:System.Transactions.Transaction.EnlistDurable%2A> ve <xref:System.Transactions.Transaction.EnlistVolatile%2A> birden çok kez.</span><span class="sxs-lookup"><span data-stu-id="31526-119">A single participant can enlist for more than one of these protocols by calling <xref:System.Transactions.Transaction.EnlistDurable%2A> and <xref:System.Transactions.Transaction.EnlistVolatile%2A> multiple times.</span></span>

### <a name="durable-enlistment"></a><span data-ttu-id="31526-120">Kalıcı liste</span><span class="sxs-lookup"><span data-stu-id="31526-120">Durable Enlistment</span></span>

<span data-ttu-id="31526-121"><xref:System.Transactions.Transaction.EnlistDurable%2A>Yöntemler, bir kaynak yöneticisinin işlem içinde sürekli bir kaynak olarak katılımını yapmak için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="31526-121">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods are used to enlist a resource manager for participation in the transaction as a durable resource.</span></span>  <span data-ttu-id="31526-122">Kalıcı bir kaynak yöneticisinin bir işlemin ortasında aşağı doğru olması bekleniyorsa, bu, katılımcı olduğu tüm işlemlerde (yöntemini kullanarak) yeniden çevrimiçi duruma getirildikten sonra kurtarma işlemini gerçekleştirebilir, ancak <xref:System.Transactions.TransactionManager.Reenlist%2A> 2. aşama tamamlanamamıştı ve <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> kurtarma işlemini tamamladıktan sonra çağrı yapabilir.</span><span class="sxs-lookup"><span data-stu-id="31526-122">It is expected that if a durable resource manager is brought down in the middle of a transaction, it can perform recovery once it is brought back online by reenlisting (using the <xref:System.Transactions.TransactionManager.Reenlist%2A> method) in all transactions in which it was a participant and did not complete phase 2, and call <xref:System.Transactions.TransactionManager.RecoveryComplete%2A> once it finishes recovery processing.</span></span> <span data-ttu-id="31526-123">Kurtarma hakkında daha fazla bilgi için bkz. [Kurtarma gerçekleştirme](performing-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="31526-123">For more information on recovery, see [Performing Recovery](performing-recovery.md).</span></span>

<span data-ttu-id="31526-124"><xref:System.Transactions.Transaction.EnlistDurable%2A> Tüm getirin yöntemleri bir <xref:System.Guid> kendi ilk parameTRe olarak nesne.</span><span class="sxs-lookup"><span data-stu-id="31526-124">The <xref:System.Transactions.Transaction.EnlistDurable%2A> methods all take a <xref:System.Guid> object as their first parameter.</span></span> <span data-ttu-id="31526-125">, <xref:System.Guid> Belirli bir kaynak yöneticisiyle dayanıklı bir kaydı ilişkilendirmek için işlem yöneticisi tarafından kullanılır.</span><span class="sxs-lookup"><span data-stu-id="31526-125">The <xref:System.Guid> is used by the transaction manager to associate a durable enlistment with a particular resource manager.</span></span> <span data-ttu-id="31526-126">Bu nedenle, bu kaynak yöneticisi tutarlı bir şekilde aynı kullandığını zorunludur <xref:System.Guid> kendisi arasında bile yeniden başlatıldığında farklı kaynak yöneticileri belirlemek için Aksi takdirde kurtarma başarısız olabilir.</span><span class="sxs-lookup"><span data-stu-id="31526-126">As such, it is imperative that a resource manager consistently uses the same <xref:System.Guid> to identify itself even across different resource managers upon restarting, otherwise the recovery can fail.</span></span>

<span data-ttu-id="31526-127">Yöntemin ikinci parametresi, <xref:System.Transactions.Transaction.EnlistDurable%2A> Resource Manager 'ın işlem bildirimlerini almak için uyguladığı nesnesine bir başvurudur.</span><span class="sxs-lookup"><span data-stu-id="31526-127">The second parameter of the <xref:System.Transactions.Transaction.EnlistDurable%2A> method is a reference to the object that the resource manager implements to receive transaction notifications.</span></span> <span data-ttu-id="31526-128">Kullandığınız aşırı yükleme, Resource Manager 'ın tek aşamalı Işleme (SPC) iyileştirmesini destekleyip desteklemediğini işlem yöneticisine bildirir.</span><span class="sxs-lookup"><span data-stu-id="31526-128">The overload you use informs the transaction manager whether your resource manager supports the Single Phase Commit (SPC) optimization.</span></span> <span data-ttu-id="31526-129">Çoğu zaman uygulamak <xref:System.Transactions.IEnlistmentNotification> Two-Phase (2PC) içinde yürütme katılmak için arabirim.</span><span class="sxs-lookup"><span data-stu-id="31526-129">Most of the time you would implement the <xref:System.Transactions.IEnlistmentNotification> interface to take part in Two-Phase Commit (2PC).</span></span> <span data-ttu-id="31526-130">Kaydetme işlemi iyileştirmek istiyorsanız, ancak, uygulama düşünebilirsiniz <xref:System.Transactions.ISinglePhaseNotification> SPC için arabirim.</span><span class="sxs-lookup"><span data-stu-id="31526-130">However, if you want to optimize the commit process, you can consider implementing the <xref:System.Transactions.ISinglePhaseNotification> interface for SPC.</span></span> <span data-ttu-id="31526-131">SPC hakkında daha fazla bilgi için bkz. tek aşamalı [işleme ve promotable tek aşamalı bildirimi kullanarak](optimization-spc-and-promotable-spn.md) [bir işlemi tek aşamada ve çok aşamalı](committing-a-transaction-in-single-phase-and-multi-phase.md) ve en iyi duruma getirme.</span><span class="sxs-lookup"><span data-stu-id="31526-131">For more information on SPC, see [Committing a Transaction in Single-Phase and Multi-Phase](committing-a-transaction-in-single-phase-and-multi-phase.md) and [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>

<span data-ttu-id="31526-132">Üçüncü parameTRe bir <xref:System.Transactions.EnlistmentOptions> numaralandırma değeri ya da olabilir, <xref:System.Transactions.EnlistmentOptions.None> veya <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span><span class="sxs-lookup"><span data-stu-id="31526-132">The third parameter is an <xref:System.Transactions.EnlistmentOptions> enumeration, whose value can be either <xref:System.Transactions.EnlistmentOptions.None> or <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>.</span></span> <span data-ttu-id="31526-133">Değer olarak ayarlanırsa <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired> , kayıt, işlem yöneticisi 'Nden hazırlama bildirimi alındıktan sonra ek kaynak yöneticileri listesine eklenebilir.</span><span class="sxs-lookup"><span data-stu-id="31526-133">If the value is set to <xref:System.Transactions.EnlistmentOptions.EnlistDuringPrepareRequired>, the enlistment may enlist additional resource managers upon receiving the Prepare notification from the transaction manager.</span></span> <span data-ttu-id="31526-134">Ancak, bu liste türü tek aşaması yürütme en iyi hale getirme için uygun değil bilmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="31526-134">However, you should be aware that this type of enlistment is not eligible for the Single Phase Commit optimization.</span></span>

### <a name="volatile-enlistment"></a><span data-ttu-id="31526-135">Geçici liste</span><span class="sxs-lookup"><span data-stu-id="31526-135">Volatile Enlistment</span></span>

<span data-ttu-id="31526-136">Gibi bir önbellek kullanarak listeleme geçici kaynaklarını yönetme katılımcıları <xref:System.Transactions.Transaction.EnlistVolatile%2A> yöntemleri.</span><span class="sxs-lookup"><span data-stu-id="31526-136">Participants managing volatile resources such as a cache should enlist using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods.</span></span> <span data-ttu-id="31526-137">Bu tür nesneler bir işlemin sonucunu elde edemeyebilir veya bir sistem hatasından sonra katıldıkları herhangi bir işlemin durumunu kurtaramayabilir.</span><span class="sxs-lookup"><span data-stu-id="31526-137">Such objects might not be able to obtain the outcome of a transaction or recover the state of any transaction they participate in after a system failure.</span></span>

<span data-ttu-id="31526-138">Bir bellek içi, geçici kaynak yönettiği, yukarıda belirtildiği gibi bir kaynak yöneticisi geçici bir liste hale getireceği.</span><span class="sxs-lookup"><span data-stu-id="31526-138">As stated previously, a resource manager would make a volatile enlistment if it manages an in-memory, volatile resource.</span></span> <span data-ttu-id="31526-139">Kullanmanın avantajlarından biri, <xref:System.Transactions.Transaction.EnlistVolatile%2A> işlemin gereksiz bir şekilde ilerlemesini zorlamaktır.</span><span class="sxs-lookup"><span data-stu-id="31526-139">One of the benefits of using <xref:System.Transactions.Transaction.EnlistVolatile%2A> is that it does not force an unnecessary escalation of the transaction.</span></span> <span data-ttu-id="31526-140">İşlem yükseltme hakkında daha fazla bilgi için bkz. [Işlem yönetimi ilerletme](transaction-management-escalation.md) konusu.</span><span class="sxs-lookup"><span data-stu-id="31526-140">For more information on transaction escalation, see [Transaction Management Escalation](transaction-management-escalation.md) topic.</span></span> <span data-ttu-id="31526-141">Listenin her ikisi de kayıt işleminin işlem yöneticisi tarafından nasıl işlendiği ve kaynak yöneticisinin işlem yöneticisi tarafından beklenildiği bir farklılık anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="31526-141">Enlisting volatility implies both a difference in how the enlistment is handled by the transaction manager, as well as what is expected of the resource manager by the transaction manager.</span></span> <span data-ttu-id="31526-142">Geçici Kaynak Yöneticisi kurtarma gerçekleştirmez olmasıdır.</span><span class="sxs-lookup"><span data-stu-id="31526-142">This is because a volatile resource manager does not perform recovery.</span></span> <span data-ttu-id="31526-143"><xref:System.Transactions.Transaction.EnlistVolatile%2A> Yöntemleri olması değil bir <xref:System.Guid> parameTResi, çünkü geçici Kaynak Yöneticisi kurtarma gerçekleştirmez ve değil çağırırsınız <xref:System.Transactions.TransactionManager.Reenlist%2A> gereken yöntemi bir <xref:System.Guid>.</span><span class="sxs-lookup"><span data-stu-id="31526-143">The <xref:System.Transactions.Transaction.EnlistVolatile%2A> methods do not take a <xref:System.Guid> parameter, because a volatile resource manager does not perform recovery and would not call the <xref:System.Transactions.TransactionManager.Reenlist%2A> method which needs a <xref:System.Guid>.</span></span>

<span data-ttu-id="31526-144">Kalıcı kayıtlar sayesinde, listeleme için kullandığınız herhangi bir aşırı yükleme yöntemi, Resource Manager 'ın tek aşamalı Işleme iyileştirmesini destekleyip desteklemediğini belirtir.</span><span class="sxs-lookup"><span data-stu-id="31526-144">As with durable enlistments, whichever overload method you use to enlist denotes to the transaction manager whether your resource manager supports the Single Phase Commit optimization.</span></span> <span data-ttu-id="31526-145">Geçici Kaynak Yöneticisi kurtarma gerçekleştiremezsiniz dolayı hiçbir kurtarma bilgi hazırla aşamasında geçici bir liste için yazılır.</span><span class="sxs-lookup"><span data-stu-id="31526-145">Since a volatile resource manager cannot perform recovery, no recovery information is written for a volatile enlistment during the Prepare phase.</span></span> <span data-ttu-id="31526-146">Bu nedenle, çağırma <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> yöntemi sonuçlanıyor bir <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="31526-146">Therefore, calling the <xref:System.Transactions.PreparingEnlistment.RecoveryInformation%2A> method results in an <xref:System.InvalidOperationException>.</span></span>

<span data-ttu-id="31526-147">Aşağıdaki örnek, yöntemi kullanılarak bir işlem için bir nesne için bir katılımcı olarak nasıl listelenmeyi gösterir <xref:System.Transactions.Transaction.EnlistVolatile%2A> .</span><span class="sxs-lookup"><span data-stu-id="31526-147">The following example shows how to enlist such an object as a participant in a transaction using the <xref:System.Transactions.Transaction.EnlistVolatile%2A> method.</span></span>

[!code-csharp[Tx_Enlist#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/tx_enlist/cs/enlist.cs#1)]
[!code-vb[Tx_Enlist#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/tx_enlist/vb/enlist.vb#1)]

### <a name="optimizing-performance"></a><span data-ttu-id="31526-148">Performansı en iyi duruma getirme</span><span class="sxs-lookup"><span data-stu-id="31526-148">Optimizing Performance</span></span>

<span data-ttu-id="31526-149"><xref:System.Transactions.Transaction> Sınıfı sağlar <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> bir Promotable tek aşaması liste'nı (PSPE) listeleme yöntemi.</span><span class="sxs-lookup"><span data-stu-id="31526-149">The <xref:System.Transactions.Transaction> class also provides the <xref:System.Transactions.Transaction.EnlistPromotableSinglePhase%2A> method to enlist a Promotable Single Phase Enlistment (PSPE).</span></span> <span data-ttu-id="31526-150">Bu, dayanıklı bir kaynak yöneticisinin (RM), daha sonra gerekirse MSDTC tarafından yönetilmek üzere ilerletilebilecek bir işlem barındırarak "sahip" olmasını sağlar.</span><span class="sxs-lookup"><span data-stu-id="31526-150">This allows a durable resource manager (RM) to host and "own" a transaction that can later be escalated to be managed by the MSDTC if necessary.</span></span> <span data-ttu-id="31526-151">Bunun hakkında daha fazla bilgi için bkz. [tek aşamalı tamamlama ve promotable tek aşamalı bildirimi kullanarak iyileştirme](optimization-spc-and-promotable-spn.md).</span><span class="sxs-lookup"><span data-stu-id="31526-151">For more information on this, see [Optimization using Single Phase Commit and Promotable Single Phase Notification](optimization-spc-and-promotable-spn.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="31526-152">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="31526-152">See also</span></span>

- [<span data-ttu-id="31526-153">Tek Aşamalı İşleme ve Yükseltilebilir Tek Aşamalı Bildirim kullanarak en iyi duruma getirme</span><span class="sxs-lookup"><span data-stu-id="31526-153">Optimization using Single Phase Commit and Promotable Single Phase Notification</span></span>](optimization-spc-and-promotable-spn.md)
- [<span data-ttu-id="31526-154">Tek Aşamalı ve Çok Aşamalı İşlem Gerçekleştirme</span><span class="sxs-lookup"><span data-stu-id="31526-154">Committing a Transaction in Single-Phase and Multi-Phase</span></span>](committing-a-transaction-in-single-phase-and-multi-phase.md)
