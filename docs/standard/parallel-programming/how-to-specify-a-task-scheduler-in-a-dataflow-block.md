---
title: 'Nasıl yapılır: Veri Akışı Bloğunda Görev Zamanlayıcı Belirtme'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- TPL dataflow library, linking to task scheduler in TPL
- Task Parallel Library, dataflows
- task scheduler, linking from TPL
ms.assetid: 27ece374-ed5b-49ef-9cec-b20db34a65e8
ms.openlocfilehash: 76c9e75f787c28657af143b46bb22d08039e2dc4
ms.sourcegitcommit: 33deec3e814238fb18a49b2a7e89278e27888291
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 06/02/2020
ms.locfileid: "84288140"
---
# <a name="how-to-specify-a-task-scheduler-in-a-dataflow-block"></a><span data-ttu-id="93eda-102">Nasıl yapılır: Veri Akışı Bloğunda Görev Zamanlayıcı Belirtme</span><span class="sxs-lookup"><span data-stu-id="93eda-102">How to: Specify a Task Scheduler in a Dataflow Block</span></span>
<span data-ttu-id="93eda-103">Bu belgede, uygulamanızda veri akışı kullandığınızda belirli bir görev zamanlayıcısını nasıl ilişkilenbileceğiniz gösterilmektedir.</span><span class="sxs-lookup"><span data-stu-id="93eda-103">This document demonstrates how to associate a specific task scheduler when you use dataflow in your application.</span></span> <span data-ttu-id="93eda-104">Örnek, <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=nameWithType> okuyucu görevlerinin etkin olduğu ve bir yazıcı görevinin etkin olduğu zaman göstermek için bir Windows Forms uygulamasındaki sınıfını kullanır.</span><span class="sxs-lookup"><span data-stu-id="93eda-104">The example uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair?displayProperty=nameWithType> class in a Windows Forms application to show when reader tasks are active and when a writer task is active.</span></span> <span data-ttu-id="93eda-105">Ayrıca, <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> bir veri akışı bloğunun Kullanıcı arabirimi iş parçacığında çalışmasını sağlamak için yöntemini kullanır.</span><span class="sxs-lookup"><span data-stu-id="93eda-105">It also uses the <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> method to enable a dataflow block to run on the user-interface thread.</span></span>

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="to-create-the-windows-forms-application"></a><span data-ttu-id="93eda-106">Windows Forms uygulamasını oluşturmak için</span><span class="sxs-lookup"><span data-stu-id="93eda-106">To Create the Windows Forms Application</span></span>  
  
1. <span data-ttu-id="93eda-107">Visual C# veya Visual Basic **Windows Forms uygulama** projesi oluşturun.</span><span class="sxs-lookup"><span data-stu-id="93eda-107">Create a Visual C# or Visual Basic **Windows Forms Application** project.</span></span> <span data-ttu-id="93eda-108">Aşağıdaki adımlarda proje adlandırılır `WriterReadersWinForms` .</span><span class="sxs-lookup"><span data-stu-id="93eda-108">In the following steps, the project is named `WriterReadersWinForms`.</span></span>  
  
2. <span data-ttu-id="93eda-109">Ana formun form tasarımcısında, Form1.cs (Visual Basic için Form1. vb), dört <xref:System.Windows.Forms.CheckBox> denetim ekleyin.</span><span class="sxs-lookup"><span data-stu-id="93eda-109">On the form designer for the main form, Form1.cs (Form1.vb for Visual Basic), add four <xref:System.Windows.Forms.CheckBox> controls.</span></span> <span data-ttu-id="93eda-110">Özelliği için <xref:System.Windows.Forms.Control.Text%2A> **Reader 1** , için okuyucu `checkBox1` **2** , için okuyucu `checkBox2` **3** `checkBox3` ve **Yazıcı** olarak ayarlayın `checkBox4` .</span><span class="sxs-lookup"><span data-stu-id="93eda-110">Set the <xref:System.Windows.Forms.Control.Text%2A> property to **Reader 1** for `checkBox1`, **Reader 2** for `checkBox2`, **Reader 3** for `checkBox3`, and **Writer** for `checkBox4`.</span></span> <span data-ttu-id="93eda-111"><xref:System.Windows.Forms.Control.Enabled%2A>Her denetim için özelliğini olarak ayarlayın `False` .</span><span class="sxs-lookup"><span data-stu-id="93eda-111">Set the <xref:System.Windows.Forms.Control.Enabled%2A> property for each control to `False`.</span></span>  
  
3. <span data-ttu-id="93eda-112">Forma bir <xref:System.Windows.Forms.Timer> denetim ekleyin.</span><span class="sxs-lookup"><span data-stu-id="93eda-112">Add a <xref:System.Windows.Forms.Timer> control to the form.</span></span> <span data-ttu-id="93eda-113"><xref:System.Windows.Forms.Timer.Interval%2A>Özelliğini olarak ayarlayın `2500` .</span><span class="sxs-lookup"><span data-stu-id="93eda-113">Set the <xref:System.Windows.Forms.Timer.Interval%2A> property to `2500`.</span></span>  
  
## <a name="adding-dataflow-functionality"></a><span data-ttu-id="93eda-114">Veri akışı Işlevselliği ekleme</span><span class="sxs-lookup"><span data-stu-id="93eda-114">Adding Dataflow Functionality</span></span>  
 <span data-ttu-id="93eda-115">Bu bölümde, uygulamaya katılan veri akışı bloklarının oluşturulması ve bunların her birinin bir Görev Zamanlayıcısı ile ilişkilendirilmesi açıklanmaktadır.</span><span class="sxs-lookup"><span data-stu-id="93eda-115">This section describes how to create the dataflow blocks that participate in the application and how to associate each one with a task scheduler.</span></span>  
  
### <a name="to-add-dataflow-functionality-to-the-application"></a><span data-ttu-id="93eda-116">Uygulamaya veri akışı Işlevselliği eklemek için</span><span class="sxs-lookup"><span data-stu-id="93eda-116">To Add Dataflow Functionality to the Application</span></span>  
  
1. <span data-ttu-id="93eda-117">Projenizde, System. Threading. Tasks. Dataflow. dll ' ye bir başvuru ekleyin.</span><span class="sxs-lookup"><span data-stu-id="93eda-117">In your project, add a reference to System.Threading.Tasks.Dataflow.dll.</span></span>  
  
2. <span data-ttu-id="93eda-118">Form1.cs (Visual Basic için Form1. vb) 'in aşağıdaki deyimlerini (Visual Basic) içerdiğinden emin olun `using` `Imports` .</span><span class="sxs-lookup"><span data-stu-id="93eda-118">Ensure that Form1.cs (Form1.vb for Visual Basic) contains the following `using` statements (`Imports` in Visual Basic).</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#1)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#1)]  
  
3. <span data-ttu-id="93eda-119">Sınıfına bir <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> veri üyesi ekleyin `Form1` .</span><span class="sxs-lookup"><span data-stu-id="93eda-119">Add a <xref:System.Threading.Tasks.Dataflow.BroadcastBlock%601> data member to the `Form1` class.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#2)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#2)]  
  
4. <span data-ttu-id="93eda-120">`Form1`Oluşturucuda, çağrısından sonra `InitializeComponent` , <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> nesnelerin durumuna geçiş yapan bir nesne oluşturun <xref:System.Windows.Forms.CheckBox> .</span><span class="sxs-lookup"><span data-stu-id="93eda-120">In the `Form1` constructor, after the call to `InitializeComponent`, create an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object that toggles the state of <xref:System.Windows.Forms.CheckBox> objects.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#3)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#3)]  
  
5. <span data-ttu-id="93eda-121">Oluşturucuda, `Form1` her bir nesne için bir nesne <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> ve dört nesne oluşturun <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> <xref:System.Windows.Forms.CheckBox> .</span><span class="sxs-lookup"><span data-stu-id="93eda-121">In the `Form1` constructor, create a <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object and four <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> objects, one <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object for each <xref:System.Windows.Forms.CheckBox> object.</span></span> <span data-ttu-id="93eda-122">Her bir <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> nesne için, <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> özelliği <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A> Okuyucular için özelliği ve yazıcı özelliği olarak ayarlanmış bir nesne belirtin <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A> .</span><span class="sxs-lookup"><span data-stu-id="93eda-122">For each <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object, specify a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ConcurrentScheduler%2A> property for the readers, and the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair.ExclusiveScheduler%2A> property for the writer.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#4)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#4)]  
  
6. <span data-ttu-id="93eda-123">Oluşturucuda, `Form1` <xref:System.Windows.Forms.Timer> nesnesini başlatın.</span><span class="sxs-lookup"><span data-stu-id="93eda-123">In the `Form1` constructor, start the <xref:System.Windows.Forms.Timer> object.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#5)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#5)]  
  
7. <span data-ttu-id="93eda-124">Ana form için form tasarımcısında, süreölçer için olay için bir olay işleyicisi oluşturun <xref:System.Windows.Forms.Timer.Tick> .</span><span class="sxs-lookup"><span data-stu-id="93eda-124">On the form designer for the main form, create an event handler for the <xref:System.Windows.Forms.Timer.Tick> event for the timer.</span></span>  
  
8. <span data-ttu-id="93eda-125"><xref:System.Windows.Forms.Timer.Tick>Süreölçer için olayı uygulayın.</span><span class="sxs-lookup"><span data-stu-id="93eda-125">Implement the <xref:System.Windows.Forms.Timer.Tick> event for the timer.</span></span>  
  
     [!code-csharp[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#6)]
     [!code-vb[TPLDataflow_WriterReadersWinForms#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#6)]  
  
 <span data-ttu-id="93eda-126">`toggleCheckBox`Veri akışı bloğu Kullanıcı arabiriminde davrandığı için, bu eylemin Kullanıcı arabirimi iş parçacığında gerçekleştirilmesi önemlidir.</span><span class="sxs-lookup"><span data-stu-id="93eda-126">Because the `toggleCheckBox` dataflow block acts on the user interface, it is important that this action occur on the user-interface thread.</span></span> <span data-ttu-id="93eda-127">Bunu gerçekleştirmek için, oluşturma sırasında bu nesne <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> , <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> özelliği olarak ayarlanmış bir nesne sağlar <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="93eda-127">To accomplish this, during construction this object provides a <xref:System.Threading.Tasks.Dataflow.ExecutionDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.DataflowBlockOptions.TaskScheduler%2A> property set to <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="93eda-128"><xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A>Yöntemi, <xref:System.Threading.Tasks.TaskScheduler> geçerli eşitleme bağlamında çalışmayı gerçekleştiren bir nesnesi oluşturur.</span><span class="sxs-lookup"><span data-stu-id="93eda-128">The <xref:System.Threading.Tasks.TaskScheduler.FromCurrentSynchronizationContext%2A> method creates a <xref:System.Threading.Tasks.TaskScheduler> object that performs work on the current synchronization context.</span></span> <span data-ttu-id="93eda-129">`Form1`Oluşturucu kullanıcı arabirimi iş parçacığından çağrıldığı için, `toggleCheckBox` veri akışı bloğu eylemi Kullanıcı arabirimi iş parçacığında da çalışır.</span><span class="sxs-lookup"><span data-stu-id="93eda-129">Because the `Form1` constructor is called from the user-interface thread, the action for the `toggleCheckBox` dataflow block also runs on the user-interface thread.</span></span>  
  
 <span data-ttu-id="93eda-130">Bu örnek ayrıca, <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> bazı veri akışı bloklarının aynı anda çalışmasını sağlamak için sınıfını ve aynı nesne üzerinde çalışan diğer tüm veri akışı bloklarına göre özel olarak hareket etmek için başka bir veri akışı bloğunu kullanır <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> .</span><span class="sxs-lookup"><span data-stu-id="93eda-130">This example also uses the <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> class to enable some dataflow blocks to act concurrently, and another dataflow block to act exclusive with respect to all other dataflow blocks that run on the same <xref:System.Threading.Tasks.ConcurrentExclusiveSchedulerPair> object.</span></span> <span data-ttu-id="93eda-131">Bu teknik, birden çok veri akışı bloğu bir kaynağı paylaşıyorsa ve bir kaynağa erişimi el ile eşitlemeye yönelik gereksinimi ortadan kaldırdığı için bu kaynağa özel erişim gerektirirken yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="93eda-131">This technique is useful when multiple dataflow blocks share a resource and some require exclusive access to that resource, because it eliminates the requirement to manually synchronize access to that resource.</span></span> <span data-ttu-id="93eda-132">El ile eşitlemenin eleme kodu daha verimli hale getirir.</span><span class="sxs-lookup"><span data-stu-id="93eda-132">The elimination of manual synchronization can make code more efficient.</span></span>  
  
## <a name="example"></a><span data-ttu-id="93eda-133">Örnek</span><span class="sxs-lookup"><span data-stu-id="93eda-133">Example</span></span>  
 <span data-ttu-id="93eda-134">Aşağıdaki örnek, Form1.cs için tüm kodu gösterir (Visual Basic için Form1. vb).</span><span class="sxs-lookup"><span data-stu-id="93eda-134">The following example shows the complete code for Form1.cs (Form1.vb for Visual Basic).</span></span>  
  
 [!code-csharp[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/cs/writerreaderswinforms/form1.cs#100)]
 [!code-vb[TPLDataflow_WriterReadersWinForms#100](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_writerreaderswinforms/vb/writerreaderswinforms/form1.vb#100)]  
  
## <a name="see-also"></a><span data-ttu-id="93eda-135">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="93eda-135">See also</span></span>

- [<span data-ttu-id="93eda-136">Veri akışı</span><span class="sxs-lookup"><span data-stu-id="93eda-136">Dataflow</span></span>](dataflow-task-parallel-library.md)
