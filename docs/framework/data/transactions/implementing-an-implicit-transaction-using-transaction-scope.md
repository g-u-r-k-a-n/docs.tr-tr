---
title: İşlem Kapsamı Kullanarak Örtük İşlem Uygulama
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 49d1706a-1e0c-4c85-9704-75c908372eb9
ms.openlocfilehash: e3af361f4268e9a83efe4d28547dc95fc242633e
ms.sourcegitcommit: ad800f019ac976cb669e635fb0ea49db740e6890
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/29/2019
ms.locfileid: "73040209"
---
# <a name="implementing-an-implicit-transaction-using-transaction-scope"></a><span data-ttu-id="d0ea0-102">İşlem Kapsamı Kullanarak Örtük İşlem Uygulama</span><span class="sxs-lookup"><span data-stu-id="d0ea0-102">Implementing an Implicit Transaction using Transaction Scope</span></span>
<span data-ttu-id="d0ea0-103"><xref:System.Transactions.TransactionScope> sınıfı, bir kod bloğunu işlem kendisiyle etkileşime girmeden bir işleme katıldıkları şekilde işaretlemek için basit bir yol sağlar.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-103">The <xref:System.Transactions.TransactionScope> class provides a simple way to mark a block of code as participating in a transaction, without requiring you to interact with the transaction itself.</span></span> <span data-ttu-id="d0ea0-104">İşlem kapsamı, ortam işlemini otomatik olarak seçebilir ve yönetebilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-104">A transaction scope can select and manage the ambient transaction automatically.</span></span> <span data-ttu-id="d0ea0-105">Kullanım kolaylığı ve verimlilik nedeniyle, bir işlem uygulaması geliştirirken <xref:System.Transactions.TransactionScope> sınıfını kullanmanız önerilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-105">Due to its ease of use and efficiency, it is recommended that you use the <xref:System.Transactions.TransactionScope> class when developing a transaction application.</span></span>  
  
 <span data-ttu-id="d0ea0-106">Ayrıca, işlemle birlikte listeleme kaynaklarına gerek kalmaz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-106">In addition, you do not need to enlist resources explicitly with the transaction.</span></span> <span data-ttu-id="d0ea0-107">Herhangi bir <xref:System.Transactions> Resource Manager (SQL Server 2005 gibi), kapsam tarafından oluşturulan bir ortam işleminin varlığını algılayabilir ve otomatik olarak listeleme yapabilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-107">Any <xref:System.Transactions> resource manager (such as SQL Server 2005) can detect the existence of an ambient transaction created by the scope and automatically enlist.</span></span>  
  
## <a name="creating-a-transaction-scope"></a><span data-ttu-id="d0ea0-108">İşlem kapsamı oluşturma</span><span class="sxs-lookup"><span data-stu-id="d0ea0-108">Creating a transaction scope</span></span>  
 <span data-ttu-id="d0ea0-109">Aşağıdaki örnek, bir basit kullanımını gösterir <xref:System.Transactions.TransactionScope> sınıfı.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-109">The following sample shows a simple usage of the <xref:System.Transactions.TransactionScope> class.</span></span>  
  
 [!code-csharp[TransactionScope#1](../../../../samples/snippets/csharp/VS_Snippets_Remoting/TransactionScope/cs/ScopeWithSQL.cs#1)]
 [!code-vb[TransactionScope#1](../../../../samples/snippets/visualbasic/VS_Snippets_Remoting/TransactionScope/vb/ScopeWithSQL.vb#1)]  
  
 <span data-ttu-id="d0ea0-110">Yeni bir <xref:System.Transactions.TransactionScope> nesnesi oluşturduktan sonra işlem kapsamı başlatılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-110">The transaction scope is started once you create a new <xref:System.Transactions.TransactionScope> object.</span></span>  <span data-ttu-id="d0ea0-111">Kod örneğinde gösterildiği gibi, `using` bir ifadesiyle kapsam oluşturmanız önerilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-111">As illustrated in the code sample, it is recommended that you create scopes with a `using` statement.</span></span> <span data-ttu-id="d0ea0-112">`using` deyimin her ikisi de Visual Basic C# ve içinde kullanılabilir ve kapsamın doğru bir şekilde atıldığından emin olmak için bir`try`...`finally`bloğu gibi çalışıyor.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-112">The `using` statement is available both in C# and in Visual Basic, and works like a `try`...`finally` block to ensure that the scope is disposed of properly.</span></span>  
  
 <span data-ttu-id="d0ea0-113"><xref:System.Transactions.TransactionScope>örneklediğinizde, işlem Yöneticisi hangi hareketin katılacağı belirler.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-113">When you instantiate <xref:System.Transactions.TransactionScope>, the transaction manager determines which transaction to participate in.</span></span> <span data-ttu-id="d0ea0-114">Belirlendikten sonra, kapsam her zaman bu işleme katılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-114">Once determined, the scope always participates in that transaction.</span></span> <span data-ttu-id="d0ea0-115">Bu karar, iki etkene dayalıdır: bir ortam işleminin mevcut olup olmadığı ve oluşturucuda `TransactionScopeOption` parametresinin değeri.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-115">The decision is based on two factors: whether an ambient transaction is present and the value of the `TransactionScopeOption` parameter in the constructor.</span></span> <span data-ttu-id="d0ea0-116">Çevresel işlem, kodunuzun çalıştırıldığı işlemdir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-116">The ambient transaction is the transaction within which your code executes.</span></span> <span data-ttu-id="d0ea0-117"><xref:System.Transactions.Transaction> sınıfının statik <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> özelliğini çağırarak çevresel işleme bir başvuru elde edebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-117">You can obtain a reference to the ambient transaction by calling the static <xref:System.Transactions.Transaction.Current%2A?displayProperty=nameWithType> property of the <xref:System.Transactions.Transaction> class.</span></span> <span data-ttu-id="d0ea0-118">Bu parametrenin nasıl kullanıldığı hakkında daha fazla bilgi için, bu konunun [TransactionScopeOption kullanılarak işlem akışını yönetme](#ManageTxFlow) bölümüne bakın.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-118">For more information on how this parameter is used, see the [Managing transaction flow using TransactionScopeOption](#ManageTxFlow) section of this topic.</span></span>  
  
## <a name="completing-a-transaction-scope"></a><span data-ttu-id="d0ea0-119">İşlem kapsamını tamamlama</span><span class="sxs-lookup"><span data-stu-id="d0ea0-119">Completing a transaction scope</span></span>  
 <span data-ttu-id="d0ea0-120">Uygulamanız bir işlemde gerçekleştirmek istediği tüm işleri tamamladığında, işlem yöneticisini işleme için kabul edilebilir olduğunu bildirmek için <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWIthType> yöntemini yalnızca bir kez çağırmanız gerekir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-120">When your application completes all the work it wants to perform in a transaction, you should call the <xref:System.Transactions.TransactionScope.Complete%2A?displayProperty=nameWIthType> method only once to inform the transaction manager that it is acceptable to commit the transaction.</span></span> <span data-ttu-id="d0ea0-121">Çağrı yerleştirmek için çok iyi bir uygulamadır <xref:System.Transactions.TransactionScope.Complete%2A> son ifade olarak `using` blok.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-121">It is very good practice to put the call to <xref:System.Transactions.TransactionScope.Complete%2A> as the last statement in the `using` block.</span></span>  
  
 <span data-ttu-id="d0ea0-122">İşlem yöneticisi bunu bir sistem hatası olarak yorumladığı ya da işlemin kapsamında oluşturulan bir özel durumla eşdeğer olduğundan, bu yöntemi çağıramaması işlemi iptal eder.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-122">Failing to call this method aborts the transaction, because the transaction manager interprets this as a system failure, or equivalent to an exception thrown within the scope of the transaction.</span></span> <span data-ttu-id="d0ea0-123">Ancak, bu yöntemin çağrılması, işlem WIL 'nin uygulanabileceğini garanti etmez.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-123">However, calling this method does not guarantee that the transaction wil be committed.</span></span> <span data-ttu-id="d0ea0-124">Yalnızca durumlarınızın işlem yöneticisini bilgilendiren bir yoldur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-124">It is merely a way of informing the transaction manager of your status.</span></span> <span data-ttu-id="d0ea0-125"><xref:System.Transactions.TransactionScope.Complete%2A> yöntemini çağırdıktan sonra, <xref:System.Transactions.Transaction.Current%2A> özelliğini kullanarak çevresel işleme erişemeyecektir ve bunu yapmaya çalıştığınızda bir özel durum oluşur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-125">After calling the <xref:System.Transactions.TransactionScope.Complete%2A> method, you can no longer access the ambient transaction by using the <xref:System.Transactions.Transaction.Current%2A> property, and attempting to do so will result in an exception being thrown.</span></span>  
  
 <span data-ttu-id="d0ea0-126"><xref:System.Transactions.TransactionScope> nesnesi başlangıçta ilk kez oluşturulduysa, işlemi işlem yöneticisi tarafından yürütmek için gerçek iş, `using` bloğundaki kodun son satırından sonra oluşur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-126">If the <xref:System.Transactions.TransactionScope> object created the transaction initially, the actual work of committing the transaction by the transaction manager occurs after the last line of code in the `using` block.</span></span> <span data-ttu-id="d0ea0-127">İşlem oluşturamadığında, <xref:System.Transactions.CommittableTransaction.Commit%2A> <xref:System.Transactions.CommittableTransaction> nesnesinin sahibi tarafından her çağrıldığında işleme oluşur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-127">If it did not create the transaction, the commit occurs whenever <xref:System.Transactions.CommittableTransaction.Commit%2A> is called by the owner of the <xref:System.Transactions.CommittableTransaction> object.</span></span> <span data-ttu-id="d0ea0-128">Bu noktada, işlem yöneticisi kaynak yöneticilerini çağırır ve <xref:System.Transactions.TransactionScope.Complete%2A> yönteminin <xref:System.Transactions.TransactionScope> nesnesinde çağrılıp çağrılmayacağı temel alınarak bunları COMMIT veya Rollback olarak bilgilendirir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-128">At that point the transaction manager calls the resource managers and informs them to either commit or rollback, based on whether the <xref:System.Transactions.TransactionScope.Complete%2A> method was called on the <xref:System.Transactions.TransactionScope> object.</span></span>  
  
 <span data-ttu-id="d0ea0-129">`using` Bildirimi sağlar <xref:System.Transactions.TransactionScope.Dispose%2A> yöntemi <xref:System.Transactions.TransactionScope> nesne bile özel bir durum oluştuğunda çağrılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-129">The `using` statement ensures that the <xref:System.Transactions.TransactionScope.Dispose%2A> method of the <xref:System.Transactions.TransactionScope> object is called even if an exception occurs.</span></span> <span data-ttu-id="d0ea0-130"><xref:System.Transactions.TransactionScope.Dispose%2A> yöntemi işlem kapsamının sonunu işaretler.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-130">The <xref:System.Transactions.TransactionScope.Dispose%2A> method marks the end of the transaction scope.</span></span> <span data-ttu-id="d0ea0-131">Bu yöntemi çağırdıktan sonra oluşan özel durumlar işlemi etkilemeyebilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-131">Exceptions that occur after calling this method may not affect the transaction.</span></span> <span data-ttu-id="d0ea0-132">Bu yöntem aynı zamanda çevresel işlemi önceki durumuna geri yükler.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-132">This method also restores the ambient transaction to it previous state.</span></span>  
  
 <span data-ttu-id="d0ea0-133">Kapsam işlemi oluşturduğunda <xref:System.Transactions.TransactionAbortedException> oluşturulur ve işlem iptal edilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-133">A <xref:System.Transactions.TransactionAbortedException> is thrown if the scope creates the transaction, and the transaction is aborted.</span></span> <span data-ttu-id="d0ea0-134">İşlem Yöneticisi bir Işleme kararına ulaşamadıysanız bir <xref:System.Transactions.TransactionInDoubtException> oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-134">A <xref:System.Transactions.TransactionInDoubtException> is thrown if the transaction manager cannot reach a Commit decision.</span></span> <span data-ttu-id="d0ea0-135">İşlem yürütüldüğünden hiçbir özel durum oluşturulmaz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-135">No exception is thrown if the transaction is committed.</span></span>  
  
## <a name="rolling-back-a-transaction"></a><span data-ttu-id="d0ea0-136">Bir işlem geri alınıyor</span><span class="sxs-lookup"><span data-stu-id="d0ea0-136">Rolling back a transaction</span></span>  
 <span data-ttu-id="d0ea0-137">Bir işlemi geri almak istiyorsanız, işlem kapsamı içinde <xref:System.Transactions.TransactionScope.Complete%2A> yöntemini çağırmamalıdır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-137">If you want to rollback a transaction, you should not call the <xref:System.Transactions.TransactionScope.Complete%2A> method within the transaction scope.</span></span> <span data-ttu-id="d0ea0-138">Örneğin, kapsam içinde bir özel durum.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-138">For example, you can throw an exception within the scope.</span></span> <span data-ttu-id="d0ea0-139">İçindeki katıldığı işlem geri alınacaktır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-139">The transaction in which it participates in will be rolled back.</span></span>  
  
## <a name="ManageTxFlow"></a><span data-ttu-id="d0ea0-140">TransactionScopeOption kullanarak işlem akışını yönetme</span><span class="sxs-lookup"><span data-stu-id="d0ea0-140">Managing transaction flow using TransactionScopeOption</span></span>  
 <span data-ttu-id="d0ea0-141">İşlem kapsamı, aşağıdaki örnekteki `RootMethod` yönteminde olduğu gibi, kendi kapsamını kullanan bir yöntem içinde <xref:System.Transactions.TransactionScope> kullanan bir yöntemi çağırarak iç içe olabilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-141">Transaction scope can be nested by calling a method that uses a <xref:System.Transactions.TransactionScope> from within a method that uses its own scope, as is the case with the `RootMethod` method in the following example,</span></span>  
  
```csharp  
void RootMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        SomeMethod();
        scope.Complete();
    }
}

void SomeMethod()
{
    using(TransactionScope scope = new TransactionScope())
    {
        /* Perform transactional work here */
        scope.Complete();
    }
}
```  
  
 <span data-ttu-id="d0ea0-142">En üst işlem kapsamı kök kapsamı olarak adlandırılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-142">The top-most transaction scope is referred to as the root scope.</span></span>  
  
 <span data-ttu-id="d0ea0-143"><xref:System.Transactions.TransactionScope> sınıfı, kapsamın işlem davranışını tanımlayan <xref:System.Transactions.TransactionScopeOption>türünün bir numaralandırmasını kabul eden birkaç aşırı yüklü Oluşturucu sağlar.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-143">The <xref:System.Transactions.TransactionScope> class provides several overloaded constructors that accept an enumeration of the type <xref:System.Transactions.TransactionScopeOption>, which defines the transactional behavior of the scope.</span></span>  
  
 <span data-ttu-id="d0ea0-144">Bir <xref:System.Transactions.TransactionScope> nesnenin üç seçenek vardır:</span><span class="sxs-lookup"><span data-stu-id="d0ea0-144">A <xref:System.Transactions.TransactionScope> object has three options:</span></span>  
  
- <span data-ttu-id="d0ea0-145">Ortam işlemine katılır veya bir tane yoksa yeni bir tane oluşturun.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-145">Join the ambient transaction, or create a new one if one does not exist.</span></span>  
  
- <span data-ttu-id="d0ea0-146">Yeni bir kök kapsamı olun, yani yeni bir işlem başlatın ve bu işlemin kendi kapsamı içinde yeni çevresel işlem olmasını sağlayabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-146">Be a new root scope, that is, start a new transaction and have that transaction be the new ambient transaction inside its own scope.</span></span>  
  
- <span data-ttu-id="d0ea0-147">Bir işlemde bir işlem olmaz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-147">Not take part in a transaction at all.</span></span> <span data-ttu-id="d0ea0-148">Sonuç olarak ortam işlemi yoktur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-148">There is no ambient transaction as a result.</span></span>  
  
 <span data-ttu-id="d0ea0-149">Kapsam <xref:System.Transactions.TransactionScopeOption.Required>ile örneklenmiştir ve bir ortam işlemi mevcutsa, kapsam bu işlemi birleştirir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-149">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Required>, and an ambient transaction is present, the scope joins that transaction.</span></span> <span data-ttu-id="d0ea0-150">Diğer taraftan, ortam işlemi yoksa, kapsam yeni bir işlem oluşturur ve kök kapsamı olur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-150">If, on the other hand, there is no ambient transaction, then the scope creates a new transaction, and become the root scope.</span></span> <span data-ttu-id="d0ea0-151">Varsayılan değer budur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-151">This is the default value.</span></span> <span data-ttu-id="d0ea0-152"><xref:System.Transactions.TransactionScopeOption.Required> kullanıldığında, kapsamın içindeki kodun, kök olup olmadığı veya yalnızca ortam hareketine katılması gibi farklı davranması gerekmez.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-152">When <xref:System.Transactions.TransactionScopeOption.Required> is used, the code inside the scope does not need to behave differently whether it is the root or just joining the ambient transaction.</span></span> <span data-ttu-id="d0ea0-153">Her iki durumda da aynı şekilde çalışması.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-153">It should operate identically in both cases.</span></span>  
  
 <span data-ttu-id="d0ea0-154">Kapsamı ile örneği varsa <xref:System.Transactions.TransactionScopeOption.RequiresNew>, her zaman bir kök kapsam olur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-154">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.RequiresNew>, it is always the root scope.</span></span> <span data-ttu-id="d0ea0-155">Yeni bir işlem başlatır ve işlem, kapsam içindeki yeni çevresel işlem haline gelir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-155">It starts a new transaction, and its transaction becomes the new ambient transaction inside the scope.</span></span>  
  
 <span data-ttu-id="d0ea0-156">Kapsam <xref:System.Transactions.TransactionScopeOption.Suppress>ile örneklendiğinden, bir ortam işleminin mevcut olup olmamasından bağımsız olarak hiçbir zaman bir işlemde yer almıyor.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-156">If the scope is instantiated with <xref:System.Transactions.TransactionScopeOption.Suppress>, it never takes part in a transaction, regardless of whether an ambient transaction is present.</span></span> <span data-ttu-id="d0ea0-157">Bu değerle örneklenen bir kapsam, her zaman çevresel işlem olarak `null` sahiptir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-157">A scope instantiated with this value always have `null` as its ambient transaction.</span></span>  
  
 <span data-ttu-id="d0ea0-158">Yukarıdaki seçenekleri aşağıdaki tabloda özetlenmiştir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-158">The above options are summarized in the following table.</span></span>  
  
|<span data-ttu-id="d0ea0-159">TransactionScopeOption</span><span class="sxs-lookup"><span data-stu-id="d0ea0-159">TransactionScopeOption</span></span>|<span data-ttu-id="d0ea0-160">Çevresel Işlem</span><span class="sxs-lookup"><span data-stu-id="d0ea0-160">Ambient Transaction</span></span>|<span data-ttu-id="d0ea0-161">Kapsam bölümü alır</span><span class="sxs-lookup"><span data-stu-id="d0ea0-161">The scope takes part in</span></span>|  
|----------------------------|-------------------------|-----------------------------|  
|<span data-ttu-id="d0ea0-162">Gerekli</span><span class="sxs-lookup"><span data-stu-id="d0ea0-162">Required</span></span>|<span data-ttu-id="d0ea0-163">Hayır</span><span class="sxs-lookup"><span data-stu-id="d0ea0-163">No</span></span>|<span data-ttu-id="d0ea0-164">Yeni Işlem (kök olacaktır)</span><span class="sxs-lookup"><span data-stu-id="d0ea0-164">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="d0ea0-165">Yeni gerektirir</span><span class="sxs-lookup"><span data-stu-id="d0ea0-165">Requires New</span></span>|<span data-ttu-id="d0ea0-166">Hayır</span><span class="sxs-lookup"><span data-stu-id="d0ea0-166">No</span></span>|<span data-ttu-id="d0ea0-167">Yeni Işlem (kök olacaktır)</span><span class="sxs-lookup"><span data-stu-id="d0ea0-167">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="d0ea0-168">Önle</span><span class="sxs-lookup"><span data-stu-id="d0ea0-168">Suppress</span></span>|<span data-ttu-id="d0ea0-169">Hayır</span><span class="sxs-lookup"><span data-stu-id="d0ea0-169">No</span></span>|<span data-ttu-id="d0ea0-170">Işlem yok</span><span class="sxs-lookup"><span data-stu-id="d0ea0-170">No Transaction</span></span>|  
|<span data-ttu-id="d0ea0-171">Gerekli</span><span class="sxs-lookup"><span data-stu-id="d0ea0-171">Required</span></span>|<span data-ttu-id="d0ea0-172">Evet</span><span class="sxs-lookup"><span data-stu-id="d0ea0-172">Yes</span></span>|<span data-ttu-id="d0ea0-173">Çevresel Işlem</span><span class="sxs-lookup"><span data-stu-id="d0ea0-173">Ambient  Transaction</span></span>|  
|<span data-ttu-id="d0ea0-174">Yeni gerektirir</span><span class="sxs-lookup"><span data-stu-id="d0ea0-174">Requires New</span></span>|<span data-ttu-id="d0ea0-175">Evet</span><span class="sxs-lookup"><span data-stu-id="d0ea0-175">Yes</span></span>|<span data-ttu-id="d0ea0-176">Yeni Işlem (kök olacaktır)</span><span class="sxs-lookup"><span data-stu-id="d0ea0-176">New Transaction (will be the root)</span></span>|  
|<span data-ttu-id="d0ea0-177">Önle</span><span class="sxs-lookup"><span data-stu-id="d0ea0-177">Suppress</span></span>|<span data-ttu-id="d0ea0-178">Evet</span><span class="sxs-lookup"><span data-stu-id="d0ea0-178">Yes</span></span>|<span data-ttu-id="d0ea0-179">Işlem yok</span><span class="sxs-lookup"><span data-stu-id="d0ea0-179">No Transaction</span></span>|  
  
 <span data-ttu-id="d0ea0-180">Bir <xref:System.Transactions.TransactionScope> nesnesi var olan bir ortam işlemine katıldığında kapsam nesnesini elden atma işlemi, kapsam işlemi iptal etmediği takdirde işlemi sonlandırmayabilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-180">When a <xref:System.Transactions.TransactionScope> object joins an existing ambient transaction, disposing of the scope object may not end the transaction, unless the scope aborts the transaction.</span></span> <span data-ttu-id="d0ea0-181">Ortam işlemi bir kök kapsam tarafından oluşturulduysa, yalnızca kök kapsamı bırakıldığında, işlem üzerinde <xref:System.Transactions.CommittableTransaction.Commit%2A> çağırılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-181">If the ambient transaction was created by a root scope, only when the root scope is disposed of, does <xref:System.Transactions.CommittableTransaction.Commit%2A> get called on the transaction.</span></span> <span data-ttu-id="d0ea0-182">İşlem el ile oluşturulduysa, işlem iptal edildiğinde ya da Oluşturucusu tarafından işlendiği zaman sona erer.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-182">If the transaction was created manually, the transaction ends when it is either aborted, or committed by its creator.</span></span>  
  
 <span data-ttu-id="d0ea0-183">Aşağıdaki örnekte gösterildiği bir <xref:System.Transactions.TransactionScope> üç iç içe kapsamlı nesneler, farklı bir her örneklenen oluşturan nesne <xref:System.Transactions.TransactionScopeOption> değeri.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-183">The following example shows a <xref:System.Transactions.TransactionScope> object that creates three nested scope objects, each instantiated with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
//Default is Required
{
    using(TransactionScope scope2 = new TransactionScope(TransactionScopeOption.Required))
    {
        //...
    }

    using(TransactionScope scope3 = new TransactionScope(TransactionScopeOption.RequiresNew))   
    {
        //...  
    }
  
    using(TransactionScope scope4 = new TransactionScope(TransactionScopeOption.Suppress))
    {
        //...  
    }
}
```  
  
 <span data-ttu-id="d0ea0-184">Örnek, <xref:System.Transactions.TransactionScopeOption.Required>ile yeni bir kapsam (`scope1`) oluşturan herhangi bir ortam işlemi olmadan bir kod bloğunu gösterir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-184">The example shows a code block without any ambient transaction creating a new scope (`scope1`) with <xref:System.Transactions.TransactionScopeOption.Required>.</span></span> <span data-ttu-id="d0ea0-185">`scope1` kapsam, yeni bir işlem (Işlem A) oluşturduğu ve Işlem bir ortam işlemi yaptığı için bir kök kapsamdır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-185">The scope `scope1` is a root scope as it creates a new transaction (Transaction A) and makes Transaction A the ambient transaction.</span></span> <span data-ttu-id="d0ea0-186">`Scope1`Daha sonra her farklı bir ile üç daha fazla nesne oluşturur <xref:System.Transactions.TransactionScopeOption> değeri.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-186">`Scope1` then creates three more objects, each with a different <xref:System.Transactions.TransactionScopeOption> value.</span></span> <span data-ttu-id="d0ea0-187">Örneğin, `scope2` <xref:System.Transactions.TransactionScopeOption.Required>ile oluşturulur ve ortam bir işlem olduğundan, `scope1`tarafından oluşturulan ilk işlemi birleştirir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-187">For example, `scope2` is created with <xref:System.Transactions.TransactionScopeOption.Required>, and since there is an ambient transaction, it joins the first transaction created by `scope1`.</span></span> <span data-ttu-id="d0ea0-188">`scope3` yeni bir işlemin kök kapsamı olduğunu ve `scope4` bir ortam işlemi olmadığını unutmayın.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-188">Note that `scope3` is the root scope of a new transaction, and that `scope4` has no ambient transaction.</span></span>  
  
 <span data-ttu-id="d0ea0-189">Değerini varsayılan ve en sık kullanılan olsa da <xref:System.Transactions.TransactionScopeOption> olan <xref:System.Transactions.TransactionScopeOption.Required>, her diğer değerlerinin benzersiz amacı vardır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-189">Although the default and most commonly used value of <xref:System.Transactions.TransactionScopeOption> is <xref:System.Transactions.TransactionScopeOption.Required>, each of the other values has its unique purpose.</span></span>  

### <a name="non-transactional-code-inside-a-transaction-scope"></a><span data-ttu-id="d0ea0-190">İşlem kapsamı içinde işlem olmayan kod</span><span class="sxs-lookup"><span data-stu-id="d0ea0-190">Non-transactional code inside a transaction scope</span></span>

 <span data-ttu-id="d0ea0-191"><xref:System.Transactions.TransactionScopeOption.Suppress>, kod bölümü tarafından gerçekleştirilen işlemleri korumak istediğinizde ve işlemler başarısız olursa çevresel işlemi durdurmak istemediğinizde yararlıdır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-191"><xref:System.Transactions.TransactionScopeOption.Suppress> is useful when you want to preserve the operations performed by the code section, and do not want to abort the ambient transaction if the operations fail.</span></span> <span data-ttu-id="d0ea0-192">Örneğin, günlüğe kaydetme veya denetim işlemleri gerçekleştirmek istediğinizde ya da çevresel işleminizi yürütmelerden veya iptal etmeksizin bağımsız olarak abonelere yayımlamak istediğinizde.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-192">For example, when you want to perform logging or audit operations, or when you want to publish events to subscribers regardless of whether your ambient transaction commits or aborts.</span></span> <span data-ttu-id="d0ea0-193">Bu değer, aşağıdaki örnekte gösterildiği gibi işlem kapsamı içinde işlem olmayan bir kod bölümüne sahip etmenize olanak tanır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-193">This value allows you to have a non-transactional code section inside a transaction scope, as shown in the following example.</span></span>  
  
```csharp  
using(TransactionScope scope1 = new TransactionScope())
{
    try
    {
        //Start of non-transactional section
        using(TransactionScope scope2 = new
            TransactionScope(TransactionScopeOption.Suppress))  
        {  
            //Do non-transactional work here  
        }  
        //Restores ambient transaction here
   }
   catch {}  
   //Rest of scope1
}
```  
  
### <a name="voting-inside-a-nested-scope"></a><span data-ttu-id="d0ea0-194">İç içe bir kapsam içinde oylama</span><span class="sxs-lookup"><span data-stu-id="d0ea0-194">Voting inside a nested scope</span></span>  
 <span data-ttu-id="d0ea0-195">İç içe kapsam, kök kapsamın çevresel hareketini birleştirebilse de, iç içe kapsamdaki <xref:System.Transactions.TransactionScope.Complete%2A> çağırmak kök kapsamda hiçbir etkisi olmaz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-195">Although a nested scope can join the ambient transaction of the root scope, calling <xref:System.Transactions.TransactionScope.Complete%2A> in the nested scope has no affect on the root scope.</span></span> <span data-ttu-id="d0ea0-196">Yalnızca kök kapsamdaki en son iç içe kapsama kadar olan tüm kapsamlar işlemi yürütmek için oy alırsanız işlem kaydedilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-196">Only if all the scopes from the root scope down to the last nested scope vote to commit the transaction, will the transaction be committed.</span></span> <span data-ttu-id="d0ea0-197">İç içe bir kapsamda <xref:System.Transactions.TransactionScope.Complete%2A> çağrılmayan kök kapsamı, ortam işlemi hemen iptal edilecek şekilde etkiler.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-197">Not calling <xref:System.Transactions.TransactionScope.Complete%2A> in a nested scope will affect the root scope as the ambient transaction will immediately be aborted.</span></span>  
  
## <a name="setting-the-transactionscope-timeout"></a><span data-ttu-id="d0ea0-198">TransactionScope zaman aşımını ayarlama</span><span class="sxs-lookup"><span data-stu-id="d0ea0-198">Setting the TransactionScope timeout</span></span>  
 <span data-ttu-id="d0ea0-199"><xref:System.Transactions.TransactionScope> aşırı yüklenmiş oluşturucularından bazıları, işlemin zaman aşımını denetlemek için kullanılan <xref:System.TimeSpan>türünde bir değer kabul eder.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-199">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a value of type <xref:System.TimeSpan>, which is used to control the timeout of the transaction.</span></span> <span data-ttu-id="d0ea0-200">Sıfır olarak ayarlanmış bir zaman aşımı sonsuz bir zaman aşımı anlamına gelir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-200">A timeout set to zero means an infinite timeout.</span></span> <span data-ttu-id="d0ea0-201">Sonsuz zaman aşımı genellikle hata ayıklama için yararlıdır, kodunuzda adım adım ilerleyerek iş mantığınızdaki bir sorunu yalıtmak istediğinizde ve sorunu bulmaya çalışırken hata ayıklama işlemini zaman aşımına uğratın.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-201">Infinite timeout is useful mostly for debugging, when you want to isolate a problem in your business logic by stepping through your code, and you do not want the transaction you debug to time out while you attempt to locate the problem.</span></span> <span data-ttu-id="d0ea0-202">Tüm diğer durumlarda sonsuz zaman aşımı değerini kullanırken son derece dikkatli olun, çünkü işlem kilitlenmeleri için korumaları geçersiz kılar.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-202">Be extremely careful using the infinite timeout value in all other cases, because it overrides the safeguards against transaction deadlocks.</span></span>  
  
 <span data-ttu-id="d0ea0-203">Genellikle ayarlanabilir <xref:System.Transactions.TransactionScope> zaman aşımına uğramak üzere iki durumda da varsayılan dışındaki değerler.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-203">You typically set the <xref:System.Transactions.TransactionScope> timeout to values other than default in two cases.</span></span> <span data-ttu-id="d0ea0-204">Birincisi geliştirme sırasında, uygulamanızın durdurulan işlemleri işleme biçimini test etmek istediğinizde olur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-204">The first is during development, when you want to test the way your application handles aborted transactions.</span></span> <span data-ttu-id="d0ea0-205">Zaman aşımını küçük bir değere (örneğin bir milisaniyelik) ayarlayarak, işlem başarısız olur ve bu nedenle hata işleme kodunuzu gözlemleyebilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-205">By setting the timeout to a small value (such as one millisecond), you cause your transaction to fail and can thus observe your error handling code.</span></span> <span data-ttu-id="d0ea0-206">Kapsam içinde kaynak talebi, söz konusu kilitlenmeleri kaynaklanan düşünüyorsanız, varsayılan zaman aşımı değerinden bir değere ayarlamanız ikinci durumdur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-206">The second case in which you set the value to be less than the default timeout is when you believe that the scope is involved in resource contention, resulting in deadlocks.</span></span> <span data-ttu-id="d0ea0-207">Bu durumda, işlemi en kısa sürede iptal etmek ve varsayılan zaman aşımı süresinin dolmasını beklemek istemezsiniz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-207">In that case, you want to abort the transaction as soon as possible and not wait for the default timeout to expire.</span></span>  
  
 <span data-ttu-id="d0ea0-208">Bir kapsam bir ortam işlemini birleşdiğinde, ancak ortam işleminin ayarlandığı değerden daha küçük bir zaman aşımı belirttiğinde, yeni ve daha kısa zaman aşımı <xref:System.Transactions.TransactionScope> nesnesinde zorlanır ve kapsam belirtilen iç içe geçen süre içinde bitmelidir veya işlem otomatik olarak iptal edildi.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-208">When a scope joins an ambient transaction but specifies a smaller timeout than the one the ambient transaction is set to, the new, shorter timeout is enforced on the <xref:System.Transactions.TransactionScope> object, and the scope must end within the nested time specified, or the transaction is automatically aborted.</span></span> <span data-ttu-id="d0ea0-209">İç içe geçmiş kapsamın zaman aşımı çevresel işlemden daha büyükse, hiçbir etkisi olmaz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-209">If the nested scope's timeout is more than that of the ambient transaction, it has no effect.</span></span>  
  
## <a name="setting-the-transactionscope-isolation-level"></a><span data-ttu-id="d0ea0-210">TransactionScope yalıtım düzeyini ayarlama</span><span class="sxs-lookup"><span data-stu-id="d0ea0-210">Setting the TransactionScope isolation level</span></span>  
 <span data-ttu-id="d0ea0-211"><xref:System.Transactions.TransactionScope> aşırı yüklenmiş oluşturucularından bazıları, bir zaman aşımı değerine ek olarak bir yalıtım düzeyi belirtmek için <xref:System.Transactions.TransactionOptions> türünde bir yapıyı kabul eder.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-211">Some of the overloaded constructors of <xref:System.Transactions.TransactionScope> accept a structure of type <xref:System.Transactions.TransactionOptions> to specify an isolation level, in addition to a timeout value.</span></span> <span data-ttu-id="d0ea0-212">Varsayılan olarak, işlem yalıtım düzeyiyle yürütülür ve <xref:System.Transactions.IsolationLevel.Serializable>olarak ayarlanır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-212">By default, the transaction executes with isolation level set to <xref:System.Transactions.IsolationLevel.Serializable>.</span></span> <span data-ttu-id="d0ea0-213">Başka bir yalıtım düzeyi seçme <xref:System.Transactions.IsolationLevel.Serializable> yaygın olarak okuma yoğun sistemleri için kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-213">Selecting an isolation level other than <xref:System.Transactions.IsolationLevel.Serializable> is commonly used for read-intensive systems.</span></span> <span data-ttu-id="d0ea0-214">Bunun için işlem işleme teorisi ve işlem semantiğinin, ilgili eşzamanlılık sorunlarının ve sistem tutarlılığı sonuçlarının bir katı şekilde anlaşılması gerekir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-214">This requires a solid understanding of transaction processing theory and the semantics of the transaction itself, the concurrency issues involved, and the consequences for system consistency.</span></span>  
  
 <span data-ttu-id="d0ea0-215">Ayrıca, tüm kaynak yöneticileri tüm yalıtım düzeylerini desteklemez ve bu işlem, bir şekilde, yapılandırılmış olandan daha yüksek bir düzeyde bir parça almak isteyebilir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-215">In addition, not all resource managers support all levels of isolation, and they may elect to take part in the transaction at a higher level than the one configured.</span></span>  
  
 <span data-ttu-id="d0ea0-216"><xref:System.Transactions.IsolationLevel.Serializable> yanı sıra her yalıtım düzeyi, aynı bilgilere erişen diğer işlemlerden kaynaklanan tutarsızlığa açıktır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-216">Every isolation level besides <xref:System.Transactions.IsolationLevel.Serializable> is susceptible to inconsistency resulting from other transactions accessing the same information.</span></span> <span data-ttu-id="d0ea0-217">Farklı yalıtım düzeyleri arasındaki farkı biçiminde okunur ve yazma kilitler kullanılır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-217">The difference between the different isolation levels is in the way read and write locks are used.</span></span> <span data-ttu-id="d0ea0-218">Bir kilit, yalnızca işlem Resource Manager 'daki verilere eriştiğinde tutulabilir veya işlem tamamlanana ya da durduruluncaya kadar tutulabilirler.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-218">A lock can be held only when the transaction accesses the data in the resource manager, or it can be held until the transaction is committed or aborted.</span></span> <span data-ttu-id="d0ea0-219">Eski verimlilik, tutarlılık ikincisi için iyidir.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-219">The former is better for throughput, the latter for consistency.</span></span> <span data-ttu-id="d0ea0-220">Kilit iki tür ve işlemleri (okuma/yazma) iki tür dört temel yalıtım düzeyi verin.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-220">The two kinds of locks and the two kinds of operations (read/write) give four basic isolation levels.</span></span> <span data-ttu-id="d0ea0-221">Daha fazla bilgi edinmek için bkz. <xref:System.Transactions.IsolationLevel>.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-221">See <xref:System.Transactions.IsolationLevel> for more information.</span></span>  
  
 <span data-ttu-id="d0ea0-222">İç içe <xref:System.Transactions.TransactionScope> nesneleri kullanılırken, tüm iç içe kapsamlar çevresel işleme katmak istiyorsanız tam olarak aynı yalıtım düzeyini kullanacak şekilde yapılandırılmalıdır.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-222">When using nested <xref:System.Transactions.TransactionScope> objects, all nested scopes must be configured to use exactly the same isolation level if they want to join the ambient transaction.</span></span> <span data-ttu-id="d0ea0-223">İç içe bir <xref:System.Transactions.TransactionScope> nesnesi, farklı bir yalıtım düzeyi belirttiğinde, ancak bir <xref:System.ArgumentException> oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-223">If a nested <xref:System.Transactions.TransactionScope> object tries to join the ambient transaction yet it specifies a different isolation level, an <xref:System.ArgumentException> is thrown.</span></span>  
  
## <a name="interop-with-com"></a><span data-ttu-id="d0ea0-224">COM + ile birlikte çalışma</span><span class="sxs-lookup"><span data-stu-id="d0ea0-224">Interop with COM+</span></span>  
 <span data-ttu-id="d0ea0-225">Yeni bir <xref:System.Transactions.TransactionScope> örneği oluşturduğunuzda, COM+ ile nasıl etkileşim kuracağınızı belirtmek için oluşturuculardan birinde <xref:System.Transactions.EnterpriseServicesInteropOption> numaralandırmayı kullanabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-225">When you create a new <xref:System.Transactions.TransactionScope> instance, you can use the <xref:System.Transactions.EnterpriseServicesInteropOption> enumeration in one of the constructors to specify how to interact with COM+.</span></span> <span data-ttu-id="d0ea0-226">Bu konuda daha fazla bilgi için bkz. [Enterprise Services ve com+ işlemleri Ile birlikte çalışabilirlik](interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="d0ea0-226">For more information on this, see [Interoperability with Enterprise Services and COM+ Transactions](interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d0ea0-227">Ayrıca bkz.</span><span class="sxs-lookup"><span data-stu-id="d0ea0-227">See also</span></span>

- <xref:System.Transactions.Transaction.Clone%2A>
- <xref:System.Transactions.TransactionScope>
