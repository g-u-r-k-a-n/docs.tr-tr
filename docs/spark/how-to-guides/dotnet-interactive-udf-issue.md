---
title: Apache Spark etkileşimli ortamlar için .NET 'te UDF 'Leri yazın ve çağırın.
description: Apache Spark etkileşimli kabuklar için .NET 'te UDF 'Leri yazmayı ve çağırmayı öğrenin.
ms.date: 10/09/2020
ms.topic: conceptual
ms.custom: mvc,how-to
ms.openlocfilehash: d02ce7ec92ac1758b490b66d241d4957082eb20e
ms.sourcegitcommit: eb7e87496f42361b1da98562dd75b516c9d58bbc
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 10/09/2020
ms.locfileid: "91877965"
---
# <a name="write-and-call-udfs-in-net-for-apache-spark-interactive-environments"></a><span data-ttu-id="10f00-103">Apache Spark etkileşimli ortamlar için .NET 'te UDF 'Leri yazın ve çağırın</span><span class="sxs-lookup"><span data-stu-id="10f00-103">Write and call UDFs in .NET for Apache Spark interactive environments</span></span>

<span data-ttu-id="10f00-104">Bu makalede, bir .NET Apache Spark etkileşimli ortamında Kullanıcı tanımlı Işlevlerin (UDF) nasıl kullanılacağını öğreneceksiniz.</span><span class="sxs-lookup"><span data-stu-id="10f00-104">In this article you will learn how to use User Defined Functions (UDFs) in a .NET for Apache Spark interactive environment.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="10f00-105">Ön koşullar</span><span class="sxs-lookup"><span data-stu-id="10f00-105">Prerequisites</span></span>

1. <span data-ttu-id="10f00-106">[.Net etkileşimli](https://github.com/dotnet/interactive) 'i yükler</span><span class="sxs-lookup"><span data-stu-id="10f00-106">Install [.NET Interactive](https://github.com/dotnet/interactive)</span></span>
2. <span data-ttu-id="10f00-107">[Jupyıter Laboratuvarı](https://jupyter.org/) 'nı yükler</span><span class="sxs-lookup"><span data-stu-id="10f00-107">Install [Jupyter lab](https://jupyter.org/)</span></span>

## <a name="net-for-apach-spark-interactive-experience"></a><span data-ttu-id="10f00-108">Apach Spark etkileşimli deneyimi için .NET</span><span class="sxs-lookup"><span data-stu-id="10f00-108">.NET for Apach Spark Interactive experience</span></span>

<span data-ttu-id="10f00-109">[.Net Apache Spark](https://github.com/dotnet/spark) , Spark içinde etkileşimli deneyim için .NET desteği sağlamak üzere [.net etkileşimli](https://devblogs.microsoft.com/dotnet/net-interactive-is-here-net-notebooks-preview-2/) kullanır.</span><span class="sxs-lookup"><span data-stu-id="10f00-109">[.NET for Apache Spark](https://github.com/dotnet/spark) uses [.NET Interactive](https://devblogs.microsoft.com/dotnet/net-interactive-is-here-net-notebooks-preview-2/) to provide .NET support for interactive experience inside Spark.</span></span> <span data-ttu-id="10f00-110">Jupi Not defterleri ile .NET etkileşimli 'ni denemek üzere ortamı nasıl ayarlayabileceğinizi anlamak için bkz. [.net etkileşimli deposu](https://github.com/dotnet/interactive).</span><span class="sxs-lookup"><span data-stu-id="10f00-110">To understand how to setup the environment to try .NET Interactive with Jupyter notebooks, see the [.NET Interactive repository](https://github.com/dotnet/interactive).</span></span>

<span data-ttu-id="10f00-111">Ayrıca, UDF 'Leri ne olduğunu ve Apache Spark için .NET ' te nasıl serileştirildiğini anlamak için [Apache Spark .net 'TEKI UDF serileştirme ile ilgili bu makaleye](udf-guide.md) gitmeniz önerilir.</span><span class="sxs-lookup"><span data-stu-id="10f00-111">Also, it is recommended to go through [this article about UDF serialization in .NET for Apache Spark](udf-guide.md) to understand what UDFs are and how they are serialized in .NET for Apache Spark.</span></span>
<span data-ttu-id="10f00-112">Bu kılavuzda, etkileşimli bir deneyimde UDF 'Leri nasıl kullanacağınızı göstermek için Jupyıter Not defterleri kullanılmaktadır.</span><span class="sxs-lookup"><span data-stu-id="10f00-112">This guide uses Jupyter Notebooks to illustrate how to use UDFs in an interactive experience.</span></span>

## <a name="define-a-udf-in-net-interactive"></a><span data-ttu-id="10f00-113">.NET etkileşimli 'da UDF tanımlama</span><span class="sxs-lookup"><span data-stu-id="10f00-113">Define a UDF in .NET Interactive</span></span>

<span data-ttu-id="10f00-114">Etkileşimli deneyimde bir hücre, bir [REPL](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop)yinelemesinin parçası olarak gönderilen kod parçacığı olarak düşünülebilir.</span><span class="sxs-lookup"><span data-stu-id="10f00-114">In the interactive experience, a cell can be thought of as the code snippet being submitted as part of one iteration of the [REPL](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop).</span></span> <span data-ttu-id="10f00-115">Örneğin, şu anlama geldiğini anlamak için aşağıdaki not defterine göz atın:</span><span class="sxs-lookup"><span data-stu-id="10f00-115">For example, take a look at the following notebook to understand what that means:</span></span>

![Jupyter Notebook hücreleri](./media/dotnet-interactive/dotnet-interactive-cells.png)

<span data-ttu-id="10f00-117">Kırmızı ok tarafından işaretlenen blokların her biri, bir hücredir veya kodun Spark 'a gönderilmesi.</span><span class="sxs-lookup"><span data-stu-id="10f00-117">Each of those blocks marked by the red arrow is one cell, or one submission of code to Spark.</span></span> <span data-ttu-id="10f00-118">Artık Kullanıcı tanımlı özel bir nesneye başvuran bir UDF tanımlarken, UDF 'nin başvurduğu nesnenin tanımlandığı hücrede tanımlanması gerekir.</span><span class="sxs-lookup"><span data-stu-id="10f00-118">Now when defining a UDF that references a custom user-defined object, it is required that the UDF be defined in the same cell where the object it references is defined.</span></span> <span data-ttu-id="10f00-119">Örnek olarak şöyle göründüğünü inceleyelim:</span><span class="sxs-lookup"><span data-stu-id="10f00-119">Let's look at what that looks like as an example:</span></span>

![Çalışma UDF](./media/dotnet-interactive/working-udf.png)

## <a name="call-a-udf-on-a-dataframe"></a><span data-ttu-id="10f00-121">DataFrame üzerinde UDF çağrısı yapın</span><span class="sxs-lookup"><span data-stu-id="10f00-121">Call a UDF on a DataFrame</span></span>

<span data-ttu-id="10f00-122">Önceden tanımlanmış bir UDF 'yi bir üzerinde çağırırken, bir `DataFrame` Önceki örnekte görünebilmesi için, daha önce gönderilen bir HÜCREDE UDF 'nin tanımlandığından emin olmak önemlidir.</span><span class="sxs-lookup"><span data-stu-id="10f00-122">When calling a previously defined UDF on a `DataFrame` it is important to make sure the UDF is defined in a previously submitted cell, before calling it, as can be seen in the previous example.</span></span>

<span data-ttu-id="10f00-123">Şimdi UDF 'yi, tanımlandığı hücrede çağırdığımızda ne olacağını görelim.</span><span class="sxs-lookup"><span data-stu-id="10f00-123">Now let's see what happens if we call the UDF in the same cell where it is defined.</span></span>

![UDF çağrısı başarısız](./media/dotnet-interactive/udf_fails.png)

<span data-ttu-id="10f00-125">Yukarıdaki vurgulanan hata, UDF derlemelerinin bir veri çerçevesinde çağrılabilmesi için önce derlenmesi ve çalışanlara sevk edilmemesinden kaynaklanır.</span><span class="sxs-lookup"><span data-stu-id="10f00-125">The above highlighted error is because the UDF assemblies need to first be compiled and shipped to the workers before it can be called on a DataFrame.</span></span>

<span data-ttu-id="10f00-126">Bunlar, Apache Spark etkileşimli deneyimle ( [Azure SYNAPSE Not defterleri](https://docs.microsoft.com/azure/synapse-analytics/spark/apache-spark-development-using-notebooks)gibi), .net 'Te UDF 'leri uygularken göz önünde bulundurmanız gereken birkaç önemli şey vardır.</span><span class="sxs-lookup"><span data-stu-id="10f00-126">These are a few important things to keep in mind while implementing UDFs in .NET for Apache Spark interactive experience (such as [Azure Synapse Notebooks](https://docs.microsoft.com/azure/synapse-analytics/spark/apache-spark-development-using-notebooks)).</span></span>

## <a name="faqs"></a><span data-ttu-id="10f00-127">SSS</span><span class="sxs-lookup"><span data-stu-id="10f00-127">FAQs</span></span>

1. <span data-ttu-id="10f00-128">**UDF 'im özel kullanıcı tanımlı bir nesneye neden başvuruyor `Type Submission#_ is not marked as serializable` ?**</span><span class="sxs-lookup"><span data-stu-id="10f00-128">**Why does my UDF referencing a custom user-defined object throws the error `Type Submission#_ is not marked as serializable`?**</span></span>  
    <span data-ttu-id="10f00-129">.NET etkileşimli, gönderilen her hücreyi benzersiz bir şekilde tanımlamak için bu hücrelerden her birini hücre gönderim numarasının bir sarmalayıcı sınıfıyla sarmalar.</span><span class="sxs-lookup"><span data-stu-id="10f00-129">.NET Interactive wraps each of these cells with a wrapper class of the cell submission number, to uniquely identify each cell being submitted.</span></span> <span data-ttu-id="10f00-130">Artık [Bu kılavuzda](udf-guide.md)ayrıntılı olarak açıklandığı gibi, özel bir nesneye başvuran bir UDF 'nin hedefi, .net etkileşimli olması durumunda özel nesnenin tanımlandığı hücrenin sarmalayıcı sınıfı tarafından sarmalanması durumunda serileştirme için de oluşturulur.</span><span class="sxs-lookup"><span data-stu-id="10f00-130">Now as explained in detail in [this guide](udf-guide.md), when a UDF that references a custom object is being serialized its target is also picked up for serialization, which in the case of .NET Interactive gets wrapped by the wrapper class of the cell where the custom object is defined.</span></span>
   <span data-ttu-id="10f00-131">Şimdi bunu, not defterinde UDF tanımımızı nasıl etkilediğini görelim:</span><span class="sxs-lookup"><span data-stu-id="10f00-131">Now let's see how that affects our UDF definition in the notebook:</span></span>

    ![UDF serileştirme hatası](./media/dotnet-interactive/udf-serialization-error.png)

    <span data-ttu-id="10f00-133">Bu durumda görünebileceği gibi `udf2_fails` , türü seri hale getirilebilir olarak işaretlenmemiş olan bir hata iletisi görüyoruz `Submission#7` . bunun nedeni, .net etkileşimli çalışma 'nin bir hücrede tanımlanan her nesneyi, bir hücrede tanımlanmış ve bu nedenle `Submission#` olarak işaretlenmediği, bu nedenle hata olarak işaretlendiğine yönelik bir durumdur `Serializable` .</span><span class="sxs-lookup"><span data-stu-id="10f00-133">As can be seen in the case of `udf2_fails`, we see the error message which says Type `Submission#7` is not marked as serializable, this is because how .NET Interactive works is it wraps every object defined in a cell with its `Submission#` class which is generated on the fly and hence is not marked as `Serializable`, hence the error.</span></span>
    <span data-ttu-id="10f00-134">Bu nedenle, **içindeki özel bir nesneye başvuran BIR UDF, o nesneyle aynı hücrede tanımlanmış olması gerekir**.</span><span class="sxs-lookup"><span data-stu-id="10f00-134">For this reason, it is **required that a UDF referencing a custom object in it, is defined in the same cell as that object**.</span></span>

2. <span data-ttu-id="10f00-135">**Yayın değişkenlerinin neden .NET etkileşimli ile çalışmıyor?**</span><span class="sxs-lookup"><span data-stu-id="10f00-135">**Why Broadcast Variables don't work with .NET Interactive?**</span></span>  
    <span data-ttu-id="10f00-136">Yukarıda açıklanan nedenlerden dolayı yayın değişkenleri .NET etkileşimli ile çalışmaz.</span><span class="sxs-lookup"><span data-stu-id="10f00-136">For the reasons explained above, broadcast variables don't work with .NET Interactive.</span></span> <span data-ttu-id="10f00-137">Yayın değişkenlerinin ne olduğunu ve bunların nasıl kullanılacağını daha ayrıntılı bir şekilde anlamak için [yayın değişkenlerinde bu kılavuzdan](broadcast-guide.md) geçmek iyi bir fikirdir.</span><span class="sxs-lookup"><span data-stu-id="10f00-137">It is a good idea to go through [this guide on broadcast variables](broadcast-guide.md) to get a deeper understanding of what broadcast variables are and how to use them.</span></span> <span data-ttu-id="10f00-138">Yayın değişkenlerinin etkileşimli senaryolarla çalışmamasının nedeni, .NET etkileşimli 'in, bir hücrede tanımlanan her nesneyi, seri hale getirilebilir olarak işaretlenmemiş, ancak daha önce gösterildiği gibi aynı özel durumla başarısız olan hücre gönderim sınıfıyla birlikte ekleme tasarımının olduğu durumdur.</span><span class="sxs-lookup"><span data-stu-id="10f00-138">The reason broadcast variables don't work with interactive scenarios is because of .NET interactive's design of appending each object defined in a cell with it's cell submission class, which since is not marked serializable, fails with the same exception as shown previously.</span></span>
   <span data-ttu-id="10f00-139">Aşağıdaki örnekte biraz daha ayrıntılı bilgi verelim:</span><span class="sxs-lookup"><span data-stu-id="10f00-139">Let's dive a little deeper with the following example:</span></span>

    ![Yayın değişkenleri başarısız](./media/dotnet-interactive/broadcast-fails.png)

    <span data-ttu-id="10f00-141">Önceki bölümlerde önerildiği gibi, aynı hücrede hem UDF 'yi hem de başvurduğu nesneyi (Bu durumda yayın değişkeni) tanımlayacağız, ancak yine de `SerializationException` `Microsoft.Spark.Sql.Session` seri hale getirilebilir olarak işaretlenmeyen hata şikayetinizi görtik.</span><span class="sxs-lookup"><span data-stu-id="10f00-141">As recommended in the previous sections, we define both the UDF and the object it is referencing (broadcast variable in this case) in the same cell, but we still see the `SerializationException` error complaining about `Microsoft.Spark.Sql.Session` not being marked as serializable.</span></span> <span data-ttu-id="10f00-142">Bunun nedeni, derleyicinin yayın değişkeni nesnesini serileştirmesine çalıştığında `bv` , adının [`SparkSession`](https://github.com/dotnet/spark/blob/master/src/csharp/Microsoft.Spark/Sql/SparkSession.cs#L20) `spark` seri hale getirilebilir olarak işaretlenmesi için gereken bir nesne ile ekleneceğini bulur.</span><span class="sxs-lookup"><span data-stu-id="10f00-142">This is because when the compiler tries to serialize the broadcast variable object `bv`, it finds its name to be appended with [`SparkSession`](https://github.com/dotnet/spark/blob/master/src/csharp/Microsoft.Spark/Sql/SparkSession.cs#L20) object `spark` which it requires to be marked as serializable.</span></span> <span data-ttu-id="10f00-143">Bu hücre gönderimi, derlenmiş derleme derlemesinde göz önünde bulundurularak daha kolay bir şekilde gösterilmiştir:</span><span class="sxs-lookup"><span data-stu-id="10f00-143">This can be demonstrated with more ease by taking a peek at the decompiled assembly of this cell submission:</span></span>

    ![Ayrıştırılmış derleme kodu](./media/dotnet-interactive/decompiledAssembly.png)

    <span data-ttu-id="10f00-145">Sınıfı olarak işaretliyoruz, bu özelliği işe sunabiliyoruz, [`SparkSession`](https://github.com/dotnet/spark/blob/master/src/csharp/Microsoft.Spark/Sql/SparkSession.cs#L20) `[Serializable]` ancak kullanıcıya bir mini oturum nesnesini seri hale getirme yeteneği vermek istemediğimiz için bu ideal bir çözüm değildir.</span><span class="sxs-lookup"><span data-stu-id="10f00-145">If we mark the [`SparkSession`](https://github.com/dotnet/spark/blob/master/src/csharp/Microsoft.Spark/Sql/SparkSession.cs#L20) class as `[Serializable]`, we can get this to work, but this is not an ideal solution as we don't want to give the user the ability to serialize a SparkSession object, as that could lead to some very weird undesirable behavior.</span></span> <span data-ttu-id="10f00-146">Bu bilinen bir sorundur ve [burada](https://github.com/dotnet/spark/issues/619) izlenmekte ve gelecek sürümlerde çözülecektir.</span><span class="sxs-lookup"><span data-stu-id="10f00-146">This is a known issue and being tracked [here](https://github.com/dotnet/spark/issues/619) and will be resolved in future versions.</span></span>
